# 2. ì „ì²´ ê³„ì¸µ êµ¬ì¡° ê°œìš” (Layered Architecture)

## ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ë€?

### 1. ê°œë… ì •ì˜

**ê³„ì¸µí˜• ì•„í‚¤í…ì²˜**ë€, ì• í”Œë¦¬ì¼€ì´ì…˜ì„ **ê¸°ëŠ¥ì´ë‚˜ ì±…ì„ì— ë”°ë¼ ìˆ˜ì§ì ìœ¼ë¡œ ê³„ì¸µí™”í•˜ì—¬ ë¶„ë¦¬**í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ì•„í‚¤í…ì²˜ íŒ¨í„´ì´ë‹¤.
 ê° ê³„ì¸µì€ **ìì‹ ë³´ë‹¤ í•˜ìœ„ ê³„ì¸µì—ë§Œ ì˜ì¡´**í•˜ê³ , ìƒìœ„ ê³„ì¸µê³¼ëŠ” **ì˜ì¡´í•˜ì§€ ì•Šë„ë¡** ì„¤ê³„ëœë‹¤.

> ğŸ¯ ëª©ì : **ì±…ì„ì˜ ë¶„ë¦¬ (Separation of Concerns)**
>  ğŸ¯ ì¥ì : **ìœ ì§€ë³´ìˆ˜ì„±, í…ŒìŠ¤íŠ¸ ìš©ì´ì„±, í™•ì¥ì„±, ì¬ì‚¬ìš©ì„±**

------

### 2. ê¸°ë³¸ ê³„ì¸µ êµ¬ì„± (5ê³„ì¸µ êµ¬ì¡° ê¸°ì¤€)

| ê³„ì¸µëª…                                 | ëŒ€í‘œ ì–´ë…¸í…Œì´ì…˜/êµ¬ì„±             | ì£¼ìš” ì±…ì„                                         |
| -------------------------------------- | -------------------------------- | ------------------------------------------------- |
| **í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ** (Controller)     | `@Controller`, `@RestController` | ì‚¬ìš©ì ìš”ì²­ ìˆ˜ì‹ , ì‘ë‹µ ë°˜í™˜, UI ë˜ëŠ” API ì¶œë ¥     |
| **ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ** (UseCase Layer)  | Application Service (ì„ íƒ)       | ìœ ìŠ¤ì¼€ì´ìŠ¤ ì‹¤í–‰, ë„ë©”ì¸ ê°ì²´ í˜¸ì¶œ, ì™¸ë¶€ ì—°ë™ ì¡°í•© |
| **ì„œë¹„ìŠ¤ ê³„ì¸µ** (Business Logic)       | `@Service`                       | ë„ë©”ì¸ ì¡°í•©, íŠ¸ëœì­ì…˜ ê´€ë¦¬, ì™¸ë¶€ API/DAO ì²˜ë¦¬     |
| **ë„ë©”ì¸ ê³„ì¸µ** (Entity, VO)           | `@Entity`, ë„ë©”ì¸ ì„œë¹„ìŠ¤         | í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ë³´ìœ , ë„ë©”ì¸ ìƒíƒœ ë³€ê²½         |
| **ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ** (Repository, DAO) | `@Repository`, `JpaRepository`   | DB ì ‘ê·¼, ì˜ì†ì„± ì²˜ë¦¬, ì¿¼ë¦¬ ìˆ˜í–‰                   |

------

### 3. ê³„ì¸µ ê°„ íë¦„ ì˜ˆì‹œ

```
ì‚¬ìš©ì ìš”ì²­ â†’ Controller â†’ Application/Service â†’ Domain â†’ Repository â†’ DB
```

#### ì˜ˆì‹œ: ì£¼ë¬¸ ìƒì„± íë¦„

```
OrderController
    â†“
OrderService (ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¸ëœì­ì…˜, ì¬ê³  ì²´í¬)
    â†“
Order (ë„ë©”ì¸ ì—”í‹°í‹°, ìƒíƒœ ë³€ê²½)
    â†“
OrderRepository (DB ì €ì¥)
```

------

### 4. ì˜ì¡´ì„± ë°©í–¥ ì›ì¹™

- `ìƒìœ„ ê³„ì¸µ â†’ í•˜ìœ„ ê³„ì¸µ` ìœ¼ë¡œë§Œ ì˜ì¡´í•¨.
- `í•˜ìœ„ ê³„ì¸µ â†’ ìƒìœ„ ê³„ì¸µ` ì˜ì¡´ì€ ê¸ˆì§€.
   (â†’ ì˜ì¡´ ì—­ì „ì´ í•„ìš”í•œ ê²½ìš°, ì¸í„°í˜ì´ìŠ¤ ì£¼ì… ë“±ìœ¼ë¡œ í•´ê²°)

```
âŒ Repository â†’ Service
âœ… Service â†’ Repository
```

------

### 5. ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ì˜ ì¥ì 

| ì¥ì             | ì„¤ëª…                                            |
| --------------- | ----------------------------------------------- |
| ğŸ¯ ëª¨ë“ˆí™”        | ê° ê³„ì¸µì„ ë…ë¦½ì ìœ¼ë¡œ ìˆ˜ì • ë° êµì²´ ê°€ëŠ¥          |
| ğŸ¯ í…ŒìŠ¤íŠ¸ ìš©ì´ì„± | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±ì´ ì‰½ê³  ì˜ì¡´ì„± ì£¼ì… êµ¬ì¡°ì— ì í•© |
| ğŸ¯ ìœ ì§€ë³´ìˆ˜ì„±    | ê¸°ëŠ¥ë³„ ì±…ì„ì´ ë¶„ë¦¬ë˜ì–´ ì´í•´í•˜ê¸° ì‰¬ì›€            |
| ğŸ¯ í™•ì¥ì„±        | ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ê³„ì¸µë³„ë¡œ ëª…í™•íˆ ìœ„ì¹˜ì‹œí‚¬ ìˆ˜ ìˆìŒ   |

------

### 6. ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ì˜ ë‹¨ì 

| ë‹¨ì                                        | ì„¤ëª…                                                      |
| ------------------------------------------ | --------------------------------------------------------- |
| ğŸ§± ìˆ˜ì§ì  êµ¬ì¡°ë¡œ ì¸í•œ í˜¸ì¶œ ë³µì¡ì„±           | ëª¨ë“  ìš”ì²­ì´ ìœ„â†’ì•„ë˜ë¡œ ë‹¨ê³„ë³„ í†µê³¼í•´ì•¼ í•˜ë¯€ë¡œ ëŠë¦´ ìˆ˜ ìˆìŒ |
| ğŸ” ì§€ë‚˜ì¹œ ê³„ì¸µ ë¶„ë¦¬ëŠ” ê³¼ë„í•œ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ | ê°„ë‹¨í•œ ê¸°ëŠ¥ë„ ì—¬ëŸ¬ ê³„ì¸µ ê±°ì³ì•¼ í•¨                         |
| âš  ë„ë©”ì¸ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì´ ì„ì¼ ìœ„í—˜   | ì—­í•  êµ¬ë¶„ì´ íë ¤ì§€ë©´ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›Œì§                  |

------

### 7. ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ vs ë‹¤ë¥¸ êµ¬ì¡°

| ì•„í‚¤í…ì²˜                     | íŠ¹ì§•                               |
| ---------------------------- | ---------------------------------- |
| Layered (ê³„ì¸µí˜•)             | ê°€ì¥ ê¸°ë³¸, ë‹¨ìˆœ ëª…ë£Œ               |
| Hexagonal (Ports & Adapters) | ì…ì¶œë ¥ê³¼ ë„ë©”ì¸ì„ ì™„ì „ ë¶„ë¦¬        |
| Clean Architecture           | ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„, ì˜ì¡´ì„± ì™„ì „ ë°˜ì „ |
| Onion Architecture           | ë„ë©”ì¸ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì›í˜• êµ¬ì¡°        |

------

### 8. Springì—ì„œ ê³„ì¸µ ì˜ˆì‹œ

```
// Controller (Presentation Layer)
@RestController
public class OrderController {
    private final OrderService orderService;
    public OrderController(OrderService orderService) { this.orderService = orderService; }

    @PostMapping("/orders")
    public ResponseEntity<Void> placeOrder(@RequestBody OrderRequest request) {
        orderService.placeOrder(request);
        return ResponseEntity.ok().build();
    }
}

// Service Layer
@Service
public class OrderService {
    private final OrderRepository orderRepository;
    public void placeOrder(OrderRequest request) {
        Order order = new Order(request.getItem(), request.getQuantity());
        orderRepository.save(order);
    }
}

// Repository Layer
@Repository
public interface OrderRepository extends JpaRepository<Order, Long> {}
```

## ì „í†µì  5ê³„ì¸µ êµ¬ì¡°ì˜ ì—­í• ê³¼ ê²½ê³„

### ğŸ§© 1. **í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ (Presentation Layer)**

**ì—­í• **: ì‚¬ìš©ì ìš”ì²­ ìˆ˜ì‹ , ì‘ë‹µ ë°˜í™˜
 **ì±…ì„**: UI ë˜ëŠ” API ì…ì¶œë ¥, HTTP ì²˜ë¦¬
 **ì£¼ìš” êµ¬ì„±**:

- `@Controller`, `@RestController`
- DTO ë³€í™˜ (`@RequestBody`, `@ResponseBody`)
- ê²€ì¦ (`@Valid`, `BindingResult`)
- View ë Œë”ë§ (`Thymeleaf`, `JSP`) or JSON ì‘ë‹µ

```
@RestController
@RequestMapping("/users")
public class UserController {
    private final UserService userService;
    
    @PostMapping
    public ResponseEntity<Void> createUser(@RequestBody @Valid UserCreateRequest dto) {
        userService.createUser(dto);
        return ResponseEntity.ok().build();
    }
}
```

ğŸ§­ **ê²½ê³„**: ì ˆëŒ€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•˜ì§€ ì•ŠìŒ.
 ì„œë¹„ìŠ¤ ê³„ì¸µì—ê²Œ ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ ìœ„ì„í•˜ê³ , DTO ë³€í™˜ì— ì§‘ì¤‘í•¨.

------

### âš™ï¸ 2. **ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ (Application Layer)** *(ì„ íƒì )*

**ì—­í• **: ìœ ìŠ¤ì¼€ì´ìŠ¤ ì¡°ë¦½ ë° ì‹¤í–‰
 **ì±…ì„**: ë„ë©”ì¸ ê°ì²´ ì¡°í•©, íŠ¸ëœì­ì…˜ ê´€ë¦¬, íë¦„ ì œì–´
 **ì£¼ìš” êµ¬ì„±**:

- ìœ ìŠ¤ì¼€ì´ìŠ¤ ì„œë¹„ìŠ¤ (`UserUseCase`, `OrderApplicationService`)
- ì™¸ë¶€ API ë˜ëŠ” DB ì—°ë™ ì¡°í•©
- ëª…ë ¹ ê°ì²´(Command), ê²°ê³¼ ê°ì²´(Result DTO)

```
@Service
public class RegisterUserUseCase {
    private final UserRepository userRepository;
    
    @Transactional
    public void register(UserCreateCommand cmd) {
        User user = new User(cmd.name(), cmd.email());
        userRepository.save(user);
    }
}
```

ğŸ§­ **ê²½ê³„**: ë„ë©”ì¸ ë¡œì§ì€ ì§ì ‘ ìˆ˜í–‰í•˜ì§€ ì•Šìœ¼ë©°, **ì¡°ìœ¨ì ì—­í• **ë§Œ ìˆ˜í–‰
 (â€» Application Layerë¥¼ ë¶„ë¦¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ì´ ì—­í• ì„ Service Layerê°€ ê²¸í•¨)

------

### ğŸ”§ 3. **ì„œë¹„ìŠ¤ ê³„ì¸µ (Service Layer)**

**ì—­í• **: ë„ë©”ì¸ ëª¨ë¸ê³¼ ì™¸ë¶€ ì„¸ê³„ì˜ ì—°ê²°
 **ì±…ì„**: íŠ¸ëœì­ì…˜ ê²½ê³„ ì„¤ì •, ë³µí•© ì‘ì—… ì‹¤í–‰, ë„ë©”ì¸/Repository í˜¸ì¶œ
 **ì£¼ìš” êµ¬ì„±**:

- `@Service` í´ë˜ìŠ¤
- `@Transactional` ì„ ì–¸ ìœ„ì¹˜
- ë„ë©”ì¸ ê·œì¹™ í˜¸ì¶œ, ë¦¬í¬ì§€í† ë¦¬ ì‚¬ìš©

```
@Service
public class OrderService {
    private final OrderRepository orderRepository;
    private final PaymentGateway paymentGateway;

    @Transactional
    public void placeOrder(OrderRequestDto dto) {
        Order order = new Order(dto.getItemId(), dto.getQuantity());
        paymentGateway.pay(dto.getPaymentInfo());
        orderRepository.save(order);
    }
}
```

ğŸ§­ **ê²½ê³„**: ë„ë©”ì¸ ê°ì²´ë¥¼ ì‚¬ìš©í•´ ë¡œì§ì„ ì‹¤í–‰í•˜ì§€ë§Œ, ì§ì ‘ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ êµ¬í˜„í•˜ì§€ ì•ŠìŒ.
 ê·¸ê±´ **ë„ë©”ì¸ ê³„ì¸µì˜ ì±…ì„**ì„.

------

### ğŸ§  4. **ë„ë©”ì¸ ê³„ì¸µ (Domain Layer)**

**ì—­í• **: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ í‘œí˜„í•˜ëŠ” ì¤‘ì‹¬ ê³„ì¸µ
 **ì±…ì„**: ìƒíƒœ ë³€ê²½, ê²€ì¦, ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìì²´
 **ì£¼ìš” êµ¬ì„±**:

- `@Entity` í´ë˜ìŠ¤
- ë„ë©”ì¸ ì„œë¹„ìŠ¤ (`OrderValidator`, `ShippingPolicy`)
- ë°¸ë¥˜ ì˜¤ë¸Œì íŠ¸ (`Money`, `Address`)
- ë„ë©”ì¸ ì´ë²¤íŠ¸

```
@Entity
public class Order {
    @Id @GeneratedValue
    private Long id;

    private int quantity;

    public void increase(int amount) {
        if (amount <= 0) throw new IllegalArgumentException();
        this.quantity += amount;
    }
}
```

ğŸ§­ **ê²½ê³„**: DB, ì›¹, ì™¸ë¶€ API ë“±ê³¼ ë¬´ê´€í•œ **ìˆœìˆ˜ Java ë¡œì§**ìœ¼ë¡œ êµ¬ì„±ë¨.
 ë„ë©”ì¸ì€ **ë¶ˆë³€ì„±, ìƒíƒœ ë³€ê²½, ìê¸° ì±…ì„ ì›ì¹™**ì„ ì¤€ìˆ˜í•´ì•¼ í•¨.

------

### ğŸ—„ 5. **ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ (Data Access Layer)**

**ì—­í• **: DB, íŒŒì¼ ë“± ì˜ì† ê³„ì¸µ ì ‘ê·¼
 **ì±…ì„**: ë°ì´í„° ì €ì¥, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ
 **ì£¼ìš” êµ¬ì„±**:

- `@Repository`
- `JpaRepository<T, ID>`
- MyBatis `@Mapper`
- Native Query, QueryDSL, `@Query`

```
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    Optional<User> findByEmail(String email);
}
```

ğŸ§­ **ê²½ê³„**: ë‹¨ìˆœ CRUD ì±…ì„ë§Œ ìˆìŒ.
 ë„ë©”ì¸ ê·œì¹™ íŒë‹¨ì€ í•˜ì§€ ì•ŠìŒ.
 ì„œë¹„ìŠ¤ ë˜ëŠ” ë„ë©”ì¸ ê³„ì¸µì´ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ íŒë‹¨í•˜ì—¬ ë¡œì§ ì‹¤í–‰.

------

### ğŸ”„ ê³„ì¸µ ê°„ ê´€ê³„ ìš”ì•½

```
ì‚¬ìš©ì â†’ Controller â†’ Service/Application â†’ Domain â†’ Repository â†’ DB
```

- ControllerëŠ” Serviceì—ê²Œ ìœ„ì„
- ServiceëŠ” Domain ê°ì²´ë¥¼ ì‚¬ìš©í•˜ê³  Repositoryë¡œ ì €ì¥
- Domainì€ ìŠ¤ìŠ¤ë¡œ ìƒíƒœë¥¼ ë°”ê¿ˆ
- RepositoryëŠ” DB ì‘ì—…ë§Œ ë‹´ë‹¹

------

### ğŸ¯ ì„¤ê³„ í•µì‹¬ í¬ì¸íŠ¸

| ê³„ì¸µ         | í•µì‹¬ ì›ì¹™                                      |
| ------------ | ---------------------------------------------- |
| Presentation | ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬ì—ë§Œ ì§‘ì¤‘                        |
| Application  | íë¦„ ì¡°ìœ¨, ìœ ìŠ¤ì¼€ì´ìŠ¤ ë‹¨ìœ„ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¸ëœì­ì…˜ |
| Service      | ë¹„ì¦ˆë‹ˆìŠ¤ ì„œë¹„ìŠ¤ ì¤‘ì‹¬, ë„ë©”ì¸ í˜¸ì¶œ ë° ì¡°í•©      |
| Domain       | ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì˜ ì£¼ì²´. ìƒíƒœ ë³€ê²½ì˜ ì¤‘ì‹¬         |
| Repository   | ê¸°ìˆ ì  ì„¸ë¶€ êµ¬í˜„ ìº¡ìŠí™”. DB ì‘ì—… ì „ë‹´          |

## ê° ê³„ì¸µ ê°„ ì˜ì¡´ì„± ë°©í–¥ê³¼ ì±…ì„

### ğŸ” 1. ì˜ì¡´ì„± ë°©í–¥ì´ë€?

**ê³„ì¸µ ê°„ ì˜ì¡´ì„± ë°©í–¥**ì€

> â€œì–´ë–¤ ê³„ì¸µì´ ì–´ë–¤ ê³„ì¸µì— ì˜ì¡´í•˜ëŠ”ê°€?â€
>  ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë°©í–¥ì„±ì„ ì˜ë¯¸í•´.

------

#### ğŸ”½ ê¸°ë³¸ ì›ì¹™ (ìƒìœ„ â†’ í•˜ìœ„ë¡œë§Œ ì˜ì¡´)

```
Presentation
    â†“
Application
    â†“
Service
    â†“
Domain
    â†“
Repository (Data Access)
```

- ìƒìœ„ ê³„ì¸µì€ **í•˜ìœ„ ê³„ì¸µì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ**
- í•˜ìœ„ ê³„ì¸µì€ **ìƒìœ„ ê³„ì¸µì„ ëª°ë¼ì•¼ í•¨**

ğŸ‘‰ ì´ë ‡ê²Œ ë˜ë©´ **ì˜ì¡´ì„± ì—­ì „ì´ í•„ìš” ì—†ìŒ**, êµ¬ì¡°ê°€ ë‹¨ìˆœí•´ì§.

------

### ğŸ§­ ê° ê³„ì¸µì˜ ì±…ì„ ë° ì˜ì¡´ ë°©í–¥

| ê³„ì¸µ                          | ì˜ì¡´ ëŒ€ìƒ                     | ì±…ì„                                    |
| ----------------------------- | ----------------------------- | --------------------------------------- |
| **Presentation** (ì»¨íŠ¸ë¡¤ëŸ¬)   | Application / Service         | ì‚¬ìš©ì ìš”ì²­ ì²˜ë¦¬, DTO ë§¤í•‘, ìœ íš¨ì„± ê²€ì¦ |
| **Application** (Use Case)    | Service, Domain, Repository   | ìœ ìŠ¤ì¼€ì´ìŠ¤ ì¡°ë¦½, íŠ¸ëœì­ì…˜ íë¦„ ì œì–´     |
| **Service** (ë¹„ì¦ˆë‹ˆìŠ¤ ì„œë¹„ìŠ¤) | Domain, Repository            | ë¹„ì¦ˆë‹ˆìŠ¤ íë¦„ ì¡°ì •, ì™¸ë¶€ API ì¡°í•©       |
| **Domain** (ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸)    | ì—†ìŒ (ê°€ëŠ¥í•˜ë©´ ìˆœìˆ˜í•˜ê²Œ ìœ ì§€) | ìƒíƒœ ê´€ë¦¬, ë„ë©”ì¸ ê·œì¹™ ì‹¤í–‰             |
| **Repository** (ë°ì´í„° ì ‘ê·¼)  | DB, JPA API ë“± ì™¸ë¶€ ê¸°ìˆ       | ë°ì´í„° ì €ì¥/ì¡°íšŒ/ì‚­ì œ, ê¸°ìˆ  ìº¡ìŠí™”      |

------

### ğŸ”„ ì˜ˆì‹œ íë¦„: íšŒì› ê°€ì…

```
[1] ì‚¬ìš©ìê°€ POST /users ìš”ì²­
    â†“
[2] UserController â†’ UserService í˜¸ì¶œ
    â†“
[3] UserService â†’ User ë„ë©”ì¸ ê°ì²´ ìƒì„±
    â†“
[4] UserService â†’ UserRepository.save()
    â†“
[5] UserRepository â†’ DB ì €ì¥
```

------

### âš ï¸ ê³„ì¸µ ê°„ ì˜ì¡´ ë°©í–¥ ìœ„ë°˜ ì‚¬ë¡€

#### âŒ Repository â†’ Service (ì—­ë°©í–¥ í˜¸ì¶œ)

```
// ì˜ëª»ëœ ì˜ˆì‹œ (ì ˆëŒ€ ê¸ˆì§€)
public class UserRepository {
    private final UserService userService; // âŒ ì˜ì¡´ì„± ë°©í–¥ ìœ„ë°˜
}
```

**ë¬¸ì œì **:

- ìˆœí™˜ ì°¸ì¡° ë°œìƒ ìœ„í—˜
- ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ ì›ì¹™ ìœ„ë°˜
- í…ŒìŠ¤íŠ¸ì™€ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€

------

### ğŸ’¡ ì¸í„°í˜ì´ìŠ¤ë¥¼ í™œìš©í•œ ì˜ì¡´ ì—­ì „ (í•„ìš”í•œ ê²½ìš°ë§Œ)

- **ë„ë©”ì¸ â†’ ì™¸ë¶€ ì‹œìŠ¤í…œ**ì— ì˜ì¡´í•  ê²½ìš°,
   ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•´ì„œ ì™¸ë¶€ êµ¬í˜„ì²´ë¥¼ ì£¼ì…í•˜ëŠ” êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ì•¼ í•´.

ì˜ˆì‹œ:

```
// ë„ë©”ì¸ ê³„ì¸µì— ì •ì˜ëœ ì¸í„°í˜ì´ìŠ¤
public interface NotificationSender {
    void sendWelcomeEmail(User user);
}
```

```
// ì¸í”„ë¼ ê³„ì¸µ êµ¬í˜„
@Service
public class EmailNotificationSender implements NotificationSender {
    public void sendWelcomeEmail(User user) {
        // SMTP or Kafka
    }
}
```

------

### ğŸ“Œ ê³„ì¸µë³„ ì±…ì„ ìš”ì•½

| ê³„ì¸µ         | ì±…ì„                         | í˜¸ì¶œ ëŒ€ìƒ           | í˜¸ì¶œ ì£¼ì²´                   |
| ------------ | ---------------------------- | ------------------- | --------------------------- |
| Presentation | ìš”ì²­ ì²˜ë¦¬, DTO ë³€í™˜          | Application/Service | ì‚¬ìš©ìì˜ ì§ì ‘ ìš”ì²­          |
| Application  | ìœ ìŠ¤ì¼€ì´ìŠ¤ ì¡°ë¦½              | Service, Domain     | Controller                  |
| Service      | ë¹„ì¦ˆë‹ˆìŠ¤ íë¦„, íŠ¸ëœì­ì…˜ ê²½ê³„ | Domain, Repository  | Application ë˜ëŠ” Controller |
| Domain       | ê·œì¹™ê³¼ ìƒíƒœì˜ ì¤‘ì‹¬           | ë‚´ë¶€ ë©”ì„œë“œ         | Service                     |
| Repository   | DB ì‘ì—…ë§Œ ìˆ˜í–‰               | DB                  | Service ë˜ëŠ” Application    |

------

### ğŸ” í…ŒìŠ¤íŠ¸ ê´€ì ì—ì„œì˜ ì´ì 

- ê° ê³„ì¸µì´ **ë‹¨ì¼ ì±…ì„**ë§Œ ê°€ì§€ê¸° ë•Œë¬¸ì—,
   mocking, stub, fake ë“±ì„ í†µí•´ **ê³„ì¸µë³„ í…ŒìŠ¤íŠ¸ ë¶„ë¦¬ ê°€ëŠ¥**
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±ì´ í›¨ì”¬ ìš©ì´í•¨.

------

### ğŸ“š ê³„ì¸µ ê°„ ì˜ì¡´ì„± ê´€ë¦¬ ë„êµ¬

- Spring DI (ìë™ ì£¼ì…)
- Interface ì„¤ê³„
- Bean ìŠ¤ì½”í”„ ê´€ë¦¬
- `@ComponentScan`, `@Configuration` í†µí•œ ëª¨ë“ˆí™”

------

### âœ… í•µì‹¬ ì •ë¦¬

| í•µì‹¬ ì›ì¹™        | ì„¤ëª…                                      |
| ---------------- | ----------------------------------------- |
| ğŸ” ë‹¨ë°©í–¥ ì˜ì¡´ì„±  | ìœ„ â†’ ì•„ë˜ë§Œ ì˜ì¡´, ì•„ë˜ â†’ ìœ„ ê¸ˆì§€          |
| ğŸ§¹ ì±…ì„ ë¶„ë¦¬      | ControllerëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ X, ServiceëŠ” View X |
| ğŸš« ìˆœí™˜ ì°¸ì¡° ë°©ì§€ | ê³„ì¸µ ê°„ ì„œë¡œ í˜¸ì¶œ X                       |
| ğŸ§ª í…ŒìŠ¤íŠ¸ í¸ì˜ì„±  | ê³„ì¸µ ë³„ mocking ê°€ëŠ¥                      |
| ğŸ“¦ í™•ì¥ì„±         | ê³„ì¸µ ë‹¨ìœ„ë¡œ êµì²´/ì¬ì„¤ê³„ ê°€ëŠ¥              |

## ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(Domain-Driven Design) ê´€ì ì—ì„œ ë³¸ ê³„ì¸µ êµ¬ì¡°

### ğŸ” 1. ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ë€?

DDDëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì„¤ê³„í•  ë•Œ, **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê°œë…(ë„ë©”ì¸)ì„ ì½”ë“œë¡œ ì§ì ‘ ëª¨ë¸ë§**í•˜ê³ ,
 **ê°œë°œìì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ì „ë¬¸ê°€ê°€ ë™ì¼í•œ ì–¸ì–´(Ubiquitous Language)**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ê°€ëŠ” ì ‘ê·¼ ë°©ì‹ì´ì•¼.

------

### ğŸ§± 2. DDDì˜ ì „í˜•ì ì¸ ê³„ì¸µ êµ¬ì¡° (4 Layer Architecture)

DDDì—ì„œëŠ” **ì „í†µì ì¸ ê³„ì¸µ ì•„í‚¤í…ì²˜ë¥¼ ë‹¤ìŒ ë„¤ ê°€ì§€ë¡œ ì¬êµ¬ì„±**í•´.

```
[1] Presentation Layer (ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ê³„ì¸µ)
[2] Application Layer (ì‘ìš© ê³„ì¸µ)
[3] Domain Layer (ë„ë©”ì¸ ê³„ì¸µ)
[4] Infrastructure Layer (ì¸í”„ë¼ ê³„ì¸µ)
```

#### êµ¬ì¡° ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Presentation          â”‚ â† ì‚¬ìš©ì ìš”ì²­/ì‘ë‹µ (API, UI)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Application           â”‚ â† ìœ ìŠ¤ì¼€ì´ìŠ¤ ì‹¤í–‰, íë¦„ ì¡°ìœ¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Domain                â”‚ â† í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ëª¨ë¸, ê·œì¹™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Infrastructure        â”‚ â† DB, ì™¸ë¶€ ì‹œìŠ¤í…œ, êµ¬í˜„ ê¸°ìˆ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

------

### ğŸ¯ 3. ê° ê³„ì¸µì˜ DDD ê´€ì  ì •ì˜ ë° ì±…ì„

------

#### ğŸ§© [1] Presentation Layer â€” ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ê³„ì¸µ

- **ì—­í• **: ì‚¬ìš©ìì™€ ì‹œìŠ¤í…œ ì‚¬ì´ì˜ ì¸í„°í˜ì´ìŠ¤ (API, ì›¹, CLI ë“±)
- **ì±…ì„**:
  - ì…ë ¥ì„ **DTO**ë¡œ ë°›ê³ , ì¶œë ¥ì„ DTOë¡œ ë³€í™˜í•˜ì—¬ ì‘ë‹µ
  - **Application Layerì˜ ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ í˜¸ì¶œ**
- **DDDì  ì‚¬ê³ **:
  - "ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ íŠ¸ë¦¬ê±°í•  ë¿ì´ë©°, ë„ë©”ì¸ì— ì§ì ‘ ê´€ì—¬í•˜ì§€ ì•ŠëŠ”ë‹¤."

------

#### âš™ï¸ [2] Application Layer â€” ì‘ìš© ê³„ì¸µ

- **ì—­í• **: ìœ ìŠ¤ì¼€ì´ìŠ¤ ë‹¨ìœ„ë¡œ ì‘ì—…ì„ ì¡°ìœ¨ (ìˆœì„œ ì œì–´, íŠ¸ëœì­ì…˜ ê²½ê³„ ë“±)
- **ì±…ì„**:
  - ë„ë©”ì¸ ëª¨ë¸ ì¡°ì‘ ìˆœì„œ ì •ì˜
  - ë„ë©”ì¸ ê°ì²´ì™€ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê°ì²´ ì¡°í•©
- **DDDì  ì‚¬ê³ **:
  - "ìê¸° ìì‹ ì€ ìƒíƒœë¥¼ ê°€ì§€ì§€ ì•Šê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ë„ ì •ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤."
  - "ë‹¨ìˆœíˆ ì‘ì—…ì˜ **íë¦„**ì„ ì¡°ìœ¨í•œë‹¤."

ì˜ˆ:

```
@Transactional
public void registerUser(RegisterUserCommand cmd) {
    if (userRepository.existsByEmail(cmd.getEmail())) {
        throw new DuplicateEmailException();
    }
    User user = new User(cmd.getName(), cmd.getEmail());
    userRepository.save(user);
    emailSender.sendWelcome(user);
}
```

------

#### ğŸ§  [3] Domain Layer â€” ë„ë©”ì¸ ê³„ì¸µ (í•µì‹¬)

- **ì—­í• **: **ë¹„ì¦ˆë‹ˆìŠ¤ì˜ ë³¸ì§ˆ**ì„ í‘œí˜„í•˜ëŠ” ëª¨ë“  ë¡œì§ì˜ ì¤‘ì‹¬
- **ì±…ì„**:
  - ë„ë©”ì¸ ëª¨ë¸ (`@Entity`, VO)
  - ë„ë©”ì¸ ì„œë¹„ìŠ¤
  - ë„ë©”ì¸ ì´ë²¤íŠ¸
  - ë¶ˆë³€ì„±, ê·œì¹™, ìƒíƒœ ì „ì´
- **DDDì  ì‚¬ê³ **:
  - "ë„ë©”ì¸ ëª¨ë¸ì€ ë°˜ë“œì‹œ **ìŠ¤ìŠ¤ë¡œ ìœ íš¨ì„±ì„ ê²€ì¦**í•˜ê³  **ìŠ¤ìŠ¤ë¡œ ìƒíƒœë¥¼ ë³€ê²½**í•´ì•¼ í•œë‹¤."
  - "ëª¨ë“  ê·œì¹™ì€ ë„ë©”ì¸ ëª¨ë¸ ì•ˆì— ë“¤ì–´ê°€ì•¼ í•˜ë©°, ì™¸ë¶€ì—ì„œ ê°•ì œë˜ì§€ ì•ŠëŠ”ë‹¤."

ì˜ˆ:

```
public class Order {
    public void complete() {
        if (this.status != Status.PAID) {
            throw new IllegalStateException("ê²°ì œë˜ì§€ ì•Šì€ ì£¼ë¬¸ì€ ì™„ë£Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        this.status = Status.COMPLETED;
    }
}
```

------

#### ğŸ—„ [4] Infrastructure Layer â€” ì¸í”„ë¼ ê³„ì¸µ

- **ì—­í• **: ê¸°ìˆ ì  ì„¸ë¶€ êµ¬í˜„ ë‹´ë‹¹ (DB, ì´ë©”ì¼, íŒŒì¼ ì €ì¥, Kafka ë“±)
- **ì±…ì„**:
  - Repository êµ¬í˜„ì²´
  - ì™¸ë¶€ API í˜¸ì¶œ, ë©”ì‹œì§€ ë°œí–‰
  - Persistence, Messaging, I/O
- **DDDì  ì‚¬ê³ **:
  - "ê¸°ìˆ ì ì¸ êµ¬í˜„ì€ ë„ë©”ì¸ì„ ë³´ì¡°í•  ë¿ì´ë©°, í•µì‹¬ ëª¨ë¸ê³¼ëŠ” ì™„ì „íˆ ë¶„ë¦¬ë˜ì–´ì•¼ í•œë‹¤."
  - "Repository ì¸í„°í˜ì´ìŠ¤ëŠ” ë„ë©”ì¸ ë˜ëŠ” ì‘ìš© ê³„ì¸µì—ì„œ ì„ ì–¸í•˜ê³ , ì‹¤ì œ êµ¬í˜„ì€ Infrastructureì—ì„œ í•œë‹¤."

ì˜ˆ:

```
@Repository
public class JpaUserRepository implements UserRepository {
    private final SpringDataJpaRepo jpaRepo;
    public void save(User user) { jpaRepo.save(user); }
}
```

------

### ğŸ” ê³„ì¸µ ê°„ ì˜ì¡´ì„± ë°©í–¥ (DDD ì›ì¹™)

| í˜¸ì¶œì                                                | í˜¸ì¶œ ëŒ€ìƒ |
| ----------------------------------------------------- | --------- |
| Presentation â†’ Application                            |           |
| Application â†’ Domain                                  |           |
| Domain â†’ ì™¸ë¶€ ê¸°ìˆ ê³¼ ì§ì ‘ ì˜ì¡´ âŒ (ì—­ì „ í•„ìš”)          |           |
| Infrastructure â†’ Domain (ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì„ í†µí•´ ì˜ì¡´) |           |

> ğŸ“Œ **ë„ë©”ì¸ ê³„ì¸µì€ ì˜ì¡´ì´ ì—†ì–´ì•¼ í•˜ë©°, ê°€ì¥ ìˆœìˆ˜í•œ í˜•íƒœì—¬ì•¼ í•œë‹¤.**

------

### ğŸ’¬ ì˜ˆ: íšŒì› ê°€ì… íë¦„ (DDD ê´€ì )

```
UserController
    â†“
RegisterUserUseCase
    â†“
User ë„ë©”ì¸ ê°ì²´ ìƒì„± ë° ìƒíƒœ ë³€ê²½
    â†“
UserRepository.save(user)   â† interface
    â†“
JpaUserRepository implements UserRepository
```

------

### ğŸ“˜ DDD ê´€ì ì—ì„œì˜ ì¢‹ì€ ì„¤ê³„ ì˜ˆì‹œ

| ìš”ì†Œ                | ì˜ˆì‹œ                                   | ì„¤ëª…                               |
| ------------------- | -------------------------------------- | ---------------------------------- |
| Entity              | `User`, `Order`                        | ì‹ë³„ì(ID)ë¥¼ ê°€ì§„ ë³€ê²½ ê°€ëŠ¥í•œ ê°ì²´ |
| Value Object        | `Address`, `Money`                     | ë¶ˆë³€ ê°ì²´, ì˜ë¯¸ ê¸°ë°˜ ë¹„êµ          |
| Domain Service      | `DiscountPolicyService`                | ë³µìˆ˜ ì—”í‹°í‹° ê°„ì˜ ê·œì¹™              |
| Application Service | `RegisterUserService`                  | ìœ ìŠ¤ì¼€ì´ìŠ¤ íë¦„ ì¡°ìœ¨               |
| Repository          | `UserRepository`                       | ë„ë©”ì¸ ê°ì²´ ì €ì¥ì†Œ ì¸í„°í˜ì´ìŠ¤      |
| Infrastructure      | `JpaUserRepository`, `EmailSenderImpl` | ê¸°ìˆ ì  êµ¬í˜„ ì„¸ë¶€                   |

------

### ğŸ§  DDD ê³„ì¸µ êµ¬ì¡°ì˜ í•µì‹¬ ìš”ì•½

| ê³„ì¸µ           | ìœ„ì¹˜      | ì±…ì„                       | ê¸°ìˆ  ì˜ì¡´ì„±          |
| -------------- | --------- | -------------------------- | -------------------- |
| Presentation   | ê°€ì¥ ë°”ê¹¥ | ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬             | HTTP, JSON           |
| Application    | ì¤‘ê°„      | ìœ ìŠ¤ì¼€ì´ìŠ¤ ì‹¤í–‰, íë¦„ ì¡°ìœ¨ | Spring, ì™¸ë¶€ API     |
| Domain         | ì¤‘ì‹¬      | ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™, ìƒíƒœ ê´€ë¦¬   | âŒ (ê¸°ìˆ  ë¬´ê´€í•´ì•¼ í•¨) |
| Infrastructure | ë°”ê¹¥ìª½    | DB, ë©”ì‹œì§• ë“± êµ¬í˜„         | âœ…                    |

------

### âœ… ìµœì¢… ìš”ì•½

| í•µì‹¬ ì›ì¹™                    | ì„¤ëª…                                            |
| ---------------------------- | ----------------------------------------------- |
| ğŸ¯ ë„ë©”ì¸ì´ ì¤‘ì‹¬ì´ë‹¤          | ëª¨ë“  ê·œì¹™ê³¼ ìƒíƒœëŠ” ë„ë©”ì¸ì—ì„œ ì‹œì‘ë˜ì–´ì•¼ í•¨     |
| ğŸ” ê¸°ìˆ ì€ ë„ë©”ì¸ì„ ë³´ì¡°í•œë‹¤   | ë„ë©”ì¸ì´ ê¸°ìˆ ì— ì¢…ì†ë˜ë©´ ì•ˆ ë¨                  |
| â¬†ï¸ ì˜ì¡´ì„±ì€ ë°”ê¹¥ì—ì„œ ì•ˆìª½ìœ¼ë¡œ | ë°”ê¹¥ ê³„ì¸µì´ ì•ˆìª½ ê³„ì¸µì„ ì˜ì¡´í•´ì•¼ í•¨ (ì—­ì „ êµ¬ì¡°) |
| ğŸ’¬ Ubiquitous Language        | ëª¨ë¸ê³¼ ì½”ë“œê°€ í•˜ë‚˜ì˜ ì–¸ì–´ë¥¼ ê³µìœ í•´ì•¼ í•¨         |