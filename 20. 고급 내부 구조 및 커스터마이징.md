# 20. ê³ ê¸‰ ë‚´ë¶€ êµ¬ì¡° ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•

## Spring ì»¨í…Œì´ë„ˆ ë™ì‘ ë°©ì‹

### 1. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë€?

**Spring ì»¨í…Œì´ë„ˆë€?**
 â†’ ê°ì²´(Bean)ì˜ ìƒì„±, ê´€ë¦¬, ì˜ì¡´ì„± ì£¼ì…, ìƒëª…ì£¼ê¸° ë“±ì„ ë‹´ë‹¹í•˜ëŠ” **ì¤‘ì•™ ê´€ë¦¬ì†Œ**ì´ë‹¤.

#### ğŸ§  í•µì‹¬ ì—­í• 

| ì—­í•                | ì„¤ëª…                         |
| ------------------ | ---------------------------- |
| Bean ìƒì„±          | Java ê°ì²´ë¥¼ ìƒì„± (`new`)     |
| Bean ì¡°ë¦½          | ì˜ì¡´ì„± ì£¼ì… (DI) ìˆ˜í–‰        |
| Bean ìƒëª…ì£¼ê¸° ê´€ë¦¬ | ì´ˆê¸°í™”, ì†Œë©¸ ì²˜ë¦¬            |
| AOP ì ìš©           | í”„ë¡ì‹œë¡œ ê¸°ëŠ¥ í™•ì¥           |
| í™˜ê²½ ê¸°ë°˜ ì„¤ì •     | í”„ë¡œíŒŒì¼, ì™¸ë¶€ ì„¤ì • ì—°ë™     |
| ì´ë²¤íŠ¸ ì²˜ë¦¬        | ì´ë²¤íŠ¸ í¼ë¸”ë¦¬ì‹± ë° êµ¬ë… ì²˜ë¦¬ |

------

### 2. ì»¨í…Œì´ë„ˆì˜ ì¢…ë¥˜

| ì»¨í…Œì´ë„ˆ êµ¬í˜„ì²´                      | ì„¤ëª…                                        |
| ------------------------------------ | ------------------------------------------- |
| `BeanFactory`                        | ê°€ì¥ ë‹¨ìˆœí•œ DI ì»¨í…Œì´ë„ˆ (ì§€ì—° ë¡œë”©)         |
| `ApplicationContext`                 | `BeanFactory` í™•ì¥, **ì‹¤ì „ì—ì„œ ì‚¬ìš©ë¨**     |
| `AnnotationConfigApplicationContext` | ìë°” ê¸°ë°˜ ì„¤ì • ì „ìš©                         |
| `GenericWebApplicationContext`       | Spring MVC í™˜ê²½ì—ì„œ ì‚¬ìš©ë¨                  |
| `WebApplicationContext`              | DispatcherServletê³¼ ì—°ë™ëœ ì›¹ ì „ìš© ì»¨í…ìŠ¤íŠ¸ |

â†’ ì‹¤ë¬´ì—ì„œëŠ” ê±°ì˜ í•­ìƒ `ApplicationContext` ë˜ëŠ” ê·¸ í•˜ìœ„ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•œë‹¤.

------

### 3. ApplicationContext ìƒì„± ê³¼ì •

#### ğŸ§­ ì‹¤í–‰ íë¦„ ìš”ì•½

```
@SpringBootApplication
public class MyApp {
    public static void main(String[] args) {
        SpringApplication.run(MyApp.class, args);
    }
}
```

ì‹¤í–‰ ì‹œ ë‚´ë¶€ì ìœ¼ë¡œ:

```
SpringApplication â†’ createApplicationContext()
 â†’ AnnotationConfigServletWebServerApplicationContext
   â†’ BeanDefinition ìƒì„±
   â†’ BeanFactoryPostProcessor ì ìš©
   â†’ Bean ìƒì„± (Constructor, DI)
   â†’ ì´ˆê¸°í™” ì½œë°± (InitializingBean, @PostConstruct)
   â†’ ApplicationEventListener ë“±ë¡
```

------

### 4. Bean ë“±ë¡ ë‹¨ê³„ (Spring ë‚´ë¶€ ìˆœì„œ)

#### ğŸ”¹ 1ë‹¨ê³„: BeanDefinition ë“±ë¡

```
@Configuration
public class AppConfig {
    @Bean
    public UserService userService() {
        return new UserService();
    }
}
```

â†’ ì´ ì½”ë“œëŠ” `UserService`ì— ëŒ€í•œ **ì„¤ê³„ë„(BeanDefinition)**ë§Œ ë“±ë¡ë¨
 ì•„ì§ ê°ì²´ëŠ” ìƒì„±ë˜ì§€ ì•ŠìŒ

------

#### ğŸ”¹ 2ë‹¨ê³„: BeanFactoryPostProcessor ì‹¤í–‰

```
@Component
public class MyProcessor implements BeanFactoryPostProcessor {
    public void postProcessBeanFactory(ConfigurableListableBeanFactory bf) {
        // ë¹ˆ ì •ì˜ ìˆ˜ì • ê°€ëŠ¥
    }
}
```

â†’ **Bean ìƒì„± ì „** ì„¤ì • ë³€ê²½ ê°€ëŠ¥

------

#### ğŸ”¹ 3ë‹¨ê³„: Bean ìƒì„± ë° ì˜ì¡´ì„± ì£¼ì…

```
@Component
public class OrderService {
    private final UserService userService;

    public OrderService(UserService userService) { // ìƒì„±ì ì£¼ì…
        this.userService = userService;
    }
}
```

â†’ ì˜ì¡´í•˜ëŠ” Beanì´ ëª¨ë‘ ì¡´ì¬í•˜ë©´, ì‹¤ì œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì£¼ì…

------

#### ğŸ”¹ 4ë‹¨ê³„: ì´ˆê¸°í™” ì½œë°±

| ë°©ì‹               | ì„¤ëª…                                        |
| ------------------ | ------------------------------------------- |
| `@PostConstruct`   | ì´ˆê¸°í™” ë©”ì„œë“œ ì§€ì •                          |
| `InitializingBean` | afterPropertiesSet()                        |
| `initMethod`       | XML ë˜ëŠ” Java ì„¤ì •ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ì§€ì • ê°€ëŠ¥ |

------

#### ğŸ”¹ 5ë‹¨ê³„: AOP í”„ë¡ì‹œ ì ìš©

- `@Transactional`, `@Async`, `@Cacheable` ë“±ì´ í”„ë¡ì‹œ ëŒ€ìƒì´ë©´ â†’ AOP ì ìš©
- ì‹¤ì œ Bean ëŒ€ì‹  **Proxy ê°ì²´**ë¥¼ ë“±ë¡

------

#### ğŸ”¹ 6ë‹¨ê³„: ApplicationListener ë“±ë¡ ë° ì´ë²¤íŠ¸ í¼ë¸”ë¦¬ì‹±

```
@Component
public class MyListener implements ApplicationListener<ContextRefreshedEvent> {
    public void onApplicationEvent(ContextRefreshedEvent event) {
        System.out.println("ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ!");
    }
}
```

------

### 5. ì „ì²´ ìƒëª…ì£¼ê¸° ìˆœì„œ

```
1. ì„¤ì • í´ë˜ìŠ¤ íƒìƒ‰
2. BeanDefinition ìŠ¤ìº” ë° ë“±ë¡
3. BeanFactoryPostProcessor ì‹¤í–‰
4. Bean ìƒì„± (Constructor)
5. ì˜ì¡´ì„± ì£¼ì… (Setter, Constructor, Field)
6. BeanPostProcessor ì‹¤í–‰
7. ì´ˆê¸°í™” ì½œë°± (@PostConstruct ë“±)
8. AOP í”„ë¡ì‹œ ì ìš©
9. ApplicationEvent ë“±ë¡
10. ApplicationRunner, CommandLineRunner ì‹¤í–‰
```

------

### 6. BeanScopeì™€ ì»¨í…Œì´ë„ˆ

| ìŠ¤ì½”í”„        | ì˜ë¯¸                                   |
| ------------- | -------------------------------------- |
| `singleton`   | í•œ ì»¨í…ìŠ¤íŠ¸ì— í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ (ê¸°ë³¸ê°’) |
| `prototype`   | ìš”ì²­ ì‹œë§ˆë‹¤ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤            |
| `request`     | HTTP ìš”ì²­ ë‹¨ìœ„ (ì›¹)                    |
| `session`     | HTTP ì„¸ì…˜ ë‹¨ìœ„ (ì›¹)                    |
| `application` | ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ ë‹¨ìœ„                   |

â†’ `prototype` ìŠ¤ì½”í”„ëŠ” ìƒì„± í›„ ì»¨í…Œì´ë„ˆê°€ ìƒëª…ì£¼ê¸° ê´€ë¦¬í•˜ì§€ ì•ŠìŒ

------

### 7. ì •ë¦¬: í•µì‹¬ í´ë˜ìŠ¤ êµ¬ì¡°

| í´ë˜ìŠ¤                               | ì—­í•                                                   |
| ------------------------------------ | ----------------------------------------------------- |
| `ApplicationContext`                 | Spring ì „ì²´ ì»¨í…Œì´ë„ˆ                                  |
| `DefaultListableBeanFactory`         | Bean ì €ì¥ì†Œ, ìƒì„± ì±…ì„                                |
| `AnnotationConfigApplicationContext` | ìë°” ê¸°ë°˜ ì„¤ì • ì „ìš© ì»¨í…ìŠ¤íŠ¸                          |
| `BeanDefinition`                     | Beanì˜ ë©”íƒ€ì •ë³´ (íƒ€ì…, scope, ìƒì„±ì ë“±)              |
| `BeanPostProcessor`                  | ë¹ˆ ìƒì„± ì§í›„ ê°œì… (ex: í”„ë¡ì‹œ ìƒì„±)                   |
| `ApplicationEventPublisher`          | ì´ë²¤íŠ¸ ë°œí–‰ê¸°                                         |
| `Environment`                        | ì™¸ë¶€ ì„¤ì • (`@Value`, `@ConfigurationProperties`) ì½ê¸° |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| ê°œë…      | ìš”ì•½                                                  |
| --------- | ----------------------------------------------------- |
| ì»¨í…Œì´ë„ˆ  | ìŠ¤í”„ë§ ê°ì²´(Bean)ì„ ë“±ë¡, ê´€ë¦¬í•˜ëŠ” í•µì‹¬               |
| ë™ì‘ ìˆœì„œ | ë“±ë¡ â†’ ì¡°ë¦½(DI) â†’ ì´ˆê¸°í™” â†’ í”„ë¡ì‹œ â†’ ì‹¤í–‰              |
| ê´€ë¦¬ ëŒ€ìƒ | @Component, @Bean, @Service ë“±ìœ¼ë¡œ ë“±ë¡í•œ ê°ì²´        |
| êµ¬ì„± ìš”ì†Œ | BeanFactory, ApplicationContext, BeanPostProcessor ë“± |
| í™•ì¥ì„±    | AOP, ì´ë²¤íŠ¸, í”„ë¡œíŒŒì¼, ì™¸ë¶€ ì„¤ì • ë“±ê³¼ í†µí•© ê°€ëŠ¥       |

## ë¹ˆ ë“±ë¡ ê³¼ì •

### ğŸ“Œ ì „ì²´ íë¦„ ìš”ì•½

Spring ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë˜ë©´, ì•„ë˜ ë‹¨ê³„ë¡œ ë¹ˆì´ ë“±ë¡ë¼:

```
1. ì„¤ì • ì •ë³´ ë¶„ì„
2. Component Scan or @Bean ë¶„ì„
3. BeanDefinition ìƒì„± ë° ë“±ë¡
4. Bean ìƒì„± ì „ ì²˜ë¦¬ (Post Processor)
5. Bean ì‹¤ì œ ìƒì„± (ìƒì„±ì)
6. ì˜ì¡´ì„± ì£¼ì…
7. ì´ˆê¸°í™” ì½œë°±
8. í”„ë¡ì‹œ ì²˜ë¦¬ (AOP)
```

------

### ğŸ§­ 1. ì„¤ì • í´ë˜ìŠ¤ ë¶„ì„

```
@SpringBootApplication  // @ComponentScan + @Configuration + @EnableAutoConfiguration
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

- ë‚´ë¶€ì ìœ¼ë¡œ `AnnotationConfigApplicationContext` ë˜ëŠ” ì›¹ì—ì„  `AnnotationConfigServletWebServerApplicationContext` ìƒì„±
- ì´ í´ë˜ìŠ¤ê°€ í•µì‹¬ ì„¤ì • í´ë˜ìŠ¤ (`@Configuration`)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  Bean ë“±ë¡ì„ ì‹œì‘

------

### ğŸ§ª 2. Component Scan / Bean ë“±ë¡

#### 2.1 ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”

```
@Component
public class UserService {}
```

â†’ ìŠ¤í”„ë§ì€ `@ComponentScan`ìœ¼ë¡œ ì§€ì •í•œ íŒ¨í‚¤ì§€ì—ì„œ `@Component`, `@Service`, `@Repository`, `@Controller` ë“±ì„ ì°¾ì•„ **BeanDefinition**ì„ ìƒì„±

#### 2.2 @Bean ì§ì ‘ ë“±ë¡

```
@Configuration
public class AppConfig {
    @Bean
    public OrderService orderService() {
        return new OrderService();
    }
}
```

â†’ ì´ ê²½ìš°ë„ ë§ˆì°¬ê°€ì§€ë¡œ `BeanDefinition` ê°ì²´ê°€ ìƒì„±ë¨

------

### ğŸ“¦ 3. BeanDefinition ìƒì„± ë° ë“±ë¡

#### BeanDefinitionì´ë€?

Springì´ **"ì´ í´ë˜ìŠ¤ëŠ” ì–´ë–¤ Beanìœ¼ë¡œ ë“±ë¡ë  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ë©”íƒ€ ì •ë³´"**ë¥¼ ë‹´ê³  ìˆëŠ” ê°ì²´ì´ë‹¤.

| ì •ë³´         | ì˜ˆì‹œ                                |
| ------------ | ----------------------------------- |
| class        | `com.example.UserService`           |
| scope        | singleton                           |
| lazy-init    | false                               |
| beanName     | `userService`                       |
| dependencies | `orderService`, `userRepository` ë“± |

> ì´ ì‹œì ê¹Œì§€ëŠ” **ì•„ì§ Bean ê°ì²´ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ**

------

### ğŸ§° 4. BeanFactoryPostProcessor ì²˜ë¦¬

`ApplicationContext`ê°€ ì´ˆê¸°í™”ë˜ê¸° ì „,
 `BeanFactory`ì— ë“±ë¡ëœ ëª¨ë“  `BeanDefinition`ì„ ê°€ê³µí•  ìˆ˜ ìˆëŠ” **í›„ì²˜ë¦¬ê¸°**ë“¤ì´ ì‹¤í–‰ëœë‹¤.

```
@Component
public class CustomProcessor implements BeanFactoryPostProcessor {
    public void postProcessBeanFactory(ConfigurableListableBeanFactory factory) {
        // ë“±ë¡ëœ BeanDefinition ìˆ˜ì • ê°€ëŠ¥
    }
}
```

------

### ğŸ”§ 5. Bean ìƒì„±

ë“œë””ì–´ ì‹¤ì œ ê°ì²´ê°€ ìƒì„±ë˜ì—ˆë‹¤.

#### ìƒì„± ì‹œì ì€?

- ê¸°ë³¸ì ìœ¼ë¡œ ApplicationContext ì´ˆê¸°í™” ì‹œì ì— ëª¨ë“  singleton Beanì„ ìƒì„±
- prototypeì€ ìš”ì²­í•  ë•Œë§ˆë‹¤ ìƒì„±

```
public class UserService {
    public UserService(OrderService orderService) {
        // ìƒì„±ì ì£¼ì…
    }
}
```

â†’ ìƒì„±ì, setter, field ë“±ìœ¼ë¡œ **ì˜ì¡´ì„±ì´ ìë™ìœ¼ë¡œ ì£¼ì…ë¨**

------

### ğŸ§· 6. ì˜ì¡´ì„± ì£¼ì… (DI)

DIëŠ” ë‹¤ìŒ ë°©ì‹ ì¤‘ í•˜ë‚˜ë¡œ ìˆ˜í–‰ëœë‹¤:

| ë°©ì‹        | ì˜ˆì‹œ                                      |
| ----------- | ----------------------------------------- |
| ìƒì„±ì ì£¼ì… | `@Autowired` ìƒì„±ì                       |
| í•„ë“œ ì£¼ì…   | `@Autowired private UserRepository repo;` |
| ì„¸í„° ì£¼ì…   | `setXxx()`ì— `@Autowired`                 |

Springì€ ì´ë¥¼ ìœ„í•´ **ì˜ì¡´ì„± íƒìƒ‰ â†’ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± â†’ ì£¼ì… â†’ ìºì‹±** ê³¼ì •ì„ ê±°ì¹¨

------

### ğŸ§¼ 7. ì´ˆê¸°í™” ì½œë°±

ìƒì„± ë° DIê°€ ì™„ë£Œëœ í›„, Beanì€ ì´ˆê¸°í™” ë‹¨ê³„ë¡œ ë„˜ì–´ê°„ë‹¤.

| ë°©ë²•                        | ì„¤ëª…                             |
| --------------------------- | -------------------------------- |
| `@PostConstruct`            | ì´ˆê¸°í™” ë©”ì„œë“œ ì§€ì •               |
| `InitializingBean`          | afterPropertiesSet() ë©”ì„œë“œ í˜¸ì¶œ |
| `@Bean(initMethod = "...")` | ëª…ì‹œì  ì§€ì •                      |

------

### ğŸ§™ 8. BeanPostProcessor ì²˜ë¦¬

Springì€ ìƒì„±ëœ Beanì— ëŒ€í•´ **í›„ì²˜ë¦¬ê¸°(BeanPostProcessor)**ë¥¼ ì‹¤í–‰í•´ì„œ,

- AOP í”„ë¡ì‹œ ì ìš©
- `@Transactional`, `@Async`, `@Validated` ë“± ê¸°ëŠ¥ ë¶€ì°©
- ì»¤ìŠ¤í…€ ë™ì‘ ì‚½ì…

```
public class MyProcessor implements BeanPostProcessor {
    public Object postProcessAfterInitialization(Object bean, String name) {
        // ë°˜í™˜ê°’ì´ ë°”ë€Œë©´ í”„ë¡ì‹œë¡œ ëŒ€ì²´ë¨
        return bean;
    }
}
```

------

### ğŸŒ€ 9. ì‹¤ì œ ApplicationContextì— Bean ë“±ë¡ ì™„ë£Œ

ì´í›„ë¶€í„°ëŠ” `getBean("userService")`, `@Autowired UserService userService` ë“±ì´ ì „ë¶€
 **ApplicationContext ë‚´ë¶€ì˜ ì‹±ê¸€í†¤ ë¹ˆ ì €ì¥ì†Œì—ì„œ êº¼ë‚´ì˜¤ëŠ” ê²ƒ**

------

### âš ï¸ ë™ì‘ ìˆœì„œ ìš”ì•½

```
@Bean ë“±ë¡
â†“
BeanDefinition ìƒì„±
â†“
BeanFactoryPostProcessor ì ìš©
â†“
Bean ìƒì„± (Constructor)
â†“
DI ì²˜ë¦¬
â†“
BeanPostProcessor ì ìš© (AOP ë“±)
â†“
ì´ˆê¸°í™” ë©”ì„œë“œ í˜¸ì¶œ
â†“
ApplicationContextì— ë“±ë¡ ì™„ë£Œ
```

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| ë‹¨ê³„                     | ì—­í•                                                |
| ------------------------ | -------------------------------------------------- |
| BeanDefinition           | í´ë˜ìŠ¤ â†’ ë©”íƒ€ë°ì´í„°ë¡œ ë“±ë¡                         |
| BeanFactoryPostProcessor | ë¹ˆ ìƒì„± ì „ì— ì •ì˜ ìˆ˜ì •                             |
| BeanPostProcessor        | ë¹ˆ ìƒì„± ì§í›„ í›„ì²˜ë¦¬ (í”„ë¡ì‹œ ë“±)                    |
| ì‹¤ì œ ìƒì„± ì‹œì            | singleton: ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™” ì‹œ / prototype: ìš”ì²­ ì‹œ |
| ìµœì¢… ì €ì¥ ìœ„ì¹˜           | ApplicationContext ë‚´ë¶€ì˜ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬        |

## `BeanDefinition`, `BeanFactoryPostProcessor`, `BeanPostProcessor`

### 1. ğŸ”¶ `BeanDefinition`

#### ğŸ“Œ ê°œë…

- `BeanDefinition`ì€ **Beanì„ ì •ì˜í•˜ê¸° ìœ„í•œ ë©”íƒ€ì •ë³´**ë¥¼ ë‹´ê³  ìˆëŠ” ê°ì²´ì´ë‹¤.
- ì¦‰, Springì´ **í´ë˜ìŠ¤ë¥¼ ì‹¤ì œ Beanìœ¼ë¡œ ë“±ë¡í•˜ê¸° ì „ì˜ ì„¤ê³„ë„**ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.

```
class BeanDefinition {
    String beanClassName;   // ì–´ë–¤ í´ë˜ìŠ¤ì¸ê°€?
    String scope;           // singleton, prototype ë“±
    boolean lazyInit;
    List<PropertyValue> properties;
    ConstructorArg[] constructorArgs;
}
```

------

#### ğŸ“¦ ìƒì„± ì‹œì 

- ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”, XML, `@Bean`, `@Import` ë“±ìœ¼ë¡œë¶€í„° ì¶”ì¶œë¨
- ì´ë•Œê¹Œì§€ëŠ” **ê°ì²´ëŠ” ìƒì„±ë˜ì§€ ì•ŠìŒ**

```
@Bean
public UserService userService() {
    return new UserService();
}
```

â†’ ìœ„ ì½”ë“œê°€ ìˆìœ¼ë©´ ë‚´ë¶€ì ìœ¼ë¡œ `BeanDefinition` ê°ì²´ê°€ ë¨¼ì € ë§Œë“¤ì–´ì§.

------

#### ğŸ“Œ BeanDefinitionì˜ ì£¼ìš” ì†ì„±ë“¤

| ì†ì„±              | ì„¤ëª…                                              |
| ----------------- | ------------------------------------------------- |
| `beanClassName`   | í´ë˜ìŠ¤ ì´ë¦„ (`com.example.UserService`)           |
| `scope`           | `singleton`, `prototype`, `request`, `session` ë“± |
| `lazyInit`        | trueë©´ ì´ˆê¸°í™” ì§€ì—°                                |
| `initMethodName`  | ì´ˆê¸°í™” ì½œë°± ë©”ì„œë“œ                                |
| `propertyValues`  | DIí•  í•„ë“œ ê°’ë“¤ (setter ì£¼ì…ìš©)                    |
| `constructorArgs` | ìƒì„±ì íŒŒë¼ë¯¸í„° ê°’ë“¤                              |

------

### 2. ğŸ”¶ `BeanFactoryPostProcessor`

#### ğŸ“Œ ê°œë…

- **BeanDefinitionì„ ìˆ˜ì •**í•  ìˆ˜ ìˆëŠ” í›„ì²˜ë¦¬ê¸°.
- ì¦‰, Beanì´ ì‹¤ì œë¡œ ìƒì„±ë˜ê¸° ì „ ë‹¨ê³„ì—ì„œ, **ì •ì˜ ìì²´ë¥¼ ê°€ê³µ**í•  ìˆ˜ ìˆë‹¤.

------

#### ğŸ“Œ ì‚¬ìš© ëª©ì 

| ì‚¬ìš© ì˜ˆ                                | ì„¤ëª…                           |
| -------------------------------------- | ------------------------------ |
| `PropertySourcesPlaceholderConfigurer` | `@Value("${...}")` ì¹˜í™˜ ì²˜ë¦¬   |
| `ConfigurationClassPostProcessor`      | `@Configuration`, `@Bean` ë“±ë¡ |
| Custom Bean ë“±ë¡ê¸°                     | ì½”ë“œë¡œ ë¹ˆì„ ìˆ˜ë™ ë“±ë¡          |

------

#### ğŸ’¡ ì‹¤ì „ ì˜ˆì œ

```
@Component
public class MyBFPP implements BeanFactoryPostProcessor {
    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory factory) {
        for (String name : factory.getBeanDefinitionNames()) {
            BeanDefinition def = factory.getBeanDefinition(name);
            if (name.equals("targetBean")) {
                def.setScope("prototype");
                def.setLazyInit(true);
            }
        }
    }
}
```

â†’ `targetBean`ì˜ scopeê³¼ lazy ì†ì„±ì„ ì½”ë“œì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆìŒ

------

#### ğŸ“Œ ì‹¤í–‰ ì‹œì 

- Springì´ ApplicationContextë¥¼ ìƒì„±í•  ë•Œ, **Beanì´ ìƒì„±ë˜ê¸° ì „ì— ë‹¨ í•œ ë²ˆ ì‹¤í–‰ë¨**
- ë‹¨, `@Component`ë¡œ ë“±ë¡ë˜ê±°ë‚˜ `@Import`ë¡œ í¬í•¨ë¼ì•¼ í•¨

------

### 3. ğŸ”¶ `BeanPostProcessor`

#### ğŸ“Œ ê°œë…

- **Bean ê°ì²´ê°€ ìƒì„±ëœ ì´í›„, ì´ˆê¸°í™” ì§ì „ì— ê°œì…**í•˜ëŠ” í™•ì¥ í¬ì¸íŠ¸
- ê°€ì¥ ë§ì´ ì“°ì´ëŠ” Springì˜ í™•ì¥ê¸°ìˆ (AOP, @Transactional, @Async ë“±)ì˜ ê¸°ë°˜

------

#### ğŸ“Œ ë™ì‘ ìˆœì„œ

1. ìƒì„±ì í˜¸ì¶œ
2. ì˜ì¡´ì„± ì£¼ì… ì™„ë£Œ
3. ì´ˆê¸°í™” ì½œë°± ì´ì „
4. **BeanPostProcessorì˜ `postProcessBeforeInitialization()` ì‹¤í–‰**
5. `@PostConstruct`, `InitializingBean.afterPropertiesSet()` ì‹¤í–‰
6. **`postProcessAfterInitialization()` ì‹¤í–‰**
7. ApplicationContextì— ë“±ë¡ ì™„ë£Œ

------

#### ğŸ’¡ ì‹¤ì „ ì˜ˆì œ

```
@Component
public class MyBPP implements BeanPostProcessor {

    @Override
    public Object postProcessBeforeInitialization(Object bean, String name) {
        if (bean instanceof UserService) {
            System.out.println("BeforeInit: " + name);
        }
        return bean;
    }

    @Override
    public Object postProcessAfterInitialization(Object bean, String name) {
        if (bean instanceof UserService) {
            System.out.println("AfterInit: " + name);
        }
        return bean;
    }
}
```

------

#### ğŸ“Œ ì£¼ìš” í™œìš© ì˜ˆ

| í™œìš©                   | ì„¤ëª…                     |
| ---------------------- | ------------------------ |
| AOP                    | í”„ë¡ì‹œ ê°ì²´ë¡œ êµì²´       |
| `@Transactional`       | íŠ¸ëœì­ì…˜ í”„ë¡ì‹œ ì ìš©     |
| `@Async`, `@Scheduled` | ì“°ë ˆë“œ ë¹„ë™ê¸°í™”          |
| `@Validated`           | JSR-303 ìœ íš¨ì„± ê²€ì‚¬      |
| ë¡œê¹…/íŠ¸ë˜í‚¹            | ìë™ ì£¼ì…ëœ ë¡œê±° ì‚½ì… ë“± |

------

### 4. Bean ìƒëª…ì£¼ê¸°ì™€ ì´ 3ê°€ì§€ì˜ ìœ„ì¹˜ ê´€ê³„

```
1. BeanDefinition ìƒì„± â† [BeanDefinition]
2. BeanFactoryPostProcessor ì‹¤í–‰ â† [BeanFactoryPostProcessor]
3. Bean ìƒì„± (new) â†’ ì˜ì¡´ì„± ì£¼ì…
4. BeanPostProcessor.beforeInit() â† [BeanPostProcessor]
5. ì´ˆê¸°í™” ì½œë°±
6. BeanPostProcessor.afterInit() â† [BeanPostProcessor]
7. ApplicationContextì— ë“±ë¡ ì™„ë£Œ
```

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½ ë¹„êµ

| í•­ëª©                       | ì‹œì                  | ëŒ€ìƒ           | ì—­í•            |
| -------------------------- | -------------------- | -------------- | -------------- |
| `BeanDefinition`           | ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™” ì´ˆë°˜ | ë©”íƒ€ ì •ë³´      | Beanì˜ ì„¤ê³„ë„  |
| `BeanFactoryPostProcessor` | ë¹ˆ ìƒì„± ì „           | BeanDefinition | ì •ì˜ ìì²´ ìˆ˜ì • |
| `BeanPostProcessor`        | ë¹ˆ ìƒì„± í›„           | ì‹¤ì œ ê°ì²´      | ì´ˆê¸°í™”, í”„ë¡ì‹œ |

------

### âœ³ï¸ ê³ ê¸‰ í™•ì¥: ê·¸ ì™¸ ê´€ë ¨ ì¸í„°í˜ì´ìŠ¤ë“¤

| ì¸í„°í˜ì´ìŠ¤                            | ì„¤ëª…                         |
| ------------------------------------- | ---------------------------- |
| `SmartInitializingSingleton`          | ëª¨ë“  Bean ìƒì„± ì™„ë£Œ í›„ ì‹¤í–‰  |
| `InstantiationAwareBeanPostProcessor` | ìƒì„±ì ì§ì „/ì§í›„ì— ê°œì… ê°€ëŠ¥ |
| `DestructionAwareBeanPostProcessor`   | ì†Œë©¸ ì§ì „ì— í›„ì²˜ë¦¬           |
| `MergedBeanDefinitionPostProcessor`   | ë³‘í•©ëœ BeanDefinition ì²˜ë¦¬   |
| `ImportBeanDefinitionRegistrar`       | ì™¸ë¶€ì—ì„œ Bean ì •ì˜ ì§ì ‘ ë“±ë¡ |

## í´ë˜ìŠ¤íŒ¨ìŠ¤ ìŠ¤ìº” ì›ë¦¬

### ğŸ“Œ ê°œë… ì •ë¦¬

> í´ë˜ìŠ¤íŒ¨ìŠ¤ ìŠ¤ìº”ì´ë€?
>  Springì´ ì§€ì •ëœ íŒ¨í‚¤ì§€ ë‚´ì˜ `.class` íŒŒì¼ì„ **ë¦¬í”Œë ‰ì…˜ ê¸°ë°˜ìœ¼ë¡œ íƒìƒ‰**í•˜ì—¬
>  `@Component` ê³„ì—´ ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ **BeanDefinitionìœ¼ë¡œ ë“±ë¡**í•˜ëŠ” ë™ì‘

------

### ğŸ” ì‘ë™ íë¦„ ìš”ì•½

```
@Configuration
@ComponentScan(basePackages = "com.example")
public class AppConfig {
}
```

â¬‡ï¸ ì‹¤í–‰ ì‹œ

```
1. basePackages ê²½ë¡œ ìŠ¤ìº”
2. .class íŒŒì¼ ë©”íƒ€ë°ì´í„° ì½ê¸° (ASM)
3. @Component, @Service ë“± ìˆëŠ” í´ë˜ìŠ¤ ì‹ë³„
4. BeanDefinition ìƒì„±
5. ApplicationContextì— ë“±ë¡
```

------

### 1. ğŸ“¦ ê¸°ë³¸ ì¶œë°œì : `@ComponentScan`

```
@SpringBootApplication // ë‚´ë¶€ì— @ComponentScan í¬í•¨
public class MainApp {
    public static void main(String[] args) {
        SpringApplication.run(MainApp.class, args);
    }
}
```

â†’ ê¸°ë³¸ì ìœ¼ë¡œ `@SpringBootApplication`ì€ í˜„ì¬ í´ë˜ìŠ¤ì˜ **íŒ¨í‚¤ì§€ ê¸°ì¤€ìœ¼ë¡œ í•˜ìœ„ ì „ì²´ë¥¼ ìŠ¤ìº”**

```
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@ComponentScan(
  basePackages = ...
)
```

------

### 2. ğŸ” ì–´ë–¤ ì–´ë…¸í…Œì´ì…˜ì´ ëŒ€ìƒì¸ê°€?

| ì–´ë…¸í…Œì´ì…˜        | ì„¤ëª…                                        |
| ----------------- | ------------------------------------------- |
| `@Component`      | ê¸°ë³¸ ë¹ˆ ë“±ë¡ ì–´ë…¸í…Œì´ì…˜                     |
| `@Service`        | `@Component`ì˜ íŠ¹ìˆ˜í™”                       |
| `@Repository`     | `@Component`ì˜ íŠ¹ìˆ˜í™” (ì˜ˆì™¸ ë³€í™˜ ê¸°ëŠ¥ ë‚´ì¥) |
| `@Controller`     | MVC ì „ìš©                                    |
| `@RestController` | `@Controller + @ResponseBody`               |

ì´ë“¤ì€ ì „ë¶€ ë‚´ë¶€ì ìœ¼ë¡œ `@Component`ê°€ ë¶™ì–´ ìˆìŒ.

------

### 3. âš™ï¸ ì‹¤ì œ ìŠ¤ìº” ë¡œì§ì˜ í•µì‹¬ í´ë˜ìŠ¤

| í´ë˜ìŠ¤                           | ì—­í•                              |
| -------------------------------- | -------------------------------- |
| `ClassPathBeanDefinitionScanner` | `.class` íŒŒì¼ ìŠ¤ìº” ìˆ˜í–‰          |
| `MetadataReader`                 | .class ë©”íƒ€ì •ë³´ ë¦¬ë”©             |
| `AnnotationMetadata`             | ì–´ë…¸í…Œì´ì…˜ ì •ë³´ ì½ê¸°             |
| `BeanDefinitionRegistry`         | ìŠ¤ìº” ê²°ê³¼ë¥¼ ë“±ë¡í•  ëŒ€ìƒ ì»¨í…Œì´ë„ˆ |

------

### 4. ğŸ“š ë‚´ë¶€ ë™ì‘ ìƒì„¸ ìˆœì„œ

#### â‘  basePackage ê²½ë¡œ íƒìƒ‰

- `com.example` â†’ `classpath:/com/example/`ë¡œ ë³€í™˜
- ë‚´ë¶€ì˜ `.class` íŒŒì¼ë“¤ íƒìƒ‰

------

#### â‘¡ `.class` íŒŒì¼ ë©”íƒ€ì •ë³´ ì½ê¸° (ASM ë¼ì´ë¸ŒëŸ¬ë¦¬)

Springì€ í´ë˜ìŠ¤ ì „ì²´ë¥¼ ë¡œë“œí•˜ì§€ ì•Šê³ ë„ **í´ë˜ìŠ¤ì˜ ì–´ë…¸í…Œì´ì…˜/ìŠˆí¼í´ë˜ìŠ¤/ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë“±ì„ ì¶”ì¶œ**í•  ìˆ˜ ìˆìŒ.

```
MetadataReaderFactory metadataReaderFactory = new CachingMetadataReaderFactory();
MetadataReader reader = metadataReaderFactory.getMetadataReader(classResource);
AnnotationMetadata metadata = reader.getAnnotationMetadata();
```

- ë¹ ë¥´ê³  íš¨ìœ¨ì ì¸ ì´ìœ : **í´ë˜ìŠ¤ë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë”©í•˜ì§€ ì•Šê³  bytecode ë ˆë²¨ì—ì„œ ë¶„ì„**

------

#### â‘¢ í•„í„° ì ìš©

```
includeFilters = {
  @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = MyMarker.class)
}
excludeFilters = {
  @ComponentScan.Filter(type = FilterType.REGEX, pattern = ".*Internal.*")
}
```

â†’ @Component ì™¸ì—ë„ ì»¤ìŠ¤í…€ í•„í„° ì¡°ê±´ìœ¼ë¡œ í¬í•¨/ì œì™¸ ê°€ëŠ¥

------

#### â‘£ BeanDefinition ìƒì„± ë° ë“±ë¡

- íƒìƒ‰ëœ í´ë˜ìŠ¤ì˜ ë©”íƒ€ì •ë³´ë¡œ `ScannedGenericBeanDefinition` ìƒì„±
- `beanNameGenerator`ë¡œ ì´ë¦„ ê²°ì • (ë³´í†µ `userService`, `orderService` ë“±)
- ìµœì¢…ì ìœ¼ë¡œ `DefaultListableBeanFactory`ì— ë“±ë¡

```
registry.registerBeanDefinition(beanName, beanDefinition);
```

------

### 5. ğŸ’¡ ì»¤ìŠ¤í…€ Component ìŠ¤ìº” ì¡°ê±´ (ê³ ê¸‰)

```
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Component
public @interface MyComponent {
}
```

```
@ComponentScan(includeFilters = {
  @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = MyComponent.class)
})
```

â†’ ì§ì ‘ ë§Œë“  ì–´ë…¸í…Œì´ì…˜ë„ ìŠ¤ìº” ëŒ€ìƒìœ¼ë¡œ ì„¤ì • ê°€ëŠ¥

------

### 6. âš ï¸ ì£¼ì˜í•  ì 

| ì‹¤ìˆ˜                               | ì„¤ëª…                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| @ComponentScanì˜ basePackages ëˆ„ë½ | ê¸°ë³¸ ìœ„ì¹˜ê°€ í˜„ì¬ í´ë˜ìŠ¤ íŒ¨í‚¤ì§€ ê¸°ì¤€ì´ë¼ **ìƒìœ„ íŒ¨í‚¤ì§€ì˜ Beanì´ ëˆ„ë½ë  ìˆ˜ ìˆìŒ** |
| `@Component` ë¹ ì§                  | ì–´ë…¸í…Œì´ì…˜ì´ ì—†ìœ¼ë©´ ìŠ¤ìº” ëŒ€ìƒì´ ì•„ë‹˜                         |
| ë¹ˆ ì´ë¦„ ì¶©ëŒ                       | ê°™ì€ ì´ë¦„ì˜ Beanì´ ì—¬ëŸ¬ ê°œ ë“±ë¡ë˜ë©´ ì—ëŸ¬                     |
| í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ë¡œë”©í•˜ì§€ ì•ŠìŒ        | **ë¦¬í”Œë ‰ì…˜ ê¸°ë°˜ì´ ì•„ë‹ˆë¼ bytecode íƒìƒ‰** (ì„±ëŠ¥ ìµœì í™”)       |

------

### 7. ì‹¤ì „ ì˜ˆ: ìŠ¤ìº” ëŒ€ìƒ ì¡°ê±´ê³¼ í•„í„° ì¡°í•©

```
@ComponentScan(
  basePackages = "com.example.app",
  includeFilters = {
    @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = Service.class)
  },
  excludeFilters = {
    @ComponentScan.Filter(type = FilterType.REGEX, pattern = ".*Internal.*")
  }
)
```

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©            | ì„¤ëª…                                                         |
| --------------- | ------------------------------------------------------------ |
| ëª©ì             | ì§€ì •ëœ íŒ¨í‚¤ì§€ì—ì„œ Bean ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ íƒìƒ‰       |
| í•µì‹¬ í´ë˜ìŠ¤     | `ClassPathBeanDefinitionScanner`                             |
| íƒìƒ‰ ë°©ë²•       | í´ë˜ìŠ¤ ì „ì²´ ë¡œë”© ì—†ì´ ASMìœ¼ë¡œ `.class` bytecode ì½ìŒ         |
| ëŒ€ìƒ ì–´ë…¸í…Œì´ì…˜ | `@Component`, `@Service`, `@Repository`, `@Controller`, ì»¤ìŠ¤í…€ |
| ê²°ê³¼ë¬¼          | `ScannedGenericBeanDefinition` â†’ BeanFactoryì— ë“±ë¡          |

## ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ê³¼ ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜

### ğŸ”¹ 1. ê°œë… ì •ì˜

| ìš©ì–´                  | ì„¤ëª…                                                         |
| --------------------- | ------------------------------------------------------------ |
| **ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜** | ì‚¬ìš©ìê°€ ì§ì ‘ ì •ì˜í•œ ì–´ë…¸í…Œì´ì…˜                              |
| **ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜**   | ì–´ë…¸í…Œì´ì…˜ ìœ„ì— ë¶™ëŠ” ì–´ë…¸í…Œì´ì…˜ (ì¦‰, ì–´ë…¸í…Œì´ì…˜ì„ ì„¤ëª…í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜) |

------

### ğŸ“Œ 2. ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜ ì¢…ë¥˜ (Java + Spring)

| ì–´ë…¸í…Œì´ì…˜                                        | ì„¤ëª…                                               |
| ------------------------------------------------- | -------------------------------------------------- |
| `@Target`                                         | ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì¼ ìˆ˜ ìˆëŠ” ìœ„ì¹˜ (í´ë˜ìŠ¤, ë©”ì„œë“œ ë“±) |
| `@Retention`                                      | ì–´ë…¸í…Œì´ì…˜ì´ ìœ ì§€ë˜ëŠ” ë²”ìœ„ (ì†ŒìŠ¤, í´ë˜ìŠ¤, ëŸ°íƒ€ì„)  |
| `@Documented`                                     | Javadocì— í¬í•¨ ì—¬ë¶€                                |
| `@Inherited`                                      | ìƒì† ì—¬ë¶€                                          |
| `@Component`                                      | Spring Bean ë“±ë¡ ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜                   |
| `@Service`, `@Controller`                         | ì „ë¶€ `@Component`ì˜ ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜                |
| `@Qualifier`, `@Transactional`, `@RequestMapping` | Springì—ì„œ ë©”íƒ€ ì •ë³´ë¥¼ ê°€ì§„ ê¸°ëŠ¥ì„± ì–´ë…¸í…Œì´ì…˜      |

------

### ğŸ¯ 3. ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ ë§Œë“œëŠ” ê¸°ë³¸ êµ¬ì¡°

#### ì˜ˆ: ì»¤ìŠ¤í…€ `@MyService` ë§Œë“¤ê¸°

```
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Component  // ì¤‘ìš”: ì´ê±¸ ë¶™ì—¬ì•¼ ComponentScan ëŒ€ìƒì´ ë¨
public @interface MyService {
    String value() default "";
}
```

> `@Component`ê°€ ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë“¤ì–´ê°€ ìˆì–´ì•¼ Springì´ ì´ê±¸ Beanìœ¼ë¡œ ì¸ì‹í•¨

------

#### ì‚¬ìš© ì˜ˆ:

```
@MyService("orderService")
public class OrderService {
    ...
}
```

â†’ ì´ í´ë˜ìŠ¤ëŠ” ìë™ìœ¼ë¡œ **Spring Beanìœ¼ë¡œ ë“±ë¡**ë˜ê³ , ì´ë¦„ì€ `"orderService"`ê°€ ë¨

------

### ğŸ§ª 4. ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ + ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜ ì‹¤ì „ íŒ¨í„´

#### (1) ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ëŸ¬ + API ë²„ì „

```
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@RestController
@RequestMapping("/api/v1")
public @interface ApiV1Controller {
}
```

â†’ ì‚¬ìš© ì‹œ:

```
@ApiV1Controller
public class UserController {
    @GetMapping("/users")
    public List<User> list() { ... }
}
```

------

#### (2) ì»¤ìŠ¤í…€ íŠ¸ëœì­ì…˜ ë¡¤ë°± ì–´ë…¸í…Œì´ì…˜

```
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Transactional(rollbackFor = Exception.class)
public @interface RollbackOnException {
}
```

â†’ `@RollbackOnException` ë§Œ ë¶™ì´ë©´ ìë™ìœ¼ë¡œ `@Transactional(rollbackFor = Exception.class)` íš¨ê³¼

------

#### (3) ì»¤ìŠ¤í…€ ìœ íš¨ì„± ê²€ì¦

```
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = MyValidator.class)
public @interface MyValidation {
    String message() default "ìœ íš¨í•˜ì§€ ì•ŠìŒ";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}
```

------

### ğŸ” 5. ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ ì½ê¸° (ë¦¬í”Œë ‰ì…˜ ê¸°ë°˜)

```
MyService annotation = clazz.getAnnotation(MyService.class);
String name = annotation.value();
```

â†’ Bean ë“±ë¡ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ë™ì‘ì„ ì¡°ê±´ë¶€ë¡œ ì œì–´í•  ìˆ˜ ìˆìŒ

------

### ğŸ“¦ 6. ì‹¤ë¬´ì—ì„œ ìì£¼ ì“°ëŠ” ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ ì˜ˆì‹œ

| ëª©ì                   | ì–´ë…¸í…Œì´ì…˜ ì˜ˆ                               |
| --------------------- | ------------------------------------------- |
| API ë²„ì „ êµ¬ë¶„         | `@ApiV1Controller`, `@ApiV2Controller`      |
| ë¡œê¹… ê³µí†µ ì ìš©        | `@Loggable`, `@Trace`                       |
| ë³´ì•ˆ ê¶Œí•œ             | `@AdminOnly`, `@LoginRequired`              |
| íŠ¸ëœì­ì…˜ ì»¤ìŠ¤í„°ë§ˆì´ì§• | `@ReadOnlyTransaction`, `@WriteTransaction` |
| í…ŒìŠ¤íŠ¸ ë¶„ë¥˜           | `@UnitTest`, `@IntegrationTest`             |
| ê³µí†µ ìœ íš¨ì„± ê²€ì‚¬      | `@ValidEmail`, `@PasswordPolicy`            |

------

### âš ï¸ 7. ì£¼ì˜ì‚¬í•­

| í•­ëª©                                                         | ì£¼ì˜ |
| ------------------------------------------------------------ | ---- |
| `@Component` ê³„ì—´ ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜ ì—†ìœ¼ë©´ ìŠ¤ìº” ëŒ€ìƒ âŒ         |      |
| `@Target` ì •í™•íˆ ëª…ì‹œí•˜ì§€ ì•Šìœ¼ë©´ ì‚¬ìš© ìœ„ì¹˜ ì œí•œë¨            |      |
| `@Retention(RUNTIME)` ì´ ì•„ë‹ˆë©´ ë¦¬í”Œë ‰ì…˜ì—ì„œ ì¸ì‹ âŒ          |      |
| ì´ë¦„ ì¤‘ë³µ ë°œìƒ ì‹œ ì¶©ëŒ ê°€ëŠ¥ (`value`, `name` ë“±ì˜ ì†ì„±)      |      |
| ìŠ¤í”„ë§ì—ì„œ ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜ì„ ì¸ì‹í•˜ëŠ” ì¡°ê±´ë„ ìˆìŒ (ì˜ˆ: AOPëŠ” RUNTIME ìœ ì§€ í•„ìˆ˜) |      |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©                   | ì„¤ëª…                                                         |
| ---------------------- | ------------------------------------------------------------ |
| **ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜**  | ì‚¬ìš©ìê°€ ì§ì ‘ ì •ì˜í•œ ê¸°ëŠ¥ì„± íƒœê·¸                             |
| **ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜**    | ì–´ë…¸í…Œì´ì…˜ ìì²´ë¥¼ ì„¤ëª…í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ (`@Target`, `@Retention`, `@Component` ë“±) |
| **ì‹¤ì „ ì˜ˆ**            | `@MyService`, `@ApiV1Controller`, `@TransactionalService`    |
| **Bean ë“±ë¡ ì¡°ê±´**     | `@Component`, `@Service` ê°™ì€ ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜ í•„ìš”           |
| **ë¦¬í”Œë ‰ì…˜ ê¸°ë°˜ ë™ì‘** | AOP, Validator, ì¸í„°ì…‰í„° ë“±ì—ì„œ ë™ì‘ ê°ì§€ ê°€ëŠ¥               |

## SPI êµ¬ì¡°

### ğŸ“Œ 1. SPIë€ ë¬´ì—‡ì¸ê°€?

> **SPI (Service Provider Interface)** ëŠ”
>  **ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ ì‚¬ìš©ì ì •ì˜ ëª¨ë“ˆì´ íŠ¹ì • ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ë¥¼ ì œê³µí•˜ê³ **,
>  ì• í”Œë¦¬ì¼€ì´ì…˜ ëŸ°íƒ€ì„ì— ì´ë¥¼ **ìë™ìœ¼ë¡œ íƒì§€í•˜ì—¬ ë¡œë“œ**í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.

ì¦‰, â€œ**êµ¬í˜„ì²´ëŠ” ë‚˜ì¤‘ì— ì£¼ê³ , ì‹œìŠ¤í…œì€ ì•Œì•„ì„œ ì°¾ì•„ì„œ ì“°ê²Œ í•´ì¤˜**â€ë¼ëŠ” ì„¤ê³„ ë°©ì‹ì´ë‹¤.

------

### ğŸ“¦ 2. Java í‘œì¤€ SPI êµ¬ì¡°

------

#### ê¸°ë³¸ êµ¬ì„±

1. **ì¸í„°í˜ì´ìŠ¤**ë¥¼ ì •ì˜í•œë‹¤
2. ê·¸ ì¸í„°í˜ì´ìŠ¤ì˜ **êµ¬í˜„ì²´ë¥¼ ì œê³µí•œë‹¤**
3. êµ¬í˜„ì²´ë¥¼ **`META-INF/services/` í´ë”ì— ë“±ë¡í•œë‹¤**
4. `ServiceLoader`ë¡œ ë¡œë”©í•œë‹¤

------

#### ì˜ˆì‹œ

#### â‘  ì¸í„°í˜ì´ìŠ¤ ì •ì˜

```
public interface NotificationService {
    void send(String message);
}
```

#### â‘¡ êµ¬í˜„ì²´ ì‘ì„±

```
public class EmailNotificationService implements NotificationService {
    public void send(String message) {
        System.out.println("Email: " + message);
    }
}
```

#### â‘¢ SPI ë“±ë¡ íŒŒì¼ ìƒì„±

ğŸ“ `src/main/resources/META-INF/services/com.example.NotificationService`

```
com.example.EmailNotificationService
```

> ì´ íŒŒì¼ì€ **ë¼ì¸ë§ˆë‹¤ í•œ ê°œì˜ êµ¬í˜„ í´ë˜ìŠ¤ ì´ë¦„**ì„ ì ëŠ” í¬ë§·

#### â‘£ ServiceLoaderë¡œ ë¡œë”©

```
ServiceLoader<NotificationService> loader =
    ServiceLoader.load(NotificationService.class);

for (NotificationService service : loader) {
    service.send("Hello SPI!");
}
```

------

### ğŸ§  3. Springì´ SPIë¥¼ ì“°ëŠ” ë°©ì‹

Spring ìì²´ë„ ë§ì€ ë¶€ë¶„ì—ì„œ **Java SPI + Springì‹ SPIë¥¼ í˜¼ìš©**í•´ì„œ í™•ì¥ êµ¬ì¡°ë¥¼ ë§Œë“¦.

------

#### ëŒ€í‘œì ì¸ Spring SPI ê¸°ë°˜ í™•ì¥ í¬ì¸íŠ¸

| SPI ì¸í„°í˜ì´ìŠ¤                                               | ì„¤ëª…                         |
| ------------------------------------------------------------ | ---------------------------- |
| `org.springframework.context.ApplicationContextInitializer`  | Spring Context ì´ˆê¸° í™•ì¥     |
| `org.springframework.boot.SpringApplicationRunListener`      | Spring Boot ì•± ì´ˆê¸°í™” ê°ì‹œì |
| `org.springframework.boot.env.EnvironmentPostProcessor`      | í™˜ê²½ ì„¤ì • ì¡°ì‘               |
| `org.springframework.beans.factory.support.BeanDefinitionRegistryPostProcessor` | ë¹ˆ ì •ì˜ ë™ì  ë“±ë¡            |
| `org.springframework.core.io.support.SpringFactoriesLoader`  | Springì˜ SPI êµ¬í˜„ì²´ ë¡œë”     |

------

#### ğŸ“ `META-INF/spring.factories`

Spring Bootì—ì„œëŠ” SPI ë“±ë¡ì„ **`spring.factories`** íŒŒì¼ì„ í†µí•´ ìˆ˜í–‰í•œë‹¤.

ğŸ“„ `src/main/resources/META-INF/spring.factories`

```
org.springframework.boot.SpringApplicationRunListener=\
com.example.MyCustomRunListener

org.springframework.context.ApplicationContextInitializer=\
com.example.MyContextInitializer
```

------

### âš™ï¸ 4. í•µì‹¬ í´ë˜ìŠ¤: `SpringFactoriesLoader`

```
List<MySPI> implementations = SpringFactoriesLoader.loadFactories(MySPI.class, classLoader);
```

- Springì€ Javaì˜ `ServiceLoader`ë¥¼ í™•ì¥í•´ì„œ `spring.factories` íŒŒì¼ì—ì„œ SPI êµ¬í˜„ì²´ë“¤ì„ ë¡œë“œí•¨
- ì—¬ëŸ¬ ê°œê°€ ìë™ìœ¼ë¡œ ë¡œë”©ë˜ë©°, ìˆœì„œë¥¼ ì œì–´í•  ìˆ˜ ìˆìŒ (`@Order`, `Ordered` ì¸í„°í˜ì´ìŠ¤)

------

### ğŸ§ª 5. ì‹¤ì „ ì˜ˆì œ: `ApplicationContextInitializer`

```
public class MyInitializer implements ApplicationContextInitializer<ConfigurableApplicationContext> {
    @Override
    public void initialize(ConfigurableApplicationContext context) {
        System.out.println("ğŸ”¥ MyInitializer ì‹¤í–‰ë¨!");
    }
}
```

ğŸ“„ `META-INF/spring.factories`

```
org.springframework.context.ApplicationContextInitializer=\
com.example.MyInitializer
```

Spring Bootê°€ ì‹¤í–‰ë˜ë©´ ìë™ìœ¼ë¡œ ì´ˆê¸°í™”ì— ê°œì…ë¨.

------

### ğŸ” 6. Java SPI vs Spring SPI ë¹„êµ

| í•­ëª©          | Java SPI (`ServiceLoader`) | Spring SPI (`SpringFactoriesLoader`)      |
| ------------- | -------------------------- | ----------------------------------------- |
| ë“±ë¡ ìœ„ì¹˜     | `META-INF/services/`       | `META-INF/spring.factories`               |
| ë‹¤ì¤‘ ì§€ì›     | ê°€ëŠ¥                       | ê°€ëŠ¥                                      |
| ìˆœì„œ ì œì–´     | ë¶ˆê°€                       | ê°€ëŠ¥ (`@Order`, `Ordered`)                |
| ë¦¬í”Œë ‰ì…˜ ì‚¬ìš© | ì˜ˆ                         | ì˜ˆ                                        |
| ì„±ëŠ¥ ìµœì í™”   | ê¸°ë³¸                       | ìºì‹± ë° ë‹¤ì¤‘ ë¡œë”© ìµœì í™”                  |
| ì‚¬ìš© ì‚¬ë¡€     | JDBC, SLF4J ë“±             | Spring Boot ìë™ ì„¤ì •, ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ë“± |

------

### âœ… 7. ë§ˆë¬´ë¦¬ ìš”ì•½

| ê°œë…           | ì„¤ëª…                                                     |
| -------------- | -------------------------------------------------------- |
| **SPI**        | ì¸í„°í˜ì´ìŠ¤ë¥¼ ì™¸ë¶€ì—ì„œ êµ¬í˜„í•˜ê³  ëŸ°íƒ€ì„ì— ë¡œë”©í•˜ëŠ” íŒ¨í„´    |
| **Java SPI**   | `ServiceLoader` + `META-INF/services/`                   |
| **Spring SPI** | `SpringFactoriesLoader` + `META-INF/spring.factories`    |
| **ì‚¬ìš© ëª©ì **  | ëª¨ë“ˆ í™•ì¥ì„±, ëŠìŠ¨í•œ ê²°í•©, ë™ì  ë¡œë”©                      |
| **ì ìš© ì˜ˆ**    | AutoConfiguration, AOP, Context ì´ˆê¸°í™”ê¸°, Bean ë“±ë¡ê¸° ë“± |

## ClassLoader ë° Reflection í™œìš©

### ğŸ§  1. ClassLoaderë€?

> JVMì—ì„œ í´ë˜ìŠ¤ íŒŒì¼(`.class`)ì„ ì½ì–´ì™€ **ë©”ëª¨ë¦¬(ë©”íƒ€ ì˜ì—­)**ì— ì ì¬í•˜ëŠ” **ë™ì  ë¡œë”© ì‹œìŠ¤í…œ**ì´ë‹¤.

#### ğŸ“¦ ë™ì‘ ì›ë¦¬

```
.class íŒŒì¼ â†“
â†’ ClassLoader â†’ Class ê°ì²´ ìƒì„± â†’ ë©”íƒ€ì˜ì—­ ë“±ë¡
```

------

#### ğŸ”¹ ClassLoader ê³„ì¸µ êµ¬ì¡°

| ClassLoader                 | ì„¤ëª…                      | ì˜ˆ                           |
| --------------------------- | ------------------------- | ---------------------------- |
| **BootstrapClassLoader**    | JVM ë‚´ì¥                  | `java.lang.*`, `java.util.*` |
| **ExtensionClassLoader**    | `ext` ë””ë ‰í„°ë¦¬ í´ë˜ìŠ¤     | JDK í™•ì¥ API                 |
| **ApplicationClassLoader**  | `classpath`ì˜ ëª¨ë“  í´ë˜ìŠ¤ | ìš°ë¦¬ê°€ ì‘ì„±í•œ ì½”ë“œ           |
| (Spring) **URLClassLoader** | ë™ì ìœ¼ë¡œ Jar ë¡œë“œ         | í”ŒëŸ¬ê·¸ì¸ ë¡œë”©                |

------

#### âœ… ì£¼ìš” ë©”ì„œë“œ

```
ClassLoader cl = Thread.currentThread().getContextClassLoader();
Class<?> clazz = cl.loadClass("com.example.MyClass");
```

------

### âœ¨ 2. Reflection (ë¦¬í”Œë ‰ì…˜)ì´ë€?

> Javaì—ì„œ **í´ë˜ìŠ¤, ë©”ì„œë“œ, í•„ë“œ, ìƒì„±ì ë“± ë©”íƒ€ì •ë³´ë¥¼ ëŸ°íƒ€ì„ì— ë™ì ìœ¼ë¡œ ì ‘ê·¼í•˜ê³  ì¡°ì‘**í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥.

------

#### ğŸ”§ ì£¼ìš” API

| ë©”ì„œë“œ                 | ì„¤ëª…                          |
| ---------------------- | ----------------------------- |
| `Class.forName("...")` | í´ë˜ìŠ¤ ë¡œë”©                   |
| `getDeclaredMethods()` | ë©”ì„œë“œ ëª©ë¡                   |
| `getConstructor()`     | ìƒì„±ì ì–»ê¸°                   |
| `newInstance()`        | ê°ì²´ ë™ì  ìƒì„±                |
| `setAccessible(true)`  | private í•„ë“œ/ë©”ì„œë“œ ì ‘ê·¼ ê°€ëŠ¥ |

------

#### ğŸ“Œ ì˜ˆì œ

```
Class<?> clazz = Class.forName("com.example.UserService");

Object instance = clazz.getDeclaredConstructor().newInstance();

Method method = clazz.getMethod("sayHello");
method.invoke(instance);
```

------

### ğŸ§¬ 3. Springì—ì„œì˜ ClassLoader + Reflection í™œìš©

------

#### (1) ğŸ“š **í´ë˜ìŠ¤íŒ¨ìŠ¤ ìŠ¤ìº”**

- Springì€ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ì‹œ `.class` íŒŒì¼ì„ ëª¨ë‘ ì½ê³ ,
   **ASM (bytecode parser)** ë¥¼ ì‚¬ìš©í•´ í´ë˜ìŠ¤ ì´ë¦„/ì–´ë…¸í…Œì´ì…˜ë§Œ ì½ê³ 
   ì‹¤ì œ í´ë˜ìŠ¤ë¥¼ **ë¡œë“œí•˜ì§€ ì•ŠìŒ** (Class.forName âŒ)

```
ClassLoader cl = getClass().getClassLoader();
MetadataReader reader = metadataReaderFactory.getMetadataReader(resource);
AnnotationMetadata metadata = reader.getAnnotationMetadata();
```

â†’ ì„±ëŠ¥ ê°œì„ ê³¼ í”„ë¡ì‹œ ì ìš©ì„ ìœ„í•´ **í´ë˜ìŠ¤ ë¡œë”© ìµœì†Œí™”**

------

#### (2) ğŸ§ª **DI (ì˜ì¡´ì„± ì£¼ì…)**

```
Constructor<?> constructor = clazz.getConstructor(Dependency.class);
Object bean = constructor.newInstance(dependency);
```

â†’ Springì€ ê°ì²´ ìƒì„± ì‹œ ìƒì„±ì/í•„ë“œ/ë©”ì„œë“œë¥¼ Reflectionìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ìë™ ì£¼ì…

------

#### (3) ğŸ§™ **AOP í”„ë¡ì‹œ ìƒì„±**

```
ProxyFactory factory = new ProxyFactory(target);
factory.addAdvice(new MyAdvice());
Object proxy = factory.getProxy();
```

â†’ `java.lang.reflect.Proxy` ë˜ëŠ” CGLIBì„ ì´ìš©í•´ ëŸ°íƒ€ì„ì— í”„ë¡ì‹œ í´ë˜ìŠ¤ ìƒì„±

------

#### (4) ğŸ§© **@Autowired, @Value, @Transactional ë“± ì²˜ë¦¬**

- ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•´ì„œ `@Autowired`ê°€ ë¶™ì€ í•„ë“œë¥¼ ì°¾ì•„ ë¹ˆì„ ì£¼ì…
- `@Transactional`ì´ ë¶™ì€ ë©”ì„œë“œë¥¼ ì°¾ì•„ íŠ¸ëœì­ì…˜ ê²½ê³„ë¥¼ í”„ë¡ì‹œë¡œ ê°ìŒˆ
- `@Value("${...}")` â†’ Environmentì—ì„œ ì½ì–´ì„œ í•„ë“œì— ì£¼ì…

------

#### (5) ğŸ§° **ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ ì²˜ë¦¬**

```
Field[] fields = clazz.getDeclaredFields();
for (Field f : fields) {
  if (f.isAnnotationPresent(MyAnnotation.class)) {
    ...
  }
}
```

â†’ ëŸ°íƒ€ì„ì— ì–´ë…¸í…Œì´ì…˜ ì •ë³´ ì½ê³  ë™ì‘ ê²°ì • ê°€ëŠ¥

------

### ğŸš§ 4. ì„±ëŠ¥ ë° ë³´ì•ˆ ì´ìŠˆ

| í•­ëª©             | ì„¤ëª…                                                         |
| ---------------- | ------------------------------------------------------------ |
| ì„±ëŠ¥ ì´ìŠˆ        | ë¦¬í”Œë ‰ì…˜ì€ ì¼ë°˜ í˜¸ì¶œë³´ë‹¤ ëŠë¦¼ (JIT ìµœì í™” ì–´ë ¤ì›€)            |
| ë³´ì•ˆ ì œí•œ        | `setAccessible(true)`ëŠ” Java 9 ì´í›„ ëª¨ë“ˆ ë³´ì•ˆ ì´ìŠˆ ë°œìƒ ê°€ëŠ¥ |
| í´ë˜ìŠ¤ ë¡œë”© ì¶©ëŒ | ì»¤ìŠ¤í…€ ClassLoaderì—ì„œ ê°™ì€ í´ë˜ìŠ¤ ì¤‘ë³µ ë¡œë”© ë¬¸ì œ ë°œìƒ ê°€ëŠ¥  |

------

### âœ… 5. ë§ˆë¬´ë¦¬ ìš”ì•½

| ê¸°ìˆ         | ì—­í•                                   | ì˜ˆì‹œ                                                |
| ----------- | ------------------------------------- | --------------------------------------------------- |
| ClassLoader | `.class`ë¥¼ JVMì— ì ì¬                 | `ClassLoader.loadClass(...)`                        |
| Reflection  | í´ë˜ìŠ¤ êµ¬ì¡°ì— ëŸ°íƒ€ì„ ì ‘ê·¼             | `clazz.getMethod(...)`, `method.invoke(...)`        |
| Spring í™œìš© | Bean ìƒì„±, DI, AOP, AutoConfiguration | `@Autowired`, `@ComponentScan`, `@Transactional` ë“± |

------

### ğŸ“š ì¶”ê°€: Spring Boot AutoConfigurationì—ì„œì˜ í™œìš©

- Spring BootëŠ” `META-INF/spring.factories`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í´ë˜ìŠ¤ ì´ë¦„ì„ ì½ì€ ë’¤,
   ì‹¤ì œ í´ë˜ìŠ¤ë¥¼ **ClassLoaderë¡œ ë¡œë”©í•˜ê³ **,
   ì¡°ê±´ì— ë”°ë¼(`@ConditionalOnClass`) Beanì„ ìƒì„±

```
if (ClassUtils.isPresent("com.fasterxml.jackson.databind.ObjectMapper", classLoader)) {
  // ObjectMapperê°€ classpathì— ìˆìœ¼ë©´ JSON ìë™ êµ¬ì„±
}
```