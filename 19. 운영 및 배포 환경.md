# 19. ìš´ì˜ ë° ë°°í¬ í™˜ê²½

## Spring Boot Actuator

ActuatorëŠ” ìš´ì˜ í™˜ê²½ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **í—¬ìŠ¤ ìƒíƒœ, ë©”íŠ¸ë¦­, í™˜ê²½ ì„¤ì •, ë¡œê·¸, ìºì‹œ, ì“°ë ˆë“œ ë“± ë‚´ë¶€ ì •ë³´ë¥¼ ì™¸ë¶€ì—ì„œ ëª¨ë‹ˆí„°ë§í•˜ê³  ì œì–´**í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ê°•ë ¥í•œ ê¸°ëŠ¥ì´ë‹¤.

### 1. Actuatorë€?

**Spring Boot Actuator**ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **ìš´ì˜ ìƒíƒœ, í—¬ìŠ¤ ì²´í¬, í†µê³„ ë©”íŠ¸ë¦­, í™˜ê²½ ì •ë³´ ë“±ì„ ì™¸ë¶€ì— ë…¸ì¶œí•˜ëŠ” ëª¨ë“ˆ**ì´ë‹¤.

ì£¼ìš” ëª©ì :

- í—¬ìŠ¤ ì²´í¬ (`/actuator/health`)
- ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ (`/actuator/metrics`)
- í™˜ê²½ ì†ì„± í™•ì¸ (`/actuator/env`)
- HTTP íŠ¸ë˜í”½ ì¶”ì  (`/actuator/httptrace`)
- ìºì‹œ ìƒíƒœ, Bean ëª©ë¡ ë“± ë‹¤ì–‘í•œ ì •ë³´ í™•ì¸

------

### 2. ì˜ì¡´ì„± ì¶”ê°€

```
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
}
```

------

### 3. ê¸°ë³¸ ì—”ë“œí¬ì¸íŠ¸

| ì—”ë“œí¬ì¸íŠ¸             | ì„¤ëª…                                             |
| ---------------------- | ------------------------------------------------ |
| `/actuator/health`     | í—¬ìŠ¤ ì²´í¬ (DB, Redis, MQ ë“± ì—°ê²° ì—¬ë¶€ í¬í•¨ ê°€ëŠ¥) |
| `/actuator/info`       | ë¹Œë“œ ì •ë³´, ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ë³´ ë…¸ì¶œ                |
| `/actuator/metrics`    | CPU, ë©”ëª¨ë¦¬, GC, ìš”ì²­ ìˆ˜, ì‘ë‹µ ì‹œê°„ ë“±ì˜ ë©”íŠ¸ë¦­  |
| `/actuator/env`        | `application.yml`ì˜ í™˜ê²½ ë³€ìˆ˜ ë…¸ì¶œ               |
| `/actuator/beans`      | ë“±ë¡ëœ ëª¨ë“  Bean ëª©ë¡                            |
| `/actuator/mappings`   | ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤í•‘ ì •ë³´                               |
| `/actuator/loggers`    | ë¡œê·¸ ë ˆë²¨ ë™ì  ë³€ê²½                              |
| `/actuator/heapdump`   | JVM Heap Dump íŒŒì¼ ë‹¤ìš´ë¡œë“œ                      |
| `/actuator/threaddump` | ì“°ë ˆë“œ ë¤í”„ ì¶œë ¥                                 |
| `/actuator/caches`     | Spring Cache ìƒíƒœ í™•ì¸ ë° ì‚­ì œ                   |

------

### 4. ì„¤ì • ë°©ë²• (`application.yml`)

```
management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
  info:
    env:
      enabled: true
```

- `exposure.include`: ë…¸ì¶œí•  actuator ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ (`*` = ì „ì²´)
- `show-details`: í—¬ìŠ¤ ì •ë³´ ìƒì„¸ ì¶œë ¥ ì—¬ë¶€
- `info.env.enabled`: `info` ì—”ë“œí¬ì¸íŠ¸ì— í™˜ê²½ ì •ë³´ í¬í•¨ ì—¬ë¶€

------

### 5. /actuator/info ì„¤ì •

`info` ì—”ë“œí¬ì¸íŠ¸ì— ì‚¬ìš©ì ì •ì˜ ì •ë³´ ì¶”ê°€ ê°€ëŠ¥:

```
info:
  app:
    name: demo-api
    version: 1.2.3
    description: Spring Boot REST API
```

```
GET /actuator/info
â†’ {
  "app": {
    "name": "demo-api",
    "version": "1.2.3",
    "description": "Spring Boot REST API"
  }
}
```

------

### 6. í—¬ìŠ¤ ì²´í¬ ìƒì„¸í™”

Spring BootëŠ” **DataSource, Redis, MongoDB, Kafka ë“±**ì´ ìë™ìœ¼ë¡œ health êµ¬ì„±ì— í¬í•¨ë¨.

```
management:
  endpoint:
    health:
      show-details: always
```

```
GET /actuator/health
â†’ {
  "status": "UP",
  "components": {
    "db": {
      "status": "UP",
      "details": {
        "database": "MySQL",
        "result": 1
      }
    },
    "diskSpace": {
      "status": "UP",
      "details": { ... }
    }
  }
}
```

------

### 7. Micrometer ê¸°ë°˜ ë©”íŠ¸ë¦­ í†µí•©

Spring Boot ActuatorëŠ” ë‚´ë¶€ì ìœ¼ë¡œ **Micrometer**ë¥¼ ì‚¬ìš©í•¨.
 â†’ Prometheus, Grafana ë“± ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ ì—°ê²° ê°€ëŠ¥

```
GET /actuator/metrics
GET /actuator/metrics/jvm.memory.used
GET /actuator/metrics/http.server.requests
```

------

### 8. Prometheus ì—°ë™

#### ì˜ì¡´ì„± ì¶”ê°€

```
implementation 'io.micrometer:micrometer-registry-prometheus'
```

#### ì„¤ì •

```
management:
  metrics:
    export:
      prometheus:
        enabled: true
  endpoints:
    web:
      exposure:
        include: prometheus
```

```
GET /actuator/prometheus
â†’ Prometheusê°€ ìŠ¤í¬ë˜í•‘ ê°€ëŠ¥
```

------

### 9. ë¡œê·¸ ë ˆë²¨ ì‹¤ì‹œê°„ ë³€ê²½

```
GET /actuator/loggers/com.example.demo
PUT /actuator/loggers/com.example.demo
{
  "configuredLevel": "DEBUG"
}
```

â†’ ì‹¤ì‹œê°„ìœ¼ë¡œ íŠ¹ì • íŒ¨í‚¤ì§€ì˜ ë¡œê·¸ ë ˆë²¨ì„ ë³€ê²½í•  ìˆ˜ ìˆìŒ (ìš´ì˜ ì¤‘ì—ë„ ë””ë²„ê¹… ê°€ëŠ¥)

------

### 10. ìºì‹œ ìƒíƒœ í™•ì¸

```
GET /actuator/caches
â†’ ë“±ë¡ëœ ìºì‹œ ëª©ë¡ ì¶œë ¥

POST /actuator/caches/myCache
â†’ íŠ¹ì • ìºì‹œ í•­ëª© ì‚­ì œ
```

------

### 11. ë³´ì•ˆ: actuator ì ‘ê·¼ ì œí•œ

ê¸°ë³¸ì ìœ¼ë¡œ `/actuator`ëŠ” ë³´ì•ˆì´ í•„ìš”í•¨. Spring Security ì‚¬ìš© ì‹œ ë‹¤ìŒì²˜ëŸ¼ ì„¤ì • ê°€ëŠ¥:

```
management:
  endpoints:
    web:
      exposure:
        include: health, info
  security:
    enabled: true
```

```
@Override
protected void configure(HttpSecurity http) throws Exception {
    http
      .authorizeRequests()
        .requestMatchers("/actuator/**").hasRole("ADMIN")
        .anyRequest().permitAll();
}
```

------

### 12. actuator + Kubernetes, í´ë¼ìš°ë“œ

- `/actuator/health/liveness`, `/actuator/health/readiness`ëŠ” K8s liveness probeì™€ readiness probeë¡œ ì‚¬ìš© ê°€ëŠ¥
- `/actuator/prometheus`ë¡œ Grafana + Prometheus ì—°ë™
- Spring Cloud + Actuator ì¡°í•©ìœ¼ë¡œ Eureka, Gateway, Config Server ìƒíƒœ ì ê²€ë„ ê°€ëŠ¥

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©            | ì„¤ëª…                                                      |
| --------------- | --------------------------------------------------------- |
| í•µì‹¬ ëª©ì        | í—¬ìŠ¤ ì²´í¬, ë©”íŠ¸ë¦­ ìˆ˜ì§‘, ìš´ì˜ ì •ë³´ ë…¸ì¶œ                    |
| ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸ | `/actuator/health`, `/metrics`, `/info`, `/prometheus` ë“± |
| ì„¤ì •            | `management.endpoints.web.exposure.include=*`             |
| í™•ì¥            | Prometheus, Grafana, Slack ì•Œë¦¼ ë“±ê³¼ í†µí•© ê°€ëŠ¥            |
| ë³´ì•ˆ            | í•„ìš” ì‹œ Security ì—°ë™ìœ¼ë¡œ ì¸ì¦ ë³´í˜¸ ê°€ëŠ¥                  |

## Prometheus, Grafana ëª¨ë‹ˆí„°ë§ ì—°ë™

### 1. êµ¬ì„±ë„

```
   [Spring Boot App]
         |
         |  <-- /actuator/prometheus
         |
   [Prometheus]  <-- scrape
         |
         |
   [Grafana]  <-- ì‹œê°í™” ëŒ€ì‹œë³´ë“œ
```

------

### 2. ì‚¬ì „ ìš”êµ¬ ì‚¬í•­

- Spring Boot 2.5+ ë˜ëŠ” 3.x
- `spring-boot-starter-actuator`
- `micrometer-registry-prometheus`
- Prometheus ì‹¤í–‰ í™˜ê²½
- Grafana ì‹¤í–‰ í™˜ê²½

ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸í•  ë• **Dockerë¡œ Prometheus + Grafana** ë„ìš°ëŠ” ê²Œ í¸í•´.

------

### 3. Spring Boot ì„¤ì •

#### ğŸ”¹ ì˜ì¡´ì„± ì¶”ê°€ (Gradle ê¸°ì¤€)

```
implementation 'org.springframework.boot:spring-boot-starter-actuator'
implementation 'io.micrometer:micrometer-registry-prometheus'
```

------

#### ğŸ”¹ application.yml ì„¤ì •

```
management:
  endpoints:
    web:
      exposure:
        include: health, metrics, prometheus
  endpoint:
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
```

------

#### ğŸ”¹ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ í›„ ë¸Œë¼ìš°ì €ì—ì„œ ì•„ë˜ ì£¼ì†Œ í™•ì¸:

```
http://localhost:8080/actuator/prometheus
```

â†’ Prometheusê°€ ì¸ì‹í•  ìˆ˜ ìˆëŠ” **í…ìŠ¤íŠ¸ í¬ë§·ì˜ ë©”íŠ¸ë¦­ ì •ë³´**ê°€ ì¶œë ¥ë˜ì–´ì•¼ í•´.

------

### 4. Prometheus ì„¤ì •

#### ğŸ”¹ Dockerë¡œ Prometheus ì‹¤í–‰

```
docker run -d \
  -p 9090:9090 \
  -v $(pwd)/prometheus.yml:/etc/prometheus/prometheus.yml \
  prom/prometheus
```

------

#### ğŸ”¹ prometheus.yml ë‚´ìš©

```
global:
  scrape_interval: 10s

scrape_configs:
  - job_name: 'spring-boot-app'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['host.docker.internal:8080']
```

> `host.docker.internal`ì€ Dockerì—ì„œ **í˜¸ìŠ¤íŠ¸ì˜ 8080 í¬íŠ¸ì— ì ‘ê·¼**í•˜ëŠ” ê³µì‹ì ì¸ ë°©ë²• (Windows/Mac ê¸°ì¤€)

> ë¦¬ëˆ…ìŠ¤ë¼ë©´ `localhost` ëŒ€ì‹  **ì‹¤ì œ IP**ë¥¼ ì¨ì•¼ í•  ìˆ˜ë„ ìˆìŒ.

------

### 5. Grafana ì„¤ì •

#### ğŸ”¹ Dockerë¡œ Grafana ì‹¤í–‰

```
docker run -d -p 3000:3000 grafana/grafana
```

#### ğŸ”¹ ë¡œê·¸ì¸ ì •ë³´

- URL: http://localhost:3000
- ê¸°ë³¸ ID: `admin` / PW: `admin`

------

#### ğŸ”¹ Prometheus ë°ì´í„°ì†ŒìŠ¤ ì—°ê²°

1. ì¢Œì¸¡ ë©”ë‰´ â†’ âš™ï¸ **Configuration > Data Sources**
2. Add data source â†’ **Prometheus**
3. URL: `http://host.docker.internal:9090`
    (LinuxëŠ” `localhost` ë˜ëŠ” IPë¡œ)

------

### 6. ëŒ€ì‹œë³´ë“œ êµ¬ì„±

#### ğŸ”¹ ë°©ë²• 1: ì§ì ‘ ìƒì„±

- Dashboards â†’ New â†’ Add Panel
- Metric ì„ íƒ: `http_server_requests_seconds_count`, `jvm_memory_used_bytes` ë“±

#### ğŸ”¹ ë°©ë²• 2: JSON Import

1. Grafana ì™¼ìª½ ë©”ë‰´ â†’ ğŸ“ Dashboards â†’ Import
2. Dashboard ID ì…ë ¥: `4701` (Spring Boot Metrics)
3. ë°ì´í„°ì†ŒìŠ¤ ì„ íƒ â†’ Import

> ID 4701ì€ Micrometer + Prometheus ê³µì‹ í…œí”Œë¦¿ì´ì•¼

------

### 7. ëŒ€í‘œ ë©”íŠ¸ë¦­ í•­ëª©

| ë©”íŠ¸ë¦­ ì´ë¦„             | ì„¤ëª…                  |
| ----------------------- | --------------------- |
| `jvm.memory.used`       | JVM ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰     |
| `jvm.gc.pause`          | GC ì‹œê°„               |
| `process.cpu.usage`     | CPU ì‚¬ìš©ë¥             |
| `http.server.requests`  | ìš”ì²­ ìˆ˜, ì‘ë‹µ ì‹œê°„    |
| `logback.events`        | ë¡œê·¸ ë ˆë²¨ë³„ ì´ë²¤íŠ¸ ìˆ˜ |
| `tomcat.threads.active` | í™œì„± ì“°ë ˆë“œ ìˆ˜        |

------

### 8. ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ì¶”ê°€ (ì„ íƒ)

```
@Autowired
MeterRegistry registry;

@PostConstruct
public void init() {
    registry.counter("custom.orders.processed").increment();
}
```

â†’ `/actuator/prometheus`ì—ì„œ `custom_orders_processed` í™•ì¸ ê°€ëŠ¥

------

### 9. ì‹¤ì „ íŒ

| í•­ëª©          | íŒ                                                           |
| ------------- | ------------------------------------------------------------ |
| ë³´ì•ˆ          | `/actuator/prometheus`ëŠ” ì¸ì¦ í•„ìš” ì‹œ Security ì„¤ì •ìœ¼ë¡œ ì œí•œ |
| ë‹¤ì¤‘ ì¸ìŠ¤í„´ìŠ¤ | Prometheusì˜ `job`, `instance` ë ˆì´ë¸”ë¡œ êµ¬ë¶„                 |
| ì‘ë‹µì§€ì—° ì¶”ì  | `http_server_requests_seconds_count`, `sum(rate(...))`ìœ¼ë¡œ ë¶„ì„ |
| ì•Œë¦¼          | Grafana Alert ë˜ëŠ” Prometheus AlertManager ì—°ë™              |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| êµ¬ì„± ìš”ì†Œ   | ì—­í•                                  |
| ----------- | ------------------------------------ |
| Spring Boot | ë©”íŠ¸ë¦­ ì œê³µ (`/actuator/prometheus`) |
| Micrometer  | ì¸¡ì • í¬ë§· ë° ìˆ˜ì§‘                    |
| Prometheus  | ìˆ˜ì§‘ê¸° (scraper)                     |
| Grafana     | ì‹œê°í™” ë„êµ¬                          |

## í™˜ê²½ ë¶„ë¦¬ ì„¤ì •

- ## `application-dev.yml`, `application-prod.yml`

  ### ğŸ“ íŒŒì¼ êµ¬ì¡°

  ```
  src/
  â””â”€â”€ main/
      â””â”€â”€ resources/
          â”œâ”€â”€ application.yml             # ê³µí†µ ì„¤ì •
          â”œâ”€â”€ application-dev.yml         # ê°œë°œ í™˜ê²½ ì „ìš©
          â””â”€â”€ application-prod.yml        # ìš´ì˜ í™˜ê²½ ì „ìš©
  ```

  - `application.yml`: ê³µí†µ ì„¤ì • (ëª¨ë“  í™˜ê²½ì— ì ìš©)
  - `application-dev.yml`: ê°œë°œ í™˜ê²½ ì „ìš© ì„¤ì • (ë¡œì»¬ ê°œë°œ ì‹œ ì‚¬ìš©)
  - `application-prod.yml`: ìš´ì˜ í™˜ê²½ ì „ìš© ì„¤ì • (ì‹¤ì œ ë°°í¬ ì‹œ ì‚¬ìš©)

  ------

  ### ğŸ”§ `application.yml` (ê³µí†µ ì„¤ì • ì˜ˆì‹œ)

  ```
  spring:
    application:
      name: my-api
    profiles:
      active: dev  # ê¸°ë³¸ì€ devë¡œ ì‹œì‘ (ìš´ì˜ ì‹œ ì´ê±¸ ì œê±°í•˜ê³  prodë¡œ ì‹¤í–‰)
  
  server:
    port: 8080
  
  logging:
    file:
      name: logs/app.log
  ```

  ------

  ### ğŸ§ª `application-dev.yml` (ê°œë°œ í™˜ê²½ ì„¤ì • ì˜ˆì‹œ + ìƒì„¸ ì„¤ëª…)

  ```
  spring:
    datasource:
      url: jdbc:mysql://localhost:3306/devdb
      username: devuser
      password: devpass
      driver-class-name: com.mysql.cj.jdbc.Driver
    jpa:
      hibernate:
        ddl-auto: update   # ê°œë°œìš©ìœ¼ë¡œ í…Œì´ë¸” ìë™ ìƒì„±/ì—…ë°ì´íŠ¸
      show-sql: true       # SQL ë¡œê·¸ ì¶œë ¥
      properties:
        hibernate:
          format_sql: true
  
  logging:
    level:
      root: DEBUG
      org.hibernate.SQL: DEBUG
      org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  
  springdoc:
    swagger-ui:
      enabled: true        # Swagger UI ê°œë°œ ì¤‘ì—ë§Œ í™œì„±í™”
  
  custom:
    cache-ttl: 30s         # ìºì‹œ TTLì„ ì§§ê²Œ (ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ ëª©ì )
  
  management:
    endpoints:
      web:
        exposure:
          include: "*"
  ```

  #### âœ… dev í™˜ê²½ íŠ¹ì§•

  | í•­ëª©               | ì„¤ëª…                              |
  | ------------------ | --------------------------------- |
  | `ddl-auto: update` | DB ìŠ¤í‚¤ë§ˆ ìë™ ë³€ê²½ í—ˆìš©          |
  | `show-sql: true`   | ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ ë¡œê·¸ ì¶œë ¥           |
  | ë¡œê·¸ë ˆë²¨           | DEBUG ë° SQL ì¶”ì ìš© TRACE         |
  | Swagger UI         | í•­ìƒ í™œì„±í™”                       |
  | ìºì‹œ TTL           | ì§§ê²Œ ì„¤ì • (30ì´ˆ ë“±)               |
  | Actuator           | ì „ì²´ endpoint ë…¸ì¶œ (`include: *`) |

  ------

  ### ğŸ” `application-prod.yml` (ìš´ì˜ í™˜ê²½ ì„¤ì • ì˜ˆì‹œ + ìƒì„¸ ì„¤ëª…)

  ```
  spring:
    datasource:
      url: jdbc:mysql://prod-db.internal:3306/proddb
      username: produser
      password: ${PROD_DB_PASSWORD}  # ìš´ì˜ í™˜ê²½ì—ì„  í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬
      driver-class-name: com.mysql.cj.jdbc.Driver
    jpa:
      hibernate:
        ddl-auto: none      # ìš´ì˜ DBëŠ” ìë™ ë³€ê²½ âŒ
      show-sql: false
      open-in-view: false   # ì„±ëŠ¥ê³¼ ì•ˆì •ì„± ê³ ë ¤
    jackson:
      serialization:
        indent_output: false  # ì„±ëŠ¥ ê³ ë ¤ (pretty print ì œê±°)
  
  logging:
    level:
      root: WARN
      com.example.app: INFO
  
  custom:
    cache-ttl: 1800s        # ìºì‹œ TTLì„ ê¸¸ê²Œ ì„¤ì • (30ë¶„)
  
  springdoc:
    swagger-ui:
      enabled: false        # ìš´ì˜í™˜ê²½ì—ì„œëŠ” Swagger UI ë¹„í™œì„±í™”
  
  management:
    endpoints:
      web:
        exposure:
          include: health, info, prometheus
    endpoint:
      health:
        show-details: never
  ```

  #### âœ… prod í™˜ê²½ íŠ¹ì§•

  | í•­ëª©             | ì„¤ëª…                                                      |
  | ---------------- | --------------------------------------------------------- |
  | DB ê³„ì •          | ìš´ì˜ìš© ê³„ì • ì‚¬ìš©, `í™˜ê²½ë³€ìˆ˜`ë¡œ ë¹„ë°€ë²ˆí˜¸ ì™¸ë¶€í™”            |
  | `ddl-auto: none` | DB êµ¬ì¡°ëŠ” ìˆ˜ë™ ê´€ë¦¬ (Flyway ë“±)                           |
  | SQL ì¶œë ¥         | ë¹„í™œì„±í™” (`show-sql: false`)                              |
  | Swagger          | ë¹„í™œì„±í™” (ë³´ì•ˆ ìœ„í—˜ ë°©ì§€)                                 |
  | ë¡œê·¸ë ˆë²¨         | WARN ê¸°ë³¸, íŒ¨í‚¤ì§€ë³„ë¡œ INFO ì„¤ì •                           |
  | Cache TTL        | ë” ê¸¸ê²Œ ì„¤ì •                                              |
  | Actuator         | ì œí•œëœ ì—”ë“œí¬ì¸íŠ¸ë§Œ ë…¸ì¶œ (`health`, `info`, `prometheus`) |

  ------

  ### âš™ï¸ í”„ë¡œíŒŒì¼ ì‹¤í–‰ ë°©ì‹

  | ë°©ì‹                    | ëª…ë ¹ì–´ ì˜ˆì‹œ                                          |
  | ----------------------- | ---------------------------------------------------- |
  | ë¡œì»¬ ì‹¤í–‰ ì‹œ dev        | ê¸°ë³¸ìœ¼ë¡œ devê°€ í™œì„±í™”ë¨                              |
  | ìš´ì˜ ì„œë²„ì—ì„œ prod ì‚¬ìš© | `--spring.profiles.active=prod` ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì • |

  ```
  # ì‹¤í–‰ ì˜ˆ
  java -jar app.jar --spring.profiles.active=prod
  ```

  ë˜ëŠ”:

  ```
  export SPRING_PROFILES_ACTIVE=prod
  ./gradlew bootRun
  ```

  ------

  ### âœ… ë³´ì•ˆ ê´€ë ¨ ì£¼ì˜ì‚¬í•­

  | í•­ëª©                                            | ì„¤ëª…                                         |
  | ----------------------------------------------- | -------------------------------------------- |
  | `application-prod.yml`ì€ Gitì— ì»¤ë°‹ âŒ           | `.gitignore`ì— ì¶”ê°€ ë˜ëŠ” CI/CDì—ì„œ ë³„ë„ ì£¼ì… |
  | DB ì•”í˜¸, API Key ë“±ì€ í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” vault ì‚¬ìš© |                                              |
  | Swagger, actuator ë“±ì€ ìš´ì˜ì—ì„œëŠ” ì œí•œ í•„ìš”     |                                              |

  ------

  ### ğŸ§© ì»¤ìŠ¤í…€ ì„¤ì • ì˜ˆì‹œ ê°€ì ¸ì˜¤ê¸°

  ```
  @Value("${custom.cache-ttl}")
  private Duration cacheTtl;
  ```

  ë˜ëŠ” `@ConfigurationProperties(prefix = "custom")`ë¡œ ì „ì²´ ë°”ì¸ë”©ë„ ê°€ëŠ¥í•´.

  ------

  ### âœ… ìš”ì•½ ë¹„êµí‘œ

  | í•­ëª©           | `application-dev.yml` | `application-prod.yml`          |
  | -------------- | --------------------- | ------------------------------- |
  | DB ì£¼ì†Œ        | ë¡œì»¬ ê°œë°œ DB          | ì‹¤ì œ ìš´ì˜ DB                    |
  | Hibernate      | `ddl-auto: update`    | `ddl-auto: none`                |
  | ë¡œê·¸ ë ˆë²¨      | DEBUG, SQL ì¶œë ¥       | WARN, SQL ìˆ¨ê¹€                  |
  | Swagger        | í•­ìƒ í™œì„±í™”           | ë¹„í™œì„±í™”                        |
  | Actuator ë…¸ì¶œ  | ì „ì²´(`*`)             | ì œí•œ(health, info)              |
  | ìºì‹œ TTL       | ì§§ìŒ (30ì´ˆ~1ë¶„)       | ê¹€ (10ë¶„~30ë¶„)                  |
  | ë³´ì•ˆ ë¯¼ê° ì •ë³´ | í¬í•¨ë˜ì–´ë„ ë¨(ë¡œì»¬)   | ë°˜ë“œì‹œ ì™¸ë¶€í™” (í™˜ê²½ë³€ìˆ˜, vault) |

## ë¡œê¹… ì„¤ì •: Logback, Log4j2

### 0. ë¡œê¹… ì‹œìŠ¤í…œ ë¹„êµ

| í•­ëª©               | Logback                   | Log4j2                                          |
| ------------------ | ------------------------- | ----------------------------------------------- |
| Spring Boot ê¸°ë³¸   | âœ… ì˜ˆ (ê¸°ë³¸ í¬í•¨)          | âŒ (ë³„ë„ ì„¤ì • í•„ìš”)                              |
| ë¹„ë™ê¸° ë¡œê¹…        | ì§€ì› (`AsyncAppender`)    | ê³ ì„±ëŠ¥ ë¹„ë™ê¸° ë¡œê¹… (`AsyncLogger`)              |
| XML/JSON/YAML ì„¤ì • | XML (ê¸°ë³¸), Groovyë„ ì§€ì› | XML, JSON, YAML ëª¨ë‘ ì§€ì›                       |
| ì„±ëŠ¥               | ì¢‹ìŒ                      | ë” ìš°ìˆ˜í•¨ (ë¹„ë™ê¸° ì¤‘ì‹¬ ì„¤ê³„)                    |
| ì„¤ì • ë³µì¡ë„        | ì¤‘ê°„                      | ì¡°ê¸ˆ ë” ë³µì¡                                    |
| Spring Boot í†µí•©   | ê¸°ë³¸ ì§€ì›                 | `spring-boot-starter-log4j2`ë¡œ ëª…ì‹œì  ì„¤ì • í•„ìš” |

------

### 1. âœ… Logback ì„¤ì • (Spring Boot ê¸°ë³¸)

------

#### ğŸ“ ê¸°ë³¸ ì„¤ì • íŒŒì¼ ìœ„ì¹˜

```
src/main/resources/logback-spring.xml
```

> âš ï¸ ë°˜ë“œì‹œ `logback.xml`ì´ ì•„ë‹Œ `logback-**spring**.xml` ì‚¬ìš©í•´ì•¼ **Spring profile ì—°ë™**ì´ ê°€ëŠ¥í•¨

------

#### ğŸ”¹ logback-spring.xml ì˜ˆì‹œ

```
<?xml version="1.0" encoding="UTF-8"?>
<configuration>

  <springProperty scope="context" name="LOG_PATH" source="logging.file.path" defaultValue="logs" />
  <property name="LOG_PATTERN" value="%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"/>

  <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_PATH}/app.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>${LOG_PATH}/app.%d{yyyy-MM-dd}.log</fileNamePattern>
      <maxHistory>7</maxHistory>
    </rollingPolicy>
    <encoder>
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <root level="INFO">
    <appender-ref ref="CONSOLE" />
    <appender-ref ref="FILE" />
  </root>

  <logger name="org.hibernate.SQL" level="DEBUG" />
  <logger name="com.example.myapp" level="DEBUG" />

</configuration>
```

------

#### ğŸ”¸ application.ymlì—ì„œ í•¨ê»˜ ì„¤ì • ê°€ëŠ¥

```
logging:
  file:
    path: logs
  level:
    root: INFO
    com.example.myapp: DEBUG
    org.hibernate.SQL: DEBUG
```

> ê°„ë‹¨í•œ ì„¤ì •ì€ `application.yml`ë¡œ ì²˜ë¦¬í•˜ê³ , ì„¸ë¶€ ì„¤ì •ì€ `logback-spring.xml`ë¡œ.

------

#### ğŸ”¹ ë¡œê·¸ í”„ë¡œíŒŒì¼ë§ (dev/prod ë¶„ê¸°)

```
<springProfile name="dev">
  <logger name="org.hibernate.SQL" level="DEBUG" />
</springProfile>

<springProfile name="prod">
  <logger name="org.hibernate.SQL" level="WARN" />
</springProfile>
```

------

### 2. âœ… Log4j2 ì„¤ì •

------

#### ğŸ“¦ ì˜ì¡´ì„± êµì²´ (Gradle)

```
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-log4j2'

    // ë‹¤ìŒ 2ê°œ ì œê±°!
    configurations {
        all {
            exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
        }
    }
}
```

------

#### ğŸ“ ì„¤ì • íŒŒì¼ ì´ë¦„

```
log4j2-spring.xml
```

------

#### ğŸ”¹ log4j2-spring.xml ì˜ˆì‹œ

```
<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="WARN">
  <Appenders>
    <Console name="Console" target="SYSTEM_OUT">
      <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/>
    </Console>

    <RollingFile name="File" fileName="logs/app.log"
                 filePattern="logs/app-%d{yyyy-MM-dd}.log.gz">
      <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/>
      <Policies>
        <TimeBasedTriggeringPolicy />
      </Policies>
    </RollingFile>
  </Appenders>

  <Loggers>
    <Root level="info">
      <AppenderRef ref="Console"/>
      <AppenderRef ref="File"/>
    </Root>
    <Logger name="com.example.myapp" level="debug" additivity="false">
      <AppenderRef ref="File"/>
    </Logger>
  </Loggers>
</Configuration>
```

------

### 3. âœ… ê³µí†µ ì„¤ì • í•­ëª© ìš”ì•½

| ì„¤ì • í•­ëª©      | ì„¤ëª…                                              |
| -------------- | ------------------------------------------------- |
| ë¡œê·¸ íŒŒì¼ ê²½ë¡œ | `logging.file.path` ë˜ëŠ” `.xml` ì§ì ‘ ì§€ì •         |
| ë¡œê·¸ í¬ë§·      | `%d{}` ë‚ ì§œ, `%level`, `%logger`, `%msg`          |
| ë¡œê·¸ ë ˆë²¨      | `TRACE`, `DEBUG`, `INFO`, `WARN`, `ERROR`         |
| íŒŒì¼ ë¡¤ë§      | ë‚ ì§œ ë˜ëŠ” í¬ê¸° ê¸°ì¤€ íšŒì „ (RollingPolicy)          |
| ì½˜ì†” ì¶œë ¥      | `ConsoleAppender`                                 |
| ë¹„ë™ê¸° ë¡œê¹…    | `AsyncAppender` (Logback), `AsyncLogger` (Log4j2) |

------

### 4. âœ… ë¡œê·¸ ë ˆë²¨ ë™ì  ë³€ê²½ (Actuator + Loggers)

```
management:
  endpoints:
    web:
      exposure:
        include: loggers
```

```
GET  /actuator/loggers/com.example.myapp
PUT  /actuator/loggers/com.example.myapp
{
  "configuredLevel": "DEBUG"
}
```

------

### 5. ì–¸ì œ Logback vs Log4j2?

| ê¸°ì¤€                      | Logback             | Log4j2             |
| ------------------------- | ------------------- | ------------------ |
| Spring Boot ê¸°ë³¸          | âœ…                   | âŒ                  |
| ê³ ì„±ëŠ¥ ë¹„ë™ê¸° ë¡œê¹…        | â–³ (`AsyncAppender`) | âœ… (`AsyncLogger`)  |
| ì„¤ì • ìœ ì—°ì„±               | ë³´í†µ                | ë›°ì–´ë‚¨             |
| JSON ë¡œê¹…, Kafka Appender | âŒ (ì™¸ë¶€ ì¶”ê°€ í•„ìš”)  | âœ… í’ë¶€í•œ ê³µì‹ ì§€ì› |
| ê°„ë‹¨í•œ ì„¤ì •               | ì‰¬ì›€                | ì•½ê°„ ë³µì¡í•¨        |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©                | Logback                  | Log4j2               |
| ------------------- | ------------------------ | -------------------- |
| ì„¤ì • íŒŒì¼           | `logback-spring.xml`     | `log4j2-spring.xml`  |
| ê¸°ë³¸ í¬í•¨           | âœ…                        | âŒ (ëª…ì‹œì  êµì²´ í•„ìš”) |
| Spring profile ì—°ë™ | ì§€ì› (`<springProfile>`) | ì§€ì›                 |
| ë¡œê·¸ ë ˆë²¨ ì œì–´      | `application.yml` or XML | ë™ì¼                 |
| ê³ ì„±ëŠ¥ ë¹„ë™ê¸°       | ì œí•œì  (`AsyncAppender`) | ìš°ìˆ˜ (`AsyncLogger`) |

## ë¡œê·¸ ìˆ˜ì§‘ê¸° ì—°ë™: ELK, Loki

### 0. êµ¬ì„± ê°œìš”

| ì‹œìŠ¤í…œ           | êµ¬ì„± ìš”ì†Œ                       |
| ---------------- | ------------------------------- |
| **ELK ìŠ¤íƒ**     | Elasticsearch, Logstash, Kibana |
| **Grafana Loki** | Loki + Promtail + Grafana       |

------

### 1. ğŸ¯ ê³µí†µ ëª©í‘œ: Spring Boot ë¡œê·¸ë¥¼ ì¤‘ì•™ ì„œë²„ë¡œ ìˆ˜ì§‘

```
[Spring Boot App]
   â†“ logs (file or stdout)
[ë¡œê·¸ ìˆ˜ì§‘ê¸°] â† logback ë˜ëŠ” log4j2
   â†“
[Elasticsearch / Loki] â† ìˆ˜ì§‘ê¸° (Filebeat, Promtail ë“±)
   â†“
[Kibana / Grafana] â† ì‹œê°í™”
```

------

### 2. âœ… ELK Stack ì—°ë™ (Elasticsearch + Logstash + Kibana)

------

#### 2.1 ë¡œê·¸ í¬ë§· ì„¤ì • (Logback ê¸°ë°˜ JSON ë¡œê·¸)

ğŸ“ `logback-spring.xml`:

```
<configuration>
  <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>logs/app.log</file>
    <encoder class="net.logstash.logback.encoder.LogstashEncoder" />
  </appender>

  <root level="INFO">
    <appender-ref ref="FILE" />
  </root>
</configuration>
```

#### ğŸ”¸ ì˜ì¡´ì„± ì¶”ê°€

```
implementation 'net.logstash.logback:logstash-logback-encoder:7.4'
```

------

#### 2.2 Filebeat ì„¤ì • (ë¡œê·¸ ìˆ˜ì§‘ê¸° â†’ Logstash/ES)

ğŸ“ `filebeat.yml`:

```
filebeat.inputs:
  - type: log
    paths:
      - /app/logs/app.log
    json.keys_under_root: true
    json.add_error_key: true

output.elasticsearch:
  hosts: ["http://localhost:9200"]

# ë˜ëŠ” Logstash ê²½ìœ  ì‹œ:
# output.logstash:
#   hosts: ["localhost:5044"]
```

> FilebeatëŠ” ê²½ëŸ‰ log shipperë¡œ, ë¡œê·¸ íŒŒì¼ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì½ì–´ Elasticsearchì— ë³´ëƒ„

------

#### 2.3 Kibanaì—ì„œ ì‹œê°í™”

- http://localhost:5601 ì ‘ì†
- "Index Pattern" ìƒì„± â†’ `filebeat-*`
- Discoverì—ì„œ JSON ë¡œê·¸ë¥¼ ì‹¤ì‹œê°„ ê²€ìƒ‰

------

### 3. âœ… Grafana Loki ì—°ë™

------

#### 3.1 ë¡œê¹… í¬ë§·: stdout (í˜¹ì€ JSON íŒŒì¼)

```
logging:
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger - %msg%n"
```

#### 3.2 Promtail ì„¤ì •

ğŸ“ `promtail-config.yaml`:

```
server:
  http_listen_port: 9080

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://localhost:3100/loki/api/v1/push

scrape_configs:
  - job_name: spring-boot-app
    static_configs:
      - targets:
          - localhost
        labels:
          job: springboot
          __path__: /app/logs/*.log
```

> Promtailì€ Lokiì— ë¡œê·¸ë¥¼ pushí•˜ëŠ” agent (Filebeatì˜ ì—­í• ê³¼ ìœ ì‚¬)

------

#### 3.3 Grafana ì„¤ì •

1. Grafana â†’ Configuration â†’ Data Sources
2. Add data source â†’ Loki ì„ íƒ
3. URL: `http://localhost:3100`

------

#### 3.4 Grafana ì¿¼ë¦¬ ì˜ˆì‹œ

```
{job="springboot"} |= "ERROR"
```

â†’ ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ + í•„í„°ë§

------

### 4. âœ… ë¹„êµ: ELK vs Loki

| í•­ëª©        | ELK                         | Loki                                    |
| ----------- | --------------------------- | --------------------------------------- |
| ìŠ¤í† ë¦¬ì§€    | JSON êµ¬ì¡° (Elasticsearch)   | í…ìŠ¤íŠ¸ + ë©”íƒ€ë°ì´í„° (Log lines + label) |
| ì¿¼ë¦¬        | Kibana + Lucene             | Grafana + LogQL                         |
| ì‚¬ìš© ë©”ëª¨ë¦¬ | ë†’ìŒ (Elasticsearch ë¬´ê±°ì›€) | ê°€ë²¼ì›€                                  |
| ìˆ˜ì§‘ê¸°      | Filebeat, Logstash          | Promtail                                |
| ì‹œê°í™” ë„êµ¬ | Kibana                      | Grafana                                 |
| ë„ì… ë‚œì´ë„ | ë†’ìŒ                        | ë‚®ìŒ                                    |
| í†µí•© ìš©ë„   | ë¡œê·¸ ë¶„ì„, ê²€ìƒ‰, í•„í„°ë§     | ë¡œê·¸ ëª¨ë‹ˆí„°ë§, ìŠ¤íŠ¸ë¦¬ë°                 |
| ì¶”ì²œ í™˜ê²½   | ëŒ€ê·œëª¨ ê²€ìƒ‰, ë²•ì  ê°ì‚¬ìš©    | ì‹¤ì‹œê°„ DevOps/í´ë¼ìš°ë“œ í™˜ê²½             |

------

### 5. ì‹¤ì „ ìš´ì˜ íŒ

| í•­ëª©           | íŒ                                                |
| -------------- | ------------------------------------------------- |
| ë¡œê·¸ í¬ë§·      | JSON êµ¬ì¡°ê°€ ìˆ˜ì§‘ê¸°ì™€ ì‹œê°í™”ì— ìœ ë¦¬                |
| íƒœê·¸/Label     | `application`, `env`, `instance` ë“±ì„ ë¡œê·¸ì— í¬í•¨ |
| ë³´ì•ˆ           | ë¡œê·¸ ì„œë²„ì— ì¸ì¦ í”„ë¡ì‹œ ë‘ê¸° (Nginx + Basic Auth) |
| ë¬¸ì œ ëŒ€ì‘      | ë¡œê·¸ íŒŒì‹± ì‹¤íŒ¨ ì‹œ `@timestamp` ìœ ì‹¤, í•„ë“œëª… í™•ì¸  |
| Spring profile | ë¡œê·¸ì— `[dev]`, `[prod]` í¬í•¨í•˜ë©´ êµ¬ë¶„ ì‰¬ì›€       |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| êµ¬ì„±                | ELK                   | Loki                         |
| ------------------- | --------------------- | ---------------------------- |
| ë¡œê·¸ ì €ì¥ì†Œ         | Elasticsearch         | Loki                         |
| ì‹œê°í™”              | Kibana                | Grafana                      |
| ìˆ˜ì§‘ê¸°              | Filebeat / Logstash   | Promtail                     |
| Spring ì„¤ì •         | JSON ë¡œê·¸ + File ì¶œë ¥ | í…ìŠ¤íŠ¸ ë¡œê·¸ + stdout or íŒŒì¼ |
| ì„±ëŠ¥                | ë¬´ê±°ì›€                | ê°€ë²¼ì›€                       |
| ë¡œê·¸ ë¼ì¸ ë‹¨ìœ„ ë¶„ì„ | ì œí•œì                 | ë§¤ìš° ê°•ë ¥ (streaming)        |

## Docker ê¸°ë°˜ ë°°í¬

### 1. ëª©í‘œ

Spring Boot í”„ë¡œì íŠ¸ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ Dockerë¡œ ë°°í¬ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë§Œë“¤ê¸°:

```
[Spring Boot Project]
    â†“ build
[.jar íŒŒì¼ ìƒì„±]
    â†“ Dockerfile ë¹Œë“œ
[Docker ì´ë¯¸ì§€]
    â†“ ì‹¤í–‰
[Docker ì»¨í…Œì´ë„ˆì—ì„œ ì•± ì‹¤í–‰]
```

------

### 2. ì„ í–‰ ì¡°ê±´

- Java 17 ë˜ëŠ” 21 (Spring Boot 3+ ê¶Œì¥)
- Gradle ë˜ëŠ” Maven ë¹Œë“œ íˆ´
- Docker ì„¤ì¹˜ë¨

------

### 3. âœ… JAR ìƒì„±

#### Gradle ê¸°ì¤€

```
./gradlew bootJar
```

ìƒì„± ìœ„ì¹˜:

```
build/libs/myapp-0.0.1-SNAPSHOT.jar
```

------

### 4. âœ… Dockerfile ì‘ì„±

ğŸ“„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `Dockerfile` ìƒì„±

```
# ë² ì´ìŠ¤ ì´ë¯¸ì§€
FROM eclipse-temurin:17-jdk-jammy

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# JAR ë³µì‚¬
COPY build/libs/myapp-0.0.1-SNAPSHOT.jar app.jar

# í¬íŠ¸ ì˜¤í”ˆ
EXPOSE 8080

# ì‹¤í–‰ ëª…ë ¹
ENTRYPOINT ["java", "-jar", "app.jar"]
```

------

### 5. âœ… `.dockerignore` ì‘ì„± (í•„ìˆ˜ ì•„ë‹˜)

```
/build
.gradle
.DS_Store
*.iml
```

â†’ Docker ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶ˆí•„ìš”í•œ íŒŒì¼ ì œì™¸

------

### 6. âœ… ì´ë¯¸ì§€ ë¹Œë“œ

```
docker build -t myapp:latest .
```

ì´ë¯¸ì§€ í™•ì¸:

```
docker images
```

------

### 7. âœ… ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```
docker run -d -p 8080:8080 --name myapp myapp:latest
```

â†’ http://localhost:8080 ì—ì„œ ì •ìƒ ë™ì‘ í™•ì¸

------

### 8. âœ… í™˜ê²½ ë³€ìˆ˜/í”„ë¡œíŒŒì¼ ì„¤ì •

```
docker run -d \
  -p 8080:8080 \
  -e SPRING_PROFILES_ACTIVE=prod \
  -e SPRING_DATASOURCE_URL=jdbc:mysql://host.docker.internal:3306/proddb \
  myapp:latest
```

------

### 9. âœ… volume/log ì„¤ì • (ìš´ì˜ ì¶”ì²œ)

```
docker run -d \
  -v /var/log/myapp:/app/logs \
  -e LOG_PATH=/app/logs \
  myapp:latest
```

------

### 10. Docker Compose ì˜ˆì œ (ë©€í‹° ì»¨í…Œì´ë„ˆ)

ğŸ“„ `docker-compose.yml` ì˜ˆì‹œ:

```
version: '3.8'
services:
  myapp:
    image: myapp:latest
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    depends_on:
      - mysql
  mysql:
    image: mysql:8
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: proddb
    ports:
      - "3306:3306"
```

```
docker-compose up --build
```

------

### 11. ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ (ê³ ê¸‰)

```
# 1ë‹¨ê³„: Build
FROM gradle:8.3-jdk17 AS builder
WORKDIR /workspace
COPY . .
RUN gradle bootJar

# 2ë‹¨ê³„: Run
FROM eclipse-temurin:17-jdk
WORKDIR /app
COPY --from=builder /workspace/build/libs/*.jar app.jar
ENTRYPOINT ["java", "-jar", "app.jar"]
```

â†’ ë¹Œë“œ íˆ´ ì—†ì´ **ê°€ë²¼ìš´ ì´ë¯¸ì§€** ìƒì„± ê°€ëŠ¥

------

### 12. ì´ë¯¸ì§€ ìµœì í™” íŒ

| í•­ëª©           | ì „ëµ                                           |
| -------------- | ---------------------------------------------- |
| ì´ë¯¸ì§€ í¬ê¸°    | `eclipse-temurin`, `alpine`, `distroless` ì‚¬ìš© |
| ë³´ì•ˆ           | root ì‚¬ìš©ì ê¸ˆì§€, `USER 1000`                  |
| ì„¤ì • íŒŒì¼ ë¶„ë¦¬ | `config/` â†’ volume mount                       |
| JAR ìœ„ì¹˜       | `/app/app.jar` ë“± í‘œì¤€í™” ê¶Œì¥                  |
| healthcheck    | Dockerfile ë˜ëŠ” Composeì—ì„œ ì„¤ì • ê°€ëŠ¥          |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| ë‹¨ê³„            | ëª…ë ¹                             |
| --------------- | -------------------------------- |
| JAR ìƒì„±        | `./gradlew bootJar`              |
| Dockerfile ì‘ì„± | `FROM eclipse-temurin` ë“±        |
| ì´ë¯¸ì§€ ë¹Œë“œ     | `docker build -t myapp .`        |
| ì»¨í…Œì´ë„ˆ ì‹¤í–‰   | `docker run -p 8080:8080 myapp`  |
| í”„ë¡œíŒŒì¼ ì„¤ì •   | `-e SPRING_PROFILES_ACTIVE=prod` |
| ë¡œê·¸ ë³¼ë¥¨ ì„¤ì •  | `-v /logs:/app/logs`             |
| Compose êµ¬ì„±    | `docker-compose.yml` ì‚¬ìš©        |

## Kubernetes ë°°í¬

### ğŸ“Œ ëª©í‘œ

Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ Kubernetesì— ë‹¤ìŒê³¼ ê°™ì´ ë°°í¬:

```
[Spring Boot ì•± (Docker ì´ë¯¸ì§€)]
     â†“
[Deployment] â†’ [Pod(s)] â† [ReplicaSet]
     â†‘
[Service] â† Cluster ë‚´ë¶€/ì™¸ë¶€ ë¼ìš°íŒ…
     â†‘
[Ingress or LoadBalancer]
```

------

### 1. ì¤€ë¹„ ì‚¬í•­

| í•­ëª©                | í•„ìš”                                  |
| ------------------- | ------------------------------------- |
| Docker              | ì´ë¯¸ì§€ ë¹Œë“œìš©                         |
| Kubernetes í´ëŸ¬ìŠ¤í„° | Minikube, Docker Desktop, EKS/GKE/AKS |
| kubectl             | í´ëŸ¬ìŠ¤í„° ì œì–´                         |
| (ì„ íƒ) Helm         | ë°°í¬ í…œí”Œë¦¿ ë„êµ¬                      |

------

### 2. Docker ì´ë¯¸ì§€ ë¹Œë“œ

```
./gradlew bootJar
docker build -t myapp:latest .
```

ë¡œì»¬ Minikubeì—ì„œ ì‚¬ìš© ì‹œ:

```
eval $(minikube docker-env)  # Minikube ë‚´ë¶€ ë„ì»¤ ì‚¬ìš©
docker build -t myapp:latest .
```

------

### 3. Kubernetes ë¦¬ì†ŒìŠ¤ ì •ì˜

#### ğŸ“„ 1. Deployment (myapp-deployment.yaml)

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 2
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
        - name: myapp-container
          image: myapp:latest
          ports:
            - containerPort: 8080
          env:
            - name: SPRING_PROFILES_ACTIVE
              value: prod
```

------

#### ğŸ“„ 2. Service (myapp-service.yaml)

```
apiVersion: v1
kind: Service
metadata:
  name: myapp-service
spec:
  type: ClusterIP
  selector:
    app: myapp
  ports:
    - port: 80
      targetPort: 8080
```

> ì™¸ë¶€ì—ì„œ ì ‘ì†í•˜ë ¤ë©´ `type: LoadBalancer` ë˜ëŠ” Ingress í•„ìš”

------

#### ğŸ“„ 3. Ingress (ì„ íƒ: myapp-ingress.yaml)

```
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: myapp-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
    - host: myapp.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: myapp-service
                port:
                  number: 80
```

> `minikube addons enable ingress`ë¡œ Nginx Ingress í™œì„±í™” í•„ìš”

------

### 4. ë¦¬ì†ŒìŠ¤ ë°°í¬

```
kubectl apply -f myapp-deployment.yaml
kubectl apply -f myapp-service.yaml
kubectl apply -f myapp-ingress.yaml  # ì„ íƒ
```

------

### 5. ì„œë¹„ìŠ¤ ì ‘ê·¼

- **ClusterIP**: í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼
- **LoadBalancer**: ì™¸ë¶€ IP ìë™ í• ë‹¹ (í´ë¼ìš°ë“œ í™˜ê²½)
- **Ingress + DNS**: í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ… (ex: `myapp.local`)

```
minikube service myapp-service  # LoadBalancer ëŒ€ì²´
```

------

### 6. ìƒíƒœ í™•ì¸

```
kubectl get pods
kubectl get deployments
kubectl get services
kubectl describe pod myapp-xxxxx
kubectl logs myapp-xxxxx
```

------

### 7. ì„¤ì • ConfigMap / Secret ë¶„ë¦¬

#### ğŸ“„ ConfigMap

```
apiVersion: v1
kind: ConfigMap
metadata:
  name: myapp-config
data:
  SPRING_PROFILES_ACTIVE: prod
```

#### ğŸ“„ Deployment ì ìš©

```
envFrom:
  - configMapRef:
      name: myapp-config
```

------

### 8. Health Check

```
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 15
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 5
```

> Spring Boot 2.3+ ì´ìƒì—ì„œ actuatorì—ì„œ `/liveness`, `/readiness` ì§€ì›

------

### 9. ë¡¤ë§ ì—…ë°ì´íŠ¸ ë° ìŠ¤ì¼€ì¼ë§

```
kubectl scale deployment myapp --replicas=4
kubectl rollout restart deployment myapp
```

------

### 10. (ì„ íƒ) Helm íŒ¨í‚¤ì§€í™”

```
helm create myapp-chart
# templates/deployment.yaml, service.yaml ì„¤ì •
helm install myapp ./myapp-chart
```

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| êµ¬ì„± ìš”ì†Œ        | ì—­í•                             |
| ---------------- | ------------------------------- |
| Deployment       | ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ì˜, Replica ê´€ë¦¬ |
| Service          | Pod ë¼ìš°íŒ…, ë‚´ë¶€ LoadBalancer   |
| Ingress          | ì™¸ë¶€ ë¼ìš°íŒ… (ë„ë©”ì¸ â†’ ì„œë¹„ìŠ¤)   |
| ConfigMap/Secret | ì„¤ì • ë¶„ë¦¬                       |
| Probes           | í—¬ìŠ¤ ì²´í¬ (liveness/readiness)  |
| Helm             | ë°°í¬ í…œí”Œë¦¿í™”                   |

## Helm Chart

### 1. Helmì´ë€?

| í•­ëª©       | ì„¤ëª…                                           |
| ---------- | ---------------------------------------------- |
| Helm       | Kubernetesìš© íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €                     |
| Chart      | Helmì˜ íŒ¨í‚¤ì§€ ë‹¨ìœ„ (YAML í…œí”Œë¦¿ + values ì„¤ì •) |
| Release    | Chartë¥¼ ì‹¤í–‰í•œ ê²°ê³¼ (ì¸ìŠ¤í„´ìŠ¤)                 |
| Repository | Chartë¥¼ ì €ì¥í•˜ëŠ” ê³³ (ë¡œì»¬/ê³µì‹/ì‚¬ì„¤ ë“±)        |

------

### 2. ì„¤ì¹˜ ë° ì´ˆê¸°í™”

```
brew install helm  # macOS
choco install kubernetes-helm  # Windows
```

ë²„ì „ í™•ì¸:

```
helm version
```

------

### 3. Helm Chart ìƒì„±

```
helm create spring-boot-app
```

êµ¬ì¡°:

```
spring-boot-app/
â”œâ”€â”€ charts/                  # í•˜ìœ„ ì°¨íŠ¸
â”œâ”€â”€ templates/               # K8s ë¦¬ì†ŒìŠ¤ í…œí”Œë¦¿
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â”œâ”€â”€ ingress.yaml
â”‚   â””â”€â”€ _helpers.tpl         # ë³€ìˆ˜ ì²˜ë¦¬ í…œí”Œë¦¿
â”œâ”€â”€ values.yaml              # ì‚¬ìš©ì ì •ì˜ ë³€ìˆ˜ íŒŒì¼
â”œâ”€â”€ Chart.yaml               # Chart ë©”íƒ€ë°ì´í„°
```

------

### 4. Chart.yaml í¸ì§‘

```
apiVersion: v2
name: spring-boot-app
description: Spring Boot Helm Chart
version: 0.1.0
appVersion: "1.0.0"
```

------

### 5. values.yaml ì •ì˜ (ì‚¬ìš©ì ì»¤ìŠ¤í„°ë§ˆì´ì§•)

```
replicaCount: 2

image:
  repository: myapp
  tag: latest
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80

env:
  SPRING_PROFILES_ACTIVE: prod

resources:
  limits:
    cpu: 500m
    memory: 512Mi

ingress:
  enabled: true
  className: nginx
  hosts:
    - host: myapp.local
      paths:
        - path: /
          pathType: Prefix
```

------

### 6. templates/deployment.yaml ì‘ì„±

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "spring-boot-app.fullname" . }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ include "spring-boot-app.name" . }}
  template:
    metadata:
      labels:
        app: {{ include "spring-boot-app.name" . }}
    spec:
      containers:
        - name: app
          image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          ports:
            - containerPort: 8080
          env:
            - name: SPRING_PROFILES_ACTIVE
              value: {{ .Values.env.SPRING_PROFILES_ACTIVE | quote }}
```

------

### 7. templates/service.yaml

```
apiVersion: v1
kind: Service
metadata:
  name: {{ include "spring-boot-app.fullname" . }}
spec:
  type: {{ .Values.service.type }}
  selector:
    app: {{ include "spring-boot-app.name" . }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: 8080
```

------

### 8. templates/ingress.yaml (ì˜µì…˜)

```
{{- if .Values.ingress.enabled }}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ include "spring-boot-app.fullname" . }}
spec:
  ingressClassName: {{ .Values.ingress.className }}
  rules:
    {{- range .Values.ingress.hosts }}
    - host: {{ .host }}
      http:
        paths:
          {{- range .paths }}
          - path: {{ .path }}
            pathType: {{ .pathType }}
            backend:
              service:
                name: {{ include "spring-boot-app.fullname" $ }}
                port:
                  number: {{ $.Values.service.port }}
          {{- end }}
    {{- end }}
{{- end }}
```

------

### 9. ë°°í¬ ëª…ë ¹ì–´

```
helm install springboot-release ./spring-boot-app
```

â†’ ì´ ëª…ë ¹ì€ `Release` ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì „ì²´ ë¦¬ì†ŒìŠ¤ë¥¼ K8sì— ì ìš©í•´.

------

### 10. ê°’ ì˜¤ë²„ë¼ì´ë“œ ë°©ì‹

```
helm install springboot-release ./spring-boot-app \
  --set image.tag=1.2.3 \
  --set env.SPRING_PROFILES_ACTIVE=dev
```

ë˜ëŠ”:

```
helm upgrade springboot-release ./spring-boot-app -f custom-values.yml
```

------

### 11. ìƒíƒœ í™•ì¸

```
helm list
helm status springboot-release
helm uninstall springboot-release
```

------

### 12. ë°°í¬ ê²°ê³¼ í™•ì¸

```
kubectl get all
kubectl describe deployment spring-boot-app
kubectl logs -f [pod-name]
```

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| êµ¬ì„± ìš”ì†Œ          | ì—­í•                            |
| ------------------ | ------------------------------ |
| `Chart.yaml`       | Helm ì°¨íŠ¸ ì •ë³´ (ì´ë¦„, ë²„ì „)    |
| `values.yaml`      | ì‚¬ìš©ìê°€ ë®ì–´ì“¸ ìˆ˜ ìˆëŠ” ê¸°ë³¸ê°’ |
| `templates/*.yaml` | Kubernetes ë¦¬ì†ŒìŠ¤ í…œí”Œë¦¿       |
| `helm install`     | Helm ë°°í¬ ì‹¤í–‰                 |
| `helm upgrade`     | ì„¤ì • ë³€ê²½ í›„ ë¡¤ë§ ì—…ë°ì´íŠ¸     |
| `helm uninstall`   | ë°°í¬ ì œê±° (ë¦¬ì†ŒìŠ¤ ìë™ ì‚­ì œ)   |

## CI/CD êµ¬ì„± (GitHub Actions, Jenkins, GitLab CI)

### ğŸ“Œ ê³µí†µ íŒŒì´í”„ë¼ì¸ íë¦„

```
[Git Push]
   â†“
[CI: Build]
   - Gradle/Maven ë¹Œë“œ
   - í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
   - Docker ì´ë¯¸ì§€ ë¹Œë“œ
   - ì´ë¯¸ì§€ Registryì— í‘¸ì‹œ
   â†“
[CD: Deploy]
   - K8s í´ëŸ¬ìŠ¤í„° ì ‘ê·¼
   - Helm upgrade ë˜ëŠ” kubectl apply
```

------

### âœ… 1. GitHub Actions êµ¬ì„±

#### ğŸ“„ `.github/workflows/deploy.yml`

```
name: CI/CD Pipeline

on:
  push:
    branches: [ main ]

env:
  IMAGE_NAME: ghcr.io/your-org/springboot-app

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Build with Gradle
        run: ./gradlew bootJar

      - name: Log in to GitHub Container Registry
        run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin

      - name: Build and push Docker image
        run: |
          docker build -t $IMAGE_NAME:${{ github.sha }} .
          docker push $IMAGE_NAME:${{ github.sha }}

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up kubectl
        uses: azure/setup-kubectl@v3
        with:
          version: 'v1.27.3'

      - name: Set KUBECONFIG
        run: |
          echo "${{ secrets.KUBECONFIG }}" | base64 --decode > kubeconfig.yaml
          export KUBECONFIG=$(pwd)/kubeconfig.yaml

      - name: Helm upgrade
        run: |
          helm upgrade --install springboot ./spring-boot-app \
            --set image.repository=$IMAGE_NAME \
            --set image.tag=${{ github.sha }}
```

#### ğŸ”’ Secret ëª©ë¡

- `GITHUB_TOKEN`: ìë™ìœ¼ë¡œ ì„¤ì •ë¨
- `KUBECONFIG`: base64 ì¸ì½”ë”©ëœ kubeconfig íŒŒì¼

------

### âœ… 2. Jenkins êµ¬ì„±

#### ğŸ“„ Jenkinsfile

```
pipeline {
  agent any

  environment {
    IMAGE = "myregistry.io/springboot:${env.BUILD_NUMBER}"
    KUBECONFIG_CRED = credentials('kubeconfig')
  }

  stages {
    stage('Checkout') {
      steps {
        git 'https://github.com/your-org/springboot-app.git'
      }
    }

    stage('Build') {
      steps {
        sh './gradlew bootJar'
      }
    }

    stage('Docker Build & Push') {
      steps {
        sh """
          docker build -t $IMAGE .
          docker push $IMAGE
        """
      }
    }

    stage('Deploy to K8s') {
      steps {
        withCredentials([file(credentialsId: 'kubeconfig', variable: 'KUBECONFIG')]) {
          sh """
            helm upgrade --install springboot ./spring-boot-app \
              --set image.repository=myregistry.io/springboot \
              --set image.tag=${env.BUILD_NUMBER}
          """
        }
      }
    }
  }
}
```

> `credentialsId: 'kubeconfig'`ëŠ” Jenkinsì— ë“±ë¡í•œ kubeconfig íŒŒì¼ í¬ë¦¬ë´ì…œ

------

### âœ… 3. GitLab CI êµ¬ì„±

#### ğŸ“„ `.gitlab-ci.yml`

```
stages:
  - build
  - deploy

variables:
  IMAGE_TAG: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHORT_SHA

build:
  stage: build
  image: gradle:8.3-jdk17
  script:
    - ./gradlew bootJar
    - docker build -t $IMAGE_TAG .
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - docker push $IMAGE_TAG

deploy:
  stage: deploy
  image: bitnami/kubectl:1.27
  script:
    - echo "$KUBECONFIG_DATA" | base64 -d > kubeconfig
    - export KUBECONFIG=$PWD/kubeconfig
    - helm upgrade --install springboot ./spring-boot-app \
        --set image.repository=$CI_REGISTRY_IMAGE \
        --set image.tag=$CI_COMMIT_SHORT_SHA
```

#### ğŸ”’ GitLab Secret ëª©ë¡

- `KUBECONFIG_DATA`: base64ë¡œ ì¸ì½”ë”©ëœ kubeconfig
- `CI_REGISTRY_USER`, `CI_REGISTRY_PASSWORD`: GitLab ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì¸ì¦ìš©

------

### ğŸ” ê³µí†µ Helm ê°’ íŒŒì¼ (`values.yaml`)

```
image:
  repository: myregistry.io/springboot
  tag: latest

env:
  SPRING_PROFILES_ACTIVE: prod
```

â†’ `--set image.tag=...` ìœ¼ë¡œ ë®ì–´ì“°ê¸° ê°€ëŠ¥

------

### âœ… CI/CD ì‹œìŠ¤í…œ ë¹„êµ

| í•­ëª©             | GitHub Actions       | Jenkins             | GitLab CI            |
| ---------------- | -------------------- | ------------------- | -------------------- |
| ëŸ¬ë„ˆ ì œê³µ        | âœ… (GitHub Hosted)    | âŒ (ì§ì ‘ ì„¤ì¹˜)       | âœ…                    |
| ë¹Œë“œ ì†ë„        | ë¹ ë¦„                 | ììœ  ì„¤ì •           | ë¹ ë¦„                 |
| Helm/K8s ì—°ë™    | ê°„ë‹¨ (action ë§ìŒ)   | ììœ ë„ ë†’ìŒ         | ë¹„êµì  ì‰¬ì›€          |
| ë³´ì•ˆ/Secret ê´€ë¦¬ | GitHub Secrets       | Jenkins Credentials | GitLab Variables     |
| ê°•ì              | ì˜¤í”ˆì†ŒìŠ¤ í†µí•©ì— ê°•í•¨ | ìœ ì—°í•œ íŒŒì´í”„ë¼ì¸   | ë ˆì§€ìŠ¤íŠ¸ë¦¬ + CI í†µí•© |

------

### ğŸ”’ ë³´ì•ˆ íŒ

- kubeconfigëŠ” base64 ì¸ì½”ë”©í•´ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ë“±ë¡í•˜ê³  `echo | decode` ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©
- DOCKER_AUTH, CI í† í°ì€ ì ˆëŒ€ Gitì— ì»¤ë°‹í•˜ì§€ ì•Šê¸°
- Helm ê°’ ì¤‘ ë¯¼ê°ì •ë³´ëŠ” Secretìœ¼ë¡œ ë¶„ë¦¬ (`--set-string env.JWT_SECRET=...`)

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| ë‹¨ê³„     | ì‘ì—…                                           |
| -------- | ---------------------------------------------- |
| CI       | ë¹Œë“œ, í…ŒìŠ¤íŠ¸, Docker ì´ë¯¸ì§€ ìƒì„± ë° Push       |
| CD       | Helm upgrade ë˜ëŠ” `kubectl apply`              |
| Secret   | kubeconfig, registry ì¸ì¦ì •ë³´, ì•± ì„¤ì • ê°’ ë“±   |
| íˆ´       | GitHub Actions / Jenkins / GitLab CI ëª¨ë‘ ê°€ëŠ¥ |
| ìš´ì˜í™˜ê²½ | GKE, EKS, AKS ë“± í´ë¼ìš°ë“œ í´ëŸ¬ìŠ¤í„° ì—°ë™ ê°€ëŠ¥   |