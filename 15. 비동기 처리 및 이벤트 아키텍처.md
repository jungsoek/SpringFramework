# 15. ë¹„ë™ê¸° ì²˜ë¦¬ ë° ì´ë²¤íŠ¸ ì•„í‚¤í…ì²˜

## ë¹„ë™ê¸° ì²˜ë¦¬ (`@Async`)

### ğŸ§© 1. `@Async`ë€?

> Springì—ì„œ **ë©”ì„œë“œë¥¼ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ë¹„ë™ê¸°ë¡œ ì‹¤í–‰**í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜

- ë©”ì„œë“œ í˜¸ì¶œì´ **ì¦‰ì‹œ ë°˜í™˜ë˜ê³ **,
- ë‚´ë¶€ ë¡œì§ì€ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë¨
- ë³‘ë ¬ ì²˜ë¦¬, ëŒ€ê¸°ì‹œê°„ ê°ì†Œ, ì‘ë‹µ ì§€ì—° ìµœì†Œí™” ë“±ì— ìœ ìš©

------

### âš™ï¸ 2. ì‚¬ìš© ì „ ì„¤ì •

#### âœ… ë¹„ë™ê¸° ê¸°ëŠ¥ í™œì„±í™”

```
@SpringBootApplication
@EnableAsync
public class MyApplication { ... }
```

> `@EnableAsync`ëŠ” ë°˜ë“œì‹œ ë£¨íŠ¸ ì„¤ì • í´ë˜ìŠ¤ ë˜ëŠ” ì„¤ì •ìš© `@Configuration` í´ë˜ìŠ¤ì— ì„ ì–¸í•´ì•¼ í•¨

------

### ğŸ“˜ 3. ê¸°ë³¸ ì‚¬ìš© ì˜ˆ

```
@Service
public class NotificationService {

    @Async
    public void sendEmail(String email) {
        // ë¹„ë™ê¸° ë©”ì„œë“œ
        System.out.println("ğŸ“§ ì´ë©”ì¼ ë°œì†¡ ì¤‘...: " + email);
        // ì˜ˆ: ë©”ì¼ ì„œë²„ ì—°ê²°, ëŒ€ê¸°
    }
}
```

```
notificationService.sendEmail("user@example.com");
// í˜¸ì¶œ ì¦‰ì‹œ ë°˜í™˜ë¨ (ì‹¤í–‰ì€ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œ)
```

------

### ğŸ”„ 4. ë°˜í™˜ê°’ì´ ìˆëŠ” ê²½ìš°: `Future`, `CompletableFuture`

#### âœ… ë¹„ë™ê¸° ê²°ê³¼ ë°›ê¸°

```
@Async
public CompletableFuture<String> findUserName(Long id) {
    // ì™¸ë¶€ API í˜¸ì¶œ ë“±
    return CompletableFuture.completedFuture("Jeongseok");
}
```

```
CompletableFuture<String> nameFuture = userService.findUserName(1L);
String name = nameFuture.get();  // ë¹„ë™ê¸° ê²°ê³¼ ëŒ€ê¸°
```

> ë‹¨, `.get()`ì„ í˜¸ì¶œí•˜ë©´ **ë¸”ë¡œí‚¹ ë°œìƒ** â†’ UI ì“°ë ˆë“œë‚˜ Controllerì—ì„œëŠ” ì‚¬ìš© ì£¼ì˜

------

### ğŸ§¨ 5. ì˜ˆì™¸ ì²˜ë¦¬

ë¹„ë™ê¸° ë©”ì„œë“œì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´,

- `void` ë°˜í™˜ â†’ ë¡œê·¸ë§Œ ì°íˆê³  ì™¸ë¶€ë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŒ
- `CompletableFuture` ë°˜í™˜ â†’ `.get()` í˜¸ì¶œ ì‹œ ì˜ˆì™¸ ë°œìƒ

```
@Async
public CompletableFuture<String> failAsync() {
    throw new RuntimeException("ì˜ˆì™¸ ë°œìƒ!");
}
```

```
try {
    future.get();
} catch (ExecutionException e) {
    System.out.println("â—ï¸ ë¹„ë™ê¸° ì˜ˆì™¸: " + e.getCause().getMessage());
}
```

------

### ğŸ§µ 6. ì»¤ìŠ¤í…€ Executor ì„¤ì •

ê¸°ë³¸ì€ `SimpleAsyncTaskExecutor` (ThreadPool ì—†ìŒ)

#### âœ… ì„¤ì • í´ë˜ìŠ¤

```
@Configuration
@EnableAsync
public class AsyncConfig {

    @Bean(name = "asyncExecutor")
    public Executor asyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(4);
        executor.setMaxPoolSize(8);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("async-thread-");
        executor.initialize();
        return executor;
    }
}
```

#### âœ… íŠ¹ì • Executor ì§€ì •

```
@Async("asyncExecutor")
public void asyncWithCustomThreadPool() { ... }
```

------

### ğŸ” 7. ì‹¤ë¬´ì—ì„œ ìì£¼ ì“°ëŠ” ì˜ˆì‹œ

| ì‚¬ìš© ì‚¬ë¡€          | ì„¤ëª…                         |
| ------------------ | ---------------------------- |
| ì´ë©”ì¼, ì•Œë¦¼ ë°œì†¡  | ëŒ€ê¸° ì‹œê°„ ì—†ëŠ” ì²˜ë¦¬          |
| ë¡œê·¸ ë¹„ë™ê¸° ì €ì¥   | ì„±ëŠ¥ ì €í•˜ ë°©ì§€               |
| ì™¸ë¶€ API ë³‘ë ¬ í˜¸ì¶œ | ëŒ€ê¸° ì‹œê°„ ìµœì í™”             |
| íŒŒì¼ ì €ì¥, ì²˜ë¦¬    | I/O ë³‘ëª© í•´ì†Œ                |
| ìºì‹œ í”„ë¦¬ë¡œë”©      | ì„œë²„ ì‹œì‘ í›„ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… |

------

### â— 8. ì£¼ì˜ì‚¬í•­

| ì£¼ì˜ í•­ëª©               | ì„¤ëª…                                                         |
| ----------------------- | ------------------------------------------------------------ |
| **ìê¸° ìì‹  í˜¸ì¶œ ê¸ˆì§€** | ê°™ì€ í´ë˜ìŠ¤ ë‚´ì—ì„œ `@Async` ë©”ì„œë“œ í˜¸ì¶œ ì‹œ ë™ì‘ âŒ (í”„ë¡ì‹œ ì ìš© ì•ˆ ë¨) |
| **íŠ¸ëœì­ì…˜ ë¶„ë¦¬**       | `@Async`ëŠ” ë³„ë„ ìŠ¤ë ˆë“œ â†’ íŠ¸ëœì­ì…˜ ë²”ìœ„ ë²—ì–´ë‚¨                |
| **ë¹ˆ ë“±ë¡ í•„ìˆ˜**        | `@Component` ë˜ëŠ” `@Service` ë“±ë¡ëœ í´ë˜ìŠ¤ì—ì„œë§Œ ì ìš© ê°€ëŠ¥   |
| **ë™ê¸°ì™€ ë³‘í–‰ ì‹œ ì£¼ì˜** | `.get()`ì„ ë¶€ì£¼ì˜í•˜ê²Œ í˜¸ì¶œí•˜ë©´ ì „ì²´ ë¸”ë¡œí‚¹ ìœ ë°œ              |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½í‘œ

| í•­ëª©           | ì„¤ëª…                                                   |
| -------------- | ------------------------------------------------------ |
| `@Async`       | ë©”ì„œë“œ ë¹„ë™ê¸° ì‹¤í–‰                                     |
| `@EnableAsync` | ì„¤ì • í´ë˜ìŠ¤ì—ì„œ í™œì„±í™” í•„ìš”                            |
| ë°˜í™˜ê°’         | `void`, `Future`, `CompletableFuture<T>`               |
| ì˜ˆì™¸ ì²˜ë¦¬      | `Future.get()` ì‹œ `ExecutionException` ë°œìƒ            |
| ì‹¤í–‰ í™˜ê²½      | ê¸°ë³¸ Executor ë˜ëŠ” ì»¤ìŠ¤í…€ ThreadPool ì‚¬ìš© ê°€ëŠ¥         |
| ì‹¤ë¬´ í™œìš©      | ì´ë©”ì¼, SMS, ì™¸ë¶€ API, ëŒ€ìš©ëŸ‰ ì²˜ë¦¬ ë“±                  |
| ë‹¨ì            | ìƒíƒœ ê³µìœ  ì–´ë ¤ì›€, ì˜ˆì™¸ ì „íŒŒ ì–´ë ¤ì›€, íŠ¸ëœì­ì…˜ ë‹¨ì ˆ ì£¼ì˜ |

## Executor ì„¤ì •

### ğŸ§© 1. Executorë€?

> **Javaì—ì„œ ë¹„ë™ê¸° ì‘ì—…ì„ ì‹¤í–‰í•  ìŠ¤ë ˆë“œ í’€(Thread Pool)ì„ ê´€ë¦¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤**

Springì—ì„œëŠ” ì£¼ë¡œ `ThreadPoolTaskExecutor`ë¥¼ êµ¬í˜„ì²´ë¡œ ì‚¬ìš©í•˜ë©°,
 `@Async`, `@Scheduled`, `CompletableFuture`, `@EventListener` ë“±ì˜ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ì— í™œìš©ë¨.

------

### ğŸ› ï¸ 2. ê¸°ë³¸ êµ¬ì„± ì˜ˆì‹œ (`@EnableAsync`ì™€ í•¨ê»˜)

```
@Configuration
@EnableAsync
public class AsyncExecutorConfig {

    @Bean(name = "asyncExecutor")
    public Executor asyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(4);                  // ê¸°ë³¸ ìŠ¤ë ˆë“œ ê°œìˆ˜
        executor.setMaxPoolSize(8);                   // ìµœëŒ€ ìŠ¤ë ˆë“œ ê°œìˆ˜
        executor.setQueueCapacity(100);               // íì— ëŒ€ê¸°í•  ì‘ì—… ìˆ˜
        executor.setKeepAliveSeconds(60);             // ìŠ¤ë ˆë“œ ìœ íœ´ ì‹œê°„
        executor.setThreadNamePrefix("async-");       // ë””ë²„ê¹…ìš© ì´ë¦„
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.AbortPolicy()); // ê½‰ ì°¼ì„ ë•Œ ì •ì±…
        executor.initialize();
        return executor;
    }
}
```

------

### ğŸ“˜ 3. ì£¼ìš” íŒŒë¼ë¯¸í„° ì„¤ëª…

| ì†ì„±                       | ì„¤ëª…                                                         |
| -------------------------- | ------------------------------------------------------------ |
| `corePoolSize`             | í•­ìƒ ìœ ì§€ë˜ëŠ” ìµœì†Œ ìŠ¤ë ˆë“œ ìˆ˜                                 |
| `maxPoolSize`              | ìŠ¤ë ˆë“œ í’€ì˜ ìµœëŒ€ í¬ê¸° (íê°€ ê½‰ ì°¼ì„ ë•Œê¹Œì§€ ì¦ê°€ ê°€ëŠ¥)        |
| `queueCapacity`            | ëŒ€ê¸° ì¤‘ì¸ ì‘ì—…ì„ ë‹´ëŠ” í í¬ê¸° (LinkedBlockingQueue)          |
| `keepAliveSeconds`         | ì´ˆê³¼ ìŠ¤ë ˆë“œê°€ idle ìƒíƒœì¼ ë•Œ ì œê±°ê¹Œì§€ ëŒ€ê¸° ì‹œê°„              |
| `threadNamePrefix`         | ë¡œê·¸ ì¶”ì  ë“±ì„ ìœ„í•œ ìŠ¤ë ˆë“œ ì´ë¦„ ì ‘ë‘ì–´                       |
| `rejectedExecutionHandler` | ìµœëŒ€ì¹˜ ì´ˆê³¼ ì‹œ ì‘ì—…ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ê²°ì • (`AbortPolicy`, `CallerRunsPolicy` ë“±) |

------

### âš¡ 4. `@Async`ì™€ ì—°ë™

```
@Async("asyncExecutor")
public void sendNotification(String msg) {
    // async-thread-1 ê°™ì€ ì´ë¦„ìœ¼ë¡œ ì‹¤í–‰ë¨
}
```

âœ… Executor ë¹ˆì˜ ì´ë¦„ì„ `@Async("ì´ë¦„")`ìœ¼ë¡œ ì§€ì •í•´ì•¼ í•´ë‹¹ í’€ì—ì„œ ì‹¤í–‰ë¨
 â— ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ `SimpleAsyncTaskExecutor` ì‚¬ìš© (ë¹„ê¶Œì¥)

------

### ğŸ”„ 5. ì—¬ëŸ¬ Executor ë¶„ë¦¬ ìš´ì˜ (ìš©ë„ë³„ ë¶„ë¦¬ ì „ëµ)

```
@Bean(name = "emailExecutor")
public Executor emailExecutor() { ... }

@Bean(name = "reportExecutor")
public Executor reportExecutor() { ... }
```

> ğŸ“Œ ë¬´ê±°ìš´ ì‘ì—…ê³¼ ê²½ëŸ‰ ì‘ì—…ì˜ Executorë¥¼ ë¶„ë¦¬í•´ **ì„±ëŠ¥ ê²©ë¦¬**í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ

------

### ğŸ’¥ 6. Rejection Policy ì¢…ë¥˜

| ì´ë¦„                  | ì„¤ëª…                                   |
| --------------------- | -------------------------------------- |
| `AbortPolicy`         | ì˜ˆì™¸ ë˜ì§ (ê¸°ë³¸ê°’)                     |
| `CallerRunsPolicy`    | í˜„ì¬ í˜¸ì¶œ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ (ì†ë„ â†“)     |
| `DiscardPolicy`       | ì•„ë¬´ ê²½ê³  ì—†ì´ ë²„ë¦¼                    |
| `DiscardOldestPolicy` | ê°€ì¥ ì˜¤ë˜ëœ ì‘ì—… ë²„ë¦¬ê³  í˜„ì¬ ì‘ì—… ì¶”ê°€ |

âœ… ì‹¤ë¬´ì—ì„œëŠ” ëŒ€ë¶€ë¶„ `CallerRunsPolicy` ë˜ëŠ” `AbortPolicy`ë¥¼ ì‚¬ìš©

------

### ğŸ§  7. ì‹¤ë¬´ íŠœë‹ ê¸°ì¤€

| í•­ëª©               | ê¶Œì¥ ê°’ (ì˜ˆì‹œ)     | ê¸°ì¤€                                            |
| ------------------ | ------------------ | ----------------------------------------------- |
| `corePoolSize`     | 4~N                | CPU core ìˆ˜ ê¸°ì¤€ (N = core Ã— 2 + I/O ëŒ€ê¸° ê³ ë ¤) |
| `maxPoolSize`      | corePoolSize Ã— 2~3 | ì˜ˆìƒ peak ì²˜ë¦¬ëŸ‰ ê³ ë ¤                           |
| `queueCapacity`    | 100~1000           | ìš”ì²­ëŸ‰ + ì²˜ë¦¬ ì‹œê°„ì— ë”°ë¼ ì¡°ì •                  |
| `keepAliveSeconds` | 30~60              | ë¹„í™œì„±í™” ì‹œ ë¦¬ì†ŒìŠ¤ íšŒìˆ˜ ì†ë„                    |

> ğŸŒ ëŒ€ëŸ‰ ì²˜ë¦¬ ì„œë¹„ìŠ¤ëŠ” ëª¨ë‹ˆí„°ë§ ê¸°ë°˜ìœ¼ë¡œ ë™ì  ì¡°ì • í•„ìš” (ex. Actuator, Prometheus)

------

### ğŸ” 8. ThreadPoolTaskExecutor vs Java Executor

| í•­ëª©                        | ThreadPoolTaskExecutor | Java `ExecutorService` |
| --------------------------- | ---------------------- | ---------------------- |
| Spring ê´€ë¦¬                 | âœ… Bean ë“±ë¡ ê°€ëŠ¥       | âŒ ìˆ˜ë™ ìƒì„±            |
| `@Async`, `@Scheduled` ì—°ë™ | âœ… ê°€ëŠ¥                 | âŒ ì—°ë™ ë¶ˆê°€            |
| ì„¤ì • í¸ì˜ì„±                 | âœ… í¸ë¦¬                 | âŒ ë³µì¡                 |
| ëª¨ë‹ˆí„°ë§/í™•ì¥               | âœ… ì§€ì›                 | âŒ ìˆ˜ë™ ê´€ë¦¬ í•„ìš”       |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©                     | ë‚´ìš©                                                         |
| ------------------------ | ------------------------------------------------------------ |
| `ThreadPoolTaskExecutor` | Spring ê¸°ë³¸ Executor êµ¬í˜„ì²´                                  |
| `@Async` ì—°ë™            | `@Async("beanName")`ìœ¼ë¡œ ìŠ¤ë ˆë“œ í’€ ì§€ì •                      |
| í•µì‹¬ íŒŒë¼ë¯¸í„°            | core/max size, queue capacity, rejection policy              |
| ê³ ì„±ëŠ¥ ìš´ì˜ ê¸°ì¤€         | ì‘ì—… ì¢…ë¥˜ë³„ Executor ë¶„ë¦¬ + CallerRunsPolicyë¡œ fallback ì²˜ë¦¬ |
| ì‹¤ë¬´ ê¸°ì¤€                | ì´ë©”ì¼, ë¡œê·¸, ì™¸ë¶€ í˜¸ì¶œ ë“± ë³‘ë ¬ ì²˜ë¦¬ì— í™œìš©                  |

## ì´ë²¤íŠ¸ ë°œí–‰ ë° êµ¬ë…

- ## `ApplicationEvent`, `@EventListener`

  ### ğŸ§© 1. Spring ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì´ë€?

  > ê°ì²´ ê°„ ê°•í•œ ì˜ì¡´ ì—†ì´ **ë¹„ë™ê¸°ì ìœ¼ë¡œ ë©”ì‹œì§€(ì´ë²¤íŠ¸)ë¥¼ ì „ë‹¬**í•˜ëŠ”
  >  **Observer íŒ¨í„´ ê¸°ë°˜**ì˜ êµ¬ì¡°

  âœ… í•µì‹¬ ëª©ì : **ëŠìŠ¨í•œ ê²°í•©, ë¹„ë™ê¸° íë¦„, íŠ¸ëœì­ì…˜ ì´í›„ ì²˜ë¦¬**

  ------

  ### âš™ï¸ 2. êµ¬ì„± íë¦„

  ```
  [Event ì •ì˜] â†’ [Event ë°œí–‰ (Publisher)] â†’ [Event ë¦¬ìŠ¤ë„ˆ (@EventListener)]
  ```
  
  - ì´ë²¤íŠ¸ ê°ì²´ëŠ” DTOì²˜ëŸ¼ ì •ì˜
  - ë°œí–‰ìëŠ” `ApplicationEventPublisher`ë¥¼ í†µí•´ ì „ì†¡
  - ë¦¬ìŠ¤ë„ˆëŠ” `@EventListener` ë˜ëŠ” `implements ApplicationListener` ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬

  ------
  
  ### ğŸ› ï¸ 3. ì´ë²¤íŠ¸ í´ë˜ìŠ¤ ì •ì˜

  #### âœ… ë°©ì‹ 1: POJO ì´ë²¤íŠ¸ ê°ì²´

  ```
  public class UserRegisteredEvent {
      private final Long userId;
      private final String email;
  
      public UserRegisteredEvent(Long userId, String email) {
          this.userId = userId;
          this.email = email;
      }
  
      // Getter
  }
  ```
  
  ------
  
  ### ğŸ“¢ 4. ì´ë²¤íŠ¸ ë°œí–‰ (Publisher)

  ```
  @Service
  @RequiredArgsConstructor
  public class UserService {
  
      private final ApplicationEventPublisher eventPublisher;
  
      public void registerUser(User user) {
          userRepository.save(user);
  
          // ì´ë²¤íŠ¸ ë°œí–‰
          eventPublisher.publishEvent(new UserRegisteredEvent(user.getId(), user.getEmail()));
      }
  }
  ```
  
  âœ… ì´ ì‹œì ì—ì„œ ë¦¬ìŠ¤ë„ˆê°€ ê°ì§€ â†’ ì‹¤í–‰
  
  ------

  ### ğŸ‘‚ 5. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (`@EventListener`)

  ```
  @Component
  public class WelcomeEmailListener {
  
      @EventListener
      public void handle(UserRegisteredEvent event) {
          emailService.sendWelcome(event.getEmail());
      }
  }
  ```
  
  âœ… ë©”ì„œë“œ ì´ë¦„ì€ ììœ 
   âœ… íŒŒë¼ë¯¸í„° íƒ€ì…ë§Œ ì¼ì¹˜í•˜ë©´ ìë™ ë§¤í•‘ë¨
  
  ------
  
  ### ğŸ” 6. ë¹„ë™ê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (`@Async` + `@EnableAsync`)

  ```
  @Async
  @EventListener
  public void handleAsync(UserRegisteredEvent event) {
      log.info("ğŸ“§ ë©”ì¼ ë°œì†¡ ì‹œì‘: {}", event.getEmail());
      ...
  }
  ```
  
  > ë¹„ë™ê¸° ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `@EnableAsync` í•„ìš”í•˜ê³ ,
  >  `@Async`ê°€ ë¶™ì€ ë¦¬ìŠ¤ë„ˆëŠ” **ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë¨**
  
  ------
  
  ### ğŸ”„ 7. íŠ¸ëœì­ì…˜ ì´í›„ ì´ë²¤íŠ¸ ì²˜ë¦¬

  ì¼ë°˜ `@EventListener`ëŠ” íŠ¸ëœì­ì…˜ ì»¤ë°‹ **ì´ì „ì—ë„** ì‹¤í–‰ë¨.

  #### âœ… íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì´í›„ ì‹¤í–‰í•˜ë ¤ë©´?

  ```
  @Component
  public class EventHandler {
  
      @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
      public void afterCommit(UserRegisteredEvent event) {
          // DB íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ëœ ì´í›„ì— ì‹¤í–‰
      }
  }
  ```
  
  > `BEFORE_COMMIT`, `AFTER_COMMIT`, `AFTER_ROLLBACK`, `AFTER_COMPLETION` ë“± ì„ íƒ ê°€ëŠ¥
  
  ------

  ### ğŸ§  8. ì‹¤ë¬´ì—ì„œì˜ ì´ë²¤íŠ¸ í™œìš© ì˜ˆì‹œ

  | ì´ë²¤íŠ¸                                 | ë¦¬ìŠ¤ë„ˆ ì—­í•                         |
  | -------------------------------------- | ---------------------------------- |
  | íšŒì› ê°€ì… ì™„ë£Œ (`UserRegisteredEvent`) | ì´ë©”ì¼ ë°œì†¡, Slack ì•Œë¦¼            |
  | ì£¼ë¬¸ ìƒì„± (`OrderCreatedEvent`)        | ì ë¦½ê¸ˆ ì ë¦½, ë°°ì†¡ ì˜ˆì•½, í†µê³„ ê¸°ë¡  |
  | ê²°ì œ ì‹¤íŒ¨ (`PaymentFailedEvent`)       | ê´€ë¦¬ì ì•Œë¦¼, ìë™ ì·¨ì†Œ ì˜ˆì•½        |
  | ê²Œì‹œê¸€ ì‘ì„± (`PostCreatedEvent`)       | ê²€ìƒ‰ ì¸ë±ìŠ¤ ë°˜ì˜, ì¶”ì²œ ì‹œìŠ¤í…œ í•™ìŠµ |
  
  â¡ï¸ **ë„ë©”ì¸ ë¡œì§ê³¼ ë¶€ê°€ì²˜ë¦¬ë¥¼ ë¶„ë¦¬**í•  ìˆ˜ ìˆì–´ ìœ ì§€ë³´ìˆ˜ì„±ì´ ëŒ€í­ ìƒìŠ¹í•¨
  
  ------

  ### â— 9. ì£¼ì˜ì‚¬í•­

  | í•­ëª©           | ì£¼ì˜ ì„¤ëª…                                            |
  | -------------- | ---------------------------------------------------- |
  | íŠ¸ëœì­ì…˜ ê²½ê³„  | ì¼ë°˜ `@EventListener`ëŠ” **íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œ ì‹¤í–‰**ë¨ |
  | ë¹„ë™ê¸° ì˜ˆì™¸    | `@Async` ë¦¬ìŠ¤ë„ˆì˜ ì˜ˆì™¸ëŠ” ë¬´ì‹œë¨ â†’ ë¡œê¹… í•„ìš”          |
  | ì‹¤í–‰ ìˆœì„œ ì œì–´ | `@Order(n)` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ìˆœì„œ ì¡°ì ˆ ê°€ëŠ¥            |
  | ì´ë²¤íŠ¸ ìˆœí™˜    | ì´ë²¤íŠ¸ A â†’ B â†’ A ë¬´í•œ ë£¨í”„ ì¡°ì‹¬                      |
  
  ------
  
  ### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½í‘œ
  
  | í•­ëª©          | ì„¤ëª…                                                   |
  | ------------- | ------------------------------------------------------ |
  | ì´ë²¤íŠ¸ ì •ì˜   | POJO ê°ì²´ë¡œ ìƒì„± (`UserRegisteredEvent`)               |
  | ë°œí–‰          | `ApplicationEventPublisher.publishEvent()`             |
  | ë¦¬ìŠ¤ë„ˆ        | `@EventListener`, `@TransactionalEventListener`        |
  | ë¹„ë™ê¸° ì‹¤í–‰   | `@Async` + `@EnableAsync`                              |
  | íŠ¸ëœì­ì…˜ ì´í›„ | `@TransactionalEventListener(phase = AFTER_COMMIT)`    |
  | ì‹¤ë¬´ ì¥ì      | ë„ë©”ì¸ ë¡œì§ê³¼ ë¶€ê°€ ë¡œì§ ë¶„ë¦¬, ëŠìŠ¨í•œ ê²°í•©, í™•ì¥ì„± ìš°ìˆ˜ |

## ë„ë©”ì¸ ì´ë²¤íŠ¸ íŒ¨í„´

### ğŸ§© 1. ë„ë©”ì¸ ì´ë²¤íŠ¸ë€?

> ë„ë©”ì¸ ëª¨ë¸ ë‚´ë¶€ì—ì„œ ë°œìƒí•œ **ì˜ë¯¸ ìˆëŠ” ìƒíƒœ ë³€í™”**ë¥¼
>  **ì™¸ë¶€ì— ì•Œë¦¬ëŠ” ë©”ì‹œì§€ ê°ì²´**

ğŸ“Œ ì˜ˆì‹œ:

- â€œíšŒì›ì´ ë“±ë¡ë˜ì—ˆë‹¤â€ â†’ `UserRegisteredEvent`
- â€œì£¼ë¬¸ì´ ê²°ì œë˜ì—ˆë‹¤â€ â†’ `OrderPaidEvent`
- â€œìƒí’ˆì˜ ì¬ê³ ê°€ ë¶€ì¡±í•´ì¡Œë‹¤â€ â†’ `OutOfStockEvent`

âœ… ì´ë²¤íŠ¸ëŠ” ë„ë©”ì¸ ë‚´ë¶€ì˜ **ë¶ˆë³€ì  ì‚¬ì‹¤(Fact)**
 âœ… ì´ë²¤íŠ¸ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ **ë„ë©”ì¸ ê°„ ëŠìŠ¨í•œ ì—°ê²°** ê°€ëŠ¥

------

### ğŸ¯ 2. ë„ë©”ì¸ ì´ë²¤íŠ¸ vs Application ì´ë²¤íŠ¸ ì°¨ì´

| í•­ëª©        | ë„ë©”ì¸ ì´ë²¤íŠ¸            | ApplicationEvent (Spring)  |
| ----------- | ------------------------ | -------------------------- |
| ë°œí–‰ ìœ„ì¹˜   | Entity, Aggregate ë‚´ë¶€   | Service, Application Layer |
| ì˜ë¯¸        | ë„ë©”ì¸ ìƒíƒœ ë³€í™” ê·¸ ìì²´ | ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì „íŒŒ ìˆ˜ë‹¨    |
| ê°ì²´ ì„±ê²©   | ë¹„ì¦ˆë‹ˆìŠ¤ ì¤‘ì‹¬            | ê¸°ìˆ ì  ì¤‘ì‹¬                |
| ì˜ˆì‹œ        | `OrderPaidEvent`         | `EmailSendRequestedEvent`  |
| ë‹¨ë°©í–¥ ì„¤ê³„ | âœ… í•„ìˆ˜                   | âœ… ì„ íƒ                     |

> Springì˜ `ApplicationEventPublisher`ëŠ” ë„ë©”ì¸ ì´ë²¤íŠ¸ ì „ë‹¬ ìˆ˜ë‹¨ ì¤‘ í•˜ë‚˜ì¼ ë¿

------

### ğŸ§± 3. êµ¬ì¡°: ì–´ë””ì—ì„œ, ì–´ë–»ê²Œ ë°œí–‰í•˜ë‚˜?

```
Entity (Aggregate Root)
  â””â”€ ìƒíƒœ ë³€ê²½ ë©”ì„œë“œ (ex. pay())
        â””â”€ ë‚´ë¶€ì—ì„œ ë„ë©”ì¸ ì´ë²¤íŠ¸ ìƒì„±
              â†“
Application Layer ë˜ëŠ” Event Handlerê°€ ìˆ˜ì‹ 
```

------

### ğŸ“˜ 4. ì˜ˆì œ â€“ ì£¼ë¬¸ ê²°ì œ í›„ ë°°ì†¡ ì˜ˆì•½

#### âœ… 1) ë„ë©”ì¸ ì´ë²¤íŠ¸ ì •ì˜

```
public class OrderPaidEvent {
    private final Long orderId;
    private final Long userId;

    public OrderPaidEvent(Long orderId, Long userId) {
        this.orderId = orderId;
        this.userId = userId;
    }
}
```

------

#### âœ… 2) Aggregate Rootì—ì„œ ì´ë²¤íŠ¸ ìƒì„±

```
@Entity
public class Order {

    @Transient
    private final List<Object> domainEvents = new ArrayList<>();

    public void pay() {
        this.status = OrderStatus.PAID;
        domainEvents.add(new OrderPaidEvent(this.id, this.user.getId()));
    }

    public List<Object> getDomainEvents() {
        return domainEvents;
    }

    public void clearEvents() {
        domainEvents.clear();
    }
}
```

------

#### âœ… 3) Application Layerì—ì„œ ì´ë²¤íŠ¸ ë°œí–‰

```
@Transactional
public void completePayment(Long orderId) {
    Order order = orderRepository.findById(orderId).orElseThrow();
    order.pay();

    orderRepository.save(order);

    // ë„ë©”ì¸ ì´ë²¤íŠ¸ ìˆ˜ë™ ë°œí–‰
    order.getDomainEvents().forEach(eventPublisher::publishEvent);
    order.clearEvents();
}
```

> â˜ï¸ í•µì‹¬: ì´ë²¤íŠ¸ëŠ” **ë„ë©”ì¸ ê°ì²´ê°€ ë§Œë“¤ê³ **, ë°œí–‰ì€ **Application Layerê°€ ë‹´ë‹¹**

------

#### âœ… 4) EventListener ì²˜ë¦¬

```
@Component
public class ShippingReservationHandler {

    @EventListener
    public void on(OrderPaidEvent event) {
        shippingService.reserveShipment(event.getOrderId());
    }
}
```

------

### ğŸ”„ 5. íŠ¸ëœì­ì…˜ ì´í›„ ì‹¤í–‰í•˜ë ¤ë©´?

```
@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
public void on(OrderPaidEvent event) {
    ...
}
```

â¡ï¸ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì´í›„ì—ë§Œ ë°°ì†¡ ì˜ˆì•½ë¨ â†’ **DB ë¡¤ë°± ë°©ì§€ ê°€ëŠ¥**

------

### âš™ï¸ 6. Springì—ì„œì˜ í†µí•© íë¦„

```
[Entity]
  ìƒíƒœë³€ê²½ â†’ ì´ë²¤íŠ¸ ê°ì²´ ìƒì„±
    â†“
[ApplicationService]
  ì €ì¥ + publishEvent() í˜¸ì¶œ
    â†“
@EventListener / @TransactionalEventListener ìˆ˜ì‹ 
    â†“
ë¹„ë™ê¸° ì²˜ë¦¬, API í˜¸ì¶œ, ë©”ì‹œì§€ ì „ì†¡ ë“±
```

------

### ğŸ’¡ 7. ì‹¤ë¬´ ì„¤ê³„ ì¥ì 

| í•­ëª©        | ì„¤ëª…                                             |
| ----------- | ------------------------------------------------ |
| ëŠìŠ¨í•œ ê²°í•© | ì£¼ë¬¸ ë„ë©”ì¸ â†” ë°°ì†¡/í¬ì¸íŠ¸/ì´ë©”ì¼ ì‹œìŠ¤í…œ ë¶„ë¦¬     |
| í™•ì¥ì„±      | ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë§Œ ì¶”ê°€í•˜ë©´ ê¸°ëŠ¥ ì¶”ê°€ ê°€ëŠ¥          |
| í…ŒìŠ¤íŠ¸ ìš©ì´ | ë„ë©”ì¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹œ ì´ë²¤íŠ¸ ìƒì„± ì—¬ë¶€ ê²€ì¦ ê°€ëŠ¥ |
| ë‹¨ì¼ ì±…ì„   | ë„ë©”ì¸ì€ ìƒíƒœ ë³€í™”ë§Œ, í›„ì²˜ë¦¬ëŠ” ë‹¤ë¥¸ ëª¨ë“ˆì´ ë‹´ë‹¹  |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½í‘œ

| í•­ëª©          | ë‚´ìš©                                                 |
| ------------- | ---------------------------------------------------- |
| ì´ë²¤íŠ¸ ìœ„ì¹˜   | Entity/Aggregate ë‚´ë¶€ì—ì„œ ìƒì„±                       |
| ë°œí–‰ ì±…ì„     | Application Layerê°€ `publishEvent()` ìˆ˜í–‰            |
| ì²˜ë¦¬ ìœ„ì¹˜     | `@EventListener`, `@TransactionalEventListener`      |
| íŠ¸ëœì­ì…˜ ê²½ê³„ | AFTER_COMMIT ì„¤ì • í•„ìˆ˜ (ê¶Œì¥)                        |
| ì¥ì           | ê²°í•©ë„â†“, í™•ì¥ì„±â†‘, í…ŒìŠ¤íŠ¸ ê°€ëŠ¥, ë¶„ì‚° ì‹œìŠ¤í…œ ì—°ê³„ ìš©ì´ |
| ì‹¤ë¬´ ì ìš©     | ì‚¬ìš©ì ê°€ì… â†’ ì´ë©”ì¼ ë°œì†¡, í¬ì¸íŠ¸ ì ë¦½, ìŠ¬ë™ ì•Œë¦¼ ë“± |

## íŠ¸ëœì­ì…˜ ì´ë²¤íŠ¸ ì²˜ë¦¬

### ğŸ§© 1. ê°œë…

> íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì´í›„ì— ì´ë²¤íŠ¸ë¥¼ ì•ˆì „í•˜ê²Œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•˜ëŠ”
>  Springì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì–´ë…¸í…Œì´ì…˜

âœ… `@EventListener`ëŠ” **íŠ¸ëœì­ì…˜ ì¤‘ì—ë„ ì‹¤í–‰**ë˜ì§€ë§Œ,
 âœ… `@TransactionalEventListener`ëŠ” **íŠ¸ëœì­ì…˜ ìƒíƒœë¥¼ ê°ì§€**í•´ì„œ ì‹¤í–‰ ì‹œì ì„ ì„ íƒí•  ìˆ˜ ìˆìŒ

------

### ğŸ”„ 2. ì‹¤í–‰ ì‹œì  (`TransactionPhase`)

| ì˜µì…˜               | ì‹¤í–‰ ì‹œì           | ì„¤ëª…                            |
| ------------------ | ------------------ | ------------------------------- |
| `AFTER_COMMIT` âœ…   | íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì§í›„ | **ì‹¤ë¬´ ê¸°ë³¸ê°’**, ë°ì´í„° ë°˜ì˜ í›„ |
| `AFTER_ROLLBACK`   | íŠ¸ëœì­ì…˜ ë¡¤ë°± ì‹œ   | ì˜¤ë¥˜ ê°ì§€ í›„ í›„ì²˜ë¦¬             |
| `AFTER_COMPLETION` | ì»¤ë°‹ ë˜ëŠ” ë¡¤ë°± í›„  | ë¬´ì¡°ê±´ ë§ˆì§€ë§‰                   |
| `BEFORE_COMMIT`    | ì»¤ë°‹ ì§ì „          | ë¡¤ë°± ë°œìƒ ì‹œ í•¨ê»˜ ë¡¤ë°±ë¨        |

------

### ğŸ“˜ 3. ê¸°ë³¸ ì‚¬ìš© ì˜ˆì‹œ

#### âœ… 1) ì´ë²¤íŠ¸ í´ë˜ìŠ¤

```
public class OrderCreatedEvent {
    private final Long orderId;

    public OrderCreatedEvent(Long orderId) {
        this.orderId = orderId;
    }
}
```

------

#### âœ… 2) ì´ë²¤íŠ¸ ë°œí–‰

```
@Service
@RequiredArgsConstructor
public class OrderService {

    private final ApplicationEventPublisher eventPublisher;

    @Transactional
    public void createOrder(Order order) {
        orderRepository.save(order);
        eventPublisher.publishEvent(new OrderCreatedEvent(order.getId()));
    }
}
```

------

#### âœ… 3) íŠ¸ëœì­ì…˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ

```
@Component
public class OrderEventHandler {

    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
    public void handleOrderCreated(OrderCreatedEvent event) {
        System.out.println("âœ… ì£¼ë¬¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ë¨ (commit ì´í›„): " + event.getOrderId());
    }
}
```

> â˜ï¸ DBì— ì£¼ë¬¸ ì €ì¥ì´ **ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹ëœ ì´í›„**ì—ë§Œ ì‹¤í–‰ë¨

------

### ğŸ§  4. ì™œ ì¤‘ìš”í•œê°€?

| ìƒí™©              | ì´ìœ                                        |
| ----------------- | ------------------------------------------ |
| ì´ë©”ì¼ ë°œì†¡       | ì£¼ë¬¸ ì €ì¥ ì‹¤íŒ¨ ì‹œ ë°œì†¡ X                   |
| í¬ì¸íŠ¸ ì ë¦½       | ë¡¤ë°±ë˜ë©´ ì ë¦½ë„ ì·¨ì†Œë˜ì–´ì•¼ í•¨              |
| Slack ì•Œë¦¼        | ì»¤ë°‹ëœ ìƒíƒœì—ì„œë§Œ ì•Œë¦¼ ë³´ë‚´ì•¼ ì‹ ë¢°ì„± ë³´ì¥  |
| Kafka ë©”ì‹œì§€ ë°œí–‰ | ì»¤ë°‹ ì „ ë°œí–‰í•˜ë©´ ë©”ì‹œì§€ì™€ DBê°€ ë¶ˆì¼ì¹˜ ê°€ëŠ¥ |

âœ… ë°˜ë“œì‹œ **AFTER_COMMIT**ì—ì„œ ì²˜ë¦¬í•´ì•¼ **ì´ë²¤íŠ¸ > ì™¸ë¶€ ì‹œìŠ¤í…œì˜ ë°ì´í„° ì •í•©ì„± ìœ ì§€** ê°€ëŠ¥

------

### ğŸ§¨ 5. ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµ

- `@TransactionalEventListener` ë©”ì„œë“œì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ,
   **íŠ¸ëœì­ì…˜ì€ ì´ë¯¸ ì»¤ë°‹ëœ ìƒíƒœ**ë¼ ë¡¤ë°± ë¶ˆê°€

â¡ï¸ **ë¡œê·¸ ë‚¨ê¸°ê¸°**, **Retry**, **Dead-letter ì²˜ë¦¬** ë“±ì„ ë”°ë¡œ êµ¬í˜„í•´ì•¼ í•¨

```
@SneakyThrows
@TransactionalEventListener(phase = AFTER_COMMIT)
public void sendNotification(OrderCreatedEvent event) {
    try {
        slackNotifier.send("ì£¼ë¬¸ ì™„ë£Œ: " + event.getOrderId());
    } catch (Exception ex) {
        log.error("â— ìŠ¬ë™ ì•Œë¦¼ ì‹¤íŒ¨: {}", ex.getMessage());
        // ì¶”í›„ ì¬ì‹œë„ íì— ì ì¬í•  ìˆ˜ ìˆìŒ
    }
}
```

------

### âš™ï¸ 6. ë¹„ë™ê¸° ì²˜ë¦¬ì™€ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥ (`@Async`)

```
@Async
@TransactionalEventListener(phase = AFTER_COMMIT)
public void processAsync(OrderCreatedEvent event) {
    log.info("ë¹„ë™ê¸° í›„ì²˜ë¦¬ ì‹¤í–‰: {}", event.getOrderId());
}
```

âœ… ë¹„ë™ê¸° + ì»¤ë°‹ ì´í›„ ì‹¤í–‰ë¨ â†’ ì™¸ë¶€ APIë‚˜ I/O ì‘ì—… ì í•©
 â— ë¹„ë™ê¸° ì˜ˆì™¸ëŠ” ë¡œê·¸ë§Œ ì¶œë ¥ë˜ê³  ì „íŒŒë˜ì§€ ì•ŠìŒ â†’ ë°˜ë“œì‹œ ì˜ˆì™¸ í•¸ë“¤ë§ í•„ìˆ˜

------

### ğŸ§± 7. ì•„í‚¤í…ì²˜ì—ì„œì˜ ìœ„ì¹˜

```
[Domain] - ë„ë©”ì¸ ì´ë²¤íŠ¸ ìƒì„±
   â†“
[Application Layer] - eventPublisher.publishEvent()
   â†“
@TransactionalEventListener
   â†“
ë¹„ë™ê¸° ì‹¤í–‰, ì™¸ë¶€ API, ë©”ì‹œì§€ ì „ì†¡, í†µê³„ ê¸°ë¡ ë“±
```

------

### ğŸ§© 8. ì‹¤ë¬´ ì„¤ê³„ íŒ

| í•­ëª©                    | ê¶Œì¥ ì „ëµ                                              |
| ----------------------- | ------------------------------------------------------ |
| ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰ ìœ„ì¹˜ | Entity or Service ë‚´ë¶€ì—ì„œ ìƒì„±                        |
| ë°œí–‰ ì±…ì„               | Application Layer (`publishEvent`)ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ìˆ˜í–‰ |
| Listener                | `@TransactionalEventListener(AFTER_COMMIT)`ë¡œ í›„ì²˜ë¦¬   |
| ì˜ˆì™¸ ì²˜ë¦¬               | try-catch í›„ ì¬ì‹œë„ í ë˜ëŠ” ë¡œê¹…                       |
| ë¦¬ìŠ¤ë„ˆ ê²©ë¦¬             | `@Async`ë¡œ ë³‘ë ¬ì„± í™•ë³´ + timeout ëŒ€ë¹„                  |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½í‘œ

| í•­ëª©                          | ì„¤ëª…                                                         |
| ----------------------------- | ------------------------------------------------------------ |
| `@TransactionalEventListener` | íŠ¸ëœì­ì…˜ ìƒíƒœ ê°ì§€ í›„ ì´ë²¤íŠ¸ ì²˜ë¦¬                            |
| ê¸°ë³¸ phase                    | `AFTER_COMMIT`                                               |
| ì˜ˆì™¸ ì²˜ë¦¬                     | íŠ¸ëœì­ì…˜ê³¼ ë³„ê°œ â†’ ìì²´ try-catch í•„ìˆ˜                        |
| ë¹„ë™ê¸° ì§€ì›                   | `@Async` í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥                                      |
| ì‹¤ë¬´ ëª©ì                      | ì´ë²¤íŠ¸ ì²˜ë¦¬ ìˆœì„œ ë³´ì¥ + DB ì •í•©ì„± ìœ ì§€ + ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ ì•ˆì • ì—°ë™ |