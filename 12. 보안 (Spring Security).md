# 12. ë³´ì•ˆ (Spring Security)

## Spring Security êµ¬ì¡°ì™€ í•„í„° ì²´ì¸

Spring SecurityëŠ” Spring ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ **ì¸ì¦(Authentication)**ê³¼ **ì¸ê°€(Authorization)**ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ **ë³´ì•ˆ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í•µì‹¬ í”„ë ˆì„ì›Œí¬**ì´ë‹¤.
 ê·¸ ì¤‘ì‹¬ì—ëŠ” **Filter Chain ê¸°ë°˜ì˜ ì•„í‚¤í…ì²˜**ê°€ ìˆìœ¼ë©°, **ëª¨ë“ˆí™”ëœ ë³´ì•ˆ í•„í„°ë“¤ì´ HTTP ìš”ì²­ì„ í†µì œ**í•œë‹¤.

------

### ğŸ“˜ 1. Spring Security ì „ì²´ êµ¬ì¡° ê°œìš”

```
Client â†’ Security Filter Chain â†’ Authentication â†’ Authorization â†’ Controller
```

| êµ¬ì„± ìš”ì†Œ                 | ì—­í•                                 |
| ------------------------- | ----------------------------------- |
| **FilterChainProxy**      | ëª¨ë“  ë³´ì•ˆ í•„í„°ë¥¼ ë¬¶ëŠ” ì§„ì…ì         |
| **SecurityFilterChain**   | URL ë³„ í•„í„° ëª©ë¡ ì •ì˜               |
| **Security Filters**      | ìš”ì²­ì„ ê°€ë¡œì±„ ì¸ì¦/ì¸ê°€ ì²˜ë¦¬        |
| **AuthenticationManager** | ì‚¬ìš©ì ì¸ì¦ ë¡œì§ (ì˜ˆ: ë¡œê·¸ì¸ ì²˜ë¦¬)  |
| **AuthorizationManager**  | ì ‘ê·¼ í—ˆìš© ì—¬ë¶€ íŒë‹¨ (ì˜ˆ: ROLE ê²€ì‚¬) |
| **UserDetailsService**    | ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ                    |
| **PasswordEncoder**       | ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ë° ë¹„êµ             |
| **SecurityContextHolder** | í˜„ì¬ ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ ì €ì¥ì†Œ      |

------

### ğŸ” 2. í•„í„° ì²´ì¸ (Security Filter Chain)

Spring SecurityëŠ” **Servlet Filter ê¸°ë°˜**ìœ¼ë¡œ ë™ì‘í•˜ë©°,
 í•˜ë‚˜ì˜ ìš”ì²­ì´ ë‹¤ìŒê³¼ ê°™ì€ í•„í„° ì²´ì¸ì„ ê±°ì¹˜ë©° ì²˜ë¦¬ëœë‹¤.

#### âœ… í•„í„° ì²´ì¸ êµ¬ì„± ì˜ˆì‹œ

```
âŠ SecurityContextPersistenceFilter
â‹ UsernamePasswordAuthenticationFilter
âŒ BasicAuthenticationFilter
â ExceptionTranslationFilter
â FilterSecurityInterceptor
...
```

------

### ğŸ§© 3. ì£¼ìš” í•„í„° ì„¤ëª…

| í•„í„° ì´ë¦„                                | ì—­í•                                          |
| ---------------------------------------- | -------------------------------------------- |
| **SecurityContextPersistenceFilter**     | `SecurityContext`ë¥¼ ìš”ì²­ ì „í›„ë¡œ ì €ì¥/ë³µì›    |
| **UsernamePasswordAuthenticationFilter** | ë¡œê·¸ì¸ í¼ ì œì¶œ ìš”ì²­ì„ ì²˜ë¦¬ (ê¸°ë³¸ `/login`)   |
| **BasicAuthenticationFilter**            | `Authorization: Basic` í—¤ë” ì²˜ë¦¬             |
| **BearerTokenAuthenticationFilter**      | JWT ë“± Bearer Token ì²˜ë¦¬ (ìŠ¤í”„ë§ ì‹œíë¦¬í‹° 6) |
| **ExceptionTranslationFilter**           | ì¸ì¦/ì¸ê°€ ì‹¤íŒ¨ â†’ ì˜ˆì™¸ ì²˜ë¦¬ (401, 403)        |
| **FilterSecurityInterceptor**            | ê¶Œí•œ ê²€ì‚¬ (ì¸ê°€ ì²˜ë¦¬) ìˆ˜í–‰                   |

> âš ï¸ í•„í„° ìˆœì„œ ì¤‘ìš”: ì¸ì¦ â†’ ì˜ˆì™¸ ì²˜ë¦¬ â†’ ì¸ê°€ ìˆœì„œëŒ€ë¡œ êµ¬ì„±ë¨

------

### ğŸ§¾ 4. ì¸ì¦(Authentication) íë¦„

```
â‘  ë¡œê·¸ì¸ ìš”ì²­ (POST /login)
  â†“
â‘¡ UsernamePasswordAuthenticationFilter â†’ AuthenticationManager
  â†“
â‘¢ UserDetailsServiceë¡œ ì‚¬ìš©ì ì¡°íšŒ
  â†“
â‘£ PasswordEncoderë¡œ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
  â†“
â‘¤ ì„±ê³µ ì‹œ Authentication ê°ì²´ ìƒì„±
  â†“
â‘¥ SecurityContextHolderì— ì €ì¥
  â†“
â‘¦ ì»¨íŠ¸ë¡¤ëŸ¬ ì‹¤í–‰
```

------

### ğŸ§¾ 5. ì¸ê°€(Authorization) íë¦„

```
â‘  ìš”ì²­ ìˆ˜ì‹ 
  â†“
â‘¡ FilterSecurityInterceptorê°€ ì¸ì¦ ê°ì²´ í™•ì¸
  â†“
â‘¢ @PreAuthorize ë˜ëŠ” URL ê¶Œí•œ ê²€ì‚¬
  â†“
â‘£ í—ˆìš© â†’ ì»¨íŠ¸ë¡¤ëŸ¬ ì‹¤í–‰ / ì°¨ë‹¨ â†’ 403 Forbidden
```

------

### âš™ï¸ 6. Filter Chain ì„¤ì • ë°©ì‹ (Spring Security 6 ê¸°ì¤€)

#### âœ… SecurityFilterChain ì„¤ì • (Java Config)

```
@Bean
SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
        .csrf().disable()
        .authorizeHttpRequests(auth -> auth
            .requestMatchers("/public/**").permitAll()
            .anyRequest().authenticated()
        )
        .formLogin(Customizer.withDefaults());
    return http.build();
}
```

------

### ğŸ”§ 7. ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ˆì‹œ

#### âœ… ì‚¬ìš©ì ì¸ì¦ ì²˜ë¦¬ ì»¤ìŠ¤í„°ë§ˆì´ì§•

```
@Bean
UserDetailsService userDetailsService() {
    return username -> userRepository.findByUsername(username)
        .map(user -> new User(user.getUsername(), user.getPassword(), authorities))
        .orElseThrow(() -> new UsernameNotFoundException("User not found"));
}
```

### âœ… ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ì„¤ì •

```
@Bean
PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}
```

------

### ğŸ§  8. ì‹¤ë¬´ ì „ëµ

| í•­ëª©                   | ì „ëµ                                                   |
| ---------------------- | ------------------------------------------------------ |
| JWT ê¸°ë°˜ ë³´ì•ˆ êµ¬ì¡°     | `BearerTokenAuthenticationFilter` ì‚¬ìš©                 |
| REST API ë³´ì•ˆ          | `stateless` + Token + ì»¤ìŠ¤í…€ í•„í„°                      |
| ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ ì²˜ë¦¬     | `UsernamePasswordAuthenticationFilter` êµì²´            |
| ì»¨íŠ¸ë¡¤ëŸ¬ ê¶Œí•œ ì œì–´     | `@PreAuthorize("hasRole('ADMIN')")`                    |
| ì˜ˆì™¸ ì‘ë‹µ ì»¤ìŠ¤í„°ë§ˆì´ì§• | `AuthenticationEntryPoint`, `AccessDeniedHandler` êµ¬í˜„ |

------

### ğŸ“Œ 9. ìš”ì•½

| êµ¬ì„± ìš”ì†Œ            | ì„¤ëª…                                            |
| -------------------- | ----------------------------------------------- |
| SecurityFilterChain  | ë³´ì•ˆ í•„í„° ëª©ë¡ êµ¬ì„±                             |
| ì£¼ìš” í•„í„°            | ì¸ì¦ â†’ ì˜ˆì™¸ â†’ ì¸ê°€ ì²˜ë¦¬ í•„í„°ë¡œ êµ¬ì„±             |
| ì¸ì¦(Authentication) | ë¡œê·¸ì¸ ì²˜ë¦¬: ID/PW, í† í° ë“±                     |
| ì¸ê°€(Authorization)  | ê¶Œí•œ í™•ì¸: URL, ë©”ì„œë“œ, ë¡¤(Role) ë“±             |
| ì‹¤ë¬´ ì‚¬ìš© ì „ëµ       | í•„í„° ì²´ì¸ ë¶„ë¦¬, JWT ì¸ì¦ í™•ì¥, ì˜ˆì™¸ í•¸ë“¤ëŸ¬ ë¶„ë¦¬ |

## Form ë¡œê·¸ì¸ ì²˜ë¦¬

**Spring Securityì—ì„œì˜ Form ë¡œê·¸ì¸ ì²˜ë¦¬**ëŠ” ê°€ì¥ ê¸°ë³¸ì ì´ê³  ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” **ì¸ì¦(Authentication)** ë°©ì‹ì´ë‹¤.
 ì‚¬ìš©ìê°€ **IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì—¬ ë¡œê·¸ì¸í•˜ë©´**,
 Spring Securityì˜ **í•„í„° ì²´ì¸ê³¼ ì¸ì¦ ë§¤ë‹ˆì €ê°€ ì´ë¥¼ ê²€ì¦í•˜ê³  ì„¸ì…˜ì— ì¸ì¦ ì •ë³´ë¥¼ ì €ì¥**í•œë‹¤.

------

### ğŸ“˜ 1. Form ë¡œê·¸ì¸ ì²˜ë¦¬ ê°œìš”

| í•­ëª©               | ì„¤ëª…                                                         |
| ------------------ | ------------------------------------------------------------ |
| ê¸°ë³¸ ë¡œê·¸ì¸ URL    | `POST /login`                                                |
| ê¸°ë³¸ ë¡œê·¸ì¸ í˜ì´ì§€ | `/login` (ìë™ ìƒì„±)                                         |
| ì¸ì¦ ì²˜ë¦¬ í•„í„°     | `UsernamePasswordAuthenticationFilter`                       |
| ì¸ì¦ ì²˜ë¦¬ í´ë˜ìŠ¤   | `AuthenticationManager`, `UserDetailsService`, `PasswordEncoder` |
| ê²°ê³¼ ì €ì¥ ìœ„ì¹˜     | `SecurityContextHolder`, `HttpSession` (ê¸°ë³¸ ì„¤ì •)           |

------

### ğŸ”„ 2. ì¸ì¦ ì²˜ë¦¬ íë¦„

```
â‘  ì‚¬ìš©ìê°€ /loginì— ID/PW ì œì¶œ
  â†“
â‘¡ UsernamePasswordAuthenticationFilterê°€ ìš”ì²­ ì²˜ë¦¬
  â†“
â‘¢ AuthenticationManagerì—ê²Œ ì¸ì¦ ìœ„ì„
  â†“
â‘£ UserDetailsServiceê°€ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
  â†“
â‘¤ PasswordEncoderë¡œ ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ ê²€ì¦
  â†“
â‘¥ ì„±ê³µ ì‹œ Authentication ê°ì²´ ìƒì„± í›„ SecurityContextHolderì— ì €ì¥
  â†“
â‘¦ ì¸ì¦ëœ ìƒíƒœë¡œ ìš”ì²­ ì²˜ë¦¬ ê°€ëŠ¥
```

------

### ğŸ§© 3. ê¸°ë³¸ ì„¤ì • (Spring Security 6 ì´ìƒ)

```
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .csrf().disable()
        .authorizeHttpRequests(auth -> auth
            .requestMatchers("/login", "/css/**", "/js/**").permitAll()
            .anyRequest().authenticated()
        )
        .formLogin(Customizer.withDefaults()); // ê¸°ë³¸ ë¡œê·¸ì¸ í¼ ì‚¬ìš©
    return http.build();
}
```

â†’ `/login` í˜ì´ì§€ ìë™ ìƒì„±
 â†’ `POST /login`ìœ¼ë¡œ ë¡œê·¸ì¸ ìš”ì²­í•˜ë©´ ì²˜ë¦¬ë¨

------

### ğŸ§ª 4. ì‚¬ìš©ì ì •ì˜ ë¡œê·¸ì¸ í˜ì´ì§€

```
.formLogin(form -> form
    .loginPage("/login")            // ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€
    .loginProcessingUrl("/login")   // ë¡œê·¸ì¸ í¼ action
    .usernameParameter("username")  // ê¸°ë³¸: username
    .passwordParameter("password")  // ê¸°ë³¸: password
    .defaultSuccessUrl("/home", true) // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì´ë™
    .failureUrl("/login?error=true")  // ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ì´ë™
)
```

------

### ğŸ§¾ 5. ë¡œê·¸ì¸ HTML í¼ ì˜ˆì‹œ

```
<form method="post" action="/login">
    <input type="text" name="username" placeholder="ì•„ì´ë””" />
    <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
    <button type="submit">ë¡œê·¸ì¸</button>
</form>
```

------

### ğŸ” 6. ì‚¬ìš©ì ì¸ì¦ êµ¬ì„± ìš”ì†Œ

#### âœ… 1. UserDetailsService

```
@Bean
UserDetailsService userDetailsService() {
    return username -> {
        User user = userRepository.findByUsername(username)
            .orElseThrow(() -> new UsernameNotFoundException(username));
        return new org.springframework.security.core.userdetails.User(
            user.getUsername(),
            user.getPassword(),
            List.of(new SimpleGrantedAuthority("ROLE_USER"))
        );
    };
}
```

------

#### âœ… 2. PasswordEncoder

```
@Bean
PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}
```

â†’ ì‚¬ìš©ì ë“±ë¡ ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°˜ë“œì‹œ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í•´ì•¼ ì¸ì¦ ì„±ê³µ

------

### ğŸ”§ 7. ë¡œê·¸ì¸ ì„±ê³µ/ì‹¤íŒ¨ í•¸ë“¤ëŸ¬ ì»¤ìŠ¤í„°ë§ˆì´ì§•

```
.formLogin(form -> form
    .successHandler((request, response, authentication) -> {
        response.sendRedirect("/home");
    })
    .failureHandler((request, response, exception) -> {
        response.sendRedirect("/login?error=true");
    })
)
```

------

### ğŸ§  8. ì‹¤ë¬´ ì „ëµ

| í•­ëª©                             | ì „ëµ                                     |
| -------------------------------- | ---------------------------------------- |
| ë¹„ë°€ë²ˆí˜¸ í‰ë¬¸ ì €ì¥ ê¸ˆì§€          | ë°˜ë“œì‹œ `BCryptPasswordEncoder` ì‚¬ìš©      |
| ë¡œê·¸ì¸ ì‹œë„ ì œí•œ                 | ì‚¬ìš©ì ì •ì˜ ë¡œê·¸ì¸ í•¸ë“¤ëŸ¬ + DB ê¸°ë¡      |
| ì‹¤íŒ¨ ì‘ë‹µ ê°œì„                    | `failureHandler`ì—ì„œ ì´ìœ  ë¶„ì„ ê°€ëŠ¥      |
| ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€             | `/login`ì— Thymeleaf or HTML í˜ì´ì§€ ì œì‘ |
| ì„¸ì…˜ ê³ ì • ë³´í˜¸, ë™ì‹œ ë¡œê·¸ì¸ ì œí•œ | `sessionManagement()` ì„¤ì • ê³ ë ¤          |

------

### ğŸ“Œ 9. ìš”ì•½

| í•­ëª©                | ì„¤ëª…                                                  |
| ------------------- | ----------------------------------------------------- |
| ê¸°ë³¸ URL            | `/login`, `POST /login`                               |
| ì¸ì¦ í•„í„°           | `UsernamePasswordAuthenticationFilter`                |
| ì‚¬ìš©ì ì •ì˜ ì„¤ì •    | `.formLogin().loginPage(...)` ë“±                      |
| í•„ìˆ˜ êµ¬ì„± ìš”ì†Œ      | `UserDetailsService`, `PasswordEncoder`               |
| ì¸ì¦ ê²°ê³¼ ì €ì¥ ìœ„ì¹˜ | `SecurityContextHolder` â†’ ì„¸ì…˜ or í† í° ê¸°ë°˜ ì „í™˜ ê°€ëŠ¥ |

## ì‚¬ìš©ì ì¸ì¦

Spring Securityì—ì„œ **ì‚¬ìš©ì ì¸ì¦(Authentication)**ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì‹œìŠ¤í…œì— ì ‘ê·¼í•˜ë ¤ê³  í•  ë•Œ,
 **ì œê³µí•œ ìê²© ì¦ëª…(ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸, í† í° ë“±)ì´ ìœ íš¨í•œì§€ë¥¼ ê²€ì¦í•˜ëŠ” ê³¼ì •**ì´ë‹¤.
 ì´ëŠ” Spring Security êµ¬ì¡°ì˜ í•µì‹¬ì´ë©°, ì¸ì¦ ì„±ê³µ ì‹œ **SecurityContextì— ì¸ì¦ ì •ë³´ê°€ ì €ì¥ë˜ê³ **
 ì´í›„ ëª¨ë“  ìš”ì²­ì€ ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¸ê°€(Authorization) ì²˜ë¦¬ëœë‹¤.

------

### ğŸ“˜ 1. ì‚¬ìš©ì ì¸ì¦ì´ë€?

> ì‚¬ìš©ìì˜ IDì™€ ë¹„ë°€ë²ˆí˜¸(ë˜ëŠ” í† í°, ì¸ì¦ì„œ ë“±)ë¥¼ ê²€ì¦í•˜ì—¬
>  **"ëˆ„êµ¬ì¸ì§€ ì¦ëª…í•˜ëŠ” ê³¼ì •"**

------

### ğŸ”„ 2. ì¸ì¦ íë¦„ ìš”ì•½

```
â‘  í´ë¼ì´ì–¸íŠ¸ê°€ ID/PW ë˜ëŠ” í† í°ê³¼ í•¨ê»˜ ìš”ì²­
  â†“
â‘¡ ì¸ì¦ í•„í„°(ì˜ˆ: UsernamePasswordAuthenticationFilter) â†’ AuthenticationManager í˜¸ì¶œ
  â†“
â‘¢ AuthenticationManager â†’ UserDetailsService â†’ ì‚¬ìš©ì ì¡°íšŒ
  â†“
â‘£ ë¹„ë°€ë²ˆí˜¸ ë¹„êµ â†’ ì„±ê³µ ì‹œ Authentication ê°ì²´ ìƒì„±
  â†“
â‘¤ SecurityContextHolderì— ì €ì¥
  â†“
â‘¥ ì¸ì¦ ì„±ê³µ ìƒíƒœë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ ë™ì‘
```

------

### ğŸ§© 3. ì¸ì¦ì— ì‚¬ìš©ë˜ëŠ” í•µì‹¬ êµ¬ì„± ìš”ì†Œ

| êµ¬ì„± ìš”ì†Œ                             | ì„¤ëª…                             |
| ------------------------------------- | -------------------------------- |
| `Authentication`                      | ì¸ì¦ ê°ì²´ (ID, PW, ê¶Œí•œ ë“± í¬í•¨) |
| `AuthenticationManager`               | ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤       |
| `UsernamePasswordAuthenticationToken` | ì¸ì¦ ì „/í›„ ìƒíƒœë¥¼ í‘œí˜„í•˜ëŠ” ê°ì²´  |
| `UserDetailsService`                  | ì‚¬ìš©ì ì •ë³´ë¥¼ ë¡œë“œí•˜ëŠ” ì„œë¹„ìŠ¤    |
| `PasswordEncoder`                     | ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”/ê²€ì¦ ë„êµ¬        |
| `SecurityContextHolder`               | ì¸ì¦ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ThreadLocal |

------

### ğŸ” 4. ì¸ì¦ ì²˜ë¦¬ í´ë˜ìŠ¤ êµ¬ì¡°

#### âœ… 1. AuthenticationManager

```
public interface AuthenticationManager {
    Authentication authenticate(Authentication authentication) throws AuthenticationException;
}
```

â†’ ê¸°ë³¸ êµ¬í˜„ì²´: `ProviderManager`

------

#### âœ… 2. UserDetailsService êµ¬í˜„

```
@Bean
public UserDetailsService userDetailsService() {
    return username -> {
        User user = userRepository.findByUsername(username)
            .orElseThrow(() -> new UsernameNotFoundException("ì‚¬ìš©ì ì—†ìŒ"));

        return new org.springframework.security.core.userdetails.User(
            user.getUsername(),
            user.getPassword(),
            List.of(new SimpleGrantedAuthority("ROLE_USER"))
        );
    };
}
```

------

#### âœ… 3. PasswordEncoder ì„¤ì •

```
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}
```

- ì‚¬ìš©ì ë“±ë¡ ì‹œì—ë„ `passwordEncoder.encode()`ë¡œ ì €ì¥
- ë¡œê·¸ì¸ ì‹œ ìë™ìœ¼ë¡œ ë§¤ì¹­ (`matches(raw, encoded)`)

------

### ğŸ§¾ 5. ì¸ì¦ ê°ì²´: `Authentication`

#### ì¸ì¦ ì „ (ë¡œê·¸ì¸ ìš”ì²­ ì‹œ)

```
new UsernamePasswordAuthenticationToken(username, password);
```

#### ì¸ì¦ í›„ (ì„±ê³µ í›„ ì €ì¥ë  ë•Œ)

```
new UsernamePasswordAuthenticationToken(userDetails, null, authorities);
```

â†’ ì´í›„ `SecurityContextHolder.getContext().getAuthentication()`ìœ¼ë¡œ í˜„ì¬ ì¸ì¦ëœ ì‚¬ìš©ì ì ‘ê·¼ ê°€ëŠ¥

------

### ğŸ§ª 6. ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥í•œ ì¸ì¦ ì „ëµ

| ì‹œì                   | í™•ì¥ ê°€ëŠ¥ ìš”ì†Œ                                               |
| --------------------- | ------------------------------------------------------------ |
| ì‚¬ìš©ì ì¡°íšŒ           | `UserDetailsService` êµ¬í˜„                                    |
| ë¹„ë°€ë²ˆí˜¸ ë¹„êµ         | `PasswordEncoder` êµì²´                                       |
| ì¸ì¦ ì²˜ë¦¬             | `AuthenticationManager`, `AuthenticationProvider` êµ¬í˜„       |
| ì¸ì¦ í•„í„° êµì²´        | `UsernamePasswordAuthenticationFilter` ì»¤ìŠ¤í„°ë§ˆì´ì§•          |
| ì¸ì¦ ì„±ê³µ/ì‹¤íŒ¨ í•¸ë“¤ëŸ¬ | `AuthenticationSuccessHandler`, `AuthenticationFailureHandler` |

------

### âœ… 7. ì‹¤ë¬´ ì „ëµ

| í•­ëª©                  | ì „ëµ                                    |
| --------------------- | --------------------------------------- |
| ì‚¬ìš©ì ì¸ì¦           | `UserDetailsService`ì—ì„œ DB ì¡°íšŒ        |
| ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ         | `BCryptPasswordEncoder`ë¡œ ì•”í˜¸í™”        |
| ì‚¬ìš©ì ì •ë³´ ì €ì¥ì†Œ    | `SecurityContextHolder` + ì„¸ì…˜ or JWT   |
| ì»¤ìŠ¤í…€ ì¸ì¦ ì²˜ë¦¬      | ìì²´ `AuthenticationProvider` êµ¬í˜„ ê°€ëŠ¥ |
| ì¸ì¦ ì‹¤íŒ¨ì‹œ ìƒì„¸ ì‘ë‹µ | `AuthenticationEntryPoint` ì»¤ìŠ¤í„°ë§ˆì´ì§• |

------

### ğŸ“Œ 8. ìš”ì•½

| í•­ëª©           | ì„¤ëª…                                                         |
| -------------- | ------------------------------------------------------------ |
| ì¸ì¦ì´ë€       | ì‚¬ìš©ì ID/PW ë˜ëŠ” í† í° ê²€ì¦                                  |
| ê¸°ë³¸ ì²˜ë¦¬ êµ¬ì¡° | AuthenticationManager â†’ UserDetailsService â†’ PasswordEncoder |
| ì¸ì¦ ì„±ê³µ ì‹œ   | Authentication ê°ì²´ ìƒì„± â†’ SecurityContextì— ì €ì¥            |
| í•„ìˆ˜ êµ¬ì„± ìš”ì†Œ | Authentication, UserDetails, PasswordEncoder                 |
| í™•ì¥ ì „ëµ      | DB ì¡°íšŒ/ë¹„ë°€ë²ˆí˜¸/í† í° ì²˜ë¦¬/ì‘ë‹µ ë°©ì‹ê¹Œì§€ ëª¨ë‘ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥ |

## ì‚¬ìš©ì ê¶Œí•œ ì²˜ë¦¬

- ## `@Secured`, `@PreAuthorize`, `@PostAuthorize`

  Spring Securityì—ì„œëŠ” ë©”ì„œë“œ ìˆ˜ì¤€ì—ì„œ ì ‘ê·¼ ì œì–´ë¥¼ í•  ìˆ˜ ìˆë„ë¡ ì—¬ëŸ¬ ì• ë…¸í…Œì´ì…˜ì„ ì œê³µí•œë‹¤.
   ê·¸ì¤‘ì—ì„œë„ **`@Secured`**, **`@PreAuthorize`**, **`@PostAuthorize`**ëŠ”
   **ë©”ì„œë“œ í˜¸ì¶œ ì „/í›„ì— ê¶Œí•œì´ë‚˜ ì¡°ê±´ì„ ê²€ì‚¬**í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.

  ì´ ì„¸ ê°€ì§€ëŠ” ëª©ì ì€ ë¹„ìŠ·í•˜ì§€ë§Œ **ì§€ì› ë°©ì‹, í‘œí˜„ë ¥, ì‚¬ìš© ì‹œê¸°**ê°€ ë‹¤ë¥´ë©°,
   ì‹¤ë¬´ì—ì„œ ë³´ì•ˆ ë¡œì§ì„ ì„ ì–¸ì ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì¤‘ìš”í•œ ê¸°ëŠ¥ì´ë‹¤.

  ------

  ### ğŸ“˜ 1. ê°œìš” ë¹„êµ

  | ì• ë…¸í…Œì´ì…˜       | ì‚¬ìš© ì‹œì    | SpEL ì§€ì› | íŠ¹ì§•                            |
  | ---------------- | ----------- | --------- | ------------------------------- |
  | `@Secured`       | í˜¸ì¶œ **ì „** | âŒ         | ê°„ë‹¨í•œ **ì—­í• (Role)** ê¸°ë°˜ ì œì–´ |
  | `@PreAuthorize`  | í˜¸ì¶œ **ì „** | âœ…         | SpEL ê¸°ë°˜, ë‹¤ì–‘í•œ ì¡°ê±´ ì§€ì›     |
  | `@PostAuthorize` | í˜¸ì¶œ **í›„** | âœ…         | ë°˜í™˜ ê°’ ê¸°ë°˜ ì¸ê°€ ê°€ëŠ¥          |

  > ğŸ“Œ SpEL (Spring Expression Language) ì‚¬ìš© ì—¬ë¶€ê°€ í° ì°¨ì´ì 

  ------

  ### ğŸ” 2. ê³µí†µ ì „ì œ: ì„¤ì • í•„ìš”

  Spring Security 6+ì—ì„œëŠ” ë°˜ë“œì‹œ ì•„ë˜ ì–´ë…¸í…Œì´ì…˜ í™œì„±í™” í•„ìš”:

  ```
  @Configuration
  @EnableMethodSecurity(securedEnabled = true, prePostEnabled = true)
  public class SecurityConfig { }
  ```

  - `securedEnabled = true` â†’ `@Secured` ì‚¬ìš© ê°€ëŠ¥
  - `prePostEnabled = true` â†’ `@PreAuthorize`, `@PostAuthorize` ì‚¬ìš© ê°€ëŠ¥

  ------

  ### âœ… 3. `@Secured`

  #### ê°œìš”

  - ë‹¨ìˆœí•œ Role ê¸°ë°˜ ì¸ê°€ì— ì í•©
  - ë¬¸ìì—´ ë°°ì—´ë¡œ `"ROLE_USER"` ë“± ì§€ì •

  #### ì˜ˆì œ

  ```
  @Secured("ROLE_ADMIN")
  public void deleteUser(Long id) { ... }
  
  @Secured({"ROLE_USER", "ROLE_MANAGER"})
  public void viewDashboard() { ... }
  ```

  â†’ ë©”ì„œë“œ í˜¸ì¶œ ì „ì— í˜„ì¬ ì‚¬ìš©ìì˜ ê¶Œí•œ ëª©ë¡ ì¤‘ í•˜ë‚˜ë¼ë„ ë§¤ì¹­ë˜ë©´ í†µê³¼

  ------

  ### âœ… 4. `@PreAuthorize`

  #### ê°œìš”

  - ë©”ì„œë“œ **í˜¸ì¶œ ì „ì— ì¸ê°€ ì¡°ê±´ íŒë‹¨**
  - **SpEL(Spring Expression Language)** ì‚¬ìš© ê°€ëŠ¥
  - ì¸ì, ì¸ì¦ ì •ë³´, ê¶Œí•œ ë“± ë³µí•© ì¡°ê±´ ì‘ì„± ê°€ëŠ¥

  #### ì˜ˆì œ

  ```
  @PreAuthorize("hasRole('ADMIN')")
  public void createUser(UserDto dto) { ... }
  
  @PreAuthorize("#id == authentication.principal.id")
  public void updateUser(Long id, UserDto dto) { ... }
  
  @PreAuthorize("hasAuthority('SCOPE_read')")
  public void readScope() { ... }
  ```

  ------

  ### âœ… 5. `@PostAuthorize`

  #### ê°œìš”

  - ë©”ì„œë“œ **í˜¸ì¶œ í›„ì— ë°˜í™˜ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ì¸ê°€ íŒë‹¨**
  - ì£¼ë¡œ **ê²°ê³¼ ê¸°ë°˜ ë³´ì•ˆ íŒë‹¨** ì‹œ ì‚¬ìš© (ì˜ˆ: ìì‹ ì˜ ë°ì´í„°ë§Œ ë³´ê¸°)

  #### ì˜ˆì œ

  ```
  @PostAuthorize("returnObject.owner == authentication.name")
  public Document getDocument(Long id) {
      return documentService.findById(id);
  }
  ```

  â†’ ë¬¸ì„œ ë°˜í™˜ í›„ì— **ë°˜í™˜ ê°ì²´ì˜ ì†Œìœ ìê°€ í˜„ì¬ ì‚¬ìš©ìì™€ ê°™ì•„ì•¼ í—ˆìš©**

  ------

  ### ğŸ”§ 6. SpELì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ í‚¤ì›Œë“œ

  | í‘œí˜„                         | ì„¤ëª…                                    |
  | ---------------------------- | --------------------------------------- |
  | `authentication`             | í˜„ì¬ ì¸ì¦ ì •ë³´ (Authentication ê°ì²´)    |
  | `authentication.name`        | ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ID                      |
  | `authentication.authorities` | ì‚¬ìš©ìì˜ ê¶Œí•œ ëª©ë¡                      |
  | `#paramName`                 | ë©”ì„œë“œ íŒŒë¼ë¯¸í„° ì ‘ê·¼                    |
  | `returnObject`               | ë°˜í™˜ëœ ê°ì²´ (`@PostAuthorize`ì—ì„œ ì‚¬ìš©) |

  ------

  ### ğŸ§  7. ì‹¤ë¬´ ì „ëµ ë¹„êµ

  | ìƒí™©                        | ì¶”ì²œ ì• ë…¸í…Œì´ì…˜                              |
  | --------------------------- | -------------------------------------------- |
  | ë‹¨ìˆœí•œ Role ê¸°ë°˜ ì œì–´       | `@Secured`                                   |
  | ì¸ì ê¸°ë°˜ ì¡°ê±´ (ID ë¹„êµ ë“±) | `@PreAuthorize`                              |
  | ë¦¬í„´ ê°ì²´ ì¡°ê±´ ë¹„êµ         | `@PostAuthorize`                             |
  | OAuth2 Scope ê¸°ë°˜ ì œì–´      | `@PreAuthorize("hasAuthority('SCOPE_xxx')")` |
  | ë³µí•© ì¡°ê±´ íŒë‹¨              | `@PreAuthorize` + SpEL ì‚¬ìš©                  |

  ------

  ### ğŸ“Œ 8. ìš”ì•½ ë¹„êµí‘œ

  | í•­ëª©        | `@Secured`       | `@PreAuthorize`         | `@PostAuthorize`         |
  | ----------- | ---------------- | ----------------------- | ------------------------ |
  | ì‚¬ìš© ì‹œì    | í˜¸ì¶œ ì „          | í˜¸ì¶œ ì „                 | í˜¸ì¶œ í›„                  |
  | SpEL ì§€ì›   | âŒ                | âœ…                       | âœ…                        |
  | ê¶Œí•œ í‘œí˜„   | ë¬¸ìì—´ (`ROLE_`) | ììœ ë¡œìš´ SpEL ì‚¬ìš© ê°€ëŠ¥ | SpELë¡œ ë¦¬í„´ ê°’ ë¶„ì„ ê°€ëŠ¥ |
  | ì‹¤ë¬´ ì‚¬ìš©ë„ | ë‚®ìŒ             | ë†’ìŒ                    | ì¤‘ê°„ (íŠ¹ìˆ˜ ëª©ì )         |

## ì»¤ìŠ¤í…€ ì¸ì¦ ë° ì¸ê°€

Spring Securityì—ì„œ **ì»¤ìŠ¤í…€ ì¸ì¦(Authentication)** ë° **ì»¤ìŠ¤í…€ ì¸ê°€(Authorization)**ëŠ”
 ê¸°ë³¸ ì œê³µë˜ëŠ” ID/PW ê¸°ë°˜ ì¸ì¦ê³¼ `hasRole`, `hasAuthority` ê°™ì€ ë‹¨ìˆœ ê¶Œí•œ ì²´í¬ë¡œëŠ” ë¶€ì¡±í•  ë•Œ ì‚¬ìš©ëœë‹¤.
 **ë³µì¡í•œ ë¡œê·¸ì¸ ë¡œì§, ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™, ì„¸ë¶„í™”ëœ ì ‘ê·¼ ì œì–´**ë¥¼ ìš”êµ¬í•˜ëŠ” ì‹¤ë¬´ì—ì„œëŠ”
 ì§ì ‘ ì¸ì¦ ë¡œì§ê³¼ ì¸ê°€ ë¡œì§ì„ ì‘ì„±í•˜ì—¬ Spring Securityì˜ ë‚´ë¶€ êµ¬ì¡°ì— ë§ê²Œ í†µí•©í•´ì•¼ í•œë‹¤.

------

### ğŸ“˜ 1. ì»¤ìŠ¤í…€ ì¸ì¦(Authentication) êµ¬ì„± ìš”ì†Œ

| êµ¬ì„± ìš”ì†Œ                | ì„¤ëª…                                              |
| ------------------------ | ------------------------------------------------- |
| `AuthenticationFilter`   | ìš”ì²­ ê°€ë¡œì±„ì„œ ì¸ì¦ ê°ì²´ ìƒì„± (ì˜ˆ: ID/PW, í† í° ë“±) |
| `AuthenticationManager`  | ì¸ì¦ ê°ì²´ë¥¼ ë°›ì•„ì„œ ì¸ì¦ ì‹œë„                      |
| `AuthenticationProvider` | ì‹¤ì œ ì¸ì¦ ë¡œì§ ìˆ˜í–‰                               |
| `UserDetailsService`     | ì‚¬ìš©ì ì¡°íšŒ                                       |
| `PasswordEncoder`        | ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ë˜ëŠ” ë¬´ë ¥í™” ê°€ëŠ¥                    |
| `SecurityContextHolder`  | ì¸ì¦ ì„±ê³µ í›„ ê²°ê³¼ ì €ì¥ì†Œ                          |

------

### ğŸ§© 2. ì»¤ìŠ¤í…€ ì¸ì¦ íë¦„ êµ¬ì¡°

```
í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ (ex: /login, /api/login)
  â†“
[1] ì»¤ìŠ¤í…€ í•„í„°(AuthenticationFilter) ë“±ë¡
  â†“
[2] AuthenticationManagerì— ì¸ì¦ ìš”ì²­
  â†“
[3] AuthenticationProviderì—ì„œ ì‚¬ìš©ì ì¡°íšŒ ë° ì¸ì¦
  â†“
[4] ì„±ê³µ ì‹œ SecurityContextì— ì €ì¥
```

------

### ğŸ”§ 3. ì»¤ìŠ¤í…€ ì¸ì¦ í•„í„° êµ¬í˜„

```
public class CustomAuthenticationFilter extends UsernamePasswordAuthenticationFilter {

    public CustomAuthenticationFilter(AuthenticationManager authenticationManager) {
        super.setAuthenticationManager(authenticationManager);
        setFilterProcessesUrl("/custom-login"); // ë¡œê·¸ì¸ URL ë³€ê²½ ê°€ëŠ¥
    }

    @Override
    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response)
        throws AuthenticationException {

        String username = request.getParameter("username");
        String password = request.getParameter("password");

        Authentication token = new UsernamePasswordAuthenticationToken(username, password);
        return this.getAuthenticationManager().authenticate(token);
    }
}
```

â†’ ì´ í•„í„°ëŠ” `/custom-login`ìœ¼ë¡œ ë“¤ì–´ì˜¨ ë¡œê·¸ì¸ ìš”ì²­ì„ ê°€ë¡œì±„ì–´
 `UsernamePasswordAuthenticationToken`ì„ ë§Œë“¤ê³  `AuthenticationManager`ì— ìœ„ì„í•¨

------

### ğŸ” 4. ì»¤ìŠ¤í…€ `AuthenticationProvider` êµ¬í˜„

```
@Component
public class CustomAuthenticationProvider implements AuthenticationProvider {

    @Autowired
    private UserDetailsService userDetailsService;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Override
    public Authentication authenticate(Authentication authentication) {
        String username = authentication.getName();
        String password = authentication.getCredentials().toString();

        UserDetails user = userDetailsService.loadUserByUsername(username);

        if (!passwordEncoder.matches(password, user.getPassword())) {
            throw new BadCredentialsException("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        return new UsernamePasswordAuthenticationToken(user, null, user.getAuthorities());
    }

    @Override
    public boolean supports(Class<?> authentication) {
        return UsernamePasswordAuthenticationToken.class.isAssignableFrom(authentication);
    }
}
```

------

### ğŸ›¡ï¸ 5. ì»¤ìŠ¤í…€ ì¸ê°€(Authorization)

#### âœ… 1. í‘œí˜„ì‹ ê¸°ë°˜ ì¸ê°€ í™•ì¥

```
@Component("customPermissionEvaluator")
public class CustomPermissionEvaluator implements PermissionEvaluator {

    @Override
    public boolean hasPermission(Authentication auth, Object target, Object permission) {
        // ë¡œì§ ì˜ˆ: í•´ë‹¹ ì‚¬ìš©ìê°€ íŠ¹ì • ê²Œì‹œë¬¼ì˜ ì†Œìœ ìì¸ì§€ í™•ì¸
        return true;
    }

    @Override
    public boolean hasPermission(Authentication auth, Serializable targetId, String targetType, Object permission) {
        return false;
    }
}
```

â†’ SpELì—ì„œ ì‚¬ìš©:

```
@PreAuthorize("@customPermissionEvaluator.hasPermission(authentication, #doc, 'write')")
```

------

#### âœ… 2. `AuthorizationManager` ê¸°ë°˜ ì»¤ìŠ¤í„°ë§ˆì´ì§• (Spring Security 6+)

```
@Bean
SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .authorizeHttpRequests(auth -> auth
            .requestMatchers("/admin/**").access(this::checkAdmin)
            .anyRequest().permitAll()
        );
    return http.build();
}

private AuthorizationDecision checkAdmin(Authentication auth, HttpServletRequest req) {
    boolean allowed = auth != null && auth.getAuthorities().stream()
        .anyMatch(granted -> granted.getAuthority().equals("ROLE_ADMIN"));
    return new AuthorizationDecision(allowed);
}
```

------

### ğŸ§  6. ì‹¤ë¬´ ì „ëµ ìš”ì•½

| ëª©ì                       | ì»¤ìŠ¤í„°ë§ˆì´ì§• ìœ„ì¹˜                                 |
| ------------------------- | ------------------------------------------------- |
| ë¡œê·¸ì¸ íŒŒë¼ë¯¸í„° êµ¬ì¡° ë³€ê²½ | `AuthenticationFilter`                            |
| ì™¸ë¶€ ì¸ì¦ ì‹œìŠ¤í…œ ì—°ë™     | `AuthenticationProvider`                          |
| ID/PW ì•„ë‹Œ í† í° ê¸°ë°˜ ì¸ì¦ | í•„í„° êµì²´ + ì»¤ìŠ¤í…€ í† í° ì¸ì¦                      |
| ì‘ë‹µ JSON ì»¤ìŠ¤í„°ë§ˆì´ì§•    | `AuthenticationSuccessHandler`, `FailureHandler`  |
| ê¶Œí•œ ì²´í¬ ë¡œì§ ë³µì¡í•¨     | `PermissionEvaluator` ë˜ëŠ” `AuthorizationManager` |

------

### ğŸ“Œ 7. ìš”ì•½

| í•­ëª©                   | ì„¤ëª…                                   |
| ---------------------- | -------------------------------------- |
| ì»¤ìŠ¤í…€ ì¸ì¦ í•„í„°       | ë¡œê·¸ì¸ ìš”ì²­ì„ ì§ì ‘ ì²˜ë¦¬í•˜ëŠ” í•„í„°       |
| AuthenticationProvider | ì¸ì¦ ë¡œì§(ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ë“±) ë‹´ë‹¹       |
| ì¸ê°€ í‘œí˜„ í™•ì¥         | SpEL + `@PreAuthorize` + ì»¤ìŠ¤í…€ Bean   |
| ì¸ì¦ ì„±ê³µ ì €ì¥ ìœ„ì¹˜    | `SecurityContextHolder`                |
| ì‹¤ë¬´ ì‚¬ìš© ì˜ˆì‹œ         | ID/PW ë¡œê·¸ì¸, JWT í† í°, API í‚¤ ì¸ì¦ ë“± |

## ì•”í˜¸í™”

- ## PasswordEncoder, BCrypt

  `PasswordEncoder`ëŠ” Spring Securityì—ì„œ **ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•ˆì „í•˜ê²Œ ì•”í˜¸í™”í•˜ê³  ê²€ì¦í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤**ì´ë‹¤.
   ê·¸ì¤‘ **`BCryptPasswordEncoder`ëŠ” ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” êµ¬í˜„ì²´**ë¡œ,
   ë³´ì•ˆì„±ê³¼ ì‹¤ì „ì„±ì„ ê³ ë ¤í•œ **ë‹¨ë°©í–¥ í•´ì‹œ ë°©ì‹**ì„ ì œê³µí•œë‹¤.

  ------
  
  ### ğŸ“˜ 1. `PasswordEncoder`ë€?
  
  Spring Securityì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” **í‘œì¤€ ì¸í„°í˜ì´ìŠ¤**ë¡œ,
  
  ```
  public interface PasswordEncoder {
      String encode(CharSequence rawPassword);
      boolean matches(CharSequence rawPassword, String encodedPassword);
  }
  ```
  
  - `encode()`: ë¹„ë°€ë²ˆí˜¸ë¥¼ **ë‹¨ë°©í–¥ í•´ì‹œë¡œ ì•”í˜¸í™”**
  - `matches()`: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ì™€ ì €ì¥ëœ í•´ì‹œê°’ì„ ë¹„êµ

  ------
  
  ### ğŸ” 2. `BCryptPasswordEncoder`ë€?
  
  | í•­ëª©     | ì„¤ëª…                                                  |
  | -------- | ----------------------------------------------------- |
  | ì•Œê³ ë¦¬ì¦˜ | **bcrypt** (Blowfish ê¸°ë°˜ ë‹¨ë°©í–¥ í•´ì‹œ í•¨ìˆ˜)           |
  | íŠ¹ì§•     | **Salt ìë™ ìƒì„±**, ë°˜ë³µ ì—°ì‚°(cost factor) ì„¤ì • ê°€ëŠ¥  |
  | ì¥ì      | Rainbow Table ê³µê²© ë°©ì§€, ëŠë¦° í•´ì‹œ â†’ brute-force ì €í•­ |
  | ë‹¨ì      | í•´ì‹œ ê²°ê³¼ ê¸¸ì´ ê¹€ (~60ì), ì†ë„ ëŠë¦¼ (ì˜ë„ëœ íŠ¹ì§•)    |
  
  ------
  
  ### âš™ï¸ 3. Spring Boot ì„¤ì • ì˜ˆì‹œ
  
  ```
  @Bean
  public PasswordEncoder passwordEncoder() {
      return new BCryptPasswordEncoder(); // ê¸°ë³¸ strength = 10
  }
  ```
  
  â†’ Spring SecurityëŠ” `UserDetailsService`ì™€ í•¨ê»˜ ì´ ì¸ì½”ë”ë¥¼ ìë™ìœ¼ë¡œ ì‚¬ìš©
  
  ------
  
  ### ğŸ”„ 4. ë¹„ë°€ë²ˆí˜¸ ì €ì¥ ë° ê²€ì¦ íë¦„
  
  #### âœ… ë¹„ë°€ë²ˆí˜¸ ì €ì¥ ì‹œ
  
  ```
  String rawPassword = "1234";
  String encoded = passwordEncoder.encode(rawPassword);
  // ê²°ê³¼: $2a$10$GnUePkW...
  ```
  
  #### âœ… ë¡œê·¸ì¸ ê²€ì¦ ì‹œ
  
  ```
  passwordEncoder.matches("1234", "$2a$10$GnUePkW...")
  â†’ true ë°˜í™˜
  ```
  
  > âœ… **ì•”í˜¸í™”ëœ ê²°ê³¼ëŠ” í•­ìƒ ë‹¤ë¦„**
  >  ê°™ì€ ë¹„ë°€ë²ˆí˜¸ë¼ë„ **ë§¤ë²ˆ ë‹¤ë¥¸ salt**ê°€ ë¶™ê¸° ë•Œë¬¸ì— hashê°’ì´ ë§¤ë²ˆ ë°”ë€œ

  ------
  
  ### ğŸ§ª 5. BCrypt í•´ì‹œ ê²°ê³¼ êµ¬ì¡°
  
  ```
  $2a$10$EGL3kShs7aZ6SvL3Kckzj.fEQIVz6KDHR1yzXnE9pPZPQqW06.Qmy
   â†‘   â†‘       â†‘
   â”‚   â”‚       â””â”€â”€ í•´ì‹œëœ ê²°ê³¼
   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ cost factor (2^10 = 1024íšŒ ë°˜ë³µ)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì•Œê³ ë¦¬ì¦˜ ë²„ì „ (2a, 2b ë“±)
  ```
  
  ------
  
  ### ğŸ” 6. `BCryptPasswordEncoder` ìƒì„±ì
  
  ```
  new BCryptPasswordEncoder(); // ê¸°ë³¸ cost = 10
  new BCryptPasswordEncoder(12); // ë” ëŠë¦¬ê²Œ, ë” ì•ˆì „í•˜ê²Œ
  ```
  
  > âœ… cost factorëŠ” ì—°ì‚° íšŸìˆ˜ë¥¼ ì˜ë¯¸
  >  ê°’ì´ í´ìˆ˜ë¡ ë³´ì•ˆ ê°•í•˜ì§€ë§Œ ì¸ì¦ ì†ë„ëŠ” ëŠë ¤ì§ (12~14 ì‹¤ë¬´ ê¶Œì¥)

  ------
  
  ### ğŸ§  7. ì‹¤ë¬´ ì „ëµ
  
  | í•­ëª©                           | ì „ëµ                                |
  | ------------------------------ | ----------------------------------- |
  | ë¹„ë°€ë²ˆí˜¸ëŠ” ë°˜ë“œì‹œ í•´ì‹œ ì €ì¥    | ì ˆëŒ€ í‰ë¬¸ ì €ì¥ ê¸ˆì§€                 |
  | **BCrypt ì‚¬ìš© ê°•ë ¥ ì¶”ì²œ**      | í˜„ì¬ ê¸°ì¤€ ê°€ì¥ ì•ˆì „í•˜ê³  ê²€ì¦ëœ ë°©ì‹ |
  | Salt ìˆ˜ë™ ê´€ë¦¬ âŒ               | `BCryptPasswordEncoder`ëŠ” ìë™ ê´€ë¦¬ |
  | ì‚¬ìš©ì ë“±ë¡ ì‹œ `encode()` í˜¸ì¶œ | ë¹„ë°€ë²ˆí˜¸ ì €ì¥ ì‹œ ë°˜ë“œì‹œ ì•”í˜¸í™”      |
  | ë¡œê·¸ì¸ ì‹œ `matches()` ì‚¬ìš©     | í‰ë¬¸ê³¼ í•´ì‹œ ë¹„êµëŠ” ì§ì ‘ í•˜ì§€ ì•ŠìŒ   |
  | ì—°ì‚° ë¹„ìš©(cost) ë†’ì´ê¸°         | ì„œë²„ ì„±ëŠ¥ í—ˆìš© ì‹œ `12~14` ì •ë„ ê¶Œì¥ |
  
  ------
  
  ### âš ï¸ 8. ì˜ëª»ëœ ì‚¬ìš© ì‚¬ë¡€ (í”¼í•´ì•¼ í•  ê²ƒ)
  
  - `equals()`ë¡œ ë¹„ë°€ë²ˆí˜¸ ë¹„êµ
     â†’ `matches()`ë¥¼ ë°˜ë“œì‹œ ì‚¬ìš©
  - í•´ì‹œë¥¼ ë‘ ë²ˆ ì´ìƒ í•˜ëŠ” ë°©ì‹
     â†’ `encode(encode(password))`ëŠ” ì•ˆë¨
  - Salt ì—†ì´ SHA-256 ë“± ì¼ë°˜ í•´ì‹œ ì‚¬ìš©
     â†’ ë¹ ë¥´ê³  ì˜ˆì¸¡ ê°€ëŠ¥ â†’ ê³µê²© ì·¨ì•½
  
  ------
  
  ### ğŸ“Œ 9. ìš”ì•½
  
  | í•­ëª©               | ì„¤ëª…                                                   |
  | ------------------ | ------------------------------------------------------ |
  | ëª©ì                | ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ë° ê²€ì¦                                |
  | ê¸°ë³¸ êµ¬í˜„ì²´        | `BCryptPasswordEncoder`                                |
  | ì•Œê³ ë¦¬ì¦˜ íŠ¹ì§•      | Salt + ë°˜ë³µ ì—°ì‚° ê¸°ë°˜ í•´ì‹œ                             |
  | encode() ê²°ê³¼ íŠ¹ì§• | ë¹„ë°€ë²ˆí˜¸ ê°™ì•„ë„ í•´ì‹œê°’ ë§¤ë²ˆ ë‹¤ë¦„                       |
  | ì‹¤ë¬´ ê¶Œì¥ ì‚¬í•­     | `matches()`, cost factor ì¡°ì •, ì €ì¥ ì „ ë°˜ë“œì‹œ encode() |

## ì„¸ì…˜ ê´€ë¦¬

Spring Securityì˜ **ì„¸ì…˜ ê´€ë¦¬(session management)**ëŠ” ì¸ì¦ëœ ì‚¬ìš©ìì— ëŒ€í•´ **ì„¸ì…˜ì„ ìƒì„±í•˜ê³  ìœ ì§€í•˜ê±°ë‚˜ ì œí•œí•˜ë©°, ë³´ì•ˆ ì·¨ì•½ì (ì˜ˆ: ì„¸ì…˜ ê³ ì •, ì„¸ì…˜ íƒˆì·¨)ì„ ë°©ì§€**í•˜ëŠ” ë° ì¤‘ì ì„ ë‘”ë‹¤.
 ì´ëŠ” íŠ¹íˆ ë¡œê·¸ì¸ ì´í›„ ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼ í•˜ëŠ” **Form ë¡œê·¸ì¸, OAuth2 ë¡œê·¸ì¸ ê¸°ë°˜ì˜ ì‹œìŠ¤í…œì—ì„œ ë§¤ìš° ì¤‘ìš”**í•˜ë‹¤.

------

### ğŸ“˜ 1. ì„¸ì…˜(Session)ì´ë€?

HTTPëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ë¬´ìƒíƒœ(stateless)**ì´ë¯€ë¡œ,
 ì‚¬ìš©ì ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€í•˜ë ¤ë©´ ì„œë²„ì— **ì„¸ì…˜ì„ ìƒì„±í•˜ì—¬ ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥**í•´ì•¼ í•¨.

| êµ¬ì„± ìš”ì†Œ         | ì„¤ëª…                                                         |
| ----------------- | ------------------------------------------------------------ |
| `HttpSession`     | ì‚¬ìš©ì ìƒíƒœ(ì¸ì¦ ì •ë³´ ë“±)ë¥¼ ì €ì¥í•˜ëŠ” ê°ì²´                    |
| `JSESSIONID` ì¿ í‚¤ | í´ë¼ì´ì–¸íŠ¸ê°€ ì„¸ì…˜ì„ ì‹ë³„í•˜ê¸° ìœ„í•œ í‚¤                         |
| `SecurityContext` | ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ë‹´ì€ ê°ì²´ (SecurityContextHolderì— ì €ì¥ë¨) |

------

### ğŸ”„ 2. ê¸°ë³¸ ë™ì‘ (Form ë¡œê·¸ì¸ ê¸°ë°˜)

```
1. ë¡œê·¸ì¸ ì„±ê³µ â†’ Authentication ê°ì²´ ìƒì„±
2. SecurityContextHolderì— ì €ì¥
3. HttpSessionì— SecurityContext ì €ì¥
4. ì´í›„ ìš”ì²­ë§ˆë‹¤ JSESSIONIDë¡œ ì‚¬ìš©ì ìƒíƒœ í™•ì¸
```

> âœ… ì¦‰, Spring SecurityëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ì„ ì œê³µ**í•˜ë©°, ì´ ë•Œ ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ë¥¼ ì„¸ì…˜ì— ì €ì¥í•¨.

------

### âš™ï¸ 3. ì„¸ì…˜ ê´€ë¦¬ ì„¤ì • ì˜ˆì‹œ

```
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .sessionManagement(session -> session
            .sessionFixation().migrateSession()     // ì„¸ì…˜ ê³ ì • ë³´í˜¸
            .maximumSessions(1)                     // ë™ì‹œ ë¡œê·¸ì¸ 1íšŒ ì œí•œ
            .maxSessionsPreventsLogin(false)        // ì´ì „ ì„¸ì…˜ ë§Œë£Œ ì²˜ë¦¬
            .expiredUrl("/login?expired=true")      // ë§Œë£Œ ì‹œ ì´ë™í•  URL
        );
    return http.build();
}
```

------

### ğŸ” 4. ì£¼ìš” ì„¸ì…˜ ë³´ì•ˆ ì˜µì…˜ ì„¤ëª…

#### âœ… ì„¸ì…˜ ê³ ì • ê³µê²© ë°©ì§€ (Session Fixation Protection)

| ì„¤ì •                                  | ì„¤ëª…                                   |
| ------------------------------------- | -------------------------------------- |
| `.sessionFixation().migrateSession()` | ë¡œê·¸ì¸ ì‹œ ìƒˆë¡œìš´ ì„¸ì…˜ ID ìƒì„± (ê¸°ë³¸ê°’) |
| `.sessionFixation().none()`           | ì„¸ì…˜ ID ê·¸ëŒ€ë¡œ ìœ ì§€ (ì·¨ì•½ì  ë°œìƒ ê°€ëŠ¥) |
| `.sessionFixation().newSession()`     | ìƒˆ ì„¸ì…˜ë§Œ ìƒì„±, ê¸°ì¡´ ì†ì„±ë„ ì‚­ì œ       |

> âœ… ê¸°ë³¸ì€ `migrateSession()`ìœ¼ë¡œ ì¶©ë¶„ (ì„¸ì…˜ IDë§Œ ë³€ê²½, ì†ì„± ìœ ì§€)

------

#### âœ… ë™ì‹œ ë¡œê·¸ì¸ ì œí•œ (Concurrent Session Control)

| ì„¤ì •                               | ì„¤ëª…                                        |
| ---------------------------------- | ------------------------------------------- |
| `.maximumSessions(n)`              | í•œ ëª…ì˜ ì‚¬ìš©ìê°€ nê°œê¹Œì§€ ë¡œê·¸ì¸ í—ˆìš©        |
| `.maxSessionsPreventsLogin(true)`  | nê°œ ì´ˆê³¼ ì‹œ ìƒˆ ë¡œê·¸ì¸ ê±°ë¶€ (ê¸°ì¡´ ì„¸ì…˜ ìœ ì§€) |
| `.maxSessionsPreventsLogin(false)` | nê°œ ì´ˆê³¼ ì‹œ ê¸°ì¡´ ì„¸ì…˜ ë¬´íš¨í™” (ê¸°ë³¸)         |

â†’ ë³´í†µ ë³´ì•ˆì´ ì¤‘ìš”í•œ ì‹œìŠ¤í…œì€ `1`ë¡œ ì„¤ì • + `true` ì˜µì…˜ ì¶”ê°€

------

#### âœ… ì„¸ì…˜ ë§Œë£Œ ì‹œ ì²˜ë¦¬

```
.expiredUrl("/login?expired=true")
```

â†’ ê¸°ì¡´ ì„¸ì…˜ì´ ë¬´íš¨í™”ë˜ì—ˆì„ ë•Œ ì‚¬ìš©ìë¥¼ ë¦¬ë””ë ‰ì…˜í•  URL ì§€ì •

------

### ğŸ’£ 5. ì„¸ì…˜ ë§Œë£Œ ì²˜ë¦¬ ì‹œ ì£¼ì˜ì‚¬í•­

- ì„¸ì…˜ì´ ë§Œë£Œë˜ë©´ `SecurityContext`ë„ ì‚¬ë¼ì§
- ì´ë•Œ ì¸ì¦ë˜ì§€ ì•Šì€ ìš”ì²­ì€ `AuthenticationEntryPoint`ë¡œ ì „ë‹¬ë¨
- í•„ìš” ì‹œ ì»¤ìŠ¤í…€ ì²˜ë¦¬ ê°€ëŠ¥ (ì˜ˆ: JSON ì‘ë‹µ)

------

### ğŸ§¾ 6. ì»¤ìŠ¤í…€ ì„¸ì…˜ ì´ë²¤íŠ¸ í•¸ë“¤ë§

#### âœ… ì„¸ì…˜ ë§Œë£Œ ê°ì§€ ë¦¬ìŠ¤ë„ˆ

```
@Component
public class SessionExpiredListener implements SessionInformationExpiredStrategy {
    @Override
    public void onExpiredSessionDetected(SessionInformationExpiredEvent event) throws IOException {
        HttpServletResponse response = event.getResponse();
        response.sendRedirect("/login?expired=true");
    }
}
```

â†’ `.expiredSessionStrategy(new SessionExpiredListener())`ë¡œ ë“±ë¡ ê°€ëŠ¥

------

### ğŸ§  7. ì‹¤ë¬´ ì „ëµ ìš”ì•½

| ëª©ì                          | ì „ëµ                                             |
| ---------------------------- | ------------------------------------------------ |
| ì„¸ì…˜ íƒˆì·¨ ë°©ì§€               | `migrateSession()` ì‚¬ìš© (ê¸°ë³¸ê°’)                 |
| ë³´ì•ˆ ê°•í™”ìš© ë™ì‹œ ë¡œê·¸ì¸ ì œí•œ | `maximumSessions(1)` + ì´ì „ ì„¸ì…˜ ë§Œë£Œ            |
| ì„¸ì…˜ ë§Œë£Œ ì‹œ UX ê³ ë ¤         | `expiredUrl()` ë˜ëŠ” ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬                |
| REST API ì‹œìŠ¤í…œ (JWT ë“±)     | `.sessionCreationPolicy(STATELESS)` ë¡œ ì„¸ì…˜ ì œê±° |
| ì„¸ì…˜ ì €ì¥ì†Œ ë¶„ì‚°í™” í•„ìš” ì‹œ   | Redis ê¸°ë°˜ `Spring Session` ì‚¬ìš©                 |

------

### ğŸ“Œ 8. ìš”ì•½

| í•­ëª©              | ì„¤ëª…                              |
| ----------------- | --------------------------------- |
| ì„¸ì…˜ ì‚¬ìš© ëª©ì     | ì¸ì¦ ì •ë³´ ìœ ì§€                    |
| ê¸°ë³¸ ì €ì¥ ìœ„ì¹˜    | `HttpSession` â†’ `JSESSIONID` ì¿ í‚¤ |
| ê³ ì • ê³µê²© ë°©ì§€    | `migrateSession()` (ê¸°ë³¸ê°’)       |
| ë™ì‹œ ë¡œê·¸ì¸ ì œí•œ  | `maximumSessions(n)` ì‚¬ìš©         |
| ë§Œë£Œ ì‹œ ì´ë™ ê²½ë¡œ | `.expiredUrl(...)` ì„¤ì • ê°€ëŠ¥      |

## Remember-me ê¸°ëŠ¥

Spring Securityì˜ **Remember-me** ê¸°ëŠ¥ì€ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í›„ **ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì•˜ë‹¤ê°€ ë‹¤ì‹œ ì—´ì–´ë„ ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€**í•  ìˆ˜ ìˆë„ë¡ ì¿ í‚¤ ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦ ì •ë³´ë¥¼ ì €ì¥í•´ì£¼ëŠ” ê¸°ëŠ¥ì´ë‹¤.
 ì£¼ë¡œ **"ë¡œê·¸ì¸ ìœ ì§€" ì²´í¬ë°•ìŠ¤**ì²˜ëŸ¼ ì‚¬ìš©ë˜ë©°, ì¸ì¦ì„ ì„¸ì…˜ì—ë§Œ ì˜ì¡´í•˜ì§€ ì•Šê²Œ í•´ì£¼ëŠ” ì¤‘ìš”í•œ í™•ì¥ì´ë‹¤.

------

### ğŸ“˜ 1. Remember-meë€?

> ì‚¬ìš©ìê°€ ì„¸ì…˜ ë§Œë£Œë‚˜ ë¸Œë¼ìš°ì € ì¬ì‹œì‘ í›„ì—ë„ **ì¿ í‚¤ë¥¼ í†µí•´ ì¸ì¦ ìƒíƒœë¥¼ ë³µì›**í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” Spring Security ê¸°ëŠ¥

| íŠ¹ì§•                       | ì„¤ëª…                         |
| -------------------------- | ---------------------------- |
| ì¸ì¦ ì§€ì†ì„±                | ì„¸ì…˜ ì—†ì´ë„ ë¡œê·¸ì¸ ìœ ì§€ ê°€ëŠ¥ |
| ì¿ í‚¤ ê¸°ë°˜                  | ì¸ì¦ ì •ë³´ë¥¼ ì¿ í‚¤ì— ì €ì¥      |
| ë‹¨ê¸° ì„¸ì…˜ + ì¥ê¸° ì¿ í‚¤ ì¡°í•© | UX í–¥ìƒ ëª©ì                  |
| ìë™ ë¡œê·¸ì¸ ìœ„í—˜ ì¡´ì¬      | ë³´ì•ˆ ì„¤ì • ì£¼ì˜ í•„ìš”          |

------

### ğŸ”„ 2. ì¸ì¦ íë¦„ ìš”ì•½

```
â‘  ë¡œê·¸ì¸ ì„±ê³µ + remember-me ìš”ì²­
  â†“
â‘¡ ì„œë²„ê°€ remember-me ì¿ í‚¤ ìƒì„± (ìë™ ë¡œê·¸ì¸ í† í° í¬í•¨)
  â†“
â‘¢ ë¸Œë¼ìš°ì € ì¬ì ‘ì† ì‹œ â†’ remember-me ì¿ í‚¤ ì¡´ì¬ í™•ì¸
  â†“
â‘£ ìœ íš¨ì„± ê²€ì¦ í›„ â†’ ìë™ ì¸ì¦ ì²˜ë¦¬ â†’ SecurityContextì— ì €ì¥
```

------

### ğŸ” 3. Remember-me ë™ì‘ ë°©ì‹: 2ê°€ì§€ ëª¨ë“œ

| ë°©ì‹                      | ì„¤ëª…                                                |
| ------------------------- | --------------------------------------------------- |
| âœ… **Token ê¸°ë°˜ (ê¸°ë³¸ê°’)** | username + ë§Œë£Œì‹œê°„ + secret key + í•´ì‹œ â†’ ì¿ í‚¤ ì €ì¥ |
| âœ… **Persistent ê¸°ë°˜**     | DBì— í† í° ì €ì¥ + ì¿ í‚¤ì—ëŠ” í† í° í‚¤ë§Œ ì €ì¥ â†’ ë” ì•ˆì „  |

------

### âš™ï¸ 4. ê¸°ë³¸ ì„¤ì • ì˜ˆì‹œ (Token-based)

```
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .formLogin(Customizer.withDefaults())
        .rememberMe(remember -> remember
            .key("secure-and-random-key")
            .rememberMeParameter("remember-me")  // ì²´í¬ë°•ìŠ¤ name
            .tokenValiditySeconds(60 * 60 * 24 * 7)  // 7ì¼
        );
    return http.build();
}
```

------

#### âœ… ë¡œê·¸ì¸ HTML ì˜ˆì‹œ

```
<form method="post" action="/login">
  <input type="text" name="username" />
  <input type="password" name="password" />
  <label><input type="checkbox" name="remember-me" /> ë¡œê·¸ì¸ ìœ ì§€</label>
  <button type="submit">ë¡œê·¸ì¸</button>
</form>
```

------

### ğŸ§© 5. Persistent Token ê¸°ë°˜ ì„¤ì • (DB ì €ì¥ ë°©ì‹)

#### âœ… DB í…Œì´ë¸” ìƒì„±

```
CREATE TABLE persistent_logins (
  username VARCHAR(64) NOT NULL,
  series VARCHAR(64) PRIMARY KEY,
  token VARCHAR(64) NOT NULL,
  last_used TIMESTAMP NOT NULL
);
```

#### âœ… ì„¤ì • ì½”ë“œ

```
@Bean
public PersistentTokenRepository tokenRepository(DataSource dataSource) {
    JdbcTokenRepositoryImpl repo = new JdbcTokenRepositoryImpl();
    repo.setDataSource(dataSource);
    return repo;
}

@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .rememberMe(remember -> remember
            .tokenRepository(tokenRepository(dataSource))
            .tokenValiditySeconds(60 * 60 * 24 * 14)  // 14ì¼
            .userDetailsService(userDetailsService)
        );
    return http.build();
}
```

â†’ Persistent ë°©ì‹ì€ **ì¿ í‚¤ íƒˆì·¨ì— ë” ì•ˆì „**, DBì—ì„œ í† í° ê´€ë¦¬ ê°€ëŠ¥

------

### ğŸ§  6. ì‹¤ë¬´ ì „ëµ

| ëª©ì                               | ì „ëµ                                         |
| --------------------------------- | -------------------------------------------- |
| ë¡œê·¸ì¸ ìœ ì§€ UX ì œê³µ               | ê¸°ë³¸ í† í° ë°©ì‹ ì‚¬ìš© ê°€ëŠ¥                     |
| ë³´ì•ˆ ê°•í™” í•„ìš”                    | Persistent + DB ì €ì¥ ë°©ì‹ ì‚¬ìš©               |
| ì¥ê¸° ìœ ì§€ ì œí•œ                    | `tokenValiditySeconds` ì§§ê²Œ ì¡°ì ˆ             |
| ì¿ í‚¤ íƒˆì·¨ ëŒ€ì‘                    | HTTPS + HttpOnly + Secure ì„¤ì •               |
| ì‚¬ìš©ì ë¡œê·¸ì•„ì›ƒ ì‹œ ì¿ í‚¤ ì‚­ì œ í•„ìš” | `logout().deleteCookies("remember-me")` ì„¤ì • |

------

### ğŸ§¾ 7. ì»¤ìŠ¤í…€ Remember-me ì„œë¹„ìŠ¤ êµ¬í˜„ (Optional)

```
public class CustomRememberMeService extends PersistentTokenBasedRememberMeServices {

    public CustomRememberMeService(String key, UserDetailsService userDetailsService,
                                   PersistentTokenRepository tokenRepository) {
        super(key, userDetailsService, tokenRepository);
    }

    @Override
    protected void onLoginSuccess(...) {
        // ì»¤ìŠ¤í…€ ë¡œì§ ê°€ëŠ¥ (ì˜ˆ: í† í° ë°œí–‰ ì•Œë¦¼ ë“±)
    }
}
```

------

### ğŸ”’ 8. ë³´ì•ˆ ì£¼ì˜ì‚¬í•­

| ìœ„í—˜ ìš”ì†Œ          | ëŒ€ì‘ ë°©ì•ˆ                               |
| ------------------ | --------------------------------------- |
| ì¿ í‚¤ íƒˆì·¨ ê°€ëŠ¥ì„±   | **HTTPS**, `Secure`, `HttpOnly` ì„¤ì •    |
| ì˜¤ë˜ëœ í† í° ì¬ì‚¬ìš© | ë§Œë£Œ ì‹œê°„ ë‹¨ì¶• + Logout ì‹œ ì‚­ì œ         |
| ë™ì¼ í† í° ì¬ì‚¬ìš©   | Persistent ë°©ì‹ì€ ìƒˆ í† í° ë°œê¸‰í•¨ (ì¶”ì²œ) |

------

### ğŸ“Œ 9. ìš”ì•½

| í•­ëª©           | ì„¤ëª…                                              |
| -------------- | ------------------------------------------------- |
| ëª©ì            | ë¡œê·¸ì¸ ìœ ì§€ ì¿ í‚¤ ì œê³µ                             |
| ê¸°ë³¸ ë™ì‘      | Token ê¸°ë°˜ ì¿ í‚¤ ìƒì„±                              |
| ë³´ì•ˆ ê°•í™” ë°©ì‹ | Persistent ë°©ì‹ + DB í† í° ì €ì¥                    |
| ì„¤ì • í•µì‹¬      | `rememberMe().key()`, `tokenValiditySeconds()`    |
| ì‹¤ë¬´ ê¶Œì¥      | 7~14ì¼ ìœ ì§€ + ë¡œê·¸ì•„ì›ƒ ì‹œ ì¿ í‚¤ ì‚­ì œ + Secure ì„¤ì • |

## CSRF ë³´í˜¸

Spring SecurityëŠ” **CSRF(Cross-Site Request Forgery, ì‚¬ì´íŠ¸ ê°„ ìš”ì²­ ìœ„ì¡°)** ê³µê²©ìœ¼ë¡œë¶€í„°
 ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³´í˜¸í•˜ê¸° ìœ„í•´ **ê¸°ë³¸ì ìœ¼ë¡œ CSRF ë³´í˜¸ ê¸°ëŠ¥ì„ í™œì„±í™”**í•œë‹¤.
 ì´ ê¸°ëŠ¥ì€ **ì•…ì˜ì ì¸ ì œ3ìê°€ ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ë¥¼ ë„ìš©í•´ ì˜ë„í•˜ì§€ ì•Šì€ ìš”ì²­ì„ ë³´ë‚´ëŠ” í–‰ìœ„**ë¥¼ ë§‰ëŠ” ë° ì¤‘ì ì„ ë‘”ë‹¤.

------

### ğŸ“˜ 1. CSRFë€?

> ì¸ì¦ëœ ì‚¬ìš©ìì˜ ê¶Œí•œì„ ì•…ìš©í•˜ì—¬ **ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©ì ëª°ë˜ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê³µê²©**
>  (ì˜ˆ: ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ `/transfer` ìš”ì²­ì„ ìë™ ì œì¶œ)

#### âœ… ì˜ˆì‹œ (ê³µê²© ì‹œë‚˜ë¦¬ì˜¤)

```
<!-- ì•…ì„± ì‚¬ì´íŠ¸ì— ì‹¬ì–´ì§„ í¼ -->
<form method="post" action="https://bank.com/transfer">
  <input type="hidden" name="to" value="attacker" />
  <input type="hidden" name="amount" value="1000000" />
</form>
<script>document.forms[0].submit();</script>
```

â†’ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ëœ ìƒíƒœë¼ë©´ ì´ ìš”ì²­ì€ **ìì‹ ë„ ëª¨ë¥´ê²Œ ì‹¤í–‰ë¨**

------

### ğŸ” 2. Spring Securityì˜ CSRF ë³´í˜¸ ì›ë¦¬

| í•­ëª©                  | ì„¤ëª…                                                         |
| --------------------- | ------------------------------------------------------------ |
| ë³´í˜¸ ëŒ€ìƒ HTTP ë©”ì„œë“œ | `POST`, `PUT`, `DELETE`, `PATCH` ë“± **ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ìš”ì²­** |
| ë³´í˜¸ ë°©ë²•             | ìš”ì²­ë§ˆë‹¤ **CSRF í† í°ì„ ê²€ì¦**í•˜ì—¬ ìœ„ì¡° ì—¬ë¶€ í™•ì¸             |
| í† í° ì €ì¥ ìœ„ì¹˜        | ì„œë²„: `HttpSession` ë˜ëŠ” `CsrfTokenRepository`               |
| í† í° ì „ë‹¬ ë°©ì‹        | í´ë¼ì´ì–¸íŠ¸: **í¼ í•„ë“œ ë˜ëŠ” HTTP í—¤ë”**ë¡œ ì „ì†¡                |

------

### ğŸ§ª 3. ê¸°ë³¸ ë™ì‘

Spring SecurityëŠ” ë‹¤ìŒ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•¨:

```
â‘  ì„œë²„ê°€ ìš”ì²­í•œ HTMLì— CSRF í† í° ì‚½ì… (í¼ or ë©”íƒ€íƒœê·¸)
â‘¡ í´ë¼ì´ì–¸íŠ¸ê°€ ì´ í† í°ì„ í•¨ê»˜ ì œì¶œ
â‘¢ ì„œë²„ëŠ” ìš”ì²­ì˜ í† í°ê³¼ ì„¸ì…˜ ì €ì¥ í† í°ì„ ë¹„êµ
â‘£ ì¼ì¹˜í•˜ë©´ ìš”ì²­ í—ˆìš©, ì•„ë‹ˆë©´ 403 Forbidden
```

------

### ğŸ§¾ 4. CSRF í† í° HTML í¼ ì‚½ì… ì˜ˆì‹œ (Thymeleaf)

```
<form th:action="@{/update}" method="post">
    <input type="text" name="data" />
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit">ì „ì†¡</button>
</form>
```

â†’ `${_csrf}` ê°ì²´ëŠ” Springì´ ìë™ìœ¼ë¡œ Viewì— ì£¼ì…

------

### âš™ï¸ 5. ì„¤ì • ì˜ˆì‹œ

#### âœ… ê¸°ë³¸ ì„¤ì • (ë³´í˜¸ í™œì„±, ìƒëµ ê°€ëŠ¥)

```
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .csrf(Customizer.withDefaults()) // ë˜ëŠ” ìƒëµ
        .authorizeHttpRequests(auth -> auth
            .anyRequest().authenticated()
        );
    return http.build();
}
```

#### âœ… ë¹„í™œì„±í™” (ì£¼ì˜!)

```
http.csrf(csrf -> csrf.disable());
```

â†’ REST API or ì™¸ë¶€ í† í° ê¸°ë°˜ ì¸ì¦(JWT ë“±)ì—ì„œ ì‚¬ìš© ê°€ëŠ¥
 â†’ ë°˜ë“œì‹œ **ì •ë‹¹í•œ ì´ìœ **ê°€ ìˆì„ ë•Œë§Œ ë¹„í™œì„±í™”í•  ê²ƒ

------

### ğŸ§© 6. REST APIì—ì„œì˜ CSRF ì²˜ë¦¬

#### âœ… 1. ì™„ì „íˆ ë¹„í™œì„±í™” (JWT ì‚¬ìš© ì‹œ ê¶Œì¥)

```
http.csrf(csrf -> csrf.disable());
http.sessionManagement(sm -> sm.sessionCreationPolicy(SessionCreationPolicy.STATELESS));
```

#### âœ… 2. CSRF í† í°ì„ í—¤ë”ë¡œ ì „ì†¡

ì„œë²„:

```
http
    .csrf(csrf -> csrf
        .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())
    );
```

í´ë¼ì´ì–¸íŠ¸ (JS):

```
fetch('/update', {
  method: 'POST',
  headers: {
    'X-CSRF-TOKEN': csrfToken
  },
  body: JSON.stringify(data)
});
```

------

### ğŸ§  7. ì‹¤ë¬´ ì „ëµ

| ìƒí™©                         | ì „ëµ                                    |
| ---------------------------- | --------------------------------------- |
| HTML Form ê¸°ë°˜ ì›¹ ì•±         | CSRF ê¸°ë³¸ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©                 |
| JS ê¸°ë°˜ SPA + ì„œë²„ ì„¸ì…˜ ì‚¬ìš© | `CookieCsrfTokenRepository`ë¡œ ì¿ í‚¤ ì „ë‹¬ |
| JWT ê¸°ë°˜ REST API            | `csrf().disable()` + `STATELESS` ëª¨ë“œ   |
| í…ŒìŠ¤íŠ¸ ì‹œ 403 ì˜¤ë¥˜ ë°œìƒ      | CSRF í† í° ë¯¸í¬í•¨ ì—¬ë¶€ í™•ì¸ í•„ìš”         |
| ì»¤ìŠ¤í…€ ì²˜ë¦¬ í•„ìš”             | `CsrfTokenRepository` ì§ì ‘ êµ¬í˜„ ê°€ëŠ¥    |

------

### ğŸ“Œ 8. ìš”ì•½

| í•­ëª©                 | ì„¤ëª…                                                |
| -------------------- | --------------------------------------------------- |
| ê¸°ë³¸ ë³´í˜¸ ëŒ€ìƒ       | POST, PUT, DELETE, PATCH ìš”ì²­                       |
| í´ë¼ì´ì–¸íŠ¸ ì „ë‹¬ ë°©ì‹ | hidden input or `X-CSRF-TOKEN` í—¤ë”                 |
| í† í° ì €ì¥ ìœ„ì¹˜       | ì„¸ì…˜ or ì¿ í‚¤                                        |
| ë¹„í™œì„±í™” í•„ìš” ì‹œ     | JWT ì‚¬ìš©, API ì„œë²„, ì™¸ë¶€ ì¸ì¦ êµ¬ì¡°                  |
| ì‹¤ë¬´ ê¶Œì¥            | HTML Formì€ í™œì„±í™” ìœ ì§€, REST APIëŠ” í•„ìš”ì‹œ ë¹„í™œì„±í™” |

## CORS ì„¤ì •

### ğŸ“˜ 1. CORSë€?

> Cross-Origin Resource Sharing
>  **ë‹¤ë¥¸ Originì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ëŠ” ê²ƒì„ í—ˆìš©í•  ê²ƒì¸ì§€ ê²°ì •í•˜ëŠ” ì •ì±…**

#### âœ… Originì´ë€?

```
Origin = [í”„ë¡œí† ì½œ + ë„ë©”ì¸ + í¬íŠ¸]

ì˜ˆ:
http://localhost:3000 â‰  http://localhost:8080
```

â†’ ë°±ì—”ë“œê°€ `localhost:8080`ì¸ë°, í”„ë¡ íŠ¸ê°€ `localhost:3000`ì—ì„œ ìš”ì²­í•˜ë©´ **CORS ì˜¤ë¥˜ ë°œìƒ**

------

### ğŸ”„ 2. CORS ìš”ì²­ íë¦„

```
1. í”„ë¡ íŠ¸ì—ì„œ ë‹¤ë¥¸ Originìœ¼ë¡œ ìš”ì²­
2. ë¸Œë¼ìš°ì €ê°€ ë¨¼ì € Preflight ìš”ì²­ (OPTIONS)
3. ì„œë²„ê°€ ì‘ë‹µ í—¤ë”ë¡œ í—ˆìš© ì—¬ë¶€ ëª…ì‹œ (Access-Control-Allow-Origin ë“±)
4. í—ˆìš©ë˜ë©´ ì‹¤ì œ ìš”ì²­ ì§„í–‰, ì•„ë‹ˆë©´ CORS ì—ëŸ¬ ë°œìƒ
```

------

### ğŸ§© 3. Springì—ì„œì˜ CORS ì„¤ì • ìœ„ì¹˜

| ì„¤ì • ìœ„ì¹˜                                       | ì„¤ëª…                              |
| ----------------------------------------------- | --------------------------------- |
| **Spring MVC (`@CrossOrigin`)**                 | Controller ìˆ˜ì¤€ or ì „ì—­ CORS      |
| **Spring Security (`CorsConfigurationSource`)** | ì¸ì¦ í•„í„°ë³´ë‹¤ ë¨¼ì € CORS í—ˆìš© í•„ìš” |

> ğŸ“Œ Spring Securityë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë°˜ë“œì‹œ **SecurityFilterChainì— CORS í—ˆìš© ì½”ë“œ ì¶”ê°€**í•´ì•¼ ì‹¤ì œ ë™ì‘í•¨.

------

### âœ… 4. Spring Security + MVC í†µí•© CORS ì„¤ì • ì˜ˆì‹œ

```
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .cors(Customizer.withDefaults()) // Securityê°€ cors í•„í„°ë¥¼ ë“±ë¡í•˜ê²Œ í•¨
        .csrf(csrf -> csrf.disable())
        .authorizeHttpRequests(auth -> auth
            .anyRequest().permitAll()
        );
    return http.build();
}

@Bean
public CorsConfigurationSource corsConfigurationSource() {
    CorsConfiguration config = new CorsConfiguration();
    config.setAllowedOrigins(List.of("http://localhost:3000")); // í—ˆìš©í•  origin
    config.setAllowedMethods(List.of("GET", "POST", "PUT", "DELETE"));
    config.setAllowedHeaders(List.of("*"));
    config.setAllowCredentials(true); // ì¿ í‚¤ í—ˆìš© ì‹œ í•„ìš”

    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    source.registerCorsConfiguration("/**", config);
    return source;
}
```

------

### ğŸ§¾ 5. ì»¨íŠ¸ë¡¤ëŸ¬ ë‹¨ìœ„ ì„¤ì •: `@CrossOrigin`

```
@CrossOrigin(origins = "http://localhost:3000")
@RestController
public class ApiController {
    @GetMapping("/data")
    public String getData() {
        return "ok";
    }
}
```

â†’ ì´ ë°©ì‹ì€ ë³´ì•ˆ í•„í„° ì´ì „ì— ì‘ë™í•˜ë¯€ë¡œ **Spring Securityì™€ í•¨ê»˜ ì“¸ ë•ŒëŠ” íš¨ê³¼ ì—†ìŒ**
 â†’ **ë‹¨ìˆœí•œ í…ŒìŠ¤íŠ¸ìš©**ìœ¼ë¡œë§Œ ê¶Œì¥

------

### ğŸ”’ 6. CORS í—¤ë” ìš”ì•½

| í—¤ë”                               | ì„¤ëª…                                                  |
| ---------------------------------- | ----------------------------------------------------- |
| `Access-Control-Allow-Origin`      | í—ˆìš©í•  origin ì§€ì • (`*`, íŠ¹ì • ë„ë©”ì¸)                 |
| `Access-Control-Allow-Methods`     | í—ˆìš©í•  HTTP ë©”ì„œë“œ                                    |
| `Access-Control-Allow-Headers`     | í—ˆìš©í•  ìš”ì²­ í—¤ë” (`Content-Type`, `Authorization` ë“±) |
| `Access-Control-Allow-Credentials` | ì¿ í‚¤/ì¸ì¦ì •ë³´ ì „ë‹¬ í—ˆìš© ì—¬ë¶€ (`true`)                 |
| `Access-Control-Max-Age`           | preflight ê²°ê³¼ë¥¼ ìºì‹œí•  ì‹œê°„(ì´ˆ)                      |

------

### ğŸ§  7. ì‹¤ë¬´ ì „ëµ

| ìƒí™©                           | ê¶Œì¥ ì„¤ì •                                                    |
| ------------------------------ | ------------------------------------------------------------ |
| ë¡œì»¬ ê°œë°œ: React â†” Spring Boot | `http://localhost:3000`ë§Œ í—ˆìš©                               |
| ìš´ì˜ í™˜ê²½: ë„ë©”ì¸ ë¶„ë¦¬         | ì‹¤ì œ ë„ë©”ì¸ë§Œ ëª…ì‹œ (`https://myapp.com`)                     |
| REST APIì—ì„œ ì¿ í‚¤ ì¸ì¦ ì‚¬ìš©    | `Allow-Credentials: true` + `Allowed-Origin`ì— `*` ì‚¬ìš© ê¸ˆì§€ |
| ëª¨ë“  ìš”ì²­ í—ˆìš© (í…ŒìŠ¤íŠ¸ìš©ë§Œ)    | `config.setAllowedOrigins(List.of("*"));` ë‹¨, `credentials=false` í•„ìˆ˜ |

------

### âš ï¸ 8. ì£¼ì˜ì‚¬í•­

| ë¬¸ì œ ìƒí™©                               | ì›ì¸                                                         |
| --------------------------------------- | ------------------------------------------------------------ |
| CORS ì„¤ì •í–ˆëŠ”ë° ì—¬ì „íˆ 403              | **Spring Security í•„í„° ì²´ì¸ì—ì„œ cors() ìƒëµ**ë¨              |
| ì¿ í‚¤ê°€ ì „ë‹¬ë˜ì§€ ì•ŠìŒ                    | `credentials=true` + í´ë¼ì´ì–¸íŠ¸ì˜ `withCredentials=true` í•„ìš” |
| `Access-Control-Allow-Origin` í—¤ë” ì—†ìŒ | ì„¤ì •ì´ ëˆ„ë½ë˜ì—ˆê±°ë‚˜ originì´ ë‹¤ë¦„                            |

------

### ğŸ“Œ 9. ìš”ì•½

| í•­ëª©               | ì„¤ëª…                                                        |
| ------------------ | ----------------------------------------------------------- |
| ì„¤ì • ìœ„ì¹˜          | Spring Security í•„í„° ì²´ì¸ + `CorsConfigurationSource`       |
| ë¸Œë¼ìš°ì € ìš”ì²­ ì²˜ë¦¬ | Preflight â†’ ì‘ë‹µ í—¤ë”ë¡œ í—ˆìš© ì—¬ë¶€ íŒë‹¨                      |
| ë³´ì•ˆ ì„¤ì • í•µì‹¬     | `allowCredentials`, `allowedOrigins`, `allowedMethods` ì¡°í•© |
| ì‹¤ë¬´ ê¶Œì¥ ì „ëµ     | ë„ë©”ì¸ ëª…ì‹œ + ì¸ì¦ í•„ìš” ì‹œ Credentials true ì„¤ì •            |

## JWT ê¸°ë°˜ ì¸ì¦

**JWT(Json Web Token) ê¸°ë°˜ ì¸ì¦**ì€ Spring Securityì—ì„œ **ì„¸ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  í´ë¼ì´ì–¸íŠ¸ì— í† í°ì„ ë°œê¸‰í•´ ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€**í•˜ëŠ” ë°©ì‹ì´ë‹¤.
 RESTful API ì„œë²„ì—ì„œëŠ” ì„¸ì…˜ì„ ìƒíƒœ ì—†ì´ ìœ ì§€í•˜ê¸° ìœ„í•´, **Spring Securityì˜ ê¸°ë³¸ ì„¸ì…˜ ì¸ì¦ ëŒ€ì‹  JWT í† í° ë°©ì‹**ì„ ì„ í˜¸í•œë‹¤.

------

### ğŸ“˜ 1. JWTë€?

> í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ **ì„œë²„ ì¸ì¦ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì „ë‹¬í•˜ëŠ” ë°©ì‹**ìœ¼ë¡œ,
>  ìì²´ ì„œëª…ëœ **JSON ê¸°ë°˜ í† í°**

#### âœ… êµ¬ì¡°

JWTëŠ” `.`ìœ¼ë¡œ êµ¬ë¶„ëœ 3ë¶€ë¶„ìœ¼ë¡œ êµ¬ì„±ë¨:

```
[header].[payload].[signature]
```

#### ì˜ˆ:

```
eyJhbGciOiJIUzI1NiJ9.       // Header: ì•Œê³ ë¦¬ì¦˜, íƒ€ì…
eyJ1c2VySWQiOjEsInJvbGUiOiJVU0VSIn0.  // Payload: ì‚¬ìš©ì ì •ë³´
aBc123...                   // Signature: ì„œëª…
```

------

### ğŸ” 2. Spring Securityì—ì„œì˜ JWT ì¸ì¦ íë¦„

```
â‘  ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ìš”ì²­ (ID, PW)
â‘¡ ì¸ì¦ ì„±ê³µ â†’ JWT í† í° ë°œê¸‰
â‘¢ ì´í›„ ìš”ì²­ ì‹œ HTTP Headerì— JWT í¬í•¨
â‘£ JWTAuthenticationFilterê°€ ìš”ì²­ì„ ê°€ë¡œì±„ê³  í† í° ê²€ì¦
â‘¤ ì„±ê³µ ì‹œ SecurityContextì— ì¸ì¦ ì •ë³´ ì €ì¥
â‘¥ ì´í›„ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì¸ì¦ ì •ë³´ì— ì ‘ê·¼ ê°€ëŠ¥
```

------

### âš™ï¸ 3. JWT êµ¬ì„± í•„ìˆ˜ ìš”ì†Œ

| í•­ëª©             | ì„¤ëª…                                      |
| ---------------- | ----------------------------------------- |
| ë¹„ë°€ í‚¤ (Secret) | í† í° ì„œëª…ì„ ìœ„í•œ í‚¤ (`HS256`, `RS256` ë“±) |
| í† í° ìœ íš¨ ì‹œê°„   | `exp` (ë§Œë£Œ ì‹œê°„) í•„ë“œ í¬í•¨               |
| í´ë ˆì„(Claim)    | ì‚¬ìš©ì ID, ê¶Œí•œ ë“± í¬í•¨ ê°€ëŠ¥              |
| ì„œëª…(Signature)  | ìœ„ë³€ì¡° ì—¬ë¶€ í™•ì¸                          |

------

### ğŸ§© 4. JWT ë°œê¸‰ ì˜ˆì œ (ë¡œê·¸ì¸ ì‹œ)

```
String token = Jwts.builder()
    .setSubject(username)
    .claim("role", "USER")
    .setIssuedAt(new Date())
    .setExpiration(new Date(System.currentTimeMillis() + 3600_000)) // 1ì‹œê°„
    .signWith(SignatureAlgorithm.HS256, secretKey)
    .compact();
```

â†’ í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ í† í°ì„ **Authorization í—¤ë”ì— ì¶”ê°€**í•´ì„œ ì‚¬ìš©

```
Authorization: Bearer <token>
```

------

### ğŸ§¾ 5. JWTAuthenticationFilter êµ¬í˜„ (ìš”ì²­ í•„í„°ë§)

```
public class JwtAuthenticationFilter extends OncePerRequestFilter {

    private final String secretKey = "my-secure-secret";

    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                    HttpServletResponse response,
                                    FilterChain filterChain) throws ServletException, IOException {

        String header = request.getHeader("Authorization");
        if (header == null || !header.startsWith("Bearer ")) {
            filterChain.doFilter(request, response);
            return;
        }

        String token = header.replace("Bearer ", "");
        try {
            Claims claims = Jwts.parser()
                .setSigningKey(secretKey)
                .parseClaimsJws(token)
                .getBody();

            String username = claims.getSubject();
            List<GrantedAuthority> authorities = List.of(new SimpleGrantedAuthority("ROLE_USER"));

            Authentication auth = new UsernamePasswordAuthenticationToken(username, null, authorities);
            SecurityContextHolder.getContext().setAuthentication(auth);

        } catch (JwtException e) {
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
            return;
        }

        filterChain.doFilter(request, response);
    }
}
```

------

### ğŸ”§ 6. Spring Security ì„¤ì •ì— í•„í„° ë“±ë¡

```
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .csrf(csrf -> csrf.disable())
        .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
        .authorizeHttpRequests(auth -> auth
            .requestMatchers("/login", "/public/**").permitAll()
            .anyRequest().authenticated()
        )
        .addFilterBefore(new JwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);
    return http.build();
}
```

â†’ ì„¸ì…˜ì„ ì™„ì „íˆ ë¹„í™œì„±í™”í•˜ê³ , ì¸ì¦ì€ JWTë¡œë§Œ ì²˜ë¦¬

------

### ğŸ§  7. ì‹¤ë¬´ ì „ëµ

| í•­ëª©                   | ì „ëµ                                            |
| ---------------------- | ----------------------------------------------- |
| í† í° ìœ íš¨ê¸°ê°„ ì„¤ì •     | ë„ˆë¬´ ê¸¸ê²Œ ì„¤ì •í•˜ë©´ ìœ„í—˜, ë„ˆë¬´ ì§§ìœ¼ë©´ UX ì €í•˜    |
| Refresh Token ë¶„ë¦¬     | Access + Refresh êµ¬ì¡°ë¡œ ê´€ë¦¬ (ì¬ë°œê¸‰ ì²˜ë¦¬)      |
| HTTPS ì ìš© í•„ìˆ˜        | í† í° íƒˆì·¨ ë°©ì§€                                  |
| ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬          | í† í°ì€ ë¬´ìƒíƒœì´ë¯€ë¡œ, ë¸”ë™ë¦¬ìŠ¤íŠ¸ ë°©ì‹ ê³ ë ¤       |
| ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì‘ë‹µ ì²˜ë¦¬ | `AuthenticationEntryPoint`ë¡œ 401 JSON ì‘ë‹µ êµ¬í˜„ |
| ë¹„ë°€ í‚¤ ê´€ë¦¬           | `.properties`, Vault, í™˜ê²½ë³€ìˆ˜ë¡œ ì™¸ë¶€í™”         |

------

### ğŸ“Œ 8. ìš”ì•½

| í•­ëª©                 | ì„¤ëª…                                   |
| -------------------- | -------------------------------------- |
| ì¸ì¦ ë°©ì‹            | ì„¸ì…˜ X, JWT O                          |
| ìš”ì²­ ì²˜ë¦¬ í•„í„°       | `JwtAuthenticationFilter`              |
| SecurityContext ì €ì¥ | ì¸ì¦ ì„±ê³µ ì‹œ ì§ì ‘ ì„¤ì •                 |
| í—¤ë” ì‚¬ìš© ë°©ì‹       | `Authorization: Bearer <token>`        |
| Stateless ì„¤ì •       | `SessionCreationPolicy.STATELESS` í•„ìˆ˜ |

## OAuth2 í´ë¼ì´ì–¸íŠ¸ ë° ì„œë²„

Spring Securityì—ì„œì˜ **OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ì™€ ë¦¬ì†ŒìŠ¤ ì„œë²„ êµ¬ì„±**ì€
 ì™¸ë¶€ ì¸ì¦ ì„œë²„(Google, Kakao, Naver ë“±) ë˜ëŠ” ìì²´ ì¸ì¦ ì„œë²„ë¥¼ í†µí•´
 **ì¸ì¦(Authorization)** ë° **ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ ì œì–´(Resource Access)**ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ í•µì‹¬ ì•„í‚¤í…ì²˜ì´ë‹¤.

OAuth2ëŠ” ë³µì¡í•˜ì§€ë§Œ, Spring SecurityëŠ” **í´ë¼ì´ì–¸íŠ¸ ë° ì„œë²„ ì¸¡ êµ¬í˜„ì„ ì‰½ê²Œ í•  ìˆ˜ ìˆëŠ” êµ¬ì„±ìš”ì†Œë“¤ì„ ì œê³µ**í•œë‹¤.

------

### ğŸ“˜ 1. OAuth2 ì•„í‚¤í…ì²˜ í•µì‹¬ êµ¬ì„±ìš”ì†Œ

| ì—­í•                      | ì„¤ëª…                                             |
| ------------------------ | ------------------------------------------------ |
| **Authorization Server** | í† í°ì„ ë°œê¸‰í•˜ëŠ” ì¸ì¦ ì„œë²„ (Google, ìì²´ ì„œë²„ ë“±) |
| **Resource Server**      | ë³´í˜¸ëœ APIë¥¼ ì œê³µ, í† í° ê²€ì¦ì„ í†µí•´ ì ‘ê·¼ ì œì–´    |
| **Client**               | ì‚¬ìš©ìë¥¼ ëŒ€ì‹ í•´ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜   |
| **Resource Owner**       | ì‚¬ìš©ìì˜ ì‹¤ì œ ê³„ì • ì •ë³´ ë° ê¶Œí•œ ë³´ìœ ì           |
| **Access Token**         | ê¶Œí•œì„ ë¶€ì—¬ë°›ì€ ìš”ì²­ì„ì„ ì¦ëª…í•˜ëŠ” ìˆ˜ë‹¨ (JWT ë“±)  |

------

### ğŸ”„ 2. ì¸ì¦ íë¦„ (Authorization Code ë°©ì‹ ê¸°ì¤€)

```
â‘  Client â†’ Authorization Server: ì¸ì¦ ìš”ì²­ (/oauth2/authorize)
â‘¡ ì‚¬ìš©ì ë¡œê·¸ì¸ í›„ ë™ì˜
â‘¢ Authorization Server â†’ Client: Authorization Code ì „ë‹¬
â‘£ Client â†’ Authorization Server: Authorization Codeë¡œ Access Token ìš”ì²­
â‘¤ Client â†’ Resource Server: Access Tokenì„ í—¤ë”ì— ë‹´ì•„ API í˜¸ì¶œ
â‘¥ Resource Server â†’ Token ìœ íš¨ì„± ê²€ì¦ í›„ ì‘ë‹µ
```

------

### ğŸ§© 3. Spring Security - OAuth2 **Client êµ¬ì„±**

Spring BootëŠ” `spring-boot-starter-oauth2-client`ë¥¼ í†µí•´ OAuth2 ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ìë™í™”í•¨.

#### âœ… 1. ì˜ì¡´ì„± ì¶”ê°€

```
implementation 'org.springframework.boot:spring-boot-starter-oauth2-client'
```

#### âœ… 2. application.yml ì„¤ì • (Google ì˜ˆì‹œ)

```
spring:
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: xxx
            client-secret: yyy
            scope: profile, email
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
```

#### âœ… 3. Security ì„¤ì •

```
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .authorizeHttpRequests(auth -> auth
            .requestMatchers("/", "/login**").permitAll()
            .anyRequest().authenticated()
        )
        .oauth2Login(Customizer.withDefaults()); // ìë™ ë¡œê·¸ì¸
    return http.build();
}
```

------

### ğŸ›¡ï¸ 4. OAuth2 **Resource Server êµ¬ì„±** (í† í° ê²€ì¦ API ì„œë²„)

#### âœ… 1. ì˜ì¡´ì„± ì¶”ê°€

```
implementation 'org.springframework.boot:spring-boot-starter-oauth2-resource-server'
implementation 'org.springframework.boot:spring-boot-starter-security'
```

#### âœ… 2. application.yml ì„¤ì • (JWT ë°©ì‹)

```
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: https://authorization-server.com/oauth2/jwks
```

ë˜ëŠ” ì§ì ‘ `public key` ë“±ë¡ ë°©ì‹:

```
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          public-key-location: classpath:public.pem
```

#### âœ… 3. Security ì„¤ì •

```
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .authorizeHttpRequests(auth -> auth
            .requestMatchers("/public").permitAll()
            .anyRequest().authenticated()
        )
        .oauth2ResourceServer(oauth2 -> oauth2
            .jwt(Customizer.withDefaults())
        );
    return http.build();
}
```

------

### ğŸ” 5. JWT ê¸°ë°˜ í† í° ê²€ì¦

í† í°ì„ í´ë¼ì´ì–¸íŠ¸ê°€ í—¤ë”ì— í¬í•¨:

```
Authorization: Bearer <access_token>
```

â†’ Spring Securityê°€ ìë™ìœ¼ë¡œ `JwtDecoder`ë¥¼ í†µí•´ ì„œëª… ë° ë§Œë£Œ ì—¬ë¶€ ê²€ì¦ í›„
 `SecurityContext`ì— `JwtAuthenticationToken` ì €ì¥

------

### ğŸ§  6. ì‹¤ë¬´ ì „ëµ ìš”ì•½

| í•­ëª©                          | ì „ëµ                                     |
| ----------------------------- | ---------------------------------------- |
| ì‚¬ìš©ì OAuth ë¡œê·¸ì¸ ì²˜ë¦¬      | `spring-boot-starter-oauth2-client` ì‚¬ìš© |
| ìì²´ API ì„œë²„ ë³´í˜¸            | `oauth2-resource-server` + JWT ì¸ì¦ ì‚¬ìš© |
| í† í° ì„œëª… ë°©ì‹                | `HS256`(ëŒ€ì¹­) ë˜ëŠ” `RS256`(ë¹„ëŒ€ì¹­ í‚¤)    |
| ì‚¬ìš©ì ì •ë³´ ë§¤í•‘ ì»¤ìŠ¤í„°ë§ˆì´ì§• | `OAuth2UserService` ì¬ì •ì˜               |
| í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ë¶„ë¦¬ ëŒ€ì‘     | AccessToken â†’ Authorization í—¤ë” ì‚¬ìš©    |

------

### ğŸ“Œ 7. ìš”ì•½

| ì—­í•              | Spring êµ¬ì„± ìš”ì†Œ                                      |
| ---------------- | ----------------------------------------------------- |
| OAuth í´ë¼ì´ì–¸íŠ¸ | `oauth2Login()` + `spring-boot-starter-oauth2-client` |
| ë¦¬ì†ŒìŠ¤ ì„œë²„      | `oauth2ResourceServer()` + JWT ì„¤ì •                   |
| ì‚¬ìš©ì ì¸ì¦ ì²˜ë¦¬ | Authorization Code Flow                               |
| í† í° ì „ë‹¬ ë°©ì‹   | `Authorization: Bearer <token>`                       |
| ë³´ì•ˆ ê²€ì¦        | JWK, ì„œëª…, ë§Œë£Œ ì‹œê°„ í™•ì¸ ë“± ìë™ ìˆ˜í–‰                |
