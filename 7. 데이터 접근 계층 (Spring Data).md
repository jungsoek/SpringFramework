# 7. ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ (Spring Data)

## JDBC ì—°ê²°

### ğŸ§© 1. JDBCë€?

> JDBCëŠ” Javaì—ì„œ **ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤(RDB)**ì™€ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” **í‘œì¤€ API(ì¸í„°í˜ì´ìŠ¤)**ì´ë‹¤.

JDBCëŠ” Java ì½”ë“œì—ì„œ **SQL ì‹¤í–‰ â†’ ê²°ê³¼ ì¡°íšŒ â†’ DB ì—°ê²° ê´€ë¦¬**ë¥¼ í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ”
 **Java SE í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬**ì´ë©°, **DB ë²¤ë”ëŠ” JDBC ë“œë¼ì´ë²„ë¥¼ ì œê³µ**í•´ì•¼ í•œë‹¤.

------

### ğŸ§± 2. ì£¼ìš” êµ¬ì„± ìš”ì†Œ

| êµ¬ì„±ìš”ì†Œ                         | ì„¤ëª…                                              |
| -------------------------------- | ------------------------------------------------- |
| `DriverManager`                  | DB ì—°ê²°ì„ ìœ„í•œ **ë“œë¼ì´ë²„ ê´€ë¦¬ ë° ì»¤ë„¥ì…˜ ìƒì„±ê¸°** |
| `Connection`                     | DBì™€ì˜ **ì—°ê²° ê°ì²´**                              |
| `Statement`, `PreparedStatement` | SQLì„ ì‹¤í–‰í•˜ëŠ” ê°ì²´ (ì¿¼ë¦¬, íŒŒë¼ë¯¸í„° ë°”ì¸ë”©)       |
| `ResultSet`                      | SELECT ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ìˆœíšŒí•˜ë©° ì¡°íšŒí•˜ëŠ” ê°ì²´         |

------

### ğŸ”§ 3. JDBC ì—°ê²° ì ˆì°¨ (5ë‹¨ê³„)

```
1. JDBC ë“œë¼ì´ë²„ ë¡œë“œ
2. DBì™€ ì—°ê²°(Connection)
3. SQL ìƒì„± ë° ì‹¤í–‰(Statement)
4. ê²°ê³¼ ì²˜ë¦¬(ResultSet)
5. ì—°ê²° ìì› í•´ì œ(close)
```

------

### ğŸ’» 4. ì‹¤ì „ ì½”ë“œ ì˜ˆì‹œ (MySQL ê¸°ì¤€)

#### ğŸ“¦ ì˜ˆì‹œ: `users` í…Œì´ë¸”ì—ì„œ ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ

```
import java.sql.*;

public class JdbcExample {

    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/testdb"; // DB URL
        String username = "testuser";
        String password = "testpass";

        String sql = "SELECT id, name, email FROM users";

        try (
            Connection conn = DriverManager.getConnection(url, username, password);
            PreparedStatement pstmt = conn.prepareStatement(sql);
            ResultSet rs = pstmt.executeQuery();
        ) {
            while (rs.next()) {
                long id = rs.getLong("id");
                String name = rs.getString("name");
                String email = rs.getString("email");

                System.out.printf("ID: %d, Name: %s, Email: %s\n", id, name, email);
            }
        } catch (SQLException e) {
            e.printStackTrace();  // ì˜ˆì™¸ ë¡œê·¸
        }
    }
}
```

------

### âš ï¸ 5. JDBC ìì› ì •ë¦¬ (try-with-resources ê¶Œì¥)

- `Connection`, `Statement`, `ResultSet`ì€ ëª¨ë‘ **AutoCloseable**
- `try-with-resources`ë¡œ ìì› ìë™ ë°˜í™˜ì„ ë³´ì¥í•´ì•¼ í•¨
- ì˜ˆì „ ë°©ì‹ (`finally`ì—ì„œ ìˆ˜ë™ close)ëŠ” ì˜¤ë¥˜ ë°œìƒ ìœ„í—˜ ë†’ìŒ

```
try (
    Connection conn = ...
    PreparedStatement stmt = ...
    ResultSet rs = ...
) {
    ...
}
```

------

### ğŸ” 6. PreparedStatement vs Statement

| í•­ëª©               | `Statement`      | `PreparedStatement`         |
| ------------------ | ---------------- | --------------------------- |
| SQL ì‹¤í–‰ ë°©ì‹      | ë¬¸ìì—´ ì§ì ‘ ì „ë‹¬ | SQL êµ¬ì¡° + ë°”ì¸ë”©           |
| SQL Injection ë°©ì§€ | âŒ                | âœ…                           |
| íŒŒë¼ë¯¸í„° ë°”ì¸ë”©    | ë¶ˆê°€ëŠ¥           | ê°€ëŠ¥ (`?` ìë¦¬ ë°”ì¸ë”©)      |
| ì„±ëŠ¥               | ìƒëŒ€ì  ëŠë¦¼      | SQL ìºì‹±ìœ¼ë¡œ ë°˜ë³µ ì„±ëŠ¥ í–¥ìƒ |

------

### ğŸ“¦ INSERT ì˜ˆì‹œ

```
String sql = "INSERT INTO users (name, email) VALUES (?, ?)";
PreparedStatement stmt = conn.prepareStatement(sql);
stmt.setString(1, "Alice");
stmt.setString(2, "alice@example.com");
int rowsInserted = stmt.executeUpdate();
```

------

### ğŸ“Œ 7. JDBC URL ì˜ˆì‹œ

| DB ì¢…ë¥˜    | URL í˜•ì‹                             |
| ---------- | ------------------------------------ |
| MySQL      | `jdbc:mysql://host:port/dbname`      |
| PostgreSQL | `jdbc:postgresql://host:port/dbname` |
| H2         | `jdbc:h2:mem:testdb`                 |
| Oracle     | `jdbc:oracle:thin:@host:port:SID`    |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©      | ì„¤ëª…                                            |
| --------- | ----------------------------------------------- |
| ì—­í•       | Javaì—ì„œ DBì— SQL ë³´ë‚´ê³  ê²°ê³¼ ë°›ëŠ” API          |
| êµ¬ì„±      | DriverManager, Connection, Statement, ResultSet |
| ë°”ì¸ë”©    | PreparedStatement + ? + setXXX ë©”ì„œë“œ           |
| ìì› ì •ë¦¬ | try-with-resourcesë¡œ ì•ˆì „í•˜ê²Œ close             |
| ìœ„í—˜      | ì§ì ‘ ë¬¸ìì—´ ì¡°ì‘ ì‹œ SQL Injection ë°œìƒ ê°€ëŠ¥     |

## JdbcTemplate

### ğŸ§© 1. JdbcTemplateì´ë€?

> Spring Frameworkê°€ ì œê³µí•˜ëŠ” JDBC API **ê°„ì†Œí™” ë„êµ¬**

#### ğŸ“Œ ëª©ì 

- ë°˜ë³µì ì¸ JDBC ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ì œê±°
- ìë™ ìì› í•´ì œ (`Connection`, `PreparedStatement`, `ResultSet`)
- SQL ë°”ì¸ë”©ì„ **ëª…ì‹œì ìœ¼ë¡œ, ì•ˆì „í•˜ê²Œ** ì§€ì›
- Exception â†’ `DataAccessException`ìœ¼ë¡œ **í†µì¼ëœ ì˜ˆì™¸ ì²˜ë¦¬**

------

### ğŸ§± 2. í•µì‹¬ íŠ¹ì§• ìš”ì•½

| íŠ¹ì§•                          | ì„¤ëª…                                    |
| ----------------------------- | --------------------------------------- |
| âœ… SQL ì‹¤í–‰ ìë™í™”             | SQL ì‹¤í–‰, ë°”ì¸ë”©, ìì› í•´ì œê¹Œì§€ í•œ ì¤„   |
| âœ… ìì› ìë™ í•´ì œ              | try-catch-finally ìƒëµ ê°€ëŠ¥             |
| âœ… PreparedStatement ìë™ ì‚¬ìš© | SQL Injection ë°©ì§€                      |
| âœ… ResultSet â†’ ê°ì²´ ë§¤í•‘       | `RowMapper`ë¥¼ í†µí•´ ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë³€í™˜   |
| âœ… ì˜ˆì™¸ ì¶”ìƒí™”                 | SQLException â†’ DataAccessException ë³€í™˜ |

------

### âš™ï¸ 3. JdbcTemplate ì„¤ì • (Spring Boot ê¸°ì¤€)

```
@Configuration
public class JdbcConfig {

    @Bean
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}
```

> ğŸ“Œ `spring-boot-starter-jdbc` ë˜ëŠ” `spring-boot-starter-data-jpa`ë¥¼ ì˜ì¡´ì„±ì— ì¶”ê°€í•˜ë©´
>  `DataSource`ëŠ” ìë™ ì£¼ì…ë¨.

------

### ğŸ’» 4. ì£¼ìš” ì‚¬ìš© ë©”ì„œë“œ

| ë©”ì„œë“œ             | ì„¤ëª…                               |
| ------------------ | ---------------------------------- |
| `query()`          | SELECT ì¿¼ë¦¬ ìˆ˜í–‰, `RowMapper` ì‚¬ìš© |
| `queryForObject()` | ë‹¨ì¼ í–‰/ë‹¨ì¼ ê°’ ì¡°íšŒ               |
| `update()`         | INSERT / UPDATE / DELETE           |
| `batchUpdate()`    | ëŒ€ëŸ‰ ì²˜ë¦¬                          |
| `execute()`        | ì¼ë°˜ ì¿¼ë¦¬ ì‹¤í–‰ (DDL ë“±)            |

------

### ğŸ§ª 5. ì‹¤ì „ ì˜ˆì œ

#### âœ” í…Œì´ë¸”

```
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    email VARCHAR(100)
);
```

------

#### âœ” User ëª¨ë¸

```
public class User {
    private Long id;
    private String name;
    private String email;

    // ìƒì„±ì, getter/setter
}
```

------

#### âœ” RowMapper êµ¬í˜„

```
public class UserRowMapper implements RowMapper<User> {
    @Override
    public User mapRow(ResultSet rs, int rowNum) throws SQLException {
        return new User(
            rs.getLong("id"),
            rs.getString("name"),
            rs.getString("email")
        );
    }
}
```

------

#### âœ” Repository í´ë˜ìŠ¤

```
@Repository
public class UserRepository {

    private final JdbcTemplate jdbc;

    public UserRepository(JdbcTemplate jdbc) {
        this.jdbc = jdbc;
    }

    public List<User> findAll() {
        String sql = "SELECT * FROM users";
        return jdbc.query(sql, new UserRowMapper());
    }

    public User findById(Long id) {
        String sql = "SELECT * FROM users WHERE id = ?";
        return jdbc.queryForObject(sql, new UserRowMapper(), id);
    }

    public void save(User user) {
        String sql = "INSERT INTO users (name, email) VALUES (?, ?)";
        jdbc.update(sql, user.getName(), user.getEmail());
    }

    public void update(User user) {
        String sql = "UPDATE users SET name = ?, email = ? WHERE id = ?";
        jdbc.update(sql, user.getName(), user.getEmail(), user.getId());
    }

    public void delete(Long id) {
        jdbc.update("DELETE FROM users WHERE id = ?", id);
    }
}
```

------

### ğŸ” 6. íŠ¸ëœì­ì…˜ ì—°ë™

`JdbcTemplate`ì€ Springì˜ íŠ¸ëœì­ì…˜ ê´€ë¦¬(`@Transactional`)ì™€ ì™„ì „íˆ í†µí•©ë¨.

```
@Service
public class UserService {

    private final UserRepository userRepository;

    @Transactional
    public void register(User user) {
        userRepository.save(user);
        // ì˜ˆì™¸ ë°œìƒ ì‹œ ìë™ ë¡¤ë°±
    }
}
```

------

### âš ï¸ 7. ì‹¤ì „ ì£¼ì˜ì‚¬í•­

| ì£¼ì˜                                | ì„¤ëª…                                     |
| ----------------------------------- | ---------------------------------------- |
| SQLì€ ëª…ì‹œì ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•¨        | ORMì²˜ëŸ¼ ìë™ ìƒì„± ì—†ìŒ                   |
| RowMapperëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥             | í•˜ë‚˜ì˜ RowMapperë¡œ ì—¬ëŸ¬ ê³³ì—ì„œ ì‚¬ìš© ê°€ëŠ¥ |
| `queryForObject()`ëŠ” 0ê±´ì´ë©´ ì˜ˆì™¸   | `EmptyResultDataAccessException` ì£¼ì˜    |
| Enum, LocalDate ë“± ë§¤í•‘ì€ ìˆ˜ë™ ì²˜ë¦¬ | ê°ì²´ ë§¤í•‘ì‹œ ì»¤ìŠ¤í…€ RowMapper í•„ìš”        |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©        | ì„¤ëª…                                      |
| ----------- | ----------------------------------------- |
| ëª©ì         | JDBC ì½”ë“œ ê°„ê²°í™” ë° ì•ˆì „í•œ SQL ì‹¤í–‰       |
| ì£¼ìš” ë©”ì„œë“œ | `query()`, `queryForObject()`, `update()` |
| SQL ë°”ì¸ë”©  | `?` ì‚¬ìš©, íƒ€ì… ì•ˆì „í•œ `PreparedStatement` |
| ê²°ê³¼ ë§¤í•‘   | `RowMapper`ë¥¼ ì‚¬ìš©í•´ ê°ì²´ ë³€í™˜            |
| íŠ¸ëœì­ì…˜    | Spring `@Transactional`ê³¼ ì™„ì „ ì—°ë™       |

## MyBatis ì—°ë™

### ğŸ§© 1. MyBatisë€?

> Java ê°ì²´ì™€ SQL ì‚¬ì´ì˜ **ë§¤í•‘(Mapping)**ì„ ìˆ˜ë™ìœ¼ë¡œ ëª…í™•íˆ ê¸°ìˆ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” **ë°˜ìë™ ORM í”„ë ˆì„ì›Œí¬**

#### âœ” íŠ¹ì§• ìš”ì•½

| í•­ëª©                | ì„¤ëª…                                            |
| ------------------- | ----------------------------------------------- |
| ğŸ” SQL ì¤‘ì‹¬          | SQLì„ ì§ì ‘ ì‘ì„±í•¨ (JPAì™€ ë‹¬ë¦¬ ìë™ ìƒì„± ì—†ìŒ)   |
| ğŸ“„ XML or ì–´ë…¸í…Œì´ì…˜ | XML ë˜ëŠ” Java ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ SQL ë§¤í•‘           |
| ğŸ”„ ê°ì²´ â†” DB ë§¤í•‘    | ì¿¼ë¦¬ ê²°ê³¼ë¥¼ Java ê°ì²´ë¡œ ë°”ì¸ë”©                  |
| Springê³¼ í†µí•© ìš©ì´  | `@Mapper`, `SqlSession`, `MapperScan` ì‚¬ìš© ê°€ëŠ¥ |

------

### ğŸ§± 2. MyBatis vs JPA ë¹„êµ

| í•­ëª©        | MyBatis            | JPA (Hibernate)          |
| ----------- | ------------------ | ------------------------ |
| SQL ì‘ì„±    | ìˆ˜ë™, ì§ì ‘ ì‘ì„±    | ìë™ ìƒì„± ê¸°ë°˜ (JPQL)    |
| ì œì–´ ë°©ì‹   | SQL ì¤‘ì‹¬           | ê°ì²´ ì¤‘ì‹¬                |
| ë³µì¡í•œ ì¿¼ë¦¬ | ë§¤ìš° ìœ ë¦¬          | ë¶ˆë¦¬í•¨                   |
| ëŸ¬ë‹ì»¤ë¸Œ    | ë‚®ìŒ (SQL ê¸°ì¤€)    | ë†’ìŒ (ê°ì²´/ìºì‹œ ì¤‘ì‹¬)    |
| ì„±ëŠ¥ íŠœë‹   | SQL ì§ì ‘ ì œì–´ ê°€ëŠ¥ | ìë™ ìºì‹œ/íŒ¨ì¹˜ ì „ëµ í•„ìš” |

------

### âš™ï¸ 3. MyBatis ê¸°ë³¸ êµ¬ì„± ìš”ì†Œ

| êµ¬ì„±ìš”ì†Œ                   | ì„¤ëª…                                 |
| -------------------------- | ------------------------------------ |
| `SqlSessionFactory`        | DB ì—°ê²°ê³¼ ë§¤í¼ ê°ì²´ ìƒì„±ì„ ë‹´ë‹¹      |
| `Mapper Interface`         | SQL ì‹¤í–‰ ë©”ì„œë“œ ì •ì˜                 |
| `Mapper XML`               | SQL ì •ì˜ (`<select>`, `<insert>` ë“±) |
| `TypeAlias`, `TypeHandler` | ê°ì²´ì™€ SQL íƒ€ì… ê°„ ë§¤í•‘ ì§€ì› ë„êµ¬    |

------

### ğŸ§ª 4. Spring Boot + MyBatis ì—°ë™ ì˜ˆì œ

------

#### ğŸ“¦ â‘  ì˜ì¡´ì„± ì„¤ì • (Maven)

```
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>3.0.2</version> <!-- ìµœì‹  ë²„ì „ í™•ì¸ í•„ìš” -->
</dependency>

<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-j</artifactId>
</dependency>
```

------

#### âš™ï¸ â‘¡ `application.yml`

```
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/testdb
    username: testuser
    password: testpass
    driver-class-name: com.mysql.cj.jdbc.Driver

mybatis:
  mapper-locations: classpath:/mappers/**/*.xml
  type-aliases-package: com.example.domain
```

------

#### ğŸ“¦ â‘¢ ë„ë©”ì¸ ê°ì²´

```
public class User {
    private Long id;
    private String name;
    private String email;

    // Getter, Setter
}
```

------

#### ğŸ“˜ â‘£ Mapper ì¸í„°í˜ì´ìŠ¤

```
@Mapper
public interface UserMapper {
    User findById(Long id);
    List<User> findAll();
    void insert(User user);
    void update(User user);
    void delete(Long id);
}
```

> ğŸ“Œ `@Mapper`ê°€ ë¶™ì€ ì¸í„°í˜ì´ìŠ¤ëŠ” MyBatisê°€ êµ¬í˜„ì²´ë¥¼ ìë™ ìƒì„±í•¨

------

#### ğŸ“„ â‘¤ Mapper XML (`resources/mappers/UserMapper.xml`)

```
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.UserMapper">

  <select id="findById" parameterType="long" resultType="User">
    SELECT * FROM users WHERE id = #{id}
  </select>

  <select id="findAll" resultType="User">
    SELECT * FROM users
  </select>

  <insert id="insert" parameterType="User">
    INSERT INTO users (name, email)
    VALUES (#{name}, #{email})
  </insert>

  <update id="update" parameterType="User">
    UPDATE users
    SET name = #{name}, email = #{email}
    WHERE id = #{id}
  </update>

  <delete id="delete" parameterType="long">
    DELETE FROM users WHERE id = #{id}
  </delete>

</mapper>
```

------

### ğŸ§¬ 5. ì„œë¹„ìŠ¤ ë° ì»¨íŠ¸ë¡¤ëŸ¬ ì—°ë™

```
@Service
public class UserService {

    private final UserMapper userMapper;

    public UserService(UserMapper userMapper) {
        this.userMapper = userMapper;
    }

    public List<User> getUsers() {
        return userMapper.findAll();
    }
}
```

```
@RestController
@RequestMapping("/api/users")
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    @GetMapping
    public List<User> getAll() {
        return userService.getUsers();
    }
}
```

------

### ğŸ” 6. íŠ¸ëœì­ì…˜ ì²˜ë¦¬

Spring Bootì™€ ì—°ë™í•˜ë©´ `@Transactional` ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥.

```
@Service
public class OrderService {

    private final OrderMapper orderMapper;
    private final InventoryMapper inventoryMapper;

    @Transactional
    public void placeOrder(Order order) {
        orderMapper.insert(order);
        inventoryMapper.decrease(order.getItemId(), order.getQuantity());
    }
}
```

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©        | ì„¤ëª…                                                     |
| ----------- | -------------------------------------------------------- |
| í•µì‹¬ ê°œë…   | SQL ë§¤í•‘ ì¤‘ì‹¬ì˜ ë°˜ìë™ ORM                               |
| ì„¤ì • ìš”ì†Œ   | `Mapper Interface + XML Mapper`                          |
| ì¥ì         | ë³µì¡í•œ SQL ìœ ë¦¬, ëª…ì‹œì  ì¿¼ë¦¬ ì œì–´                        |
| Spring í†µí•© | `@Mapper`, `@MapperScan`, `@Transactional`               |
| ë¹„êµ        | SQLì´ ëª…í™•í•´ì•¼ í•˜ë©´ â†’ MyBatis / ìë™ ë§¤í•‘ì´ ì¢‹ë‹¤ë©´ â†’ JPA |

## ORM ê°œë…

### ğŸ§© 1. ORMì´ë€?

> **ê°ì²´(Object)**ì™€ **ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤(Relational DB)** ì‚¬ì´ì˜
>  **íŒ¨ëŸ¬ë‹¤ì„ ì°¨ì´ë¥¼ ìë™ìœ¼ë¡œ ë§¤í•‘í•´ì£¼ëŠ” ê¸°ìˆ **

ì¦‰,

- Javaì—ì„œëŠ” **ê°ì²´**,
- DBì—ì„œëŠ” **í…Œì´ë¸”**ë¡œ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ì´ êµ¬ì¡° ì°¨ì´ë¥¼
   ORMì´ **ìë™ìœ¼ë¡œ ì¤‘ê°„ì—ì„œ ë³€í™˜**í•´ì£¼ëŠ” ê²ƒì´ë‹¤.

------

### ğŸ“Œ 2. í•µì‹¬ ë™ì‘ ì›ë¦¬

| ìë°” ì„¸ê³„                        | DB ì„¸ê³„                                |
| -------------------------------- | -------------------------------------- |
| `User` í´ë˜ìŠ¤                    | `users` í…Œì´ë¸”                         |
| `user.getName()`                 | `SELECT name FROM users WHERE id=?`    |
| `new User(...)`                  | `INSERT INTO users (...) VALUES (...)` |
| `user.setName("kim")` â†’ `save()` | `UPDATE users SET name="kim"`          |

â¡ï¸ ORMì€ ìœ„ ê³¼ì •ì„ **SQL ì—†ì´ ê°ì²´ ë‹¨ìœ„ë¡œ ì²˜ë¦¬**í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

------

### ğŸ§  3. ì™œ ORMì„ ì“°ëŠ”ê°€?

| ëª©ì           | ì„¤ëª…                                      |
| ------------- | ----------------------------------------- |
| â›³ ìƒì‚°ì„±      | SQL ì—†ì´ ê°ì²´ë§Œìœ¼ë¡œ CRUD ê°€ëŠ¥             |
| ğŸ“¦ ìœ ì§€ë³´ìˆ˜ì„±  | DB í…Œì´ë¸” êµ¬ì¡°ì™€ ê°ì²´ ëª¨ë¸ ê°„ ë™ê¸°í™” ìš©ì´ |
| ğŸ§ª í…ŒìŠ¤íŠ¸ì„±    | DB ì—†ì´ ë©”ëª¨ë¦¬ ê¸°ë°˜ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ (H2 ë“±)   |
| ğŸ” ì´ì‹ì„±      | DBMS ë³€ê²½ ì‹œ ì˜í–¥ ìµœì†Œí™”                  |
| ğŸ§¼ ì½”ë“œ ê¹”ë”í•¨ | DAO/SQL ì½”ë“œê°€ ì¤„ì–´ë“¬                     |

------

### âš™ï¸ 4. ëŒ€í‘œì ì¸ ORM í”„ë ˆì„ì›Œí¬

| ì–¸ì–´       | ORM ê¸°ìˆ                               |
| ---------- | ------------------------------------- |
| Java       | Hibernate (JPA), MyBatis (ë°˜ìë™ ORM) |
| Python     | SQLAlchemy, Django ORM                |
| C#         | Entity Framework                      |
| Ruby       | ActiveRecord                          |
| JavaScript | Sequelize, Prisma                     |

> ğŸ“Œ Javaì—ì„œ "ORM"ì´ë¼ í•˜ë©´ ë³´í†µ `JPA(Hibernate)`ë¥¼ ì˜ë¯¸í•œë‹¤.

------

### ğŸ§ª 5. ê°„ë‹¨í•œ JPA ì˜ˆì‹œ

```
@Entity
public class User {
    @Id @GeneratedValue
    private Long id;

    private String name;
    private String email;
}
```

```
User user = new User("Alice", "alice@example.com");
entityManager.persist(user);  // â†’ INSERT INTO users ...
```

```
User u = entityManager.find(User.class, 1L);  // â†’ SELECT * FROM users WHERE id=1
```

```
u.setName("Bob");  
// ë³€ê²½ ê°ì§€ (dirty checking) â†’ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ UPDATE ìë™ ì‹¤í–‰
```

------

### ğŸ” 6. ORM vs SQL ì§ì ‘ ì‘ì„± (JDBC/MyBatis)

| í•­ëª©       | ORM (JPA)                                 | SQL ì§ì ‘ ì‘ì„± (JDBC/MyBatis) |
| ---------- | ----------------------------------------- | ---------------------------- |
| SQL ì‘ì„±ëŸ‰ | ê±°ì˜ ì—†ìŒ                                 | ëª…ì‹œì ìœ¼ë¡œ SQL ì‘ì„±          |
| ì†ë„ ì œì–´  | ìë™ ìºì‹œ, Lazy Loading                   | ì§ì ‘ íŠœë‹ í•„ìš”               |
| ë³µì¡ ì¿¼ë¦¬  | ë¶ˆí¸í•¨ (JPQL)                             | ë§¤ìš° ììœ ë¡œì›€                |
| ìœ ì§€ë³´ìˆ˜   | Entityì™€ DB ë™ê¸°í™” ì‰¬ì›€                   | SQL ë³€ê²½ ì¶”ì  ì–´ë ¤ì›€         |
| ëŸ¬ë‹ì»¤ë¸Œ   | ë†’ìŒ (Hibernate ë¬¸ë²•, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë“±) | ë‚®ìŒ (SQL ì¹œìˆ™ìì— ìœ ë¦¬)     |

------

### âš ï¸ 7. ORM ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­

| í•­ëª©                      | ì„¤ëª…                                                         |
| ------------------------- | ------------------------------------------------------------ |
| ğŸ” N+1 ë¬¸ì œ                | Lazy Loading ë‚¨ë°œ ì‹œ ì¿¼ë¦¬ í­ë°œ ìœ„í—˜                          |
| âŒ ê³¼ë„í•œ ì¶”ìƒí™”           | SQL íŠœë‹ ì–´ë ¤ì›€ â†’ ì„±ëŠ¥ ë¯¼ê°í•œ ë¶€ë¶„ì€ SQLë¡œ ë”°ë¡œ ì‘ì„± í•„ìš”    |
| ğŸ” ì¿¼ë¦¬ ì¶”ì  ì–´ë ¤ì›€        | ì–´ë–¤ SQLì´ ì‹¤í–‰ë˜ëŠ”ì§€ ë¡œê·¸ í™•ì¸ í•„ìš” (`show_sql`, `p6spy` ë“±) |
| ğŸ§  ê°ì²´ ìƒëª…ì£¼ê¸° ê´€ë¦¬ í•„ìˆ˜ | `persist`, `detach`, `merge`, `remove` ë“± JPA ìƒíƒœ ì´í•´ í•„ìš” |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©      | ì„¤ëª…                                   |
| --------- | -------------------------------------- |
| ì •ì˜      | ê°ì²´ â†” ê´€ê³„í˜• ë°ì´í„° ê°„ ìë™ ë§¤í•‘ ê¸°ìˆ  |
| ì—­í•       | SQL ì—†ì´ë„ ê°ì²´ë¡œ DB ì—°ë™ ê°€ëŠ¥         |
| ì£¼ìš” ê¸°ìˆ  | Hibernate (JPA), MyBatis               |
| ì¥ì       | ìƒì‚°ì„±, ìœ ì§€ë³´ìˆ˜ì„±, ì½”ë“œ ì¼ê´€ì„±        |
| ë‹¨ì       | ì„±ëŠ¥ íŠœë‹ ë‚œì´ë„, ëŸ¬ë‹ì»¤ë¸Œ ìˆìŒ        |

## JPAì™€ Hibernate

### ğŸ§© 1. JPAë€?

> **Java Persistence API**
>  Java ì§„ì˜ì˜ **ê³µì‹ ORM í‘œì¤€ ëª…ì„¸**
>  â†’ ìë°” ê°ì²´ë¥¼ ê´€ê³„í˜• DBì— ë§¤í•‘í•˜ê¸° ìœ„í•œ **ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ API**

- **ìë°” í‘œì¤€** (javax.persistence.*)
- SQL ì‘ì„± ì—†ì´ ê°ì²´ë¥¼ DBì™€ ë§¤í•‘
- **ì¸í„°í˜ì´ìŠ¤ ê·œê²©ë§Œ ì •ì˜**, ì‹¤ì œ ë™ì‘ì€ êµ¬í˜„ì²´ê°€ ë‹´ë‹¹

------

### ğŸ§± 2. Hibernateë€?

> **JPAì˜ ëŒ€í‘œì ì¸ êµ¬í˜„ì²´**
>  â†’ JPAê°€ ì •ì˜í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ **ì‹¤ì œë¡œ ë™ì‘í•˜ë„ë¡ ë§Œë“  ë¼ì´ë¸ŒëŸ¬ë¦¬**

- JPA ì´ì „ë¶€í„° ì¡´ì¬í•œ **ë…ë¦½ ORM í”„ë ˆì„ì›Œí¬**
- JPA ê¸°ëŠ¥ + ê³ ê¸‰ ê¸°ëŠ¥ í¬í•¨ (ìºì‹œ, ë°°ì¹˜, í†µê³„ ë“±)

------

### ğŸ¯ 3. JPA vs Hibernate ë¹„êµ

| í•­ëª©        | JPA                 | Hibernate                                |
| ----------- | ------------------- | ---------------------------------------- |
| ì •ì²´ì„±      | **í‘œì¤€ ì¸í„°í˜ì´ìŠ¤** | **JPA êµ¬í˜„ì²´ (ë¼ì´ë¸ŒëŸ¬ë¦¬)**              |
| ìœ„ì¹˜        | javax.persistence.* | org.hibernate.*                          |
| ê°œë°œ ë°©ì‹   | ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜     | êµ¬í˜„ì²´ ê¸°ë°˜                              |
| ëª©ì         | ì—¬ëŸ¬ êµ¬í˜„ì²´ ì§€ì›    | ì„±ëŠ¥ê³¼ ê¸°ëŠ¥ ê°•í™”                         |
| ì‚¬ìš© ë°©ë²•   | `EntityManager`     | `Session`, `JpaTransactionManager`       |
| ê¸°ëŠ¥ í™•ì¥ì„± | ì œí•œì               | í’ë¶€í•¨ (2ì°¨ ìºì‹œ, Envers, Statistics ë“±) |

> ğŸ“Œ ì •ë¦¬í•˜ë©´:
>
> - **JPAëŠ” "ê·œì¹™ì„œ"**,
> - **HibernateëŠ” "ê·œì¹™ì„ ë”°ë¼ ë§Œë“  ì‹¤ì œ í”„ë¡œê·¸ë¨"**ì´ë‹¤.

------

### ğŸ§­ 4. ì•„í‚¤í…ì²˜ íë¦„

```
[ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ]
        â†“ (JPA API)
[ EntityManager, @Entity, JPQL ]
        â†“
[ Hibernate (JPA êµ¬í˜„ì²´) ]
        â†“
[ JDBC ]
        â†“
[ MySQL, Oracle, PostgreSQL ë“± DB ]
```

------

### ğŸ“¦ 5. ì‹¤ì „ ì˜ˆì œ

#### ğŸ“„ JPA ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜

```
@Entity
public class User {
    @Id @GeneratedValue
    private Long id;
    private String name;
}
```

```
User user = new User("Alice");
entityManager.persist(user); // JPA í‘œì¤€ API
```

------

#### ğŸ”§ Hibernate ê³ ê¸‰ ê¸°ëŠ¥ ì‚¬ìš© ì˜ˆ

```
Session session = entityManager.unwrap(Session.class);
session.setDefaultReadOnly(true); // Hibernate ì „ìš© ê¸°ëŠ¥
```

------

### ğŸ”¥ 6. Hibernateì˜ ëŒ€í‘œ í™•ì¥ ê¸°ëŠ¥ë“¤

| ê¸°ëŠ¥                | ì„¤ëª…                                         |
| ------------------- | -------------------------------------------- |
| 2ì°¨ ìºì‹œ            | EhCache, Infinispan ë“± í†µí•© ì§€ì›             |
| Envers              | ì—”í‹°í‹° ìˆ˜ì • ì´ë ¥ ìë™ ê¸°ë¡                   |
| Hibernate Validator | Bean Validation ì—°ë™                         |
| ê³ ê¸‰ Fetch ì „ëµ     | Join, FetchProfile                           |
| Batch insert/update | ì„±ëŠ¥ í–¥ìƒ ê°€ëŠ¥ (`hibernate.jdbc.batch_size`) |

------

### âš ï¸ 7. ì£¼ì˜ì‚¬í•­ ë° ì‹¤ì „ íŒ

| ì£¼ì˜ì‚¬í•­                             | ì„¤ëª…                                                      |
| ------------------------------------ | --------------------------------------------------------- |
| ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´í•´ í•„ìˆ˜            | `persist`, `merge`, `detach`, `flush` ì •í™•íˆ êµ¬ë¶„ í•„ìš”    |
| N+1 ë¬¸ì œ                             | Lazy Loading ë‚¨ë°œ â†’ ë°˜ë“œì‹œ Fetch Join, EntityGraphë¡œ í•´ê²° |
| Flush íƒ€ì´ë°                         | ì¿¼ë¦¬ ì‹¤í–‰ì€ ì¦‰ì‹œ X â†’ commit ì „ ìë™ Flush                 |
| DDL ìë™ ìƒì„±                        | ì‹¤ë¬´ì—ì„œëŠ” `ddl-auto: none` ê¶Œì¥ (ìë™ í…Œì´ë¸” ìƒì„± ìœ„í—˜)  |
| JPA í‘œì¤€ ì¤€ìˆ˜ vs Hibernate ë…ì í™•ì¥ | íŠ¹ì • ê¸°ëŠ¥ ì‚¬ìš© ì‹œ ì´ì‹ì„± ì†í•´ ìˆìŒ                        |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½í‘œ

| í•­ëª©        | JPA                   | Hibernate                |
| ----------- | --------------------- | ------------------------ |
| ì—­í•         | ORM í‘œì¤€ ëª…ì„¸ (API)   | êµ¬í˜„ì²´ (ë¼ì´ë¸ŒëŸ¬ë¦¬)      |
| ê´€ê³„        | ì¸í„°í˜ì´ìŠ¤            | êµ¬í˜„ í´ë˜ìŠ¤              |
| ì‚¬ìš© ë°©ë²•   | EntityManager         | Session                  |
| ì˜ˆì™¸ íƒ€ì…   | `javax.persistence.*` | `org.hibernate.*`        |
| í‘œì¤€ì„±      | âœ…                     | âŒ (ì „ìš© ê¸°ëŠ¥ ë§ìŒ)       |
| í•™ìŠµ ë‚œì´ë„ | ë³´í†µ                  | ì•½ê°„ ë” ë†’ìŒ (ê¸°ëŠ¥ ë‹¤ì–‘) |

------

### ğŸ§± ì‹¤ë¬´ì—ì„œëŠ”?

âœ” **Spring Data JPA** = JPA + Hibernate + Spring ì¶”ìƒí™”
 â†’ ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì íŠ¸ëŠ”
 **JPAë¥¼ ì½”ë“œë¡œ ì‚¬ìš©í•˜ê³ , Hibernateë¥¼ ë‚´ë¶€ êµ¬í˜„ì²´ë¡œ ì‚¬ìš©í•¨**

```
spring:
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
```

## Entity ë§¤í•‘

- ## `@Entity`, `@Table`, `@Id`, `@GeneratedValue`, `@Column`

  ### 1ï¸âƒ£ `@Entity`

  #### ğŸ”¸ ì •ì˜

  > JPAì—ì„œ ì´ í´ë˜ìŠ¤ê°€ **ì˜ì†ì„± ê´€ë¦¬ ëŒ€ìƒ(ì—”í‹°í‹°)**ì„ì„ ë‚˜íƒ€ë‚¸ë‹¤.

  #### ğŸ”¸ ì—­í• 

  - ì´ í´ë˜ìŠ¤ëŠ” **DB í…Œì´ë¸”ê³¼ ë§¤í•‘**ë  ìë°” ê°ì²´ì„ì„ ì„ ì–¸
  - ë°˜ë“œì‹œ **ê¸°ë³¸ ìƒì„±ì(public ë˜ëŠ” protected)**ê°€ ìˆì–´ì•¼ í•¨

  #### ğŸ”¸ ì¡°ê±´

  - ê¸°ë³¸ ìƒì„±ì í•„ìš”
  - final í´ë˜ìŠ¤ âŒ, ì¸í„°í˜ì´ìŠ¤ âŒ
  - í•„ë“œëŠ” í”„ë¡ì‹œë¥¼ ìœ„í•´ private ë˜ëŠ” protected ê¶Œì¥

  #### âœ” ì˜ˆì‹œ

  ```
  @Entity
  public class User {
      ...
  }
  ```

  ------

  ### 2ï¸âƒ£ `@Table`

  #### ğŸ”¸ ì •ì˜

  > ì´ ì—”í‹°í‹°ê°€ **ë§¤í•‘ë  í…Œì´ë¸” ì´ë¦„** ë° ê¸°íƒ€ ì„¤ì •ì„ ì •ì˜í•¨.

  #### ğŸ”¸ ê¸°ë³¸ê°’

  - í´ë˜ìŠ¤ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ í…Œì´ë¸” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš© (ex: `User` â†’ `user`)

  #### ğŸ”¸ ì†ì„±

  | ì†ì„±                | ì„¤ëª…                    |
  | ------------------- | ----------------------- |
  | `name`              | ë§¤í•‘í•  í…Œì´ë¸” ì´ë¦„ ì§€ì • |
  | `schema`            | ìŠ¤í‚¤ë§ˆ ì´ë¦„             |
  | `uniqueConstraints` | ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ ì§€ì •    |

  #### âœ” ì˜ˆì‹œ

  ```
  @Entity
  @Table(name = "users")
  public class User { ... }
  ```

  ------

  ### 3ï¸âƒ£ `@Id`

  #### ğŸ”¸ ì •ì˜

  > ì´ í•„ë“œë¥¼ **ê¸°ë³¸ í‚¤(Primary Key)**ë¡œ ì§€ì •í•¨.

  #### ğŸ”¸ íŠ¹ì§•

  - í•˜ë‚˜ ì´ìƒì˜ í•„ìˆ˜ ì‹ë³„ì í•„ë“œì— ì§€ì •
  - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì´ IDë¡œ ì—”í‹°í‹°ë¥¼ êµ¬ë¶„í•¨

  #### âœ” ì˜ˆì‹œ

  ```
  @Id
  private Long id;
  ```

  ------

  ### 4ï¸âƒ£ `@GeneratedValue`

  #### ğŸ”¸ ì •ì˜

  > `@Id` í•„ë“œì˜ ê°’ì„ **ìë™ ìƒì„±**í•˜ëŠ” ì „ëµì„ ì§€ì •

  #### ğŸ”¸ ì†ì„± (ì „ëµ)

  | ì „ëµ            | ì„¤ëª…                                     |
  | --------------- | ---------------------------------------- |
  | `AUTO` (ê¸°ë³¸ê°’) | DB ë°©ì–¸ì— ë”°ë¼ ìë™ ì„ íƒ                 |
  | `IDENTITY`      | DBì˜ auto_increment ì‚¬ìš© (MySQL ë“±)      |
  | `SEQUENCE`      | ì‹œí€€ìŠ¤ ê°ì²´ ì‚¬ìš© (Oracle, PostgreSQL ë“±) |
  | `TABLE`         | í‚¤ ìƒì„±ìš© í…Œì´ë¸” ì‚¬ìš© (ë¹„ì¶”ì²œ)           |

  #### âœ” ì˜ˆì‹œ

  ```
  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;
  ```

  ------

  ### 5ï¸âƒ£ `@Column`

  #### ğŸ”¸ ì •ì˜

  > ì—”í‹°í‹° í•„ë“œë¥¼ **DB ì»¬ëŸ¼ê³¼ ë§¤í•‘**í•˜ëŠ” ì„¤ì •

  #### ğŸ”¸ ìƒëµ ê°€ëŠ¥

  â†’ ìƒëµ ì‹œ í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì»¬ëŸ¼ ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©

  #### ğŸ”¸ ì£¼ìš” ì†ì„±

  | ì†ì„±               | ì„¤ëª…                         |
  | ------------------ | ---------------------------- |
  | `name`             | DB ì»¬ëŸ¼ ì´ë¦„ ì§€ì •            |
  | `nullable`         | NULL í—ˆìš© ì—¬ë¶€ (`true` ê¸°ë³¸) |
  | `unique`           | ìœ ì¼ê°’ ì œì•½ ì¡°ê±´             |
  | `length`           | ë¬¸ìì—´ ê¸¸ì´ (ê¸°ë³¸ 255)       |
  | `columnDefinition` | DBì— ìƒì„±ë  ì»¬ëŸ¼ì˜ DDL ì •ì˜  |

  #### âœ” ì˜ˆì‹œ

  ```
  @Column(name = "user_name", nullable = false, length = 100)
  private String name;
  ```

  ------

  ### âœ… ì¢…í•© ì˜ˆì œ

  ```
  @Entity
  @Table(name = "users")
  public class User {
  
      @Id
      @GeneratedValue(strategy = GenerationType.IDENTITY)
      private Long id;
  
      @Column(name = "user_name", nullable = false, length = 100)
      private String name;
  
      @Column(unique = true, nullable = false)
      private String email;
  
      protected User() {} // ê¸°ë³¸ ìƒì„±ì (JPA í•„ìˆ˜)
  
      public User(String name, String email) {
          this.name = name;
          this.email = email;
      }
  }
  ```

  ------

  ### âš ï¸ ì‹¤ì „ íŒ

  | í•­ëª©           | ê¶Œì¥ ì‚¬í•­                                                    |
  | -------------- | ------------------------------------------------------------ |
  | ê¸°ë³¸ ìƒì„±ì    | ë°˜ë“œì‹œ `protected` ì´ìƒìœ¼ë¡œ ì„ ì–¸                             |
  | ID ì „ëµ        | MySQLì€ `IDENTITY`, Oracleì€ `SEQUENCE` ê¶Œì¥                 |
  | `@Column` ìƒëµ | ê¸°ë³¸ê°’ìœ¼ë¡œ ì˜ ì‘ë™í•˜ë˜, ëª…ì‹œì  ì„¤ì •ì´ ê°€ë…ì„± ë†’ìŒ            |
  | ì´ë¦„ ê·œì¹™      | ì»¬ëŸ¼/í…Œì´ë¸” ì´ë¦„ì€ snake_case, í•„ë“œëŠ” camelCase ë§ì´ ì‚¬ìš©    |
  | DDL ìë™ ìƒì„±  | ì‹¤ë¬´ì—ì„œëŠ” `spring.jpa.hibernate.ddl-auto=none` ì„¤ì •í•˜ê³  SQL ìˆ˜ë™ ì‘ì„± ê¶Œì¥ |

  ------

  ### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

  | ì–´ë…¸í…Œì´ì…˜        | ì—­í•                                      |
  | ----------------- | ---------------------------------------- |
  | `@Entity`         | ì´ í´ë˜ìŠ¤ê°€ JPA ì—”í‹°í‹°ì„ì„ ì„ ì–¸          |
  | `@Table`          | ë§¤í•‘ë˜ëŠ” í…Œì´ë¸” ì´ë¦„ ì§€ì •                |
  | `@Id`             | ê¸°ë³¸ í‚¤ í•„ë“œ ì§€ì •                        |
  | `@GeneratedValue` | ê¸°ë³¸ í‚¤ ìë™ ìƒì„± ì „ëµ                   |
  | `@Column`         | ì»¬ëŸ¼ ë§¤í•‘ ìƒì„¸ ì„¤ì • (ì´ë¦„, ì œì•½ ì¡°ê±´ ë“±) |

## Spring Data JPA

- ## `JpaRepository`, `CrudRepository`

  ### ğŸ§© 1. ê³µí†µ ê°œë…: Spring Data Repository

  > Spring Data JPAëŠ” **Repository ì¸í„°í˜ì´ìŠ¤ ê³„ì¸µ êµ¬ì¡°**ë¥¼ í†µí•´
  >  **JPA ì—”í‹°í‹°ì— ëŒ€í•œ CRUD, í˜ì´ì§•, ì •ë ¬, ì¿¼ë¦¬ ë©”ì„œë“œ ê¸°ëŠ¥ì„ ìë™ìœ¼ë¡œ ì œê³µ**í•œë‹¤.

  ```
  Repository (ìµœìƒìœ„)
  â”œâ”€â”€ CrudRepository<T, ID>
  â”‚   â””â”€â”€ PagingAndSortingRepository<T, ID>
  â”‚       â””â”€â”€ JpaRepository<T, ID>
  ```

  ------

  ### ğŸ“¦ 2. `CrudRepository<T, ID>`

  #### âœ” ì •ì˜

  > ê°€ì¥ ê¸°ë³¸ì ì¸ CRUD ê¸°ëŠ¥ë§Œ ì œê³µí•˜ëŠ” ì¸í„°í˜ì´ìŠ¤

  ```
  public interface CrudRepository<T, ID> extends Repository<T, ID> {
      <S extends T> S save(S entity);
      Optional<T> findById(ID id);
      Iterable<T> findAll();
      void delete(T entity);
      long count();
      boolean existsById(ID id);
  }
  ```

  #### âœ” íŠ¹ì§•

  - **ê¸°ë³¸ CRUDë§Œ í•„ìš”í•  ë•Œ ì¶©ë¶„**
  - ì •ë ¬, í˜ì´ì§• ê¸°ëŠ¥ì€ ì—†ìŒ

  ------

  ### ğŸ“¦ 3. `JpaRepository<T, ID>`

  #### âœ” ì •ì˜

  > `CrudRepository` + `PagingAndSortingRepository` + JPA íŠ¹í™” ê¸°ëŠ¥ì„ ëª¨ë‘ í¬í•¨í•˜ëŠ” **ê°€ì¥ ì™„ì„±ëœ ë¦¬í¬ì§€í† ë¦¬**

  ```
  public interface JpaRepository<T, ID> extends PagingAndSortingRepository<T, ID> {
      List<T> findAll();
      List<T> findAllById(Iterable<ID> ids);
      void flush();
      <S extends T> S saveAndFlush(S entity);
      void deleteInBatch(Iterable<T> entities);
  }
  ```

  #### âœ” íŠ¹ì§•

  - **í˜ì´ì§•, ì •ë ¬ ì§€ì› (`Pageable`)**
  - **JPA ë‚´ë¶€ ìºì‹œ, ë°°ì¹˜ ê¸°ëŠ¥, flush ì œì–´ ë“± ê³ ê¸‰ ê¸°ëŠ¥ ì œê³µ**
  - ì‹¤ë¬´ì—ì„œëŠ” ë³´í†µ ì´ê±¸ **ê¸°ë³¸ Repositoryë¡œ ì‚¬ìš©**

  ------

  ### ğŸ§ª 4. ì‚¬ìš© ì˜ˆì‹œ

  #### ğŸ“„ ì—”í‹°í‹°

  ```
  @Entity
  public class User {
      @Id @GeneratedValue
      private Long id;
  
      private String name;
      private String email;
  }
  ```

  ------

  #### âœ” JpaRepository êµ¬í˜„

  ```
  public interface UserRepository extends JpaRepository<User, Long> {
      Optional<User> findByEmail(String email);
  }
  ```

  ```
  List<User> users = userRepository.findAll();                  // ì „ì²´ ì¡°íšŒ
  Page<User> page = userRepository.findAll(PageRequest.of(0, 10));  // í˜ì´ì§• ì¡°íšŒ
  ```

  ------

  #### âœ” CrudRepository êµ¬í˜„ (ë¹„ì¶”ì²œì´ì§€ë§Œ ê°€ëŠ¥)

  ```
  public interface UserRepository extends CrudRepository<User, Long> {
      Optional<User> findByEmail(String email);
  }
  ```

  ```
  Iterable<User> users = userRepository.findAll();
  ```

  ------

  ### ğŸ“Š 5. ê¸°ëŠ¥ ì°¨ì´ ë¹„êµí‘œ

  | ê¸°ëŠ¥                | CrudRepository | JpaRepository                   |
  | ------------------- | -------------- | ------------------------------- |
  | ê¸°ë³¸ CRUD           | âœ…              | âœ…                               |
  | í˜ì´ì§•/ì •ë ¬         | âŒ              | âœ… (`Pageable`, `Sort`)          |
  | ë°°ì¹˜ ì‚­ì œ           | âŒ              | âœ… (`deleteAllInBatch()`)        |
  | flush ì œì–´          | âŒ              | âœ… (`saveAndFlush()`, `flush()`) |
  | findAll() ë¦¬í„´ íƒ€ì… | `Iterable<T>`  | `List<T>`                       |
  | ì‹¤ë¬´ ì í•©ë„         | ë‚®ìŒ           | ë†’ìŒ (ì¶”ì²œ)                     |

  ------

  ### ğŸ§  6. ì–¸ì œ ë­˜ ì¨ì•¼ í• ê¹Œ?

  | ìƒí™©                                      | ì„ íƒ                                      |
  | ----------------------------------------- | ----------------------------------------- |
  | ì •ë§ ë‹¨ìˆœí•œ CRUDë§Œ í•„ìš”í•  ë•Œ              | `CrudRepository` ê°€ëŠ¥ (í…ŒìŠ¤íŠ¸/í•™ìŠµìš©)     |
  | í˜ì´ì§•, ì •ë ¬, ê³ ê¸‰ ì¿¼ë¦¬ ê¸°ëŠ¥ í•„ìš”         | âœ… `JpaRepository` ì¶”ì²œ                    |
  | Spring Data JPA ê³µì‹/ì»¤ë®¤ë‹ˆí‹° ì˜ˆì‹œ ëŒ€ë¶€ë¶„ | `JpaRepository` ê¸°ì¤€                      |
  | Querydsl ë“± í†µí•© ì‹œ í™•ì¥ì„± ê³ ë ¤           | `JpaRepository` ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„í•˜ëŠ” ê²Œ ìœ ë¦¬ |

  ------

  ### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

  | í•­ëª©      | CrudRepository    | JpaRepository                  |
  | --------- | ----------------- | ------------------------------ |
  | ì •ì˜      | ê¸°ë³¸ CRUD ì „ìš©    | CRUD + í˜ì´ì§•/ì •ë ¬ + ê³ ê¸‰ ê¸°ëŠ¥ |
  | ìƒì† ê³„ì¸µ | Repository â†’ Crud | â†’ Paging â†’ Jpa                 |
  | ë°˜í™˜ íƒ€ì… | Iterable ì¤‘ì‹¬     | List, Page ì¤‘ì‹¬                |
  | ì‹¤ë¬´ ì‚¬ìš© | ê±°ì˜ ì•ˆ ì”€        | âœ… ëŒ€ë¶€ë¶„ ì´ê±¸ ì”€               |
  | ì¶”ì²œ ì—¬ë¶€ | âŒ ì œí•œì           | âœ… í‘œì¤€ì²˜ëŸ¼ ì‚¬ìš©ë¨              |

- ## `@Query`, Query Method

  ### ğŸ§© 1. Query Methodë€?

  > **ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œ ìë™ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±**í•˜ëŠ” Spring Data JPAì˜ ê¸°ëŠ¥

  ```
  Optional<User> findByEmail(String email);
  List<User> findByAgeGreaterThanAndStatus(String age, Status status);
  ```

  â¡ï¸ ì´ë¦„ì„ ë¶„ì„í•´ Springì´ ìë™ìœ¼ë¡œ JPQLì„ ë§Œë“¤ì–´ ì‹¤í–‰

  ------

  #### âœ… ë¬¸ë²• êµ¬ì„±

  ```
  findBy + í•„ë“œëª… + ì¡°ê±´ í‚¤ì›Œë“œ
  ```

  | í‚¤ì›Œë“œ                             | ì˜ë¯¸           |
  | ---------------------------------- | -------------- |
  | `And`, `Or`                        | ë…¼ë¦¬ ì—°ì‚°      |
  | `Between`                          | ë²”ìœ„           |
  | `LessThan`, `GreaterThan`          | ë¹„êµ           |
  | `Like`, `Containing`, `StartsWith` | ë¬¸ìì—´ ê²€ìƒ‰    |
  | `OrderBy`                          | ì •ë ¬ ì¡°ê±´      |
  | `Top3`, `First`                    | ê²°ê³¼ ê°œìˆ˜ ì œí•œ |

  ------

  #### ğŸ“˜ ì˜ˆì œ

  ```
  List<User> findByAgeGreaterThanAndStatusOrderByCreatedDateDesc(int age, Status status);
  ```

  â†’ JPQL:

  ```
  SELECT u FROM User u
  WHERE u.age > :age AND u.status = :status
  ORDER BY u.createdDate DESC
  ```

  ------

  ### ğŸ§© 2. `@Query` ì–´ë…¸í…Œì´ì…˜

  > ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ í‘œí˜„í•˜ê¸° ì–´ë ¤ìš´ ì¿¼ë¦¬ë¥¼ **ì§ì ‘ JPQL ë˜ëŠ” Native SQLë¡œ ì‘ì„±**í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜

  ------

  #### ğŸ“˜ ê¸°ë³¸ JPQL ì‚¬ìš©

  ```
  @Query("SELECT u FROM User u WHERE u.email = :email")
  Optional<User> findByEmail(@Param("email") String email);
  ```

  #### ğŸ“˜ Native SQL ì‚¬ìš©

  ```
  @Query(value = "SELECT * FROM users WHERE email = :email", nativeQuery = true)
  Optional<User> findNativeByEmail(@Param("email") String email);
  ```

  ------

  #### ğŸ“˜ ì¡°ê±´/ì»¬ëŸ¼ ì œí•œ

  ```
  @Query("SELECT u.name FROM User u WHERE u.age > :age")
  List<String> findNamesByAge(@Param("age") int age);
  ```

  ------

  #### ğŸ“˜ DML ì¿¼ë¦¬ (insert/update/delete)

  ```
  @Modifying
  @Query("UPDATE User u SET u.status = :status WHERE u.id = :id")
  void updateUserStatus(@Param("id") Long id, @Param("status") Status status);
  ```

  > ğŸ“Œ DMLì—ëŠ” ë°˜ë“œì‹œ `@Modifying` ë¶™ì—¬ì•¼ í•¨

  ------

  ### ğŸ” 3. Query Method vs @Query ë¹„êµí‘œ

  | í•­ëª©             | Query Method                 | `@Query`                           |
  | ---------------- | ---------------------------- | ---------------------------------- |
  | ì •ì˜ ë°©ì‹        | ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì •ì˜         | JPQL/SQL ì§ì ‘ ì‘ì„±                 |
  | ë‹¨ìˆœ ì¡°ê±´        | âœ… ë§¤ìš° ê°„í¸                  | ê°€ëŠ¥í•˜ì§€ë§Œ ë¹„íš¨ìœ¨ì                 |
  | ë³µì¡í•œ ì¡°ì¸/ì¡°ê±´ | âŒ ë¶ˆê°€ ë˜ëŠ” ë§¤ìš° ê¸¸ì–´ì§      | âœ… ììœ ë¡­ê²Œ ì‘ì„± ê°€ëŠ¥               |
  | ê²°ê³¼ ì»¬ëŸ¼ ì œí•œ   | âŒ ë¶ˆí¸í•¨                     | âœ… SELECT name ë“± ììœ               |
  | native SQL       | âŒ                            | âœ… `nativeQuery = true`             |
  | ìœ ì§€ë³´ìˆ˜ì„±       | ì´ë¦„ ê¸¸ì–´ì§€ë©´ ì–´ë ¤ì›€         | SQL ê°€ë…ì„± ìœ ì§€ ê°€ëŠ¥               |
  | ëŸ°íƒ€ì„ ì˜¤ë¥˜      | ë©”ì„œë“œëª… ì˜¤ë¥˜ ì‹œ ì»´íŒŒì¼ ì‹¤íŒ¨ | ì¿¼ë¦¬ ë¬¸ë²• ì˜¤ë¥˜ëŠ” **ëŸ°íƒ€ì„**ì— ë°œìƒ |

  ------

  ### ğŸ’¡ ì‹¤ë¬´ ì„¤ê³„ íŒ

  | ìƒí™©                             | ë°©ë²•                                                    |
  | -------------------------------- | ------------------------------------------------------- |
  | ë‹¨ìˆœ ì¡°íšŒ (id, email, status ë“±) | âœ… Query Method                                          |
  | ë³µì¡í•œ ì¡°ê±´, ì¡°ì¸, ë™ì  ì¿¼ë¦¬     | âœ… `@Query` or QueryDSL                                  |
  | ì •ë ¬, í˜ì´ì§•                     | `findByStatusOrderByCreatedDateDesc(Pageable pageable)` |
  | ë„¤ì´í‹°ë¸Œ ì„±ëŠ¥ ìµœì í™”             | `@Query(nativeQuery = true)` ë˜ëŠ” ë³„ë„ Repository       |

  ------

  ### ğŸ“¦ ì‹¤ì „ ì˜ˆì‹œ ì¢…í•©

  ```
  public interface UserRepository extends JpaRepository<User, Long> {
  
      // Query Method
      Optional<User> findByEmail(String email);
  
      List<User> findByStatusAndAgeGreaterThan(Status status, int age);
  
      // JPQL ì§ì ‘ ì‘ì„±
      @Query("SELECT u FROM User u WHERE u.status = :status ORDER BY u.createdDate DESC")
      List<User> findRecentUsers(@Param("status") Status status);
  
      // Native SQL
      @Query(value = "SELECT * FROM users WHERE name LIKE %:name%", nativeQuery = true)
      List<User> searchByName(@Param("name") String name);
  
      // ì—…ë°ì´íŠ¸ ì¿¼ë¦¬
      @Modifying
      @Query("UPDATE User u SET u.status = 'DELETED' WHERE u.lastLogin < :cutoff")
      void softDeleteInactive(@Param("cutoff") LocalDateTime cutoff);
  }
  ```

  ------

  ### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

  | í•­ëª©         | ì„¤ëª…                                                        |
  | ------------ | ----------------------------------------------------------- |
  | Query Method | ê°„ë‹¨í•œ ì¡°ê±´ ì¿¼ë¦¬ëŠ” ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œ ì²˜ë¦¬                   |
  | `@Query`     | ë³µì¡í•œ ì¡°ê±´, ë‹¤ì¤‘ ì¡°ì¸, native SQLì´ í•„ìš”í•  ë•Œ ì‚¬ìš©         |
  | ì„ íƒ ê¸°ì¤€    | **ë‹¨ìˆœ = Query Method**, **ë³µì¡ = @Query or QueryDSL**      |
  | ì •ë ¬/í˜ì´ì§•  | Pageable í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥                                     |
  | ì„±ëŠ¥ ìµœì í™”  | ë°˜ë“œì‹œ ì‹¤í–‰ SQLì„ ë¡œê·¸ë¡œ í™•ì¸ (`spring.jpa.show-sql: true`) |

## í˜ì´ì§•ê³¼ ì •ë ¬

### ğŸ§© 1. í˜ì´ì§•(Paging)ì´ë€?

> ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜¤ì§€ ì•Šê³ ,
>  í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•œ **íŠ¹ì • í˜ì´ì§€(ë²”ìœ„)**ë§Œí¼ë§Œ ì¡°íšŒí•˜ëŠ” ê¸°ë²•

------

### ğŸ“¦ 2. ì •ë ¬(Sorting)ì´ë€?

> ë°ì´í„°ë¥¼ **ì§€ì •í•œ ê¸°ì¤€(í•„ë“œ)**ì— ë”°ë¼ **ì˜¤ë¦„ì°¨ìˆœ / ë‚´ë¦¼ì°¨ìˆœ** ì •ë ¬í•˜ì—¬ ê°€ì ¸ì˜¤ëŠ” ê¸°ëŠ¥

------

### ğŸ“ 3. í•µì‹¬ ì¸í„°í˜ì´ìŠ¤

#### âœ… `Pageable`

- ìš”ì²­ ì •ë³´ë¥¼ ë‹´ëŠ” ê°ì²´
- í˜ì´ì§€ ë²ˆí˜¸, í˜ì´ì§€ í¬ê¸°, ì •ë ¬ ì •ë³´ë¥¼ í¬í•¨

```
PageRequest.of(í˜ì´ì§€ë²ˆí˜¸, í˜ì´ì§€í¬ê¸°, Sort)
```

- **í˜ì´ì§€ ë²ˆí˜¸ëŠ” 0ë¶€í„° ì‹œì‘!**

#### âœ… `Page<T>`

- ì¡°íšŒ ê²°ê³¼ë¥¼ ë‹´ëŠ” ê°ì²´
- ì´ í˜ì´ì§€ ìˆ˜, í˜„ì¬ í˜ì´ì§€, ì „ì²´ ë°ì´í„° ê°œìˆ˜ ë“±ì˜ **ë©”íƒ€ ì •ë³´ í¬í•¨**

------

### ğŸ’¡ 4. ë¦¬í¬ì§€í† ë¦¬ ì‚¬ìš© ì˜ˆì‹œ

```
public interface UserRepository extends JpaRepository<User, Long> {

    Page<User> findByStatus(Status status, Pageable pageable);
}
```

------

### ğŸ“˜ 5. ì»¨íŠ¸ë¡¤ëŸ¬ ì½”ë“œ ì˜ˆì‹œ

```
@GetMapping("/users")
public Page<User> getUsers(
    @RequestParam(defaultValue = "0") int page,
    @RequestParam(defaultValue = "10") int size,
    @RequestParam(defaultValue = "createdDate,desc") String[] sort
) {
    Pageable pageable = PageRequest.of(page, size, Sort.by(sortDirection(sort), sortField(sort)));
    return userRepository.findByStatus(Status.ACTIVE, pageable);
}

private Sort.Direction sortDirection(String[] sort) {
    return sort.length > 1 && sort[1].equalsIgnoreCase("asc") ? Sort.Direction.ASC : Sort.Direction.DESC;
}

private String sortField(String[] sort) {
    return sort[0];
}
```

------

### ğŸ§ª 6. ì •ì  í˜ì´ì§• ì˜ˆì‹œ

```
Pageable pageable = PageRequest.of(0, 20, Sort.by("name").ascending());
Page<User> page = userRepository.findByStatus(Status.ACTIVE, pageable);

List<User> content = page.getContent();      // í˜„ì¬ í˜ì´ì§€ ë°ì´í„°
int totalPages = page.getTotalPages();       // ì´ í˜ì´ì§€ ìˆ˜
long totalElements = page.getTotalElements(); // ì „ì²´ ë°ì´í„° ìˆ˜
boolean isFirst = page.isFirst();            // ì²« í˜ì´ì§€ ì—¬ë¶€
```

------

### ğŸ“Š 7. ì •ë ¬ ì˜ˆì‹œ

```
Sort.by("name").ascending()
Sort.by("createdDate").descending()
Sort.by(Sort.Order.asc("age"), Sort.Order.desc("createdDate"))
```

------

### ğŸ§¬ 8. ì»¤ìŠ¤í…€ ì •ë ¬ê³¼ DTO ë§¤í•‘

```
@Query("SELECT new com.example.dto.UserDto(u.name, u.email) FROM User u WHERE u.status = :status")
Page<UserDto> findDtoByStatus(@Param("status") Status status, Pageable pageable);
```

> `Page<T>`ëŠ” DTOì—ë„ ì ìš© ê°€ëŠ¥. ë‹¨, `SELECT new ...` êµ¬ë¬¸ ì‚¬ìš©

------

### âš ï¸ 9. ì£¼ì˜ì‚¬í•­

| í•­ëª©                         | ì£¼ì˜í•  ì                                                  |
| ---------------------------- | --------------------------------------------------------- |
| í˜ì´ì§€ ë²ˆí˜¸                  | 0ë¶€í„° ì‹œì‘ (1 ì•„ë‹˜!)                                      |
| ì •ë ¬ í•„ë“œëª… ì˜¤íƒ€             | ëŸ°íƒ€ì„ ì˜ˆì™¸ ë°œìƒ (ì£¼ì˜)                                   |
| `Page<User>` vs `List<User>` | `Page`ëŠ” í˜ì´ì§• ë©”íƒ€ í¬í•¨, `List`ëŠ” ë‹¨ìˆœ ë°ì´í„°           |
| Count ì¿¼ë¦¬                   | `Page` ë°˜í™˜ ì‹œ **ìë™ìœ¼ë¡œ count ì¿¼ë¦¬ ì‹¤í–‰ë¨** (ì„±ëŠ¥ ê³ ë ¤) |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| í•­ëª©        | ì„¤ëª…                                                         |
| ----------- | ------------------------------------------------------------ |
| `Pageable`  | ìš”ì²­ ì •ë³´ (page, size, sort)                                 |
| `Page<T>`   | ì‘ë‹µ ê²°ê³¼ + ë©”íƒ€ ë°ì´í„°                                      |
| ì •ë ¬ ë°©ë²•   | `Sort.by("field").ascending()`                               |
| ì‹¤ë¬´ ì¶”ì²œ   | `Page<T>` + DTO projection + ì •ë ¬ í•„ë“œ ê²€ì¦                  |
| JPA ì¡°ì¸ ì‹œ | ë°˜ë“œì‹œ `DISTINCT`, `countQuery` ë³„ë„ ì§€ì • í•„ìš” (í˜ì´ì§• ê¹¨ì§ˆ ìˆ˜ ìˆìŒ) |

## Fetch ì „ëµ

- ## Lazy vs Eager

  ### ğŸ§© 1. ê°œë… ìš”ì•½

  | ë¡œë”© ë°©ì‹            | ì„¤ëª…                                               |
  | -------------------- | -------------------------------------------------- |
  | **Lazy(ì§€ì—° ë¡œë”©)**  | ê´€ê³„ëœ ì—”í‹°í‹°ë¥¼ **ì‹¤ì œ ì‚¬ìš©í•  ë•Œê¹Œì§€ ë¡œë”©ì„ ë¯¸ë£¸** |
  | **Eager(ì¦‰ì‹œ ë¡œë”©)** | **ì—”í‹°í‹°ê°€ ë¡œë”©ë  ë•Œ ì¦‰ì‹œ ê´€ê³„ ê°ì²´ë„ í•¨ê»˜ ë¡œë”©**  |

  ------

  ### ğŸ¯ 2. ì–¸ì œ ì‚¬ìš©ë˜ëŠ”ê°€?

  JPAì—ì„œ `@OneToMany`, `@ManyToOne`, `@OneToOne`, `@ManyToMany` ê´€ê³„ë¥¼ ì •ì˜í•  ë•Œ
   **ì—°ê´€ ì—”í‹°í‹°ë¥¼ ì–´ë–¤ ì‹œì ì— ë¡œë”©í• ì§€ë¥¼ ì •í•˜ëŠ” ì „ëµ**

  ------

  ### ğŸ§± 3. ê¸°ë³¸ ì„¤ì •

  | ê´€ê³„                        | ê¸°ë³¸ ë¡œë”© ë°©ì‹                       |
  | --------------------------- | ------------------------------------ |
  | `@ManyToOne`, `@OneToOne`   | **EAGER** (ì¦‰ì‹œ ë¡œë”©) â† ë¹„ì¶”ì²œ       |
  | `@OneToMany`, `@ManyToMany` | **LAZY** (ì§€ì—° ë¡œë”©) â† ê¸°ë³¸ê°’ì´ ì¢‹ìŒ |

  > ğŸ“Œ ì‹¤ë¬´ì—ì„  ëª¨ë“  ì—°ê´€ê´€ê³„ë¥¼ **LAZYë¡œ ëª…ì‹œì  ì„¤ì •**í•˜ëŠ” ê²ƒì´ ê°•ë ¥ ì¶”ì²œ

  ```
  @ManyToOne(fetch = FetchType.LAZY)
  private Team team;
  ```

  ------

  ### ğŸ“˜ 4. ì‹¤ì „ ì˜ˆì‹œ

  #### ì—”í‹°í‹°

  ```
  @Entity
  public class Member {
      @Id @GeneratedValue
      private Long id;
      private String name;
  
      @ManyToOne(fetch = FetchType.LAZY)  // â† ì—¬ê¸°!
      private Team team;
  }
  ```

  ```
  @Entity
  public class Team {
      @Id @GeneratedValue
      private Long id;
      private String name;
  }
  ```

  ------

  #### âœ” LAZY: ì§€ì—° ë¡œë”©

  ```
  Member member = entityManager.find(Member.class, 1L); // ì¿¼ë¦¬ 1ë²ˆ (memberë§Œ)
  Team team = member.getTeam(); // ì—¬ê¸°ì„œ ì¿¼ë¦¬ 1ë²ˆ ì¶”ê°€ ì‹¤í–‰ë¨
  ```

  ì´ 2ë²ˆ ì¿¼ë¦¬ ì‹¤í–‰:

  ```
  SELECT * FROM member WHERE id = 1;
  SELECT * FROM team WHERE id = ?; -- ì‹¤ì œ ì‚¬ìš©í•  ë•Œ ì‹¤í–‰ë¨
  ```

  ------

  #### âœ” EAGER: ì¦‰ì‹œ ë¡œë”©

  ```
  Member member = entityManager.find(Member.class, 1L); 
  ```

  â†’ ìë™ìœ¼ë¡œ ì¡°ì¸ ì¿¼ë¦¬ ì‹¤í–‰:

  ```
  SELECT m.*, t.* FROM member m
  LEFT JOIN team t ON m.team_id = t.id
  WHERE m.id = 1;
  ```

  ------

  ### ğŸ”¥ 5. N+1 ë¬¸ì œ (Lazy ë¡œë”© ë¶€ì‘ìš© ì˜ˆ)

  ```
  List<Member> members = memberRepository.findAll(); // member 10ê°œ ì¡°íšŒ
  
  for (Member m : members) {
      System.out.println(m.getTeam().getName()); // team 10ë²ˆ ì¡°íšŒ!
  }
  ```

  â†’ ì¿¼ë¦¬ 11ë²ˆ ì‹¤í–‰ (1 + 10)
   â¡ï¸ ì´ê²ƒì´ **N+1 ë¬¸ì œ**

  ------

  ### ğŸ’Š í•´ê²° ë°©ë²•

  | ë°©ë²•            | ì„¤ëª…                                                         |
  | --------------- | ------------------------------------------------------------ |
  | `JOIN FETCH`    | JPQLì—ì„œ Fetch Join ì‚¬ìš©                                     |
  | `@EntityGraph`  | ìŠ¤í”„ë§ ë°ì´í„° JPAì—ì„œ ê´€ê³„ í•„ë“œ ëª…ì‹œì  ë¡œë”©                  |
  | DTO Projection  | í•„ìš”í•œ í•„ë“œë§Œ ì¡°íšŒí•˜ëŠ” DTO ì¿¼ë¦¬ ì‚¬ìš©                         |
  | Batch Size ì„¤ì • | LAZY ë¡œë”© ì‹œ ì¼ê´„ ì¡°íšŒ (`hibernate.default_batch_fetch_size`) |

  ------

  ### ğŸ§  ì‹¤ë¬´ ì„¤ê³„ ì „ëµ

  | ì„¤ê³„ ê¸°ì¤€             | ê¶Œì¥ ë°©ì‹                                             |
  | --------------------- | ----------------------------------------------------- |
  | ëª¨ë“  ì—°ê´€ ê´€ê³„        | ê¸°ë³¸ì€ `LAZY`ë¡œ ëª…ì‹œ ì„¤ì •                             |
  | ë‹¨ì¼ ì¿¼ë¦¬ë¡œ ì¡°ì¸ ì¡°íšŒ | `fetch join`, `@EntityGraph`                          |
  | ì¡°íšŒ ì „ìš© DTO API     | ì§ì ‘ `JPQL`, `QueryDSL`, `native` ì¿¼ë¦¬ë¡œ í•„ë“œë§Œ ì¡°íšŒ  |
  | ì–‘ë°©í–¥ ê´€ê³„           | ë¬´ì¡°ê±´ `LAZY`, ìˆœí™˜ ì°¸ì¡° ì£¼ì˜ (`toString()`, JSON ë“±) |

  ------

  ### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½í‘œ

  | í•­ëª©      | Lazy                     | Eager                  |
  | --------- | ------------------------ | ---------------------- |
  | ì •ì˜      | ì‹¤ì œ ì ‘ê·¼ ì‹œ ë¡œë”©        | ì¦‰ì‹œ ë¡œë”©              |
  | ê¸°ë³¸ ì ìš© | `@OneToMany` ë“±          | `@ManyToOne` ë“± (ì£¼ì˜) |
  | ì¥ì       | ì„±ëŠ¥ ìµœì í™”, ì„ íƒì  ë¡œë”© | í¸ë¦¬í•¨ (ì´ˆë³´ììš©)      |
  | ë‹¨ì       | N+1 ë¬¸ì œ ê°€ëŠ¥            | ë¶ˆí•„ìš”í•œ ì¡°ì¸ ê³¼ë‹¤     |
  | ì‹¤ë¬´ ê¶Œì¥ | âœ… ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©          | âŒ ì˜ë„ì ìœ¼ë¡œë§Œ ì‚¬ìš©    |

## ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸

### ğŸ§© 1. ì •ì˜

> **ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥(persist)í•˜ëŠ” í™˜ê²½**ì´ë©°,
>  **1ì°¨ ìºì‹œ, ë³€ê²½ ê°ì§€, íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë“±**ì„ ë‹´ë‹¹í•˜ëŠ” **JPA ë‚´ë¶€ ë©”ëª¨ë¦¬ ê³µê°„**

#### ğŸ“Œ í‚¤ì›Œë“œ:

- ë©”ëª¨ë¦¬ìƒì˜ DB ìœ ì‚¬ êµ¬ì¡°
- ì—”í‹°í‹°ì˜ **ìƒíƒœë¥¼ ì¶”ì í•˜ê³  ìºì‹œ**í•¨
- í•˜ë‚˜ì˜ `EntityManager`ì— 1ê°œì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ í• ë‹¹ë¨

------

### ğŸ”„ 2. ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸°ì™€ ìƒíƒœ

| ìƒíƒœ                  | ì„¤ëª…                                                         |
| --------------------- | ------------------------------------------------------------ |
| **ë¹„ì˜ì† (new)**      | ê°ì²´ë§Œ ìƒì„±í–ˆì§€ë§Œ JPAê°€ ê´€ë¦¬í•˜ì§€ ì•ŠìŒ                        |
| **ì˜ì† (managed)**    | `persist()` í˜¸ì¶œ í›„ JPAê°€ ìƒíƒœ ì¶”ì                           |
| **ì¤€ì˜ì† (detached)** | ì˜ì† ìƒíƒœì˜€ì§€ë§Œ ë” ì´ìƒ ê´€ë¦¬ë˜ì§€ ì•ŠìŒ (`detach`, `clear`, `close`) |
| **ì‚­ì œ (removed)**    | `remove()`ë¡œ ì‚­ì œ ì˜ˆì • ìƒíƒœ                                  |

------

### âš™ï¸ 3. ì£¼ìš” ê¸°ëŠ¥ ì •ë¦¬

| ê¸°ëŠ¥                         | ì„¤ëª…                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| âœ… 1ì°¨ ìºì‹œ                   | DBì—ì„œ ë¶ˆëŸ¬ì˜¨ ì—”í‹°í‹°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ì—¬ ì¬ì¡°íšŒ ì‹œ ì¬ì‚¬ìš©    |
| âœ… ë™ì¼ì„± ë³´ì¥                | ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ê°™ì€ IDì˜ ì—”í‹°í‹°ëŠ” í•­ìƒ **ê°™ì€ ê°ì²´(==)** |
| âœ… ë³€ê²½ ê°ì§€ (Dirty Checking) | ì—”í‹°í‹° í•„ë“œê°€ ë³€ê²½ë˜ë©´ ìë™ìœ¼ë¡œ `UPDATE` ì‹¤í–‰                |
| âœ… ì§€ì—°ì“°ê¸° (Flush)           | íŠ¸ëœì­ì…˜ ì¢…ë£Œ ì§ì „ê¹Œì§€ SQL ì‹¤í–‰ ì§€ì—°, ëª¨ì•„ì„œ DB ë°˜ì˜         |
| âœ… ì“°ê¸° ì§€ì—° ì €ì¥ì†Œ           | `persist()` í•´ë„ ë°”ë¡œ INSERTë˜ì§€ ì•Šê³ , ì»¤ë°‹ ì‹œ ì¼ê´„ ì²˜ë¦¬ë¨   |

------

### ğŸ§  4. ë™ì‘ íë¦„ ì˜ˆì œ

```
@Transactional
public void updateUser(Long id) {
    User user = entityManager.find(User.class, id); // 1. ì¡°íšŒ â†’ 1ì°¨ ìºì‹œì— ì €ì¥
    user.setName("ë³€ê²½ëœ ì´ë¦„");                      // 2. ìƒíƒœ ë³€ê²½ ê°ì§€
    // 3. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ flush â†’ update ì¿¼ë¦¬ ìë™ ì‹¤í–‰
}
```

â¡ï¸ ê°œë°œìëŠ” update ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì•„ë„,
 JPAê°€ **ë³€ê²½ëœ í•„ë“œë¥¼ ë¹„êµí•´ì„œ SQLì„ ìë™ ìƒì„±**í•´ì¤Œ.

------

### ğŸ’» 5. 1ì°¨ ìºì‹œ ì‹¤ì „ ì˜ˆ

```
User u1 = em.find(User.class, 1L); // DB ì¡°íšŒ â†’ 1ì°¨ ìºì‹œì— ì €ì¥
User u2 = em.find(User.class, 1L); // 1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒ, ì¿¼ë¦¬ X

System.out.println(u1 == u2); // true (ë™ì¼ ê°ì²´)
```

------

### ğŸ”¥ 6. flush(í”ŒëŸ¬ì‹œ)

> **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ì‚¬í•­ì„ DBì— ë°˜ì˜**í•˜ëŠ” ì‹œì 

| ì‹œì              | ì„¤ëª…                        |
| ---------------- | --------------------------- |
| íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ | ìë™ í˜¸ì¶œ (ê°€ì¥ ì¼ë°˜ì )     |
| JPQL ì‹¤í–‰ ì „     | ì¿¼ë¦¬ ì‹¤í–‰ ì „ì— ìë™ flush   |
| ëª…ì‹œì  í˜¸ì¶œ      | `em.flush()` ì§ì ‘ í˜¸ì¶œ ê°€ëŠ¥ |

â¡ï¸ flushëŠ” DBì— **ì“°ê¸°ë§Œ ì‹¤í–‰**í•˜ê³ , íŠ¸ëœì­ì…˜ì€ ì—¬ì „íˆ **ì—´ë ¤ ìˆìŒ**

------

### ğŸ§± 7. `detach`, `clear`, `close`

| ë©”ì„œë“œ              | ê¸°ëŠ¥                                      |
| ------------------- | ----------------------------------------- |
| `em.detach(entity)` | íŠ¹ì • ì—”í‹°í‹°ë§Œ ì¤€ì˜ì†í™”                    |
| `em.clear()`        | ëª¨ë“  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë¹„ìš°ê¸°               |
| `em.close()`        | ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ (EntityManager ì†Œë©¸) |

------

### âš ï¸ 8. ì‹¤ë¬´ì—ì„œ ì£¼ì˜í•  ì 

| í•­ëª©                                     | ì„¤ëª…                                                         |
| ---------------------------------------- | ------------------------------------------------------------ |
| `em.find()` vs `em.getReference()`       | ì „ìëŠ” ì¦‰ì‹œ ë¡œë”©, í›„ìëŠ” í”„ë¡ì‹œ (Lazy)                       |
| ë³€ê²½ ê°ì§€ëŠ” ì˜ì† ìƒíƒœì—ì„œë§Œ              | ì¤€ì˜ì† ê°ì²´ëŠ” ì¶”ì  ë¶ˆê°€                                      |
| ë™ì¼ì„± ë³´ì¥ = ì„±ëŠ¥ ë³´ì¥                  | ê°™ì€ ê°ì²´ëŠ” ì¬ì¡°íšŒ ì—†ì´ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥                       |
| ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” íŠ¸ëœì­ì…˜ ë‹¨ìœ„ë¡œ ê´€ë¦¬   | Springì—ì„œ `@Transactional`ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‹¨ìœ„ ì˜ë¯¸ë„ í¬í•¨ |
| `flush()`ëŠ” ì“°ê¸°ë§Œ, `commit`ì´ ì§„ì§œ ë°˜ì˜ | ë‹¨ìˆœ flushë§Œìœ¼ë¡œ íŠ¸ëœì­ì…˜ ì¢…ë£Œë˜ì§€ ì•ŠìŒ                      |

------

### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½í‘œ

| ê°œë…            | ì„¤ëª…                                          |
| --------------- | --------------------------------------------- |
| ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ | ì—”í‹°í‹°ë¥¼ ì¶”ì í•˜ê³  ì €ì¥í•˜ëŠ” JPA ë‚´ë¶€ ë©”ëª¨ë¦¬    |
| 1ì°¨ ìºì‹œ        | ê°™ì€ ì—”í‹°í‹° ID ì¡°íšŒ ì‹œ ë©”ëª¨ë¦¬ì—ì„œ ë°˜í™˜        |
| ë³€ê²½ ê°ì§€       | Setterë¡œ ê°’ ë°”ê¾¸ë©´ flush ì‹œ ìë™ update       |
| flush           | ë³€ê²½ ë‚´ìš© DB ë°˜ì˜ (SQL ì‹¤í–‰), íŠ¸ëœì­ì…˜ ìœ ì§€ë¨ |
| ë™ì¼ì„± ë³´ì¥     | ê°™ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ `user == user` í•­ìƒ true |
| ìƒëª…ì£¼ê¸°        | new â†’ persist() â†’ managed â†’ detach/remove     |

## íŠ¸ëœì­ì…˜ ì²˜ë¦¬

- ## `@Transactional`

  ### ğŸ§© 1. ì •ì˜

  > Spring Frameworkì—ì„œ ì œê³µí•˜ëŠ” **ì„ ì–¸ì  íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ì–´ë…¸í…Œì´ì…˜**
  >  ë©”ì„œë“œë‚˜ í´ë˜ìŠ¤ì— ì„ ì–¸í•˜ë©´, í•´ë‹¹ ë²”ìœ„ë¥¼ **í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ ë‹¨ìœ„**ë¡œ ì‹¤í–‰í•¨

  ì¦‰,

  - ë©”ì„œë“œ ì§„ì… â†’ íŠ¸ëœì­ì…˜ ì‹œì‘
  - ì •ìƒ ì¢…ë£Œ â†’ `commit()`
  - ì˜ˆì™¸ ë°œìƒ â†’ `rollback()`
     ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤Œ.

  ------

  ### ğŸ¯ 2. ë™ì‘ ë²”ìœ„

  | ì„ ì–¸ ìœ„ì¹˜ | ì ìš© ëŒ€ìƒ                       |
  | --------- | ------------------------------- |
  | í´ë˜ìŠ¤    | í´ë˜ìŠ¤ì˜ **ëª¨ë“  public ë©”ì„œë“œ** |
  | ë©”ì„œë“œ    | í•´ë‹¹ ë©”ì„œë“œë§Œ íŠ¸ëœì­ì…˜ ì ìš©     |

  ```
  @Transactional
  public class OrderService {
      public void placeOrder() {} // íŠ¸ëœì­ì…˜ O
  }
  ```

  ------

  ### âš™ï¸ 3. ì£¼ìš” ì†ì„±

  | ì†ì„±          | ê¸°ë³¸ê°’           | ì„¤ëª…                                   |
  | ------------- | ---------------- | -------------------------------------- |
  | `propagation` | REQUIRED         | ì „íŒŒ ë°©ì‹: ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ ì°¸ì—¬ |
  | `isolation`   | DEFAULT          | DB ê²©ë¦¬ ìˆ˜ì¤€                           |
  | `readOnly`    | false            | ì½ê¸° ì „ìš© ìµœì í™”                       |
  | `rollbackFor` | RuntimeException | ì–´ë–¤ ì˜ˆì™¸ì— ëŒ€í•´ ë¡¤ë°±í• ì§€ ì§€ì •         |
  | `timeout`     | -1 (ë¬´ì œí•œ)      | ì œí•œ ì‹œê°„ ì´ˆê³¼ ì‹œ ë¡¤ë°±                 |

  ------

  ### ğŸ” 4. íŠ¸ëœì­ì…˜ ì „íŒŒ(propagation)

  | ê°’              | ì„¤ëª…                                                      |
  | --------------- | --------------------------------------------------------- |
  | `REQUIRED`      | í˜„ì¬ íŠ¸ëœì­ì…˜ ì¡´ì¬ ì‹œ ì°¸ì—¬, ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„± (**ê¸°ë³¸ê°’**) |
  | `REQUIRES_NEW`  | ê¸°ì¡´ íŠ¸ëœì­ì…˜ **ì¤‘ë‹¨** í›„ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ ìƒì„±            |
  | `MANDATORY`     | ë°˜ë“œì‹œ íŠ¸ëœì­ì…˜ ìˆì–´ì•¼ í•¨, ì—†ìœ¼ë©´ ì˜ˆì™¸                    |
  | `NESTED`        | SavePointë¡œ í•˜ìœ„ íŠ¸ëœì­ì…˜ ìƒì„± (JDBC í•„ìš”)                |
  | `NEVER`         | íŠ¸ëœì­ì…˜ ìˆìœ¼ë©´ ì˜ˆì™¸                                      |
  | `SUPPORTS`      | íŠ¸ëœì­ì…˜ ìˆìœ¼ë©´ ì°¸ì—¬, ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì‹¤í–‰                    |
  | `NOT_SUPPORTED` | íŠ¸ëœì­ì…˜ ì—†ì´ ì‹¤í–‰ (ì¤‘ë‹¨ í›„ ë¹„íŠ¸ëœì­ì…˜ ì‹¤í–‰)              |

  ------

  ### ğŸ§ª 5. ì˜ˆì œ

  ```
  @Transactional
  public void transferMoney(Account from, Account to, int amount) {
      from.decrease(amount);  // ë³€ê²½ ê°ì§€
      to.increase(amount);    // ë³€ê²½ ê°ì§€
      // íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ update ìë™ ë°œìƒ
  }
  ```

  ------

  ### ğŸ” 6. ì˜ˆì™¸ì— ë”°ë¥¸ ë¡¤ë°± ê·œì¹™

  | ì˜ˆì™¸ íƒ€ì…           | ë¡¤ë°± ì—¬ë¶€ (ê¸°ë³¸) |
  | ------------------- | ---------------- |
  | `RuntimeException`  | âœ… ë¡¤ë°±ë¨         |
  | `Error`             | âœ… ë¡¤ë°±ë¨         |
  | `Checked Exception` | âŒ ì»¤ë°‹ë¨         |

  > ğŸ“Œ Checked Exceptionë„ ë¡¤ë°±í•˜ë ¤ë©´ `rollbackFor` ëª…ì‹œí•´ì•¼ í•¨:

  ```
  @Transactional(rollbackFor = Exception.class)
  ```

  ------

  ### ğŸ” 7. ë‚´ë¶€ ë™ì‘ êµ¬ì¡° (í”„ë¡ì‹œ ê¸°ë°˜ AOP)

  - Springì€ `@Transactional`ì´ ë¶™ì€ ê°ì²´ë¥¼ **í”„ë¡ì‹œë¡œ ê°ì‹¸ê³ **,
     íŠ¸ëœì­ì…˜ ì‹œì‘/ì¢…ë£Œ/ë¡¤ë°±ì„ ìë™ ì‚½ì…í•¨.
  - ì´ë•Œ, **ê°™ì€ í´ë˜ìŠ¤ ë‚´ ë©”ì„œë“œ í˜¸ì¶œì€ íŠ¸ëœì­ì…˜ ì ìš©ë˜ì§€ ì•ŠìŒ** (í”„ë¡ì‹œ ìš°íšŒ)

  ```
  // íŠ¸ëœì­ì…˜ ì ìš© âŒ
  this.innerMethod();
  ```

  > âœ… í•´ê²° ë°©ë²•: ë©”ì„œë“œë¥¼ ë‹¤ë¥¸ Beanìœ¼ë¡œ ë¶„ë¦¬ or ìê¸° ìì‹ ì„ ì£¼ì…

  ------

  ### âš ï¸ 8. ì‹¤ë¬´ ì£¼ì˜ì‚¬í•­ ìš”ì•½

  | í•­ëª©                                         | ì„¤ëª…                                             |
  | -------------------------------------------- | ------------------------------------------------ |
  | `private` ë©”ì„œë“œ âŒ                           | í”„ë¡ì‹œ ì ìš© ì•ˆ ë¨                                |
  | `self-invocation` âŒ                          | ê°™ì€ í´ë˜ìŠ¤ ì•ˆì—ì„œ ë‚´ë¶€ í˜¸ì¶œí•˜ë©´ íŠ¸ëœì­ì…˜ ë¬´ì‹œë¨ |
  | `readOnly=true`                              | SELECT ì „ìš© ë©”ì„œë“œì—ë§Œ ì§€ì • â†’ flush ìµœì í™”       |
  | `@Transactional`ì€ Service Layer ì¤‘ì‹¬ì— ì„ ì–¸ | Controller/Repositoryì— ì„ ì–¸ ì§€ì–‘                |

  ------

  ### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

  | í•­ëª©        | ì„¤ëª…                                                  |
  | ----------- | ----------------------------------------------------- |
  | ì •ì˜        | ì„ ì–¸ì  íŠ¸ëœì­ì…˜ ê²½ê³„ ì§€ì •                             |
  | ë™ì‘ ì‹œì    | ë©”ì„œë“œ ì§„ì… ì‹œ íŠ¸ëœì­ì…˜ ì‹œì‘, ì¢…ë£Œ ì‹œ commit/rollback |
  | ë¡¤ë°± ëŒ€ìƒ   | ê¸°ë³¸ì€ RuntimeException, ëª…ì‹œì ìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥         |
  | readOnly    | SELECT ì „ìš© ë©”ì„œë“œì— flush ìµœì†Œí™” ì ìš©                |
  | ë‚´ë¶€ í˜¸ì¶œ âŒ | í”„ë¡ì‹œ êµ¬ì¡°ë¡œ ì¸í•´ ìš°íšŒë˜ë¯€ë¡œ ì£¼ì˜                    |
  | ê¶Œì¥ ìœ„ì¹˜   | Service ê³„ì¸µì—ì„œ ì‚¬ìš©, í•µì‹¬ ìœ ìŠ¤ì¼€ì´ìŠ¤ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ê¸°  |

## N+1 ë¬¸ì œì™€ í•´ê²° ì „ëµ

- ## Fetch Join

  ### ğŸ§© 1. Fetch Joinì´ë€?

  > JPAì—ì„œ **ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ í•¨ê»˜ ë¡œë”©**í•˜ê¸° ìœ„í•œ
  >  **JPQLì˜ ì¡°ì¸ ë°©ì‹** ì¤‘ í•˜ë‚˜

  ğŸ“Œ ë‹¨ìˆœí•œ **JOIN**ê³¼ëŠ” ë‹¤ë¥´ê²Œ,
   **ì—°ê´€ ì—”í‹°í‹°ê¹Œì§€ í•œ ë²ˆì— ê°€ì ¸ì˜¤ë©° ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— í•¨ê»˜ ì €ì¥**í•¨

  ------

  ### ğŸ”„ 2. ê¸°ë³¸ JOIN vs FETCH JOIN

  | êµ¬ë¶„            | JOIN                                         | FETCH JOIN                         |
  | --------------- | -------------------------------------------- | ---------------------------------- |
  | ëª©ì             | ì¡°ì¸ ì¡°ê±´ì—ë§Œ ì‚¬ìš© (ì¡°íšŒ ëŒ€ìƒì€ ë£¨íŠ¸ ì—”í‹°í‹°) | ì—°ê´€ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ê³  ì˜ì†í™” |
  | ì—°ê´€ ê°ì²´ ë¡œë”©  | âŒ                                            | âœ…                                  |
  | 1ì°¨ ìºì‹œì— ë“±ë¡ | âŒ (ë£¨íŠ¸ë§Œ)                                   | âœ… (ë£¨íŠ¸ + ì—°ê´€ ëª¨ë‘)               |
  | N+1 í•´ê²°        | âŒ                                            | âœ…                                  |

  ------

  ### ğŸ§± 3. ì˜ˆì‹œ ì—”í‹°í‹°

  ```
  @Entity
  public class Member {
      @Id @GeneratedValue
      private Long id;
  
      private String name;
  
      @ManyToOne(fetch = FetchType.LAZY)
      private Team team;
  }
  ```

  ------

  ### ğŸ“˜ 4. Fetch Join ì˜ˆì œ

  ```
  @Query("SELECT m FROM Member m JOIN FETCH m.team")
  List<Member> findAllWithTeam();
  ```

  â†’ ì‹¤í–‰ë˜ëŠ” JPQL â†’ SQL ë³€í™˜ ì˜ˆì‹œ:

  ```
  SELECT m.*, t.*
  FROM member m
  JOIN team t ON m.team_id = t.id;
  ```

  âœ… ê²°ê³¼:

  - `Member`ì™€ `Team` ëª¨ë‘ **í•œ ë²ˆì— ë¡œë”©**
  - `member.getTeam()` í˜¸ì¶œ ì‹œ **ì¶”ê°€ ì¿¼ë¦¬ ì—†ìŒ**

  ------

  ### âŒ 5. Fetch Joinì´ ì—†ì„ ë•Œ (N+1 ë¬¸ì œ ë°œìƒ)

  ```
  List<Member> members = memberRepository.findAll(); // ì¿¼ë¦¬ 1ë²ˆ
  
  for (Member m : members) {
      System.out.println(m.getTeam().getName()); // ì¿¼ë¦¬ Në²ˆ ì¶”ê°€ ë°œìƒ!
  }
  ```

  â¡ï¸ ì´ `1 + N`ë²ˆì˜ ì¿¼ë¦¬ ì‹¤í–‰
   â¡ï¸ ì„±ëŠ¥ ì €í•˜ ì‹¬ê° â†’ ë°˜ë“œì‹œ **Fetch Join ë˜ëŠ” DTO ì¡°íšŒ**ë¡œ í•´ê²°í•´ì•¼ í•¨

  ------

  ### ğŸ” 6. ë‹¤ëŒ€ì¼ / ì¼ëŒ€ë‹¤ Fetch Join

  #### âœ… ë‹¤ëŒ€ì¼ (`@ManyToOne`) â†’ OK

  ```
  @Query("SELECT m FROM Member m JOIN FETCH m.team")
  List<Member> findAllWithTeam();
  ```

  â†’ ë‹¤ìˆ˜ì˜ Memberì— ëŒ€í•´ ê°ê° 1ê°œì˜ Teamë§Œ ì—°ê²°ë˜ë¯€ë¡œ ì¤‘ë³µ ì—†ìŒ

  ------

  #### âš ï¸ ì¼ëŒ€ë‹¤ (`@OneToMany`) â†’ ì£¼ì˜!

  ```
  @Query("SELECT t FROM Team t JOIN FETCH t.members")
  List<Team> findAllWithMembers();
  ```

  â†’ `Team`ì´ ì—¬ëŸ¬ `Member`ì™€ ë§¤í•‘ë  ê²½ìš°, **Team ê°ì²´ê°€ ì¤‘ë³µ ì¡°íšŒ**ë¨

  â¡ï¸ í•´ê²° ë°©ë²•:

  - `DISTINCT` í‚¤ì›Œë“œ ì‚¬ìš©
  - í˜ì´ì§• ë¶ˆê°€ëŠ¥ (DBì—ì„œ join í›„ ë©”ëª¨ë¦¬ì—ì„œ í˜ì´ì§•ë¨)

  ------

  ### âš ï¸ 7. í˜ì´ì§•ê³¼ Fetch Join

  | ìƒí™©                      | ì²˜ë¦¬ ë°©ë²•                                                    |
  | ------------------------- | ------------------------------------------------------------ |
  | ë‹¨ì¼ ì—”í‹°í‹° í˜ì´ì§•        | ë¬¸ì œ ì—†ìŒ                                                    |
  | `@OneToMany` + Fetch Join | âŒ í˜ì´ì§• ê¹¨ì§ (in-memory ì²˜ë¦¬ë¨)                             |
  | í•´ê²°ì±…                    | **Batch Size ì„¤ì •**, **DTO ì§ì ‘ ì¡°íšŒ**, **ë‹¤ë‹¨ê³„ ì¡°íšŒ ë¶„ë¦¬** |

  ------

  ### âœ… 8. ì‹¤ë¬´ ì •ë¦¬

  | ìš©ë„                         | Fetch Join ì—¬ë¶€                     |
  | ---------------------------- | ----------------------------------- |
  | ì—°ê´€ ì—”í‹°í‹°ë¥¼ ìì£¼ ë³´ì—¬ì¤„ ë•Œ | âœ… Fetch Joinìœ¼ë¡œ í•œ ë²ˆì— ì¡°íšŒ       |
  | ë‹¨ìˆœ ID ì¡°íšŒ                 | âŒ Lazy ê·¸ëŒ€ë¡œ ë‘ê¸°                  |
  | í˜ì´ì§• + OneToMany           | âŒ Fetch Join ëŒ€ì‹  DTO or Batch Size |
  | readOnly API                 | DTO í”„ë¡œì ì…˜ or QueryDSL preferred  |

  ------

  ### ğŸ”¥ 9. Fetch Join vs EntityGraph vs Lazy ë¹„êµ

  | í•­ëª©                | Fetch Join    | `@EntityGraph`         | Lazy (ê¸°ë³¸) |
  | ------------------- | ------------- | ---------------------- | ----------- |
  | ì œì–´ ìœ„ì¹˜           | JPQL          | Repository ë©”ì„œë“œ ì„ ì–¸ | ì—”í‹°í‹° í•„ë“œ |
  | ì¡°ì¸ ì¿¼ë¦¬ ì§ì ‘ ì‘ì„± | âœ…             | âŒ                      | âŒ           |
  | N+1 í•´ê²°            | âœ…             | âœ…                      | âŒ           |
  | í˜ì´ì§• í˜¸í™˜ì„±       | âŒ (OneToMany) | âŒ                      | âœ…           |
  | ê°€ì¥ ê°•ë ¥í•œ ì œì–´    | âœ…             | ì¤‘ê°„                   | ì•½í•¨        |

  ------

  ### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½í‘œ

  | í•­ëª©      | ì„¤ëª…                                                   |
  | --------- | ------------------------------------------------------ |
  | ì •ì˜      | ì—°ê´€ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ë¡œë”©í•˜ëŠ” JPQL ì¡°ì¸ ë°©ì‹             |
  | ì¥ì       | N+1 ë¬¸ì œ í•´ê²°, ì„±ëŠ¥ ìµœì í™”                             |
  | ë‹¨ì       | í˜ì´ì§• ë¶ˆê°€, ì¤‘ë³µ ë°ì´í„° ê°€ëŠ¥ì„±                        |
  | ì‚¬ìš© ì‹œì  | Lazy + Fetch Joinìœ¼ë¡œ í•„ìš”í•œ ê²½ìš°ë§Œ ì¦‰ì‹œ ì¡°íšŒ          |
  | ì‹¤ë¬´ íŒ   | OneToManyëŠ” Fetch Join ì§€ì–‘ â†’ DTO or Batch Sizeë¡œ ëŒ€ì²´ |

- ## EntityGraph

  ### ğŸ§© 1. ì •ì˜

  > JPAì—ì„œ **ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ë¡œë”©í•  ë•Œ Fetch ì „ëµì„ ì •ì ìœ¼ë¡œ ë˜ëŠ” ë™ì ìœ¼ë¡œ ì§€ì •**í•  ìˆ˜ ìˆëŠ” ì–´ë…¸í…Œì´ì…˜

  ì¦‰, **JPQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì•„ë„**
   ì—°ê´€ í•„ë“œë¥¼ **ì§€ì—°ë¡œë”© â†’ ì¦‰ì‹œë¡œë”©(Fetch Joinì²˜ëŸ¼)** ë°”ê¿”ì£¼ëŠ” ê¸°ëŠ¥.

  ------

  ### ğŸ¯ 2. ì™œ ì‚¬ìš©í•˜ëŠ”ê°€?

  | ë¬¸ì œ                                   | í•´ê²°                                                   |
  | -------------------------------------- | ------------------------------------------------------ |
  | `LAZY`ë¡œ ì„¤ì •í•œ í•„ë“œì—ì„œ N+1 ë¬¸ì œ ë°œìƒ | `@EntityGraph`ë¡œ í•„ìš”í•œ ì—°ê´€ í•„ë“œë§Œ Fetch              |
  | Fetch Joinì€ JPQLì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥      | EntityGraphëŠ” **Repository ë©”ì„œë“œì— ì„ ì–¸ì  ì ìš© ê°€ëŠ¥** |
  | í˜ì´ì§• ì‹œ Fetch Joinì€ ê¹¨ì§            | EntityGraphëŠ” **í˜ì´ì§• ì§€ì›ë¨** (ë‹¨, ë‹¤ëŒ€ì¼ë§Œ)         |

  ------

  ### ğŸ“˜ 3. ì‚¬ìš© ë°©ë²•

  #### âœ… â‘  ê¸°ë³¸í˜•: ì†ì„± ê¸°ë°˜

  ```
  @Entity
  public class Member {
      @Id @GeneratedValue
      private Long id;
  
      private String name;
  
      @ManyToOne(fetch = FetchType.LAZY)
      private Team team;
  }
  ```

  ```
  @Repository
  public interface MemberRepository extends JpaRepository<Member, Long> {
  
      @EntityGraph(attributePaths = {"team"})
      List<Member> findAll(); // teamë„ í•¨ê»˜ ë¡œë”©ë¨
  }
  ```

  - `attributePaths`ëŠ” **LAZY í•„ë“œ ì´ë¦„ì„ ë¬¸ìì—´ë¡œ ëª…ì‹œ**
  - ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ **Member + Team**ì„ Join Fetchì²˜ëŸ¼ ê°€ì ¸ì˜´

  ------

  #### âœ… â‘¡ JPQL + EntityGraph

  ```
  @Query("SELECT m FROM Member m WHERE m.status = :status")
  @EntityGraph(attributePaths = {"team"})
  List<Member> findWithTeamByStatus(@Param("status") Status status);
  ```

  ------

  #### âœ… â‘¢ Named EntityGraph ì„ ì–¸í˜• (ë³µì¡í•œ ê²½ìš°)

  ```
  @Entity
  @NamedEntityGraph(
      name = "Member.withTeam",
      attributeNodes = @NamedAttributeNode("team")
  )
  public class Member { ... }
  ```

  ```
  @EntityGraph(value = "Member.withTeam")
  List<Member> findByStatus(Status status);
  ```

  ------

  ### ğŸ§  4. Fetch Join vs EntityGraph ë¹„êµ

  | í•­ëª©          | Fetch Join                          | EntityGraph                  |
  | ------------- | ----------------------------------- | ---------------------------- |
  | ì‚¬ìš© ìœ„ì¹˜     | JPQL ì¿¼ë¦¬ ë‚´ì—ì„œ ì§ì ‘               | Repository ë©”ì„œë“œ ì„ ì–¸ë¶€     |
  | ë™ì  ì œì–´     | âŒ                                   | âœ… (`attributePaths`)         |
  | í˜ì´ì§• í˜¸í™˜ì„± | âŒ (OneToMany ì‹œ ê¹¨ì§)               | âœ… (OneToOne, ManyToOne ê¸°ì¤€) |
  | ìœ ì§€ë³´ìˆ˜ì„±    | JPQLì— ì˜ì¡´                         | ì„ ì–¸ì ì´ê³  ê¹”ë”í•¨            |
  | ì‹¤ë¬´ ì í•©ì„±   | ë³µì¡ ì¡°ì¸, ìµœì  ì¿¼ë¦¬ ì§ì ‘ ì œì–´í•  ë•Œ | í˜ì´ì§• + ê°„ë‹¨ ì—°ê´€ ë¡œë”©í•  ë•Œ |

  ------

  ### ğŸ”¬ 5. EntityGraph ë™ì‘ ì˜ˆì‹œ

  ```
  // ë‚´ë¶€ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” SQL (Fetch Joinê³¼ ìœ ì‚¬)
  SELECT m.*, t.* 
  FROM member m
  LEFT JOIN team t ON m.team_id = t.id;
  ```

  â†’ í•˜ì§€ë§Œ **JPQL ì—†ì´**, ì˜¤ì§ ë©”ì„œë“œ ì„ ì–¸ë¶€ë§Œìœ¼ë¡œ ì´ ë™ì‘ì´ ê°€ëŠ¥

  ------

  ### âš ï¸ 6. ì‹¤ì „ ì£¼ì˜ì‚¬í•­

  | ì£¼ì˜                                                 | ì„¤ëª…                                           |
  | ---------------------------------------------------- | ---------------------------------------------- |
  | `attributePaths` ì˜¤íƒ€ ì£¼ì˜                           | í•„ë“œ ì´ë¦„ ë¬¸ìì—´ì´ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ íƒ€ì„ ê²€ì¦ âŒ |
  | ì»¬ë ‰ì…˜(`@OneToMany`)ì€ ì‚¬ìš© ì œí•œ                     | í˜ì´ì§•ê³¼ í•¨ê»˜ ì“°ë©´ ì•ˆ ë¨ (Fetch Joinê³¼ ë™ì¼)   |
  | ë³µì¡ ì¡°ì¸ì—ëŠ” í•œê³„ ìˆìŒ                              | ì´ë• JPQL + Fetch Join + DTO ì¡°ë¦½ ì¶”ì²œ         |
  | ë™ì  ì¿¼ë¦¬ì—ì„  `JpaSpecificationExecutor`ì™€ í†µí•© ê°€ëŠ¥ | QueryDSL ë˜ëŠ” Specificationìœ¼ë¡œ ì¡°ê±´ ë¶„ê¸° ê°€ëŠ¥ |

  ------

  ### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

  | í•­ëª©        | ì„¤ëª…                                         |
  | ----------- | -------------------------------------------- |
  | ì •ì˜        | ì—°ê´€ ì—”í‹°í‹°ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ Fetch Joinì²˜ëŸ¼ ë¡œë”© |
  | ëª©ì         | N+1 ë¬¸ì œ í•´ê²°, JPQL ì—†ëŠ” Fetch ì „ëµ ì§€ì •     |
  | ì‚¬ìš© ìœ„ì¹˜   | Repository ì¸í„°í˜ì´ìŠ¤ ë©”ì„œë“œì— ë¶™ì„          |
  | ì„±ëŠ¥        | Fetch Join ìˆ˜ì¤€ìœ¼ë¡œ ë¹ ë¦„ (í”„ë¡ì‹œ X)          |
  | í˜ì´ì§• ì§€ì› | âœ… (ë‹¨ì¼ ì—°ê´€ ê´€ê³„ì— í•œí•¨)                    |
  | ì¶”ì²œ ì‚¬ìš©   | ì¡°íšŒìš© API, í˜ì´ì§• ì²˜ë¦¬ ì‹œ ì—°ê´€ ì—”í‹°í‹° ë¡œë”©  |

- ## Batch Size

  ### ğŸ§© 1. ì •ì˜

  > JPAì—ì„œ `@ManyToOne`, `@OneToMany`, `@ElementCollection` ë“± **Lazy ë¡œë”© ì—°ê´€ ì»¬ë ‰ì…˜ì„ ë‹¤ìˆ˜ ì¡°íšŒí•  ë•Œ**,
  >  N+1 ë¬¸ì œë¥¼ **1 + 1 ì¿¼ë¦¬ë¡œ ì¤„ì´ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ íŠœë‹ ê¸°ë²•**

  ------

  ### ğŸ¯ 2. ì™œ ì‚¬ìš©í•˜ëŠ”ê°€?

  | ë¬¸ì œ      | ì„¤ëª…                                                        |
  | --------- | ----------------------------------------------------------- |
  | N+1 ë¬¸ì œ  | ë£¨íŠ¸ ì—”í‹°í‹° Nê°œ ì¡°íšŒ â†’ ì—°ê´€ ì—”í‹°í‹° Në²ˆ ì¶”ê°€ ì¡°íšŒ            |
  | Lazy ë¡œë”© | `@ManyToOne`, `@OneToMany`ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ LAZYë¡œ ì„¤ì • ì‹œ ë°œìƒ |
  | í•´ê²°ì±…    | `fetch join`, `EntityGraph`, ë˜ëŠ” â¡ï¸ **Batch Size**          |

  ------

  ### ğŸ§  3. ì‘ë™ ì›ë¦¬

  ```
  List<Member> members = memberRepository.findAll(); // 10ëª…
  ```

  ê° Memberì— ì—°ê´€ëœ Teamì´ Lazyì¼ ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì´ SQLì´ ì‹¤í–‰ë¨:

  ```
  SELECT * FROM member; -- 1íšŒ
  SELECT * FROM team WHERE id = 1; -- 10íšŒ
  ...
  ```

  â¡ï¸ ì´ 11íšŒ ì¿¼ë¦¬ (1 + N)

  ------

  âœ… **Batch Size ì„¤ì • ì‹œ**, ë‹¤ìŒì²˜ëŸ¼ ìµœì í™”ë¨:

  ```
  SELECT * FROM team WHERE id IN (1, 2, 3, 4, 5, ..., 10); -- ë”± 1íšŒ
  ```

  > Lazy ë¡œë”©ì´ì§€ë§Œ **JPAê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì»¬ë ‰ì…˜ì„ ëª¨ì•„ì„œ IN ì¿¼ë¦¬ë¡œ ì²˜ë¦¬**í•¨

  ------

  ### âš™ï¸ 4. ì„¤ì • ë°©ë²•

  #### âœ… â‘  ì „ì—­ ì„¤ì • (`application.yml`)

  ```
  spring:
    jpa:
      properties:
        hibernate.default_batch_fetch_size: 100
  ```

  #### âœ… â‘¡ ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ (JPA í‘œì¤€ì€ ì•„ë‹˜)

  ```
  @OneToMany(mappedBy = "member")
  @BatchSize(size = 50)
  private List<Order> orders;
  ```

  ```
  @ManyToOne(fetch = FetchType.LAZY)
  @BatchSize(size = 20)
  private Team team;
  ```

  > ğŸ“Œ ì–´ë…¸í…Œì´ì…˜ë³´ë‹¤ ì „ì—­ ì„¤ì •ì´ ì‹¤ë¬´ì—ì„œ ë” ë§ì´ ì‚¬ìš©ë¨

  ------

  ### ğŸ“˜ 5. ì‹¤ì „ ì˜ˆì‹œ

  ```
  List<Member> members = memberRepository.findAll(); // 10ëª…
  for (Member m : members) {
      System.out.println(m.getTeam().getName()); // Lazy Team ì¡°íšŒ
  }
  ```

  - `team_id` 10ê°œë¥¼ ë³´ê³ 
  - `SELECT * FROM team WHERE id IN (?, ?, ..., ?)` í•œ ë²ˆë§Œ ì‹¤í–‰ë¨

  ------

  ### ğŸ” 6. EntityGraph vs Batch Size

  | í•­ëª©      | EntityGraph                  | Batch Size                     |
  | --------- | ---------------------------- | ------------------------------ |
  | ì ‘ê·¼ ë°©ì‹ | ëª…ì‹œì  ì¡°ì¸                  | ì§€ì—° ë¡œë”© ìµœì í™”               |
  | ì‘ë™ ì‹œì  | ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ                 | Lazy í•„ë“œ ì ‘ê·¼ ì‹œ              |
  | í˜ì´ì§•    | âœ… ì‚¬ìš© ê°€ëŠ¥                  | âœ… ì‚¬ìš© ê°€ëŠ¥                    |
  | DTO ì¡°íšŒ  | âŒ                            | âŒ                              |
  | ì œì–´ë ¥    | ì •ì                          | ëŸ°íƒ€ì„ ë™ì                     |
  | ìš©ë„      | ìì£¼ ì¡°íšŒë˜ëŠ” í•„ë“œ ë¯¸ë¦¬ ë¡œë”© | Lazy í•„ë“œê°€ ë§ì„ ë•Œ N+1 ì¤„ì´ê¸° |

  ------

  ### âš ï¸ 7. ì£¼ì˜ì‚¬í•­

  | í•­ëª©                                                | ì„¤ëª…                               |
  | --------------------------------------------------- | ---------------------------------- |
  | ì»¬ë ‰ì…˜ í¬ê¸°ê°€ í¬ë©´ ë¹„íš¨ìœ¨                           | IN ì ˆì´ ì»¤ì ¸ì„œ ì„±ëŠ¥ ì €í•˜ ìš°ë ¤ ìˆìŒ |
  | ìë™ batchingì€ Lazy í•„ë“œì—ë§Œ                       | Eagerì—” ì ìš© âŒ                     |
  | Hibernate êµ¬í˜„ì²´ì— ì˜ì¡´                             | JPA í‘œì¤€ ì•„ë‹˜ (Hibernateë§Œ ì§€ì›)   |
  | ë‚´ë¶€ì ìœ¼ë¡œ `IN (...)`ì´ë¯€ë¡œ DB IN ì ˆ ì œí•œ í™•ì¸ í•„ìš” |                                    |

  ------

  ### âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

  | í•­ëª©      | ì„¤ëª…                                                 |
  | --------- | ---------------------------------------------------- |
  | ì •ì˜      | Lazy ì—°ê´€ í•„ë“œë¥¼ IN ì¿¼ë¦¬ë¡œ ì¼ê´„ ë¡œë”©                 |
  | ëŒ€ìƒ      | `@OneToMany`, `@ManyToOne`, `@ElementCollection`     |
  | ì„¤ì • ìœ„ì¹˜ | `hibernate.default_batch_fetch_size`                 |
  | íš¨ê³¼      | N+1 â†’ 1 + 1 ì¿¼ë¦¬ë¡œ ìµœì í™”                            |
  | ì‹¤ë¬´ íŒ   | Lazy ê¸°ë³¸ + EntityGraph or Batch Size í˜¼í•© ì‚¬ìš© ê¶Œì¥ |
  | ê¶Œì¥ í¬ê¸° | ì¼ë°˜ì ìœ¼ë¡œ 50~200 ì‚¬ì´ íŠœë‹ í•„ìš”                     |